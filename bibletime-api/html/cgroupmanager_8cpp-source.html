<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cgroupmanager.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cgroupmanager.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cgroupmanager.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Wed Jan 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#define BOOKMARK_FORMAT_VERSION 1</font>
00019 <font class="preprocessor"></font>
00020 
00021 <font class="comment">//own includes</font>
00022 <font class="preprocessor">#include "cgroupmanager.h"</font>
00023 <font class="preprocessor">#include "cgroupmanageritem.h"</font>
00024 
00025 <font class="preprocessor">#include "backend/cswordbiblemoduleinfo.h"</font>
00026 <font class="preprocessor">#include "backend/cswordcommentarymoduleinfo.h"</font>
00027 <font class="preprocessor">#include "backend/cswordlexiconmoduleinfo.h"</font>
00028 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00029 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00030 <font class="preprocessor">#include "backend/creferencemanager.h"</font>
00031 <font class="preprocessor">#include "printing/cprintitem.h"</font>
00032 <font class="preprocessor">#include "printing/cprinter.h"</font>
00033 
00034 <font class="preprocessor">#include "frontend/chtmldialog.h"</font>
00035 <font class="preprocessor">#include "frontend/cinputdialog.h"</font>
00036 <font class="preprocessor">#include "frontend/searchdialog/csearchdialog.h"</font>
00037 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00038 <font class="preprocessor">#include "frontend/cexportmanager.h"</font>
00039 
00040 <font class="preprocessor">#include "whatsthisdef.h"</font>
00041 <font class="preprocessor">#include "resource.h"</font>
00042 
00043 <font class="preprocessor">#include &lt;iostream.h&gt;</font>
00044 
00045 <font class="comment">//QT includes</font>
00046 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00047 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00048 <font class="preprocessor">#include &lt;qmessagebox.h&gt;</font>
00049 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00050 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00051 <font class="preprocessor">#include &lt;qvaluelist.h&gt;</font>
00052 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00053 <font class="preprocessor">#include &lt;qinputdialog.h&gt;</font>
00054 <font class="preprocessor">#include &lt;qstyle.h&gt;</font>
00055 
00056 <font class="comment">//KDE includes</font>
00057 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00058 <font class="preprocessor">#include &lt;kstddirs.h&gt;</font>
00059 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00060 <font class="preprocessor">#include &lt;kconfig.h&gt;</font>
00061 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00062 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00063 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00064 <font class="preprocessor">#include &lt;kpassdlg.h&gt;</font>
00065 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00066 <font class="preprocessor">#include &lt;kmessagebox.h&gt;</font>
00067 
00068 
00069 CGroupManager::ToolTip::ToolTip(QWidget* parent) : <a class="code" href="class_c_tool_tip.html">CToolTip</a>(parent) {
00070 }
00071 
<a name="l00072"></a><a class="code" href="class_c_group_manager_1_1_tool_tip.html#a1">00072</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager_1_1_tool_tip.html#a1">CGroupManager::ToolTip::maybeTip</a>(<font class="keyword">const</font> QPoint&amp; p) {
00073     <font class="keywordflow">if</font> (!<a class="code" href="class_c_tool_tip.html#a1">parentWidget</a>()-&gt;inherits(<font class="stringliteral">"CGroupManager"</font>))
00074         <font class="keywordflow">return</font>;
00075     
00076     <a class="code" href="class_c_group_manager.html">CGroupManager</a>* m = 0;
00077     <font class="keywordflow">if</font> ( !(m = dynamic_cast&lt;CGroupManager*&gt;(<a class="code" href="class_c_tool_tip.html#a1">parentWidget</a>())) )
00078         <font class="keywordflow">return</font>; 
00079     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = 0;
00080     <font class="keywordflow">if</font> ( !( i = dynamic_cast&lt;CGroupManagerItem*&gt;(m-&gt;itemAt(p))) )
00081         <font class="keywordflow">return</font>;
00082     
00083     QRect r = m-&gt;itemRect(i);
00084     <font class="keywordflow">if</font> (!r.isValid())
00085         <font class="keywordflow">return</font>;
00086     
00087     <font class="comment">//get type of item and display correct text</font>
00088     <font class="keyword">const</font> QString text = i-&gt;<a class="code" href="class_c_group_manager_item.html#a16">getToolTip</a>();
00089     <font class="keywordflow">if</font> (!text.isEmpty()) {
00090     QPoint globalPoint = m-&gt;viewport()-&gt;mapTo(m, p);
00091         <a class="code" href="class_c_tool_tip.html#b0">tip</a>(globalPoint, r, text);
00092     }
00093 }
00094 
00095 
00096 CGroupManager::CGroupManager(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name, ListCSwordModuleInfo *swordList, <font class="keyword">const</font> <font class="keywordtype">bool</font> useBookmarks, <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>, <font class="keyword">const</font> <font class="keywordtype">bool</font> useDnD, <font class="keyword">const</font> <font class="keywordtype">bool</font> useExtendedMode, <font class="keyword">const</font> <font class="keywordtype">bool</font> useRMBMenu, <font class="keyword">const</font> <font class="keywordtype">bool</font> showHelpDialogs)
00097     : KListView(parent, name),
00098         m_swordList(swordList),     
00099         m_config( new KConfig("bt-groupmanager", false, false ) ),
00100       m_menu(false),
00101         m_searchDialog(0),      
00102         m_pressedItem(0),       
00103         m_useBookmarks(useBookmarks),
00104         m_saveSettings(<a class="code" href="class_c_group_manager.html#a5">saveSettings</a>),
00105         m_useDragDrop(useDnD),
00106         m_useExtendedMode(useExtendedMode),
00107         m_useRMBMenu(useRMBMenu),
00108         m_showHelpDialogs(showHelpDialogs)
00109 {
00110     <a class="code" href="class_c_group_manager.html#a6">initView</a>();
00111     <a class="code" href="class_c_group_manager.html#c0">initConnections</a>();
00112     <a class="code" href="class_c_group_manager.html#a4">readSettings</a>();
00113 }
00114 
00115 CGroupManager::~CGroupManager(){    
00116     <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>();
00117     m_config-&gt;sync();
00118     <font class="keyword">delete</font> m_config;
00119     m_config = 0;
00120 }
00121 
<a name="l00123"></a><a class="code" href="class_c_group_manager.html#a2">00123</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a2">CGroupManager::setupSwordTree</a>() {
00124   qWarning(<font class="stringliteral">"CGroupManager::setupSwordTree()"</font>);
00125     <a class="code" href="class_c_group_manager.html#c16">readGroups</a>(m_config, 0);
00126     <a class="code" href="class_c_group_manager.html#c14">readSwordModules</a>(m_config, 0);  
00127     <font class="keywordflow">if</font> (m_useBookmarks)
00128         <a class="code" href="class_c_group_manager.html#c12">readSwordBookmarks</a>(m_config, 0);
00129     <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
00130 }
00131 
<a name="l00133"></a><a class="code" href="class_c_group_manager.html#a3">00133</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a3">CGroupManager::setupStandardSwordTree</a>() {
00134     qWarning(<font class="stringliteral">"CGroupManager::setupStandardSwordTree"</font>);  
00135  <font class="keywordflow">if</font> (!m_swordList || (m_swordList &amp;&amp; !m_swordList-&gt;count())) {
00136         qWarning(<font class="stringliteral">"CGroupManager::setupStandardSwordTree: m_swordList is empty or qual to NULL. return now."</font>);
00137         <font class="keywordflow">return</font>;
00138     }
00139     
00140     <font class="keyword">const</font> <font class="keywordtype">bool</font> initialized = m_config-&gt;readBoolEntry(<font class="stringliteral">"initialized"</font>, <font class="keyword">false</font>);
00141     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* moduleInfo = 0;
00142     QListViewItemIterator it( <font class="keyword">this</font> );
00143     
00144     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* bibleGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Bibles"</font>));      
00145     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* bookGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Books"</font>));    
00146     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* commentaryGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Commentaries"</font>));           
00147     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* lexiconGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Lexicons"</font>));
00148     
00149     <font class="keywordflow">for</font>(moduleInfo = m_swordList-&gt;first(); moduleInfo; moduleInfo = m_swordList-&gt;next()) {
00150         <font class="keywordtype">bool</font> alreadyCreated = <font class="keyword">false</font>;
00151     QListViewItemIterator it( <font class="keyword">this</font> );
00152         <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
00153             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
00154             <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() == moduleInfo) { <font class="comment">//already there</font>
00155                 alreadyCreated = <font class="keyword">true</font>;
00156                 <font class="keywordflow">break</font>;
00157             }
00158         }
00159         <font class="keywordflow">if</font> ( moduleInfo &amp;&amp; !alreadyCreated) { <font class="comment">//module was probably newly installed, insert it</font>
00160             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* itemParent = 0;
00161             <font class="keywordflow">switch</font> (moduleInfo-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) {
00162                 <font class="keywordflow">case</font> CSwordModuleInfo::Bible:
00163                     itemParent = bibleGroup;
00164                     <font class="keywordflow">break</font>;
00165                 <font class="keywordflow">case</font> CSwordModuleInfo::Commentary:
00166                     itemParent = commentaryGroup;
00167                     <font class="keywordflow">break</font>;
00168                 <font class="keywordflow">case</font> CSwordModuleInfo::Lexicon:
00169                     itemParent = lexiconGroup;
00170                     <font class="keywordflow">break</font>;
00171                 <font class="keywordflow">case</font> CSwordModuleInfo::GenericBook:
00172                     itemParent = bookGroup;
00173                     <font class="keywordflow">break</font>;                  
00174                 <font class="keywordflow">default</font>:
00175                     <font class="keywordflow">break</font>;
00176             }
00177             <font class="keywordflow">if</font> (itemParent)
00178                 (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(itemParent,QString::null,QString::null, moduleInfo,0, CGroupManagerItem::Module);
00179         }
00180     }
00181     <font class="keywordflow">if</font> (!initialized) {
00182         bibleGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);
00183         lexiconGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);
00184         commentaryGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);    
00185         bookGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);              
00186         sort();     
00187     }
00188     
00189     <font class="comment">// Now delete the groupes which have no child items</font>
00190     <font class="keywordflow">if</font> (!bibleGroup-&gt;childCount()) {        
00191         <font class="keyword">delete</font> bibleGroup;
00192         bibleGroup = 0;
00193     }
00194     <font class="keywordflow">if</font> (!lexiconGroup-&gt;childCount()) {
00195         <font class="keyword">delete</font> lexiconGroup;
00196         lexiconGroup = 0;
00197     }
00198     <font class="keywordflow">if</font> (!commentaryGroup-&gt;childCount()) {
00199         <font class="keyword">delete</font> commentaryGroup;
00200         commentaryGroup = 0;
00201     }
00202     <font class="keywordflow">if</font> (!bookGroup-&gt;childCount()) {
00203         <font class="keyword">delete</font> bookGroup;
00204         bookGroup = 0;
00205     }   
00206 }
00207 
<a name="l00209"></a><a class="code" href="class_c_group_manager.html#c0">00209</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c0">CGroupManager::initConnections</a>(){
00210     connect(<font class="keyword">this</font>, SIGNAL(returnPressed(QListViewItem*)), SLOT(<a class="code" href="class_c_group_manager.html#i0">slotReturnPressed</a>(QListViewItem*)));
00211     <font class="keywordflow">if</font> (m_useRMBMenu)
00212         connect(m_popupMenu, SIGNAL(aboutToShow()),
00213             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h2">slotPopupAboutToShow</a>()));
00214 }
00215 
<a name="l00217"></a><a class="code" href="class_c_group_manager.html#a5">00217</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a5">CGroupManager::saveSettings</a>(){ 
00218     qWarning(<font class="stringliteral">"CGroupManager::saveSettings()"</font>);
00219 
00220     KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00221     <font class="keywordflow">if</font> (!m_saveSettings) {
00222         <font class="keywordflow">return</font>;
00223     }
00224             
00225     <font class="comment">//save column width </font>
00226     m_config-&gt;writeEntry(<font class="stringliteral">"initialized"</font>, <font class="keyword">true</font>);
00227     m_config-&gt;writeEntry(<font class="stringliteral">"First column"</font>, columnWidth(0));
00228     
00229   <font class="comment">//save the bookmarks and the groups   </font>
00230     <a class="code" href="class_c_group_manager.html#c15">saveGroups</a>(m_config,0);
00231     <a class="code" href="class_c_group_manager.html#c13">saveSwordModules</a>(m_config,0);
00232     <a class="code" href="class_c_group_manager.html#c11">saveSwordBookmarks</a>(m_config, 0);
00233 }
00234 
<a name="l00236"></a><a class="code" href="class_c_group_manager.html#a4">00236</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a4">CGroupManager::readSettings</a>(){
00237     KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00238     <font class="keywordflow">if</font> (m_config-&gt;readBoolEntry(<font class="stringliteral">"initialized"</font>))
00239         <a class="code" href="class_c_group_manager.html#a2">setupSwordTree</a>();
00240     <font class="keywordflow">else</font>
00241         <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
00242     setColumnWidth(0, m_config-&gt;readNumEntry(<font class="stringliteral">"First column"</font>, visibleWidth()) );
00243 }
00244 
<a name="l00246"></a><a class="code" href="class_c_group_manager.html#a6">00246</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a6">CGroupManager::initView</a>(){
00247     m_toolTip = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_1_1_tool_tip.html">ToolTip</a>(<font class="keyword">this</font>);
00248   setTooltipColumn(-1);
00249   setShowToolTips(<font class="keyword">false</font>);<font class="comment">//to disable Qt's tooltips</font>
00250     
00251     QWhatsThis::add(<font class="keyword">this</font>, WT_GM_WIDGET );
00252     m_singleClick = KGlobalSettings::singleClick();
00253             
00254     setBackgroundMode(PaletteBase);
00255     setSorting(-1);
00256   setFullWidth(<font class="keyword">true</font>);
00257         
00258     <font class="keywordflow">if</font> (m_useDragDrop)
00259         viewport()-&gt;setAcceptDrops(<font class="keyword">true</font>);
00260     <font class="keywordflow">if</font> (m_useExtendedMode)
00261         setSelectionModeExt(KListView::Extended);
00262     setRootIsDecorated(<font class="keyword">false</font>);
00263     setAllColumnsShowFocus(<font class="keyword">true</font>);
00264                 
00265     addColumn(i18n(<font class="stringliteral">"Caption"</font>));
00266     header()-&gt;hide();
00267     
00268     <font class="keywordflow">if</font> (!m_useRMBMenu) {
00269         m_popupMenu = 0;
00270     }
00271     <font class="keywordflow">else</font> {      
00272         m_popupMenu = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00273         m_popupMenu-&gt;insertTitle(i18n(<font class="stringliteral">"Main index"</font>));
00274         m_popupMenu-&gt;insertItem(GROUP_NEW_ICON_SMALL, i18n(<font class="stringliteral">"Create a new folder"</font>),
00275             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h6">slotCreateNewGroup</a>()),0,ID_GM_GROUP_CREATE);
00276         m_popupMenu-&gt;setWhatsThis(ID_GM_GROUP_CREATE, WT_GM_NEW_GROUP); 
00277         m_popupMenu-&gt;insertItem(GROUP_CHANGE_ICON_SMALL, i18n(<font class="stringliteral">"Change this folder"</font>),
00278             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h13">slotChangeGroup</a>()),0,ID_GM_GROUP_CHANGE);
00279         m_popupMenu-&gt;setWhatsThis(ID_GM_GROUP_CHANGE, WT_GM_CHANGE_GROUP);      
00280         m_popupMenu-&gt;insertSeparator(); 
00281         m_popupMenu-&gt;insertItem(BOOKMARK_CHANGE_ICON_SMALL,i18n(<font class="stringliteral">"Change this bookmark"</font>),
00282             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h1">slotChangeBookmark</a>()),0,ID_GM_BOOKMARK_CHANGE);
00283         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARK_CHANGE, WT_GM_CHANGE_BOOKMARK);
00284         m_popupMenu-&gt;insertItem(BOOKMARK_IMPORT_ICON_SMALL,i18n(<font class="stringliteral">"Import bookmarks"</font>),
00285             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h8">slotImportBookmarks</a>()),0,ID_GM_BOOKMARKS_IMPORT); 
00286         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARKS_IMPORT, WT_GM_IMPORT_BOOKMARKS);
00287         m_popupMenu-&gt;insertItem(BOOKMARK_EXPORT_ICON_SMALL,i18n(<font class="stringliteral">"Export bookmarks"</font>),
00288             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h7">slotExportBookmarks</a>()),0,ID_GM_BOOKMARKS_EXPORT);     
00289         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARKS_EXPORT, WT_GM_EXPORT_BOOKMARKS);  
00290         m_popupMenu-&gt;insertItem(BOOKMARK_PRINT_ICON_SMALL,i18n(<font class="stringliteral">"Print bookmark"</font>),
00291             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h14">slotPrintBookmark</a>()),0,ID_GM_BOOKMARK_PRINT);
00292         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARK_PRINT, WT_GM_PRINT_BOOKMARK);
00293         m_popupMenu-&gt;insertItem(ITEMS_DELETE_ICON_SMALL, i18n(<font class="stringliteral">"Remove selected item(s)"</font>),
00294             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h0">slotDeleteSelectedItems</a>()),0,ID_GM_ITEMS_DELETE);
00295         m_popupMenu-&gt;insertSeparator();
00296         m_popupMenu-&gt;insertItem(MODULE_SEARCH_ICON_SMALL,i18n(<font class="stringliteral">"Search in selected module(s)"</font>),
00297             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h3">slotSearchSelectedModules</a>()),0,ID_GM_MODULES_SEARCH);
00298         m_popupMenu-&gt;insertSeparator();
00299         m_popupMenu-&gt;insertItem(MODULE_UNLOCK_ICON_SMALL,i18n(<font class="stringliteral">"Unlock this module"</font>),
00300             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#g0">slotUnlockModule</a>()),0,ID_GM_MODULE_UNLOCK);  
00301         m_popupMenu-&gt;setWhatsThis(ID_GM_MODULE_UNLOCK, WT_GM_UNLOCK_MODULE);    
00302         m_popupMenu-&gt;insertItem(MODULE_ABOUT_ICON_SMALL, i18n(<font class="stringliteral">"About this module"</font>),
00303             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h4">slotShowAbout</a>()),0,ID_GM_MODULE_ABOUT);
00304         m_popupMenu-&gt;setWhatsThis(ID_GM_MODULE_ABOUT, WT_GM_ABOUT_MODULE);
00305     }
00306 }
00307     
<a name="l00309"></a><a class="code" href="class_c_group_manager.html#h0">00309</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h0">CGroupManager::slotDeleteSelectedItems</a>(){
00310     QListViewItemIterator it( <font class="keyword">this</font> );
00311     <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
00312         <font class="keywordflow">if</font> ( it.current()-&gt;isSelected() )
00313             <font class="keyword">delete</font> it.current();
00314     }
00315 }   
00316 
<a name="l00318"></a><a class="code" href="class_c_group_manager.html#h3">00318</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h3">CGroupManager::slotSearchSelectedModules</a>() {
00319     ListCSwordModuleInfo searchList;
00320     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *item = 0;
00321     
00322     QPtrList&lt;QListViewItem&gt; items = selectedItems();
00323     <font class="keywordflow">for</font> (items.first(); items.current(); items.next()) {
00324         item = dynamic_cast&lt;CGroupManagerItem*&gt;(items.current());
00325         <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module)
00326             searchList.append(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00327     }
00328     <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>();
00329     m_config-&gt;sync();
00330 
00331     <font class="keywordflow">if</font> (!m_searchDialog)
00332         m_searchDialog = <font class="keyword">new</font> <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>(searchList,0,0);
00333     <font class="keywordflow">else</font>
00334         m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a3">setModuleList</a>(searchList);
00335     connect(m_searchDialog, SIGNAL(finished()),
00336         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h15">slotDeleteSearchdialog</a>()));  
00337     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a4">setSearchText</a>(QString::null);
00338     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#g0">show</a>();
00339     m_searchDialog-&gt;raise();
00340 }   
00341 
00342 <font class="keywordtype">void</font> CGroupManager::searchBookmarkedModule(<font class="keyword">const</font> QString&amp; text, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item) {  
00343 <font class="comment">//  qWarning("CGroupManager::searchBookmarkedModule(const QString&amp; text, CGroupManagerItem* item)");</font>
00344 <font class="comment">//  ASSERT(item);</font>
00345   <font class="keywordflow">if</font> (!item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
00346     <font class="keywordflow">return</font>;
00347     ListCSwordModuleInfo searchList;
00348     searchList.append(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00349     
00350     <font class="keywordflow">if</font> (!m_searchDialog)
00351         m_searchDialog = <font class="keyword">new</font> <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>(searchList,0,0);
00352     <font class="keywordflow">else</font>
00353         m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a3">setModuleList</a>(searchList);
00354     connect(m_searchDialog, SIGNAL(finished()),
00355         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h15">slotDeleteSearchdialog</a>()));  
00356         
00357   m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a4">setSearchText</a>(text);
00358     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#g0">show</a>();
00359     m_searchDialog-&gt;raise();
00360     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a6">startSearch</a>();  
00361 }   
00362 
00364 <font class="keywordtype">void</font> CGroupManager::createNewBookmark(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parent, <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; ref){
00365     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* swordModule = dynamic_cast&lt;CSwordModuleInfo*&gt;(module);        
00366     <font class="keywordflow">if</font> (!swordModule)
00367         <font class="keywordflow">return</font>;
00368     
00369     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;  
00370     <font class="keywordtype">bool</font> ok = <font class="keyword">false</font>;
00371     <font class="keyword">const</font> QString description = <a class="code" href="class_c_input_dialog.html#d0">CInputDialog::getText</a>(i18n(<font class="stringliteral">"Bookmark description - BibleTime"</font>), i18n(<font class="stringliteral">"Please enter here the description:"</font>), QString::null, &amp;ok);
00372     <font class="keywordflow">if</font> (!ok)
00373         <font class="keywordflow">return</font>;
00374 
00375     myItem = 0;
00376   <font class="keywordflow">if</font> ( parent &amp;&amp; (parent-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
00377     myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parent,QString::null,QString::null,module, 0, CGroupManagerItem::Bookmark);
00378     parent-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00379   }
00380     <font class="keywordflow">else</font>
00381         myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>,QString::null,QString::null,module, 0, CGroupManagerItem::Bookmark);
00382         
00383     <font class="keywordflow">if</font> (myItem) {   <font class="comment">//it's a Sword module</font>
00384         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module);
00385         <font class="keywordflow">if</font> (key) {
00386             key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(ref);
00387             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a9">setBookmarkKey</a>(key);    <font class="comment">//the key is deleted by the groupmmanager item</font>
00388         }
00389     }       
00390   <font class="keywordflow">if</font> (myItem)   <font class="comment">//set the description       </font>
00391         myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>(description);
00392     setFocus();     
00393 }
00394 
00395 
<a name="l00397"></a><a class="code" href="class_c_group_manager.html#h1">00397</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h1">CGroupManager::slotChangeBookmark</a>(){
00398     <font class="keywordflow">if</font> (!m_pressedItem)
00399         <font class="keywordflow">return</font>;     
00400     <font class="keywordtype">bool</font> isOk;
00401     QString description = <a class="code" href="class_c_input_dialog.html#d0">CInputDialog::getText</a>(i18n(<font class="stringliteral">"Change bookmark description - BibleTime"</font>),i18n(<font class="stringliteral">"Please change the description of the item!"</font>), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>(), &amp;isOk);
00402     <font class="keywordflow">if</font> (isOk)
00403         m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>(description);
00404 }
00405 
<a name="l00407"></a><a class="code" href="class_c_group_manager.html#h13">00407</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h13">CGroupManager::slotChangeGroup</a>(){
00408     <font class="keywordflow">if</font> (!m_pressedItem)
00409         <font class="keywordflow">return</font>;     
00410     
00411     <font class="keywordtype">bool</font> isOk;
00412     QString description = QInputDialog::getText(i18n(<font class="stringliteral">"Change folder - BibleTime"</font>), i18n(<font class="stringliteral">"Please change the name of the group!"</font>), QLineEdit::Normal,m_pressedItem-&gt;text(0), &amp;isOk, <font class="keyword">this</font>);    
00413     <font class="keywordflow">if</font> (isOk)
00414         m_pressedItem-&gt;setText( 0, description );
00415 }
00416 
<a name="l00418"></a><a class="code" href="class_c_group_manager.html#h2">00418</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h2">CGroupManager::slotPopupAboutToShow</a>(){
00419     <font class="keywordflow">if</font> (!m_useRMBMenu)
00420         <font class="keywordflow">return</font>;
00421         
00422     m_menu = <font class="keyword">true</font>;
00423     
00424     
00425     <font class="keywordflow">if</font> (m_pressedItem) {
00426         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) {
00427             <font class="keywordtype">bool</font> moduleIsEncrypted = m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>();
00428             
00429             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">true</font>);          
00430             
00431             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">false</font>);
00432             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00433             
00434             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);
00435             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">false</font>);
00436             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, <font class="keyword">false</font>);         
00437             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);           
00438 
00439             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">false</font>);
00440                         
00441             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">true</font>);    
00442             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, moduleIsEncrypted);            
00443             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">true</font>);
00444         }
00445         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) {
00446             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">true</font>);
00447                         
00448             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">false</font>);         
00449             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00450                         
00451             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">true</font>);
00452             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">false</font>);
00453             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, <font class="keyword">false</font>);         
00454             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">true</font>);
00455             
00456             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">true</font>);                      
00457             
00458             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00459             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);            
00460             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);
00461 
00462         }
00463         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00464             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">false</font>);
00465                         
00466             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">true</font>);
00467             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">true</font>);
00468                                                 
00469             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);                          
00470             
00471             <font class="comment">//enable import and export only if a bookmark exists in this group</font>
00472             <font class="keywordtype">bool</font> foundBookmark = <font class="keyword">false</font>;
00473         QListViewItem * myChild = m_pressedItem-&gt;firstChild();
00474         <font class="keywordflow">while</font>( myChild &amp;&amp; !foundBookmark) {
00475             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(myChild);
00476                 <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00477                     foundBookmark = <font class="keyword">true</font>;
00478                 myChild = myChild-&gt;nextSibling();
00479         }
00480             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">true</font>);
00481             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, foundBookmark);
00482             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);
00483                 
00484             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">true</font>);
00485 
00486             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00487             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);
00488             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);
00489         }       
00490     }
00491     <font class="keywordflow">else</font> { <font class="comment">//top level</font>
00492         m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">false</font>);
00493                         
00494         m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">true</font>);
00495         m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00496             
00497         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);              
00498             
00499         <font class="keywordtype">bool</font> foundBookmark = <font class="keyword">false</font>; 
00500      QListViewItemIterator it( <font class="keyword">this</font> );
00501      <font class="keywordflow">for</font> ( ; it.current() &amp;&amp; !foundBookmark; ++it ) {
00502         <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
00503             <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00504                 foundBookmark = <font class="keyword">true</font>;
00505         }           
00506         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">true</font>);
00507         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, foundBookmark);
00508         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);
00509                         
00510         m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">false</font>);
00511                         
00512         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00513         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);            
00514         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);         
00515     }
00516 }
00517 
<a name="l00519"></a><a class="code" href="class_c_group_manager.html#h4">00519</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h4">CGroupManager::slotShowAbout</a>(){
00520     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = dynamic_cast&lt;CSwordModuleInfo*&gt;(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());    
00521     <font class="keywordflow">if</font> (!m_pressedItem || !m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() || !module)
00522         <font class="keywordflow">return</font>;
00523     QString text;   
00524 
00525   <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a10">hasVersion</a>())
00526     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00527         .arg(i18n(<font class="stringliteral">"Version"</font>))
00528         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::ModuleVersion));
00529 
00530     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;&lt;b&gt;%3:&lt;/b&gt; %4&lt;br&gt;"</font>)
00531         .arg(i18n(<font class="stringliteral">"Location"</font>))
00532 <font class="comment">//      .arg(backend()-&gt;modulePath(module-&gt;name()))</font>
00533         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::AbsoluteDataPath))
00534         .arg(i18n(<font class="stringliteral">"Language"</font>))
00535         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Lang());
00536 
00537     <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;isWritable())
00538         text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00539                             .arg(i18n(<font class="stringliteral">"Writable"</font>))
00540                             .arg(i18n(<font class="stringliteral">"yes"</font>));
00541 
00542     <font class="keywordflow">if</font> ( module-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>() )
00543         text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00544                             .arg(i18n(<font class="stringliteral">"Unlock key"</font>))
00545                             .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::CipherKey));  
00546     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>).arg(i18n(<font class="stringliteral">"Encoding"</font>)).arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>() ? i18n(<font class="stringliteral">"Unicode"</font>) : i18n(<font class="stringliteral">"iso8859-1"</font>));
00547 
00548     QString options;
00549     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> opts;
00550     <font class="keywordflow">for</font> (opts = CSwordBackend::filterOptionsMIN; opts &lt;= CSwordBackend::filterOptionsMAX; ++opts){
00551         <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a20">has</a>( (<a class="code" href="class_c_sword_backend.html#s15">CSwordBackend::FilterOptions</a>)opts)){
00552         <font class="keywordflow">if</font> (!options.isEmpty())
00553             options += QString::fromLatin1(<font class="stringliteral">", "</font>);
00554         options += <a class="code" href="class_c_sword_backend.html#d3">CSwordBackend::translatedOptionName</a>( (<a class="code" href="class_c_sword_backend.html#s15">CSwordBackend::FilterOptions</a>)opts);
00555         }
00556     }
00557     <font class="keywordflow">if</font> (!options.isEmpty())
00558         text += QString(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00559             .arg(i18n(<font class="stringliteral">"Features"</font>))
00560             .arg(options);
00561 
00562     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt;&lt;br&gt; &lt;font size=\"-1\"&gt;%2&lt;/font&gt;"</font>)
00563                         .arg(<font class="stringliteral">"About"</font>)
00564                         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::AboutInformation));
00565 
00566     KMessageBox::about(<font class="keyword">this</font>, text, module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::Description), <font class="keyword">false</font>);
00567 }
00568 
00570 <font class="keywordtype">void</font> CGroupManager::slotCreateNewPresenter(){
00571     <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00572         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module || m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00573             emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null );
00574     }
00575 }
00576 
00578 <font class="keywordtype">void</font> CGroupManager::contentsDragEnterEvent( QDragEnterEvent* e){
00579   <font class="keywordflow">if</font> (QTextDrag::canDecode(e)) {
00580     e-&gt;accept(<font class="keyword">true</font>);
00581     QString str;
00582       QCString submime;
00583     <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=BOOKMARK))
00584         m_dragType = BOOKMARK;
00585     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=REFERENCE))
00586         m_dragType = REFERENCE;     
00587 <font class="comment">//      else if (QTextDrag::decode(e,str,submime=MODULE))</font>
00588 <font class="comment">//          m_dragType = MODULE;    </font>
00589 <font class="comment">//      else if (QTextDrag::decode(e,str,submime=GROUP))</font>
00590 <font class="comment">//          m_dragType = GROUP;             </font>
00591     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=TEXT))
00592         m_dragType = TEXT;
00593     <font class="keywordflow">else</font>
00594         m_dragType = <font class="stringliteral">""</font>;
00595   }
00596   <font class="keywordflow">else</font> {
00597     e-&gt;ignore();
00598     m_dragType = <font class="stringliteral">""</font>;
00599   }
00600 }
00601 
00603 <font class="keywordtype">void</font> CGroupManager::contentsDragMoveEvent( QDragMoveEvent* e){
00604   <font class="comment">//open folders</font>
00605   <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)itemAt( contentsToViewport(e-&gt;pos()) );         
00606   e-&gt;accept(QTextDrag::canDecode(e));       
00607     <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group &amp;&amp; !item-&gt;isOpen())
00608         item-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00609 
00610     m_afterItemDrop = item;
00611     <font class="keywordflow">if</font> (item)
00612         m_parentItemDrop = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
00613     <font class="keywordflow">else</font>
00614         m_parentItemDrop = 0;
00615     
00616     QRect tmpRect = <a class="code" href="class_c_group_manager.html#h10">drawDropVisualizer</a>(0, m_parentItemDrop, m_afterItemDrop, m_dragType );
00617     <font class="keywordflow">if</font> (tmpRect != m_oldDragRect ) {
00618         <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00619         m_oldDragRect = tmpRect;
00620         <font class="keywordflow">if</font> (tmpRect.isValid())
00621             viewport()-&gt;repaint(tmpRect);
00622     }
00623 }
00624 
00626 <font class="keywordtype">void</font> CGroupManager::contentsDragLeaveEvent( QDragLeaveEvent* e){    
00627     KListView::contentsDragLeaveEvent(e);   
00628     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00629     
00630     m_oldDragRect = QRect();
00631     m_dragType = <font class="stringliteral">""</font>;
00632 }
00633 
00637 <font class="preprocessor">#define MOVE_ITEMS  \</font>
00638 <font class="preprocessor">            for ( item = m_itemList-&gt;last(); item != 0; item = m_itemList-&gt;prev()){ \</font>
00639 <font class="preprocessor">                if ( item &amp;&amp; (item != target) ){ \</font>
00640 <font class="preprocessor">                    parentItem = dynamic_cast&lt;CGroupManagerItem*&gt;(item-&gt;parent()); \</font>
00641 <font class="preprocessor">                    if ( isChild(item, target) ) \</font>
00642 <font class="preprocessor">                        continue; \</font>
00643 <font class="preprocessor">                    if (parentItem &amp;&amp; parentItem != item) \</font>
00644 <font class="preprocessor">                        parentItem-&gt;takeItem(item); \</font>
00645 <font class="preprocessor">                    else \</font>
00646 <font class="preprocessor">                        takeItem(item); \</font>
00647 <font class="preprocessor">                    if ( target &amp;&amp; target!=item ) \</font>
00648 <font class="preprocessor">                        if (target-&gt;type()==CGroupManagerItem::Group) \</font>
00649 <font class="preprocessor">                            target-&gt;insertItem(item); \</font>
00650 <font class="preprocessor">                        else{ \</font>
00651 <font class="preprocessor">                            if (target-&gt;parent()) \</font>
00652 <font class="preprocessor">                                target-&gt;parent()-&gt;insertItem(item); \</font>
00653 <font class="preprocessor">                            else \</font>
00654 <font class="preprocessor">                                this-&gt;insertItem(item); \</font>
00655 <font class="preprocessor">                        }  \</font>
00656 <font class="preprocessor">                    else \</font>
00657 <font class="preprocessor">                        this-&gt;insertItem(item); \</font>
00658 <font class="preprocessor">                } \</font>
00659 <font class="preprocessor">            }</font>
00660 <font class="preprocessor"></font>
00662 <font class="keywordtype">void</font> CGroupManager::contentsDropEvent( QDropEvent* e){
00663   <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* target = dynamic_cast&lt;CGroupManagerItem *&gt;(itemAt(contentsToViewport(e-&gt;pos())));
00664 
00665   QString str;
00666   QCString submime;
00667   <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=BOOKMARK)){
00668     <font class="comment">//a bookmark was dragged</font>
00669     <font class="keywordflow">if</font> ( e-&gt;source() != viewport() ){
00670       <font class="keywordflow">return</font>;
00671     }
00672     <font class="keywordflow">if</font> ( !(m_itemList) ){
00673       <font class="keywordflow">return</font>;
00674     }
00675     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00676     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
00677     <font class="comment">// Bookmark dragged on module - open a presenter</font>
00678     <font class="keywordflow">if</font> ( (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00679             &amp;&amp; target &amp;&amp; (target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) ){
00680       emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>(target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(),m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );
00681     }
00682     <font class="comment">//move around bookmarks</font>
00683     <font class="keywordflow">else</font>{       
00684         MOVE_ITEMS      
00685     }<font class="comment">//else</font>
00686   }<font class="comment">//Bookmark</font>
00687 <font class="comment">//  else if (QTextDrag::decode(e,str,submime=GROUP)){</font>
00688 <font class="comment">//    //a group was dragged</font>
00689 <font class="comment">//    if ( e-&gt;source() != this-&gt;viewport() )</font>
00690 <font class="comment">//      return;</font>
00691 <font class="comment">//    if ( !(m_itemList) )</font>
00692 <font class="comment">//      return;</font>
00693 <font class="comment">//    CGroupManagerItem* item = 0;</font>
00694 <font class="comment">//    CGroupManagerItem* parentItem = 0;</font>
00695 <font class="comment">//    //move around groups      </font>
00696 <font class="comment">//    MOVE_ITEMS</font>
00697 <font class="comment">//  }//group</font>
00698 <font class="comment">//  else if (QTextDrag::decode(e,str,submime=MODULE)){</font>
00699 <font class="comment">//    //a module was dragged</font>
00700 <font class="comment">//    if ( e-&gt;source() != this-&gt;viewport() ){</font>
00701 <font class="comment">//      return;</font>
00702 <font class="comment">//    }</font>
00703 <font class="comment">//    if ( !(m_itemList) ){</font>
00704 <font class="comment">//      return;</font>
00705 <font class="comment">//    }</font>
00706 <font class="comment">//    CGroupManagerItem* item = 0;</font>
00707 <font class="comment">//    CGroupManagerItem* parentItem = 0;</font>
00708 <font class="comment">//    MOVE_ITEMS</font>
00709 <font class="comment">//  }//module</font>
00710   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=REFERENCE)){
00711     <font class="comment">//a reference was dragged</font>
00712         QString ref;
00713     QString mod;
00714     <a class="code" href="class_c_reference_manager.html#d3">CReferenceManager::decodeReference</a>(str,mod,ref);
00715 
00716     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* info = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(mod);
00717     <font class="keywordflow">if</font> ( info <font class="comment">/*&amp;&amp; (info-&gt;name() == mod)*/</font> ){
00718             <font class="keywordflow">if</font> (!target){ <font class="comment">//Reference was dragged on no item</font>
00719                 createNewBookmark(0, info, ref); <font class="comment">//CREATE A NEW BOOKMARK</font>
00720             }
00721             <font class="keywordflow">else</font>{
00722                 <font class="keywordflow">switch</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()){
00723                     <font class="keywordflow">case</font> (CGroupManagerItem::Group):
00724                         <font class="keywordflow">if</font> (info)  <font class="comment">//Create a bookmark</font>
00725                             createNewBookmark(target,info, ref);
00726                         <font class="keywordflow">break</font>;
00727                     <font class="keywordflow">case</font> (CGroupManagerItem::Bookmark):
00728                         <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>())
00729                             createNewBookmark(target-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>(),info, ref);
00730                         <font class="keywordflow">else</font>
00731                             createNewBookmark(0,info, ref);                     
00732                         <font class="keywordflow">break</font>;
00733                     <font class="keywordflow">case</font> (CGroupManagerItem::Module):
00734                         <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()){
00739                             <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Bible || target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Commentary )
00740                                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), ref );                          
00741                             <font class="keywordflow">else</font>
00742                                 searchBookmarkedModule(ref,target);
00743                         }
00744                         <font class="keywordflow">break</font>;
00745                 }<font class="comment">//switch;</font>
00746             }<font class="comment">//(target)</font>
00747     }<font class="comment">//(info)</font>
00748   }<font class="comment">//reference</font>
00749   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=TEXT)){
00750         <font class="comment">//plain text was dragged -&gt; open searchdialog</font>
00751         <font class="keywordflow">if</font> ( target &amp;&amp; target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()==CGroupManagerItem::Module &amp;&amp; target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() )
00752             searchBookmarkedModule(str,target);
00753   }
00754     m_dragType = <font class="stringliteral">""</font>;
00755     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00756 }
00757 <font class="preprocessor">#undef MOVE_ITEMS</font>
00758 <font class="preprocessor"></font>
00760 <font class="keywordtype">void</font> CGroupManager::contentsMousePressEvent( QMouseEvent* e ) {
00761     m_pressedPos = e-&gt;pos();
00762   m_pressedItem = dynamic_cast&lt;CGroupManagerItem*&gt;(itemAt(contentsToViewport(m_pressedPos)));
00763   <font class="keyword">const</font> <font class="keywordtype">bool</font> open = m_pressedItem ? m_pressedItem-&gt;isOpen() : false;
00764     KListView::contentsMousePressEvent(e);  
00765     
00766     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00767             <font class="keywordflow">return</font>;
00768             
00769     <font class="keywordflow">if</font> (e-&gt;button() == LeftButton) {
00770         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group
00771                 &amp;&amp; m_singleClick &amp;&amp; (m_pressedItem-&gt;isOpen() == open) ) {
00772             <font class="comment">//open group with first click if it's a global setting of KDE</font>
00773             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !m_pressedItem-&gt;isOpen() );
00774         }
00775     }
00776     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;button() == RightButton &amp; m_useRMBMenu) {   
00777         m_menu = <font class="keyword">true</font>;
00778         m_popupMenu-&gt;exec( viewport()-&gt;mapToGlobal( contentsToViewport(m_pressedPos) ));
00779         m_menu = <font class="keyword">false</font>;         
00780     }
00781 }
00782 
<a name="l00784"></a><a class="code" href="class_c_group_manager.html#h12">00784</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h12">CGroupManager::contentsMouseDoubleClickEvent</a> ( QMouseEvent * e){
00785 <font class="comment">//  qDebug("CGroupManager::contentsMouseDoubleClickEvent ( QMouseEvent * e)");</font>
00786   <font class="keywordtype">bool</font> open = <font class="keyword">false</font>;    
00787   <font class="keywordflow">if</font> (m_pressedItem)
00788     open = m_pressedItem-&gt;isOpen();
00789         
00790     KListView::contentsMouseDoubleClickEvent(e);
00791 
00792     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00793             <font class="keywordflow">return</font>;
00794     <font class="keywordflow">if</font> (e-&gt;button() == LeftButton) {
00795         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group
00796                 &amp;&amp; !m_singleClick &amp;&amp; (m_pressedItem-&gt;isOpen() == open) ) {
00797             <font class="comment">//open group with first click if it's a global setting of KDE</font>
00798             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !m_pressedItem-&gt;isOpen() );
00799         }
00800     }   
00801 }
00802 
00803 <font class="keywordtype">void</font> CGroupManager::contentsMouseReleaseEvent ( QMouseEvent* e ) {
00804     KListView::contentsMouseReleaseEvent(e);    
00805   <font class="keywordflow">if</font> ( !(m_pressedItem = dynamic_cast&lt;CGroupManagerItem*&gt;(itemAt(contentsToViewport(e-&gt;pos())))) )
00806     <font class="keywordflow">return</font>; 
00807     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00808         <font class="keywordflow">return</font>;
00809 
00810     <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; (e-&gt;button() == LeftButton)) {
00811         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00812         <font class="comment">//check if module is encrypted and show dialog if it wasn't opened before       </font>
00813             QPtrList&lt;QListViewItem&gt; items = selectedItems();            
00814             <font class="keywordflow">if</font> (items.count() &gt; 1) {
00815                 ListCSwordModuleInfo modules;
00816                 <font class="keywordflow">for</font> (items.first(); items.current(); items.next()) {
00817                     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(items.current());
00818                     <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
00819                         modules.append(i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00820                 }
00821                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( modules, QString::null );             
00822             }
00823             <font class="keywordflow">else</font>
00824                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null );
00825                         
00826         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>()) {
00827             KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00828             <font class="keywordflow">if</font> (m_showHelpDialogs &amp;&amp; !m_config-&gt;readBoolEntry(QString::fromLatin1(<font class="stringliteral">"shown %1 encrypted"</font>).arg(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>()), <font class="keyword">false</font>)) {
00829                     <a class="code" href="class_c_h_t_m_l_dialog.html">CHTMLDialog</a> dlg(HELPDIALOG_MODULE_LOCKED);
00830                     dlg.exec();             
00831                 }
00832             <font class="keywordflow">if</font> (m_showHelpDialogs)
00833                 m_config-&gt;writeEntry(QString::fromLatin1(<font class="stringliteral">"shown %1 encrypted"</font>).arg(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>()), <font class="keyword">true</font>);
00834         }
00835         }
00836         <font class="keywordflow">else</font> <font class="keywordflow">if</font>  (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) {
00837             <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>() )
00838                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );
00839         }
00840     }
00841 }
00842 
<a name="l00844"></a><a class="code" href="class_c_group_manager.html#c7">00844</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c7">CGroupManager::contentsMouseMoveEvent</a> ( QMouseEvent * e) {
00845     KListView::contentsMouseMoveEvent( e ); 
00846     <font class="keywordflow">if</font> (!m_useDragDrop)
00847         <font class="keywordflow">return</font>;
00848     
00849     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* dragItem=(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *)itemAt( contentsToViewport(e-&gt;pos()) );
00850 
00851     <font class="comment">//mouse is pressed, an item is selected and the popup menu isn't opened</font>
00852     <font class="keywordflow">if</font> ( (e-&gt;state()&amp;LeftButton) &amp;&amp; (e-&gt;stateAfter()&amp;LeftButton) &amp;&amp; dragItem &amp;&amp; !m_menu) {
00853         <font class="comment">//Is it time to start a drag?</font>
00854     <font class="keywordflow">if</font> (abs(e-&gt;pos().x() - m_pressedPos.x()) &gt; KGlobalSettings::dndEventDelay() ||
00855                 abs(e-&gt;pos().y() - m_pressedPos.y()) &gt; KGlobalSettings::dndEventDelay() )   {
00856         <font class="comment">// Collect all selected items</font>
00857 <font class="comment">//      ASSERT(m_itemList);</font>
00858         m_itemList = <font class="keyword">new</font> QPtrList&lt;CGroupManagerItem&gt;;
00859         QListViewItemIterator it( <font class="keyword">this</font> );
00860         <font class="keywordflow">for</font>( ; it.current(); it++ )
00861         <font class="keywordflow">if</font> ( it.current()-&gt;isSelected() )
00862                     m_itemList-&gt;append( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );                             
00863         QTextDrag *d = 0;
00864         <font class="keywordflow">if</font> (!dragItem)
00865             <font class="keywordflow">return</font>;
00866             <font class="keywordflow">switch</font> (dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()){
00867                 <font class="keywordflow">case</font> (CGroupManagerItem::Bookmark):
00868              <font class="keywordflow">if</font> (dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00869                 QString ref = dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>();
00870                 QString mod = dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>();
00871                     
00872                 d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(mod,ref), viewport());
00873                 d-&gt;setSubtype(BOOKMARK);
00874                     m_dragType = BOOKMARK;
00875                     }
00876                     <font class="keywordflow">break</font>;                  
00877 <font class="comment">//              case (CGroupManagerItem::Module):</font>
00878 <font class="comment">//                  d = new QTextDrag( "" , viewport());</font>
00879 <font class="comment">//                  d-&gt;setSubtype(MODULE);</font>
00880 <font class="comment">//                  m_dragType = MODULE;</font>
00881 <font class="comment">//                  break;                  </font>
00882 <font class="comment">//              case (CGroupManagerItem::Group):</font>
00883 <font class="comment">//                  d = new QTextDrag( "" , viewport());</font>
00884 <font class="comment">//                  d-&gt;setSubtype(GROUP);</font>
00885 <font class="comment">//                  m_dragType = GROUP;</font>
00886 <font class="comment">//                  break;</font>
00887             }
00888             
00889             <font class="keywordflow">if</font> (d) {
00890                 d-&gt;setPixmap( *(dragItem-&gt;pixmap(0)) );
00891                 m_menu = <font class="keyword">false</font>;
00892                 d-&gt;drag();
00893             }           
00894         }
00895     }
00896 }
00897 
<a name="l00899"></a><a class="code" href="class_c_group_manager.html#h6">00899</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h6">CGroupManager::slotCreateNewGroup</a>(){
00900     <font class="keywordtype">bool</font> isOk;
00901     QString groupname = QInputDialog::getText(i18n(<font class="stringliteral">"Enter name of folder - BibleTime"</font>),i18n(<font class="stringliteral">"Please enter the name of the folder!"</font>),QLineEdit::Normal,QString::null, &amp;isOk);
00902     <font class="keywordflow">if</font> (isOk) {
00903         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00904             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(m_pressedItem, groupname, QString::null, 0,0, CGroupManagerItem::Group);
00905             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00906         }
00907         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group){
00908             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>(), groupname, QString::null, 0,0, CGroupManagerItem::Group);
00909             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00910         }
00911         <font class="keywordflow">else</font> {
00912             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, groupname, QString::null, 0, 0,CGroupManagerItem::Group);
00913         }
00914     }
00915 }
00916 
<a name="l00917"></a><a class="code" href="class_c_group_manager.html#c8">00917</a> <font class="keyword">const</font> <font class="keywordtype">int</font> <a class="code" href="class_c_group_manager.html#c8">CGroupManager::parentId</a>(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *item, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem)
00918 {
00919     <font class="comment">// search parent of item and return the id of the parent</font>
00920     <font class="keywordtype">int</font> ret = -1;   <font class="comment">// the view and the parent item have id -1</font>
00921     <font class="keywordtype">int</font> index = 0;
00922     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
00923     
00924     <font class="keywordflow">if</font> (item) {
00925         <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; item != parentItem) {
00926           QListViewItemIterator it;
00927           <font class="keywordflow">if</font> (parentItem) {
00928             it = QListViewItemIterator( parentItem );       
00929           }
00930           <font class="keywordflow">else</font>
00931             it = QListViewItemIterator( <font class="keyword">this</font> );
00932             
00933             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() == parentItem)
00934                 <font class="keywordflow">return</font> -1;
00935             <font class="keywordflow">while</font> (it.current() &amp;&amp; (it.current() != item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) ) {
00936                 myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current();
00937                 <font class="keywordflow">if</font> (parentItem &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(parentItem, myItem) ) {
00938                     it++;
00939                     <font class="keywordflow">continue</font>;
00940                 }
00941                 <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00942                     index++;
00943                 }
00944                 it++;
00945             }
00946             <font class="keywordflow">if</font> (it.current())
00947                 ret = index;
00948         }
00949     }
00950     <font class="keywordflow">return</font> ret;
00951 }
00952 
<a name="l00954"></a><a class="code" href="class_c_group_manager.html#c9">00954</a> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* <a class="code" href="class_c_group_manager.html#c9">CGroupManager::findParent</a>( <font class="keyword">const</font> <font class="keywordtype">int</font> ID, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem){
00955     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
00956     <font class="keywordtype">int</font> index = 0;
00957     
00958     QListViewItemIterator it;
00959   <font class="keywordflow">if</font> (parentItem)
00960     it = QListViewItemIterator(parentItem);
00961   <font class="keywordflow">else</font>
00962       it = QListViewItemIterator(<font class="keyword">this</font>);
00963 
00964   <font class="comment">//traverse the tree and try to find the group with the id ID index using comparision</font>
00965   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
00966         myItem = dynamic_cast&lt;CGroupManagerItem*&gt;( it.current() );
00967         <font class="keywordflow">if</font> ( parentItem &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(parentItem, myItem) ) {
00968             <font class="keywordflow">continue</font>;
00969         }       
00970         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00971             <font class="keywordflow">if</font> (index == ID) {              
00972                 <font class="keywordflow">return</font> myItem;
00973             }
00974             <font class="keywordflow">else</font>
00975                 index++;
00976         }
00977     }       
00978     <font class="keywordflow">return</font> 0;   <font class="comment">// return 0 if parent wasn't found</font>
00979 }
00980 
<a name="l00982"></a><a class="code" href="class_c_group_manager.html#g0">00982</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g0">CGroupManager::slotUnlockModule</a>(){ 
00983     <font class="keywordtype">bool</font> ok;
00984     QString unlockKey = QInputDialog::getText(i18n(<font class="stringliteral">"BibleTime - Unlock module"</font>),i18n(<font class="stringliteral">"Enter the key to unlock the module!"</font>),QLineEdit::Normal, m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::CipherKey), &amp;ok);
00985     <font class="keywordflow">if</font> (ok) {
00986         <a class="code" href="class_c_sword_module_info.html#s29">CSwordModuleInfo::UnlockErrorCode</a> ret = m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a6">unlock</a>( unlockKey );
00987         <font class="keywordflow">if</font> ( ret != CSwordModuleInfo::noError) {
00988             <font class="comment">//an error occured</font>
00989             <font class="keywordflow">switch</font> (ret) {
00990                 <font class="keywordflow">case</font> CSwordModuleInfo::noPermission:                
00991                     <font class="keywordflow">break</font>;
00992                 <font class="keywordflow">case</font> CSwordModuleInfo::wrongUnlockKey:              
00993                     <font class="keywordflow">break</font>;
00994                 <font class="keywordflow">case</font> CSwordModuleInfo::notLocked:
00995                     <font class="keywordflow">break</font>;
00996                     
00997                 <font class="keywordflow">default</font>:
00998                     <font class="keywordflow">break</font>;
00999             }
01000         }
01001     }
01002 }
01003 
<a name="l01005"></a><a class="code" href="class_c_group_manager.html#c12">01005</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c12">CGroupManager::readSwordBookmarks</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> Action){
01006     <font class="comment">//read and create group entries</font>
01007     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;  
01008     
01009     QStringList groupList = configFile-&gt;readListEntry(<font class="stringliteral">"Groups"</font>);
01010 
01011     <font class="comment">//read in all bookmarks</font>
01012     QStringList bookmarkList                            = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmarks"</font>);
01013     QStringList bookmarkModulesList             = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmark modules"</font>);
01014     QStringList bookmarkDescriptionsList    = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmark descriptions"</font>);
01015     QValueList&lt;int&gt; parentList                      = configFile-&gt;readIntListEntry(<font class="stringliteral">"Bookmark parents"</font>);
01016 
01017     QStringList::Iterator it_bookmarks  = bookmarkList.begin();
01018     QStringList::Iterator it_modules        = bookmarkModulesList.begin();
01019     QStringList::Iterator it_descriptions   = bookmarkDescriptionsList.begin();
01020     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01021 
01022     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* moduleInfo = 0;
01023     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *myItem = 0;  
01024     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *oldItem = 0;
01025 
01026     <font class="keywordflow">while</font> ( it_bookmarks != bookmarkList.end() &amp;&amp; it_parents != parentList.end()
01027                     &amp;&amp; it_modules != bookmarkModulesList.end() ) {
01028         moduleInfo = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>((*it_modules));
01029         <font class="keywordflow">if</font> ( (*it_parents) == -1) {
01030             <font class="keywordflow">if</font> (group)
01031                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_bookmarks), (*it_modules), moduleInfo, 0, CGroupManagerItem::Bookmark);
01032             <font class="keywordflow">else</font>
01033                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_bookmarks), (*it_modules), moduleInfo, 0, CGroupManagerItem::Bookmark);
01034         }
01035         <font class="keywordflow">else</font> {
01036             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents), group ? group : 0 );
01037             <font class="keywordflow">if</font> (parentItem)
01038                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01039             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group)
01040                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01041             <font class="keywordflow">else</font>
01042                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01043         }
01044         <font class="keywordflow">if</font> (myItem &amp;&amp; it_descriptions != bookmarkDescriptionsList.end())
01045             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>( *it_descriptions );
01046         <font class="keywordflow">if</font> (myItem &amp;&amp; oldItem) {
01047             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a17">moveAfter</a>(oldItem);
01048         }
01049         oldItem = myItem;
01050 
01051         ++it_parents;
01052         ++it_modules;
01053         ++it_descriptions;
01054         ++it_bookmarks;
01055     }
01056     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01057 }
01058 
<a name="l01060"></a><a class="code" href="class_c_group_manager.html#c11">01060</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c11">CGroupManager::saveSwordBookmarks</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> Action){
01061     <font class="keywordtype">int</font> parentID = 0;
01062     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01063     QStringList groupList;
01064     QValueList&lt;int&gt; parentList;
01065     QStringList bookmarkList;   
01066     QStringList bookmarkModuleList; 
01067     QStringList bookmarkDescriptionList;        
01068     QListViewItemIterator it;
01069     
01070     <font class="comment">//save bookmarks</font>
01071     parentList.clear();
01072     bookmarkList.clear();
01073     bookmarkModuleList.clear();
01074     bookmarkDescriptionList.clear();
01075 
01076     <font class="keywordflow">if</font> (group)
01077         it = QListViewItemIterator ( group );
01078     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() == 0) {
01079         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01080     }
01081     <font class="keywordflow">else</font>
01082         it = QListViewItemIterator (<font class="keyword">this</font>);
01083 
01084   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01085         myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current();
01086     <font class="keywordflow">if</font> (group)
01087         <font class="keywordflow">if</font> (!<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem)) {
01088                 <font class="keywordflow">continue</font>;                   
01089             }
01090         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)  {
01091             <font class="keywordflow">if</font> (group) {
01092                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( dynamic_cast&lt;CGroupManagerItem*&gt;(it.current()),m_pressedItem );    
01093             }
01094             <font class="keywordflow">else</font> {
01095                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( dynamic_cast&lt;CGroupManagerItem*&gt;(it.current()) );  
01096             }
01097             parentList.append( parentID );
01098 
01099             <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>();                                  
01100             <font class="keywordflow">if</font> (key)    {
01101                 VerseKey* vk = dynamic_cast&lt;VerseKey*&gt;(key);
01102                 QString oldLocale;
01103                 <font class="keywordflow">if</font> (vk) {
01104                     oldLocale = QString::fromLatin1(vk-&gt;getLocale());
01105                     vk-&gt;setLocale(<font class="stringliteral">"en"</font>); <font class="comment">//save the english key names</font>
01106                 }
01107                 bookmarkList.append( key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>() );
01108                 <font class="keywordflow">if</font> (vk) {
01109                     vk-&gt;setLocale(oldLocale.latin1());
01110                 }
01111             }
01112             <font class="keywordflow">else</font>
01113                 bookmarkList.append(<font class="stringliteral">""</font>);    <font class="comment">//invalid key</font>
01114                 
01115             <font class="keywordflow">if</font> (myItem &amp;&amp; !myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>().isEmpty()) <font class="comment">//save description</font>
01116                 bookmarkDescriptionList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>() );
01117             <font class="keywordflow">else</font>
01118                 bookmarkDescriptionList.append( QString::null );
01119                 
01120             <font class="keywordflow">if</font> (myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) { <font class="comment">//save the module</font>
01121                 bookmarkModuleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>() );
01122             }
01123             <font class="keywordflow">else</font> {
01124                 bookmarkModuleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#o6">m_moduleName</a> );
01125             }
01126         }
01127     }   
01128     
01129     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmarks"</font>, bookmarkList);
01130     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark descriptions"</font>, bookmarkDescriptionList);
01131     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark modules"</font>, bookmarkModuleList);
01132     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark parents"</font>, parentList);
01133     
01134     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01135 }
01136 
<a name="l01138"></a><a class="code" href="class_c_group_manager.html#h8">01138</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h8">CGroupManager::slotImportBookmarks</a>(){
01139     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
01140         QString file = KFileDialog::getOpenFileName(QString::null, <font class="stringliteral">"*.btb | *.btb"</font>, 0, i18n(<font class="stringliteral">"Import bookmarks ..."</font>));   
01141         <font class="keywordflow">if</font> (!file.isNull()) {
01142             KSimpleConfig simpleConfig(file, <font class="keyword">false</font>);
01143             simpleConfig.setGroup(<font class="stringliteral">"Bookmarks"</font>);
01144             <font class="keywordtype">short</font> <font class="keywordtype">int</font> formatVersion = simpleConfig.readNumEntry(<font class="stringliteral">"Bookmark format version"</font>, -1);
01145             
01146             <font class="comment">//bookmark format of imported file is newer than our version            </font>
01147             <font class="keywordflow">if</font> (formatVersion &gt; BOOKMARK_FORMAT_VERSION) {
01148                 <font class="keyword">const</font> <font class="keywordtype">int</font> retValue = KMessageBox::warningContinueCancel(<font class="keyword">this</font>, i18n(<font class="stringliteral">"&lt;qt&gt;A problem occurred while importing bookmarks!&lt;BR&gt;\</font>
01149 <font class="stringliteral">The bookmarks format of the imported file is newer&lt;BR&gt;\</font>
01150 <font class="stringliteral">than the bookmarks format version of this version of BibleTime!&lt;BR&gt;\</font>
01151 <font class="stringliteral">&lt;B&gt;Importing the bookmarks may not work correctly!&lt;/B&gt;&lt;BR&gt;Do you want to continue?&lt;/qt&gt;"</font>), i18n(<font class="stringliteral">"Import of bookmarks"</font>), i18n(<font class="stringliteral">"Continue"</font>) );
01152                 <font class="keywordflow">if</font> ( retValue != KMessageBox::Continue )
01153                     <font class="keywordflow">return</font>;
01154             }
01155             
01156             <a class="code" href="class_c_group_manager.html#c16">readGroups</a>(&amp;simpleConfig, m_pressedItem, Import);           
01157             <a class="code" href="class_c_group_manager.html#c12">readSwordBookmarks</a>(&amp;simpleConfig, m_pressedItem, Import);
01158         }
01159     }
01160 }
01161 
<a name="l01163"></a><a class="code" href="class_c_group_manager.html#h7">01163</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h7">CGroupManager::slotExportBookmarks</a>(){
01164     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
01165         QString file = KFileDialog::getSaveFileName (QString::null, <font class="stringliteral">"*.btb | *.btb"</font>, 0, i18n(<font class="stringliteral">"Export bookmarks ..."</font>));  
01166         <font class="keywordflow">if</font> (!file.isNull()) {
01167             KSimpleConfig simpleConfig(file, <font class="keyword">false</font>);
01168             simpleConfig.setGroup(<font class="stringliteral">"Bookmarks"</font>);         
01169             simpleConfig.writeEntry(<font class="stringliteral">"Bookmark format version"</font>, BOOKMARK_FORMAT_VERSION);
01170             
01171             <a class="code" href="class_c_group_manager.html#c15">saveGroups</a>(&amp;simpleConfig, m_pressedItem, Export);
01172             <a class="code" href="class_c_group_manager.html#c11">saveSwordBookmarks</a>(&amp;simpleConfig, m_pressedItem, Export);
01173             simpleConfig.sync();
01174         }
01175     }
01176 }
01177 
01178 
<a name="l01179"></a><a class="code" href="class_c_group_manager.html#c14">01179</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c14">CGroupManager::readSwordModules</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01180     <font class="keywordflow">if</font> (!m_swordList) {
01181         qWarning(<font class="stringliteral">"CGroupManager::readSwordModules: no sword modules, return and do nothing."</font>);
01182         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01183     }
01184     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;  
01185 
01186     QStringList moduleList = configFile-&gt;readListEntry(<font class="stringliteral">"Modules"</font>);
01187     QValueList&lt;int&gt; parentList = configFile-&gt;readIntListEntry(<font class="stringliteral">"Module parents"</font>);        
01188     QStringList::Iterator it_modules = moduleList.begin();
01189     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01190     
01191     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* myModuleInfo = 0;
01192     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01193     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* oldItem = 0;
01194     
01195     <font class="keywordflow">while</font> ( it_modules != moduleList.end() &amp;&amp; it_parents != parentList.end() ) {        
01196         <font class="keywordflow">if</font> ((*it_modules).isEmpty() || !( myModuleInfo = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(*it_modules) )) {  <font class="comment">//the module was removed so we don't show it</font>
01197             ++it_parents;
01198             ++it_modules;
01199             <font class="keywordflow">continue</font>;
01200         }
01201             
01202         <font class="keywordflow">if</font> ( (*it_parents) == -1) { <font class="comment">//module on top</font>
01203             parentItem = group; <font class="comment">//instead of group ? group : 0;</font>
01204         }
01205         <font class="keywordflow">else</font> {
01206             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents), group );
01207             <font class="keywordflow">if</font> (!parentItem)
01208                 parentItem = group;
01209         }
01210 
01211         <font class="keywordflow">if</font> (parentItem) {
01212             myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, QString::null, QString::null, myModuleInfo,0, CGroupManagerItem::Module);
01213         }
01214         <font class="keywordflow">else</font>
01215             myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, QString::null, QString::null, myModuleInfo,0, CGroupManagerItem::Module);      
01216         
01217         <font class="keywordflow">if</font> (myItem &amp;&amp; oldItem)
01218             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a17">moveAfter</a>(oldItem);
01219         
01220         oldItem = myItem;
01221             
01222         ++it_parents;
01223         ++it_modules;
01224     }   
01225     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01226 };
01227 
<a name="l01228"></a><a class="code" href="class_c_group_manager.html#c13">01228</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c13">CGroupManager::saveSwordModules</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01229     <font class="keywordtype">int</font> parentID = 0;
01230     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01231     QValueList&lt;int&gt; parentList;
01232     QStringList moduleList; 
01233     
01234     QListViewItemIterator it;
01235     
01236     parentList.clear();
01237     moduleList.clear();
01238 
01239     <font class="keywordflow">if</font> (group)
01240         it = QListViewItemIterator( group );
01241     <font class="keywordflow">else</font>
01242         it = QListViewItemIterator(<font class="keyword">this</font>);
01243 
01244   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01245             myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*) it.current();
01246         <font class="keywordflow">if</font> (group)
01247             <font class="keywordflow">if</font> (!<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem))
01248                     <font class="keywordflow">continue</font>;                   
01249             
01250             <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module)  {
01251                 <font class="keywordflow">if</font> (group)
01252                     parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current(),m_pressedItem );  
01253                 <font class="keywordflow">else</font>
01254                     parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );    
01255                 parentList.append( parentID );
01256                 
01257                 <font class="keywordflow">if</font> (myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
01258                     moduleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>() );              
01259                 <font class="keywordflow">else</font> {
01260                     moduleList.append( myItem-&gt;text(0) );   <font class="comment">//first column is the modulename</font>
01261                 }
01262             }
01263     }   
01264     configFile-&gt;writeEntry(<font class="stringliteral">"Modules"</font>, moduleList);
01265     configFile-&gt;writeEntry(<font class="stringliteral">"Module parents"</font>, parentList);
01266 
01267     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01268 }
01269 
<a name="l01270"></a><a class="code" href="class_c_group_manager.html#c16">01270</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c16">CGroupManager::readGroups</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> Action action) {
01271     qWarning(<font class="stringliteral">"CGroupManager::readGroups(KConfig* configFile, CGroupManagerItem* group, const Action action)"</font>);
01272  <font class="comment">//read and create group entries</font>
01273     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
01274     <font class="keywordtype">bool</font> groupExists = <font class="keyword">false</font>;   
01275     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* oldItem = 0;
01276     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* newItem = 0;
01277     
01278     QStringList groupList = configFile-&gt;readListEntry(<font class="stringliteral">"Groups"</font>);
01279     QValueList&lt;int&gt; parentList = configFile-&gt;readIntListEntry(<font class="stringliteral">"Group parents"</font>);
01280     
01281     QStringList::Iterator it_groups = groupList.begin();
01282     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01283     
01284     <font class="keywordflow">while</font> ( (it_groups != groupList.end()) &amp;&amp; (it_parents != parentList.end()) ) {
01285         groupExists = <font class="keyword">false</font>;
01286         <font class="keywordflow">if</font> ( (*it_parents) == -1) { <font class="comment">//no parent item saved</font>
01287             <font class="keywordflow">if</font> (action == Import) { <font class="comment">//try to find existing group</font>
01288                 <font class="keywordflow">if</font> (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* existingGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(*it_groups, group, *it_parents))
01289                     groupExists = <font class="keyword">true</font>;
01290             }
01291             <font class="keywordflow">else</font>
01292                 parentItem = group;
01293         }
01294         <font class="keywordflow">else</font> {
01295             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents),group );
01296             <font class="keywordflow">if</font> (!parentItem)
01297                 parentItem = group;
01298         }
01299         
01300         <font class="keywordflow">if</font> (!groupExists) {         
01301             <font class="keywordflow">if</font> (parentItem) {
01302                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, (*it_groups), QString::null, 0,0, CGroupManagerItem::Group);
01303             }
01304             <font class="keywordflow">else</font> {
01305                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_groups), QString::null, 0,0, CGroupManagerItem::Group);
01306             }
01307         
01308             <font class="keywordflow">if</font> (newItem &amp;&amp; oldItem ) {          
01309                 newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a17">moveAfter</a>( oldItem );
01310             }
01311             <font class="keywordflow">if</font> (newItem) {
01312                 <font class="comment">/* we can't move a topgroup behind a subgroup, so we use multiple</font>
01313 <font class="comment">                 parent calls</font>
01314 <font class="comment">                */</font>
01315                 <font class="keywordflow">while</font> (<a class="code" href="class_c_group_manager.html#c8">parentId</a>(newItem) &gt; *it_parents) {
01316                     <font class="keywordflow">if</font> ( (group &amp;&amp; <a class="code" href="class_c_group_manager.html#a8">isChild</a>(group, newItem)) || (newItem &amp;&amp; newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) )
01317                         newItem = newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
01318                     <font class="keywordflow">else</font>
01319                         <font class="keywordflow">break</font>;
01320                 }
01321                 oldItem = newItem;
01322             }                   
01323         }
01324         
01325         ++it_parents;
01326         ++it_groups;
01327     }   
01328     <font class="keywordflow">return</font> <font class="keyword">true</font>;    
01329 };
01330 
<a name="l01331"></a><a class="code" href="class_c_group_manager.html#c15">01331</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c15">CGroupManager::saveGroups</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, Action normal) {
01332     <font class="keywordtype">int</font> parentID = 0;
01333     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01334     QStringList groupList;
01335     QValueList&lt;int&gt; parentList;
01336     
01337     QListViewItemIterator it;
01338     
01339     <font class="comment">//save groups   </font>
01340     <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() &gt; 0)
01341         it = QListViewItemIterator ( group-&gt;firstChild() );
01342     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() == 0) {
01343         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01344     }
01345     <font class="keywordflow">else</font>
01346       it = QListViewItemIterator ( <font class="keyword">this</font> );
01347 
01348   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01349         myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*) it.current();
01350     <font class="keywordflow">if</font> (group &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem))
01351             <font class="keywordflow">continue</font>;       
01352         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)  {
01353             <font class="keywordflow">if</font> (group)
01354                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current(), m_pressedItem );
01355             <font class="keywordflow">else</font>
01356                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );
01357             groupList.append( myItem-&gt;text(0) );
01358             parentList.append( parentID );
01359         }
01360     }
01361     configFile-&gt;writeEntry(<font class="stringliteral">"Groups"</font>, groupList);
01362     configFile-&gt;writeEntry(<font class="stringliteral">"Group parents"</font>, parentList);
01363     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01364 }
01365 
<a name="l01367"></a><a class="code" href="class_c_group_manager.html#a8">01367</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#a8">CGroupManager::isChild</a>(QListViewItem* parent, QListViewItem* child){
01368     QListViewItem *myParent = child;
01369     <font class="keywordflow">while</font> (myParent &amp;&amp; myParent != parent )
01370         myParent = myParent-&gt;parent();      
01371     <font class="keywordflow">return</font> (myParent == parent) &amp;&amp; (parent != child);
01372 }
01373 
<a name="l01375"></a><a class="code" href="class_c_group_manager.html#h9">01375</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h9">CGroupManager::viewportPaintEvent</a>(QPaintEvent* e) {
01376   KListView::viewportPaintEvent(e);
01377 
01378   <font class="keywordflow">if</font> (m_oldDragRect.isValid())
01379   {
01380     <font class="keyword">static</font> <font class="keywordtype">bool</font> invalidated=<font class="keyword">false</font>;
01381     <font class="keywordflow">if</font> (!invalidated)
01382     {
01383       invalidated=<font class="keyword">true</font>;
01384 <font class="preprocessor">#warning deleting this made the drop visualization work again. No idea why. ;)</font>
01385 <font class="preprocessor"></font><font class="preprocessor">#warning please somebody with more in-depth knowledge check this.</font>
01386 <font class="preprocessor"></font><font class="comment">//      viewport()-&gt;repaint(m_oldDragRect);</font>
01387     }
01388     QPainter painter(viewport());
01389     <a class="code" href="class_c_group_manager.html#h10">drawDropVisualizer</a>(&amp;painter, m_parentItemDrop, m_afterItemDrop, <font class="stringliteral">""</font>);
01390     invalidated=<font class="keyword">false</font>;
01391   }
01392 }
01393 
<a name="l01395"></a><a class="code" href="class_c_group_manager.html#h10">01395</a> <font class="keyword">const</font> QRect <a class="code" href="class_c_group_manager.html#h10">CGroupManager::drawDropVisualizer</a> (QPainter *p, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *<font class="comment">/*parent*/</font>, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *after, <font class="keyword">const</font> QString&amp; <font class="comment">/*type*/</font>){
01396   QRect insertmarker;
01397   <font class="keywordtype">bool</font> useParent = <font class="keyword">false</font>;
01398         
01399     <font class="keywordflow">if</font> ( m_dragType == BOOKMARK ) {     <font class="comment">//we are moving a module</font>
01400         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01401             insertmarker = itemRect(after);
01402         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )            
01403             insertmarker = QRect(itemRect(after));
01404         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark ) {
01405             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01406                 useParent = <font class="keyword">true</font>;
01407                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());   <font class="comment">//paint nothing</font>
01408             }
01409             <font class="keywordflow">else</font>
01410                 insertmarker = QRect();
01411         }
01412         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01413             useParent = <font class="keyword">true</font>;
01414             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());               
01415         }
01416         <font class="keywordflow">else</font> <font class="comment">//if (!after)</font>
01417             insertmarker = QRect(); <font class="comment">//this-&gt;visibleRect();      </font>
01418 <font class="comment">//      else</font>
01419 <font class="comment">//          insertmarker = QRect();</font>
01420     }
01421     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_dragType == REFERENCE ) {   <font class="comment">//we are moving a reference</font>
01422         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01423             insertmarker = itemRect(after);
01424         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )         
01425             insertmarker = QRect(itemRect(after));
01426         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark ) {
01427             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01428                 useParent = <font class="keyword">true</font>;
01429                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01430             }
01431             <font class="keywordflow">else</font>
01432                 insertmarker = QRect();     <font class="comment">//paint nothing         </font>
01433         }
01434         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01435             useParent = <font class="keyword">true</font>;
01436             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());               
01437         }
01438         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!after)
01439             insertmarker = QRect(); <font class="comment">//this-&gt;visibleRect();</font>
01440         <font class="keywordflow">else</font>
01441             insertmarker = QRect();
01442     }
01443 <font class="comment">//  else if ( m_dragType == MODULE ) {  //we are moving a reference</font>
01444 <font class="comment">//      if ( after &amp;&amp; after-&gt;type() == CGroupManagerItem::Group)</font>
01445 <font class="comment">//          insertmarker = itemRect(after);</font>
01446 <font class="comment">//      else if ( after &amp;&amp; (after-&gt;type() == CGroupManagerItem::Module || after-&gt;type() == CGroupManagerItem::Bookmark) ) {</font>
01447 <font class="comment">//          if (after-&gt;parent()) {</font>
01448 <font class="comment">//              useParent = true;</font>
01449 <font class="comment">//              insertmarker = itemRect(after-&gt;parent());</font>
01450 <font class="comment">//          }</font>
01451 <font class="comment">//          else</font>
01452 <font class="comment">//              insertmarker = QRect();     //paint nothing         </font>
01453 <font class="comment">//      }       </font>
01454 <font class="comment">//      else if ( after &amp;&amp; after-&gt;parent() &amp;&amp; after-&gt;parent()-&gt;type() == CGroupManagerItem::Group ) {</font>
01455 <font class="comment">//          useParent = true;</font>
01456 <font class="comment">//          insertmarker = itemRect(after-&gt;parent());</font>
01457 <font class="comment">//      }</font>
01458 <font class="comment">//      else if (!after)</font>
01459 <font class="comment">//          insertmarker = QRect();//this-&gt;visibleRect();</font>
01460 <font class="comment">//      else</font>
01461 <font class="comment">//          insertmarker = QRect();</font>
01462 <font class="comment">//  }   </font>
01463 <font class="comment">//  else if (m_dragType == TEXT) {</font>
01464 <font class="comment">//      if ( after &amp;&amp; after &amp;&amp; after-&gt;type() == CGroupManagerItem::Module )         </font>
01465 <font class="comment">//          insertmarker = QRect(itemRect(after));</font>
01466 <font class="comment">//      else</font>
01467 <font class="comment">//          insertmarker = QRect();</font>
01468 <font class="comment">//  }</font>
01469 <font class="comment">//  else if (m_pressedItem) {</font>
01470 <font class="comment">//      if ( m_pressedItem-&gt;type() == CGroupManagerItem::Group  ) { //we are moving a group</font>
01471 <font class="comment">//          if (after &amp;&amp; after-&gt;type() == CGroupManagerItem::Group)</font>
01472 <font class="comment">//              insertmarker = itemRect(after);</font>
01473 <font class="comment">//          else if (after &amp;&amp; after-&gt;parent() &amp;&amp; after-&gt;parent()-&gt;type() == CGroupManagerItem::Group) {</font>
01474 <font class="comment">//              useParent = true;</font>
01475 <font class="comment">//              insertmarker = itemRect(after-&gt;parent());</font>
01476 <font class="comment">//          }</font>
01477 <font class="comment">//          else if (!after)</font>
01478 <font class="comment">//              insertmarker = QRect();//this-&gt;visibleRect();</font>
01479 <font class="comment">//      else</font>
01480 <font class="comment">//          insertmarker = QRect();</font>
01481 <font class="comment">//      }</font>
01482 <font class="comment">//  }</font>
01483 <font class="comment">//</font>
01484 <font class="comment">//  if ( p &amp;&amp; insertmarker.isValid() )  {</font>
01485 <font class="comment">//      if (useParent)</font>
01486 <font class="comment">//          insertmarker.setLeft( treeStepSize()*(after-&gt;parent()-&gt;depth()+(rootIsDecorated() ? 1 :0 ))+itemMargin()- contentsX());</font>
01487 <font class="comment">//      else</font>
01488 <font class="comment">//          insertmarker.setLeft( treeStepSize()*(after-&gt;depth()+(rootIsDecorated() ? 1 :0 ))+itemMargin() - contentsX());</font>
01489 <font class="comment">//      style().drawPrimitive( QStyle::PE_FocusRect, p, insertmarker, colorGroup(), QStyle::Style_HasFocus);</font>
01491 <font class="comment">//  }</font>
01492 <font class="comment">//  else if (!insertmarker.isValid()) {</font>
01493 <font class="comment">//      cleanDropVisualizer();</font>
01494 <font class="comment">//  }</font>
01495   <font class="keywordflow">return</font> insertmarker;
01496 }
01497 
<a name="l01499"></a><a class="code" href="class_c_group_manager.html#h11">01499</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h11">CGroupManager::cleanDropVisualizer</a>(){
01500   <font class="keywordflow">if</font> ( m_oldDragRect.isValid() ) {
01501     QRect rect = m_oldDragRect;
01502     m_oldDragRect = QRect();
01503     viewport()-&gt;repaint(rect,<font class="keyword">true</font>);
01504   }
01505 }
01506 
<a name="l01508"></a><a class="code" href="class_c_group_manager.html#g1">01508</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g1">CGroupManager::slotReset</a>(){
01509     <font class="keywordtype">int</font> result = 0;
01510     <font class="keywordflow">if</font> (m_showHelpDialogs)
01511         result = KMessageBox:: warningContinueCancel( <font class="keyword">this</font>, i18n(<font class="stringliteral">"&lt;qt&gt;This function will reset the main index!&lt;BR&gt;This will recreate the original groups and delete all other items!&lt;BR&gt;Be sure no important bookmarks will be deleted!&lt;BR&gt;Do you want to continue?&lt;/qt&gt;"</font>), i18n(<font class="stringliteral">"BibleTime - Reset main index"</font>), i18n(<font class="stringliteral">"Continue"</font>));
01512     <font class="keywordflow">else</font>
01513         result = KMessageBox::Continue;
01514         
01515     <font class="keywordflow">if</font> (result == KMessageBox::Continue) {
01516         clear();
01517         <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
01518     }
01519 }
01520 
<a name="l01522"></a><a class="code" href="class_c_group_manager.html#h14">01522</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h14">CGroupManager::slotPrintBookmark</a>(){    
01523     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() != CGroupManagerItem::Bookmark) )
01524         <font class="keywordflow">return</font>;
01525     <a class="code" href="class_c_export_manager.html#d7">CExportManager::printKey</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>()-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(), QString::null, m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>() );
01526 }
01527 
<a name="l01529"></a><a class="code" href="class_c_group_manager.html#h15">01529</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h15">CGroupManager::slotDeleteSearchdialog</a>(){
01530     <font class="keywordflow">if</font> (m_searchDialog)
01531         m_searchDialog-&gt;delayedDestruct();  <font class="comment">//delete the search dialog</font>
01532     m_searchDialog = 0;
01533 }
01534 
<a name="l01536"></a><a class="code" href="class_c_group_manager.html#i0">01536</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#i0">CGroupManager::slotReturnPressed</a>( QListViewItem* i){
01537     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = dynamic_cast&lt;CGroupManagerItem*&gt;(i);
01538     <font class="keywordflow">if</font> (!item)
01539         <font class="keywordflow">return</font>; 
01540     <font class="keywordflow">switch</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>())    {
01541         <font class="keywordflow">case</font> CGroupManagerItem::Bookmark:
01542             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())             
01543                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(),item-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );           
01544             <font class="keywordflow">break</font>;
01545         <font class="keywordflow">case</font> CGroupManagerItem::Module:
01546             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
01547                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null);            
01548             <font class="keywordflow">break</font>;
01549         <font class="keywordflow">case</font> CGroupManagerItem::Group:
01550             item-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !item-&gt;isOpen() );
01551             <font class="keywordflow">break</font>;
01552         <font class="keywordflow">default</font>:
01553             <font class="keywordflow">break</font>;
01554     }
01555 }
01556 
<a name="l01558"></a><a class="code" href="class_c_group_manager.html#g2">01558</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g2">CGroupManager::resizeContents</a>( <font class="keywordtype">int</font> w, <font class="keywordtype">int</font> h ){
01559     <font class="keywordflow">if</font> (m_useDragDrop)
01560         KListView::resizeContents(w,h+25);
01561     <font class="keywordflow">else</font>
01562         KListView::resizeContents(w,h);
01563 }
01564 
<a name="l01566"></a><a class="code" href="class_c_group_manager.html#c17">01566</a> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* <a class="code" href="class_c_group_manager.html#c17">CGroupManager::findGroup</a>(<font class="keyword">const</font> QString&amp; name, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> <font class="keywordtype">int</font> id){
01567     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;    
01568     QListViewItemIterator it    ;
01569     <font class="keywordflow">if</font> (group)
01570         it = QListViewItemIterator(group);
01571     <font class="keywordflow">else</font>
01572         it = QListViewItemIterator(<font class="keyword">this</font>);
01573     
01574     <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
01575         item = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
01576         <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group &amp;&amp; item-&gt;text(0) == name &amp;&amp; <a class="code" href="class_c_group_manager.html#c8">parentId</a>(item, group) == id) { <font class="comment">//found the right group</font>
01577             <font class="keywordflow">if</font> (group &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(group, item))
01578                 item = 0;
01579             <font class="keywordflow">else</font>
01580                 <font class="keywordflow">break</font>;
01581         }
01582         <font class="keywordflow">else</font> {
01583             item = 0;
01584         }
01585     }
01586     <font class="keywordflow">if</font> (!item) {        
01587         <font class="keywordflow">if</font> (group)
01588             item = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, name, QString::null, 0, 0, CGroupManagerItem::Group);
01589         <font class="keywordflow">else</font>
01590             item = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, name, QString::null, 0, 0, CGroupManagerItem::Group);        
01591     }
01592   <font class="keywordflow">return</font> item;
01593 }
01594 
<a name="l01596"></a><a class="code" href="class_c_group_manager.html#c18">01596</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c18">CGroupManager::printTree</a>() {
01597     QListViewItemIterator it(<font class="keyword">this</font>);
01598     <font class="keywordflow">while</font> (it.current()) {
01599         QListViewItem* item = it.current();
01600         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; item-&gt;depth(); ++i) {
01601             cout &lt;&lt; <font class="stringliteral">"\t"</font>;
01602         }
01603         cout &lt;&lt; item-&gt;text(0).latin1() &lt;&lt; endl;
01604         ++it;
01605     };
01606 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:08 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
