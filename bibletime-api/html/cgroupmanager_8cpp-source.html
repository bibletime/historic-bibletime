<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cgroupmanager.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cgroupmanager.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cgroupmanager.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Wed Jan 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#define BOOKMARK_FORMAT_VERSION 1</font>
00019 <font class="preprocessor"></font>
00020 
00021 <font class="comment">//own includes</font>
00022 <font class="preprocessor">#include "cgroupmanager.h"</font>
00023 <font class="preprocessor">#include "cgroupmanageritem.h"</font>
00024 
00025 <font class="preprocessor">#include "../../backend/cswordbiblemoduleinfo.h"</font>
00026 <font class="preprocessor">#include "../../backend/cswordcommentarymoduleinfo.h"</font>
00027 <font class="preprocessor">#include "../../backend/cswordlexiconmoduleinfo.h"</font>
00028 <font class="preprocessor">#include "../../backend/cswordversekey.h"</font>
00029 <font class="preprocessor">#include "../../backend/cswordldkey.h"</font>
00030 <font class="preprocessor">#include "../../backend/creferencemanager.h"</font>
00031 <font class="preprocessor">#include "../../printing/cprintitem.h"</font>
00032 <font class="preprocessor">#include "../../printing/cprinter.h"</font>
00033 <font class="preprocessor">#include "../chtmldialog.h"</font>
00034 <font class="preprocessor">#include "../cinputdialog.h"</font>
00035 <font class="preprocessor">#include "../searchdialog/csearchdialog.h"</font>
00036 <font class="preprocessor">#include "../cbtconfig.h"</font>
00037 <font class="preprocessor">#include "../cexportmanager.h"</font>
00038 
00039 <font class="preprocessor">#include "../../whatsthisdef.h"</font>
00040 <font class="preprocessor">#include "../../resource.h"</font>
00041 
00042 <font class="comment">//QT includes</font>
00043 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00044 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00045 <font class="preprocessor">#include &lt;qmessagebox.h&gt;</font>
00046 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00047 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00048 <font class="preprocessor">#include &lt;qvaluelist.h&gt;</font>
00049 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00050 <font class="preprocessor">#include &lt;qinputdialog.h&gt;</font>
00051 
00052 <font class="comment">//KDE includes</font>
00053 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00054 <font class="preprocessor">#include &lt;kstddirs.h&gt;</font>
00055 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00056 <font class="preprocessor">#include &lt;kconfig.h&gt;</font>
00057 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00058 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00059 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00060 <font class="preprocessor">#include &lt;kdestyle.h&gt;</font>
00061 <font class="preprocessor">#include &lt;kpassdlg.h&gt;</font>
00062 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00063 <font class="preprocessor">#include &lt;kmessagebox.h&gt;</font>
00064 
00065 
00066 CGroupManager::ToolTip::ToolTip(QWidget* parent) : QToolTip(parent) {
00067 }
00068 
<a name="l00069"></a><a class="code" href="class_c_group_manager_1_1_tool_tip.html#a1">00069</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager_1_1_tool_tip.html#a1">CGroupManager::ToolTip::maybeTip</a>(<font class="keyword">const</font> QPoint&amp; p) {
00070     <font class="keywordflow">if</font> (!parentWidget()-&gt;inherits(<font class="stringliteral">"CGroupManager"</font>))
00071         <font class="keywordflow">return</font>;
00072     
00073     <a class="code" href="class_c_group_manager.html">CGroupManager</a>* m = 0;
00074     <font class="keywordflow">if</font> ( !(m = dynamic_cast&lt;CGroupManager*&gt;(parentWidget())) )
00075         <font class="keywordflow">return</font>; 
00076     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = 0;
00077     <font class="keywordflow">if</font> ( !( i = dynamic_cast&lt;CGroupManagerItem*&gt;(m-&gt;itemAt(p))) )
00078         <font class="keywordflow">return</font>;
00079     
00080     QRect r = m-&gt;itemRect(i);
00081     <font class="keywordflow">if</font> (!r.isValid())
00082         <font class="keywordflow">return</font>;
00083     
00084     <font class="comment">//get type of item and display correct text</font>
00085     <font class="keyword">const</font> QString text = i-&gt;<a class="code" href="class_c_group_manager_item.html#a16">getToolTip</a>();
00086     <font class="keywordflow">if</font> (!text.isEmpty()) {
00087         <font class="keyword">const</font> QFont oldFont = font();               
00088         <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = dynamic_cast&lt;CSwordModuleInfo*&gt;(i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00089 
00090         <font class="comment">//Module is Unicode-based. Only set font if a bookmark should be displayed</font>
00091         <font class="keywordflow">if</font> (i-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>() &amp;&amp; m &amp;&amp; m-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>() )
00092             setFont(CBTConfig::get( CBTConfig::unicode ));
00093 
00094         tip(r, text);
00095         setFont(oldFont);
00096     }
00097 }
00098 
00099 
00100 CGroupManager::CGroupManager(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name, ListCSwordModuleInfo *swordList, <font class="keyword">const</font> <font class="keywordtype">bool</font> useBookmarks, <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>, <font class="keyword">const</font> <font class="keywordtype">bool</font> useDnD, <font class="keyword">const</font> <font class="keywordtype">bool</font> useExtendedMode, <font class="keyword">const</font> <font class="keywordtype">bool</font> useRMBMenu, <font class="keyword">const</font> <font class="keywordtype">bool</font> showHelpDialogs)
00101     : KListView(parent, name),
00102         m_useBookmarks(useBookmarks), m_saveSettings(<a class="code" href="class_c_group_manager.html#a5">saveSettings</a>),
00103         m_useDragDrop(useDnD),
00104         m_useExtendedMode(useExtendedMode), m_useRMBMenu(useRMBMenu),
00105         m_showHelpDialogs(showHelpDialogs),
00106         m_config( new KConfig("bt-groupmanager", false, false ) ),
00107       m_menu(false),
00108         m_searchDialog(0),
00109         m_pressedItem(0),
00110         m_swordList(swordList)
00111 {
00112     <a class="code" href="class_c_group_manager.html#a6">initView</a>();
00113     <a class="code" href="class_c_group_manager.html#c0">initConnections</a>();
00114     <a class="code" href="class_c_group_manager.html#a4">readSettings</a>();
00115 }
00116 
00117 CGroupManager::~CGroupManager(){    
00118     <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>();
00119     m_config-&gt;sync();
00120     <font class="keyword">delete</font> m_config;
00121 }
00122 
<a name="l00124"></a><a class="code" href="class_c_group_manager.html#a2">00124</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a2">CGroupManager::setupSwordTree</a>() {
00125     <a class="code" href="class_c_group_manager.html#c16">readGroups</a>(m_config, 0);
00126     <a class="code" href="class_c_group_manager.html#c14">readSwordModules</a>(m_config, 0);  
00127     <font class="keywordflow">if</font> (m_useBookmarks)
00128         <a class="code" href="class_c_group_manager.html#c12">readSwordBookmarks</a>(m_config, 0);    
00129 
00130     <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
00131 }
00132 
<a name="l00134"></a><a class="code" href="class_c_group_manager.html#a3">00134</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a3">CGroupManager::setupStandardSwordTree</a>() {
00135     <font class="keywordflow">if</font> (!m_swordList || (m_swordList &amp;&amp; !m_swordList-&gt;count())) {
00136         qWarning(<font class="stringliteral">"CGroupManager::setupStandardSwordTree: m_swordList is empty or qual to NULL. return now."</font>);
00137         <font class="keywordflow">return</font>;
00138     }
00139     
00140     <font class="keyword">const</font> <font class="keywordtype">bool</font> initialized = m_config-&gt;readBoolEntry(<font class="stringliteral">"initialized"</font>, <font class="keyword">false</font>);
00141     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* moduleInfo = 0;
00142     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00143     QListViewItemIterator it( <font class="keyword">this</font> );
00144     
00145 <font class="preprocessor">    #define CGROUPMANAGER_GROUP(name, groupItem) \</font>
00146 <font class="preprocessor">    { \</font>
00147 <font class="preprocessor">        it = QListViewItemIterator(this); \</font>
00148 <font class="preprocessor">        item = 0; \</font>
00149 <font class="preprocessor">        for ( ; it.current(); ++it ) { \</font>
00150 <font class="preprocessor">            if ( it.current() ) { \</font>
00151 <font class="preprocessor">                item = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current()); \</font>
00152 <font class="preprocessor">                if (item &amp;&amp; (item-&gt;text(0) == name) ) { \</font>
00153 <font class="preprocessor">                    groupItem = item; \</font>
00154 <font class="preprocessor">                    break; \</font>
00155 <font class="preprocessor">                } \</font>
00156 <font class="preprocessor">                else \</font>
00157 <font class="preprocessor">                    groupItem = 0; \</font>
00158 <font class="preprocessor">            } \</font>
00159 <font class="preprocessor">        }   \</font>
00160 <font class="preprocessor">        if (!groupItem) \</font>
00161 <font class="preprocessor">            groupItem = new CGroupManagerItem(this, name, QString::null, 0, 0, CGroupManagerItem::Group); \</font>
00162 <font class="preprocessor">    }</font>
00163 <font class="preprocessor"></font>    <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* bibleGroup = 0;
00164     CGROUPMANAGER_GROUP(i18n(<font class="stringliteral">"Bibles"</font>), bibleGroup);
00165         
00166     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* commentaryGroup = 0;
00167     CGROUPMANAGER_GROUP(i18n(<font class="stringliteral">"Commentaries"</font>), commentaryGroup);
00168         
00169     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* lexiconGroup = 0;
00170     CGROUPMANAGER_GROUP(i18n(<font class="stringliteral">"Lexicons"</font>), lexiconGroup);
00171 
00172     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* bookGroup = 0;
00173     CGROUPMANAGER_GROUP(i18n(<font class="stringliteral">"Books"</font>), bookGroup);
00174             
00175 <font class="preprocessor">    #undef CGROUPMANAGER_GROUP</font>
00176 <font class="preprocessor"></font>    
00177     <font class="keywordflow">for</font>(moduleInfo = m_swordList-&gt;first(); moduleInfo; moduleInfo = m_swordList-&gt;next()) {
00178         <font class="keywordtype">bool</font> alreadyCreated = <font class="keyword">false</font>;
00179     QListViewItemIterator it( <font class="keyword">this</font> );
00180         <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
00181             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
00182             <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() == moduleInfo) { <font class="comment">//already there</font>
00183                 alreadyCreated = <font class="keyword">true</font>;
00184                 <font class="keywordflow">break</font>;
00185             }
00186         }
00187         <font class="keywordflow">if</font> ( moduleInfo &amp;&amp; !alreadyCreated) {
00188             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* itemParent = 0;
00189             <font class="keywordflow">switch</font> (moduleInfo-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) {
00190                 <font class="keywordflow">case</font> CSwordModuleInfo::Bible:
00191                     itemParent = bibleGroup;
00192                     <font class="keywordflow">break</font>;
00193                 <font class="keywordflow">case</font> CSwordModuleInfo::Commentary:
00194                     itemParent = commentaryGroup;
00195                     <font class="keywordflow">break</font>;
00196                 <font class="keywordflow">case</font> CSwordModuleInfo::Lexicon:
00197                     itemParent = lexiconGroup;
00198                     <font class="keywordflow">break</font>;
00199                 <font class="keywordflow">case</font> CSwordModuleInfo::GenericBook:
00200                     itemParent = bookGroup;
00201                     <font class="keywordflow">break</font>;                  
00202                 <font class="keywordflow">default</font>:
00203                     <font class="keywordflow">break</font>;
00204             }
00205             <font class="keywordflow">if</font> (itemParent)
00206                 (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(itemParent, <font class="stringliteral">""</font>,QString::null, moduleInfo,0, CGroupManagerItem::Module);
00207         }
00208     }
00209     
00210     <font class="comment">// Now delete the groupes which have no child items</font>
00211     <font class="keywordflow">if</font> (!bibleGroup-&gt;childCount()) {        
00212         <font class="keyword">delete</font> bibleGroup;
00213         bibleGroup = 0;
00214     }
00215     <font class="keywordflow">if</font> (!lexiconGroup-&gt;childCount()) {
00216         <font class="keyword">delete</font> lexiconGroup;
00217         lexiconGroup = 0;
00218     }
00219     <font class="keywordflow">if</font> (!commentaryGroup-&gt;childCount()) {
00220         <font class="keyword">delete</font> commentaryGroup;
00221         commentaryGroup = 0;
00222     }
00223     <font class="keywordflow">if</font> (!bookGroup-&gt;childCount()) {
00224         <font class="keyword">delete</font> bookGroup;
00225         bookGroup = 0;
00226     }
00227 
00228     <font class="keywordflow">if</font> (!initialized) {
00229         <font class="keywordflow">if</font> (bibleGroup)
00230             bibleGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);
00231         <font class="keywordflow">if</font> (lexiconGroup)
00232             lexiconGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);
00233         <font class="keywordflow">if</font> (commentaryGroup)
00234             commentaryGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);    
00235         <font class="keywordflow">if</font> (bookGroup)
00236             bookGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);              
00237     }
00238 }
00239 
<a name="l00241"></a><a class="code" href="class_c_group_manager.html#c0">00241</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c0">CGroupManager::initConnections</a>(){
00242     connect(<font class="keyword">this</font>, SIGNAL(returnPressed(QListViewItem*)), SLOT(<a class="code" href="class_c_group_manager.html#i0">slotReturnPressed</a>(QListViewItem*)));
00243     <font class="keywordflow">if</font> (m_useRMBMenu)
00244         connect(m_popupMenu, SIGNAL(aboutToShow()),
00245             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h2">slotPopupAboutToShow</a>()));
00246 }
00247 
<a name="l00249"></a><a class="code" href="class_c_group_manager.html#a5">00249</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a5">CGroupManager::saveSettings</a>(){ 
00250     KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00251     
00252     <font class="keywordflow">if</font> (!m_saveSettings) {
00253         <font class="keywordflow">return</font>;
00254     }
00255             
00256     <font class="comment">//save column width </font>
00257     m_config-&gt;writeEntry(<font class="stringliteral">"initialized"</font>, <font class="keyword">true</font>);
00258     m_config-&gt;writeEntry(<font class="stringliteral">"First column"</font>, columnWidth(0));
00259     
00260     <font class="comment">//save the bookmarks and the groups</font>
00261     
00262     <a class="code" href="class_c_group_manager.html#c15">saveGroups</a>(m_config,0);
00263     <a class="code" href="class_c_group_manager.html#c13">saveSwordModules</a>(m_config,0);
00264     <a class="code" href="class_c_group_manager.html#c11">saveSwordBookmarks</a>(m_config, 0);
00265 
00266     m_config-&gt;sync();
00267 }
00268 
<a name="l00270"></a><a class="code" href="class_c_group_manager.html#a4">00270</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a4">CGroupManager::readSettings</a>(){
00271     KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00272     <font class="keywordflow">if</font> (m_config-&gt;readBoolEntry(<font class="stringliteral">"initialized"</font>))
00273         <a class="code" href="class_c_group_manager.html#a2">setupSwordTree</a>();
00274     <font class="keywordflow">else</font>
00275         <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
00276     setColumnWidth(0, m_config-&gt;readNumEntry(<font class="stringliteral">"First column"</font>, visibleWidth()) );
00277 }
00278 
<a name="l00280"></a><a class="code" href="class_c_group_manager.html#a6">00280</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a6">CGroupManager::initView</a>(){
00281     m_toolTip = <font class="keyword">new</font> ToolTip(<font class="keyword">this</font>);
00282     
00283     QWhatsThis::add(<font class="keyword">this</font>, WT_GM_WIDGET );
00284     m_singleClick = KGlobalSettings::singleClick();
00285             
00286     setBackgroundMode(PaletteBase);
00287     setSorting(-1);
00288         
00289     <font class="keywordflow">if</font> (m_useDragDrop)
00290         viewport()-&gt;setAcceptDrops(<font class="keyword">true</font>);
00291     <font class="keywordflow">if</font> (m_useExtendedMode)
00292         setSelectionModeExt(KListView::Extended);
00293     setRootIsDecorated(<font class="keyword">false</font>);
00294     setAllColumnsShowFocus(<font class="keyword">true</font>);
00295                 
00296     addColumn(i18n(<font class="stringliteral">"Caption"</font>));
00297     header()-&gt;hide();
00298     
00299     <font class="keywordflow">if</font> (!m_useRMBMenu) {
00300         m_popupMenu = 0;
00301     }
00302     <font class="keywordflow">else</font> {      
00303         m_popupMenu = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00304         m_popupMenu-&gt;insertTitle(i18n(<font class="stringliteral">"Main index"</font>));
00305         m_popupMenu-&gt;insertItem(GROUP_NEW_ICON_SMALL, i18n(<font class="stringliteral">"Create a new folder"</font>),
00306             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h6">slotCreateNewGroup</a>()),0,ID_GM_GROUP_CREATE);
00307         m_popupMenu-&gt;setWhatsThis(ID_GM_GROUP_CREATE, WT_GM_NEW_GROUP); 
00308         m_popupMenu-&gt;insertItem(GROUP_CHANGE_ICON_SMALL, i18n(<font class="stringliteral">"Change this folder"</font>),
00309             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h13">slotChangeGroup</a>()),0,ID_GM_GROUP_CHANGE);
00310         m_popupMenu-&gt;setWhatsThis(ID_GM_GROUP_CHANGE, WT_GM_CHANGE_GROUP);      
00311         m_popupMenu-&gt;insertSeparator(); 
00312         m_popupMenu-&gt;insertItem(BOOKMARK_CHANGE_ICON_SMALL,i18n(<font class="stringliteral">"Change this bookmark"</font>),
00313             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h1">slotChangeBookmark</a>()),0,ID_GM_BOOKMARK_CHANGE);
00314         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARK_CHANGE, WT_GM_CHANGE_BOOKMARK);
00315         m_popupMenu-&gt;insertItem(BOOKMARK_IMPORT_ICON_SMALL,i18n(<font class="stringliteral">"Import bookmarks"</font>),
00316             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h8">slotImportBookmarks</a>()),0,ID_GM_BOOKMARKS_IMPORT); 
00317         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARKS_IMPORT, WT_GM_IMPORT_BOOKMARKS);
00318         m_popupMenu-&gt;insertItem(BOOKMARK_EXPORT_ICON_SMALL,i18n(<font class="stringliteral">"Export bookmarks"</font>),
00319             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h7">slotExportBookmarks</a>()),0,ID_GM_BOOKMARKS_EXPORT);     
00320         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARKS_EXPORT, WT_GM_EXPORT_BOOKMARKS);  
00321         m_popupMenu-&gt;insertItem(BOOKMARK_PRINT_ICON_SMALL,i18n(<font class="stringliteral">"Print bookmark"</font>),
00322             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h14">slotPrintBookmark</a>()),0,ID_GM_BOOKMARK_PRINT);
00323         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARK_PRINT, WT_GM_PRINT_BOOKMARK);
00324         m_popupMenu-&gt;insertItem(ITEMS_DELETE_ICON_SMALL, i18n(<font class="stringliteral">"Remove selected item(s)"</font>),
00325             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h0">slotDeleteSelectedItems</a>()),0,ID_GM_ITEMS_DELETE);
00326         m_popupMenu-&gt;insertSeparator();
00327         m_popupMenu-&gt;insertItem(MODULE_SEARCH_ICON_SMALL,i18n(<font class="stringliteral">"Search in selected module(s)"</font>),
00328             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h3">slotSearchSelectedModules</a>()),0,ID_GM_MODULES_SEARCH);
00329         m_popupMenu-&gt;insertSeparator();
00330         m_popupMenu-&gt;insertItem(MODULE_UNLOCK_ICON_SMALL,i18n(<font class="stringliteral">"Unlock this module"</font>),
00331             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#g0">slotUnlockModule</a>()),0,ID_GM_MODULE_UNLOCK);  
00332         m_popupMenu-&gt;setWhatsThis(ID_GM_MODULE_UNLOCK, WT_GM_UNLOCK_MODULE);    
00333         m_popupMenu-&gt;insertItem(MODULE_ABOUT_ICON_SMALL, i18n(<font class="stringliteral">"About this module"</font>),
00334             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h4">slotShowAbout</a>()),0,ID_GM_MODULE_ABOUT);
00335         m_popupMenu-&gt;setWhatsThis(ID_GM_MODULE_ABOUT, WT_GM_ABOUT_MODULE);
00336     }
00337 }
00338     
<a name="l00340"></a><a class="code" href="class_c_group_manager.html#h0">00340</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h0">CGroupManager::slotDeleteSelectedItems</a>(){
00341     QListViewItemIterator it( <font class="keyword">this</font> );
00342     <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
00343         <font class="keywordflow">if</font> ( it.current()-&gt;isSelected() )
00344             <font class="keyword">delete</font> it.current();
00345     }
00346 }   
00347 
<a name="l00349"></a><a class="code" href="class_c_group_manager.html#h3">00349</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h3">CGroupManager::slotSearchSelectedModules</a>() {
00350     ListCSwordModuleInfo searchList;
00351     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *item = 0;
00352     
00353     QList&lt;QListViewItem&gt; items = selectedItems();
00354     <font class="keywordflow">for</font> (items.first(); items.current(); items.next()) {
00355         item = dynamic_cast&lt;CGroupManagerItem*&gt;(items.current());
00356         <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module)
00357             searchList.append(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00358     }
00359     <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>();
00360     m_config-&gt;sync();
00361 
00362     <font class="keywordflow">if</font> (!m_searchDialog)
00363         m_searchDialog = <font class="keyword">new</font> <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>(searchList,0,0);
00364     <font class="keywordflow">else</font>
00365         m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a3">setModuleList</a>(searchList);
00366     connect(m_searchDialog, SIGNAL(finished()),
00367         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h16">slotDeleteSearchdialog</a>()));  
00368     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a4">setSearchText</a>(QString::null);
00369     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#g0">show</a>();
00370     m_searchDialog-&gt;raise();
00371 }   
00372 
00373 <font class="keywordtype">void</font> CGroupManager::searchBookmarkedModule(<font class="keyword">const</font> QString&amp; text, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item) {  
00374   qWarning(<font class="stringliteral">"CGroupManager::searchBookmarkedModule(const QString&amp; text, CGroupManagerItem* item)"</font>);
00375   ASSERT(item);
00376   <font class="keywordflow">if</font> (!item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
00377     <font class="keywordflow">return</font>;
00378     ListCSwordModuleInfo searchList;
00379     searchList.append(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00380     
00381     <font class="keywordflow">if</font> (!m_searchDialog)
00382         m_searchDialog = <font class="keyword">new</font> <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>(searchList,0,0);
00383     <font class="keywordflow">else</font>
00384         m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a3">setModuleList</a>(searchList);
00385     connect(m_searchDialog, SIGNAL(finished()),
00386         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h16">slotDeleteSearchdialog</a>()));  
00387         
00388   m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a4">setSearchText</a>(text);
00389     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#g0">show</a>();
00390     m_searchDialog-&gt;raise();
00391     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a6">startSearch</a>();  
00392 }   
00393 
00395 <font class="keywordtype">void</font> CGroupManager::createNewBookmark(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parent, <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; ref){
00396     qWarning(<font class="stringliteral">"createNewBookmark: ref is %s"</font>, ref.latin1());
00397     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* swordModule = dynamic_cast&lt;CSwordModuleInfo*&gt;(module);        
00398     <font class="keywordflow">if</font> (!swordModule)
00399         <font class="keywordflow">return</font>;
00400     
00401     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;  
00402     <font class="keywordtype">bool</font> ok = <font class="keyword">false</font>;
00403     <font class="keyword">const</font> QString description = <a class="code" href="class_c_input_dialog.html#d0">CInputDialog::getText</a>(i18n(<font class="stringliteral">"Bookmark description - BibleTime"</font>), i18n(<font class="stringliteral">"Please enter here the description:"</font>), QString::null, &amp;ok);
00404     <font class="keywordflow">if</font> (!ok)
00405         <font class="keywordflow">return</font>;
00406 
00407     myItem = 0;
00408   <font class="keywordflow">if</font> ( parent &amp;&amp; (parent-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
00409     myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parent,QString::null,QString::null,module, 0, CGroupManagerItem::Bookmark);
00410     parent-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00411   }
00412     <font class="keywordflow">else</font>
00413         myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>,QString::null,QString::null,module, 0, CGroupManagerItem::Bookmark);
00414         
00415     <font class="keywordflow">if</font> (myItem) {   <font class="comment">//it's a Sword module</font>
00416         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module);
00417         <font class="keywordflow">if</font> (key) {
00418             key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(ref);
00419             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a9">setBookmarkKey</a>(key);    <font class="comment">//the key is deleted by the groupmmanager item</font>
00420         }
00421     }       
00422   <font class="keywordflow">if</font> (myItem)   <font class="comment">//set the description       </font>
00423         myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>(description);
00424     setFocus();     
00425 }
00426 
00427 
<a name="l00429"></a><a class="code" href="class_c_group_manager.html#h1">00429</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h1">CGroupManager::slotChangeBookmark</a>(){
00430     <font class="keywordflow">if</font> (!m_pressedItem)
00431         <font class="keywordflow">return</font>;     
00432     <font class="keywordtype">bool</font> isOk;
00433     QString description = <a class="code" href="class_c_input_dialog.html#d0">CInputDialog::getText</a>(i18n(<font class="stringliteral">"Change bookmark description - BibleTime"</font>),i18n(<font class="stringliteral">"Please change the description of the item!"</font>), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>(), &amp;isOk, 0);
00434     <font class="keywordflow">if</font> (isOk)
00435         m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>(description);
00436 }
00437 
<a name="l00439"></a><a class="code" href="class_c_group_manager.html#h13">00439</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h13">CGroupManager::slotChangeGroup</a>(){
00440     <font class="keywordflow">if</font> (!m_pressedItem)
00441         <font class="keywordflow">return</font>;     
00442     
00443     <font class="keywordtype">bool</font> isOk;
00444     QString description = QInputDialog::getText(i18n(<font class="stringliteral">"Change folder - BibleTime"</font>),i18n(<font class="stringliteral">"Please change the name of the group!"</font>), m_pressedItem-&gt;text(0), &amp;isOk, 0);  
00445     <font class="keywordflow">if</font> (isOk)
00446         m_pressedItem-&gt;setText( 0, description );
00447 }
00448 
<a name="l00450"></a><a class="code" href="class_c_group_manager.html#h2">00450</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h2">CGroupManager::slotPopupAboutToShow</a>(){
00451     <font class="keywordflow">if</font> (!m_useRMBMenu)
00452         <font class="keywordflow">return</font>;
00453         
00454     m_menu = <font class="keyword">true</font>;
00455     
00456     
00457     <font class="keywordflow">if</font> (m_pressedItem) {
00458         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) {
00459             <font class="keywordtype">bool</font> moduleIsEncrypted = m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>();
00460             
00461             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">true</font>);          
00462             
00463             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">false</font>);
00464             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00465             
00466             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);
00467             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">false</font>);
00468             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, <font class="keyword">false</font>);         
00469             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);           
00470 
00471             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">false</font>);
00472                         
00473             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">true</font>);    
00474             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, moduleIsEncrypted);            
00475             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">true</font>);
00476         }
00477         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) {
00478             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">true</font>);
00479                         
00480             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">false</font>);         
00481             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00482                         
00483             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">true</font>);
00484             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">false</font>);
00485             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, <font class="keyword">false</font>);         
00486             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">true</font>);
00487             
00488             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">true</font>);                      
00489             
00490             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00491             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);            
00492             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);
00493 
00494         }
00495         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00496             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">false</font>);
00497                         
00498             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">true</font>);
00499             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">true</font>);
00500                                                 
00501             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);                          
00502             
00503             <font class="comment">//enable import and export only if a bookmark exists in this group</font>
00504             <font class="keywordtype">bool</font> foundBookmark = <font class="keyword">false</font>;
00505         QListViewItem * myChild = m_pressedItem-&gt;firstChild();
00506         <font class="keywordflow">while</font>( myChild &amp;&amp; !foundBookmark) {
00507             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(myChild);
00508                 <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00509                     foundBookmark = <font class="keyword">true</font>;
00510                 myChild = myChild-&gt;nextSibling();
00511         }
00512             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">true</font>);
00513             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, foundBookmark);
00514             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);
00515                 
00516             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">true</font>);
00517 
00518             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00519             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);
00520             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);
00521         }       
00522     }
00523     <font class="keywordflow">else</font> { <font class="comment">//top level</font>
00524         m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">false</font>);
00525                         
00526         m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">true</font>);
00527         m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00528             
00529         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);              
00530             
00531         <font class="keywordtype">bool</font> foundBookmark = <font class="keyword">false</font>; 
00532      QListViewItemIterator it( <font class="keyword">this</font> );
00533      <font class="keywordflow">for</font> ( ; it.current() &amp;&amp; !foundBookmark; ++it ) {
00534         <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
00535             <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00536                 foundBookmark = <font class="keyword">true</font>;
00537         }           
00538         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">true</font>);
00539         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, foundBookmark);
00540         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);
00541                         
00542         m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">false</font>);
00543                         
00544         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00545         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);            
00546         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);         
00547     }
00548 }
00549 
<a name="l00551"></a><a class="code" href="class_c_group_manager.html#h4">00551</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h4">CGroupManager::slotShowAbout</a>(){
00552     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = dynamic_cast&lt;CSwordModuleInfo*&gt;(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());    
00553     <font class="keywordflow">if</font> (!m_pressedItem || !m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() || !module)
00554         <font class="keywordflow">return</font>;
00555     QString text;   
00556 
00557   <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a10">hasVersion</a>())
00558     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00559         .arg(i18n(<font class="stringliteral">"Version"</font>))
00560         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::ModuleVersion));
00561 
00562     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;&lt;b&gt;%3:&lt;/b&gt; %4&lt;br&gt;"</font>)
00563         .arg(i18n(<font class="stringliteral">"Location"</font>))
00564 <font class="comment">//      .arg(backend()-&gt;modulePath(module-&gt;name()))</font>
00565         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::AbsoluteDataPath))
00566         .arg(i18n(<font class="stringliteral">"Language"</font>))
00567         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Lang());
00568 
00569     <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;isWritable())
00570         text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00571                             .arg(i18n(<font class="stringliteral">"Writable"</font>))
00572                             .arg(i18n(<font class="stringliteral">"yes"</font>));
00573 
00574     <font class="keywordflow">if</font> ( module-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>() )
00575         text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00576                             .arg(i18n(<font class="stringliteral">"Unlock key"</font>))
00577                             .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::CipherKey));  
00578     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>).arg(i18n(<font class="stringliteral">"Encoding"</font>)).arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>() ? i18n(<font class="stringliteral">"Unicode"</font>) : i18n(<font class="stringliteral">"iso8859-1"</font>));
00579 
00580     QString options;
00581     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> opts;
00582     <font class="keywordflow">for</font> (opts = CSwordBackend::filterOptionsMIN; opts &lt;= CSwordBackend::filterOptionsMAX; ++opts){
00583         <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a20">has</a>( (<a class="code" href="class_c_sword_backend.html#s16">CSwordBackend::FilterOptions</a>)opts)){
00584         <font class="keywordflow">if</font> (!options.isEmpty())
00585             options += QString::fromLatin1(<font class="stringliteral">", "</font>);
00586         options += <a class="code" href="class_c_sword_backend.html#d3">CSwordBackend::translatedOptionName</a>( (<a class="code" href="class_c_sword_backend.html#s16">CSwordBackend::FilterOptions</a>)opts);
00587         }
00588     }
00589     <font class="keywordflow">if</font> (!options.isEmpty())
00590         text += QString(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00591             .arg(i18n(<font class="stringliteral">"Features"</font>))
00592             .arg(options);
00593 
00594     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt;&lt;br&gt; &lt;font size=\"-1\"&gt;%2&lt;/font&gt;"</font>)
00595                         .arg(<font class="stringliteral">"About"</font>)
00596                         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::AboutInformation));
00597 
00598     KMessageBox::about(<font class="keyword">this</font>, text, module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::Description), <font class="keyword">false</font>);
00599 }
00600 
00602 <font class="keywordtype">void</font> CGroupManager::slotCreateNewPresenter(){
00603     qWarning(<font class="stringliteral">"CGroupManager::slotCreateNewPresenter()"</font>);
00604     <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00605         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module || m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00606             emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null );
00607     }
00608 }
00609 
00611 <font class="keywordtype">void</font> CGroupManager::contentsDragEnterEvent( QDragEnterEvent* e){
00612   <font class="keywordflow">if</font> (QTextDrag::canDecode(e)) {
00613     e-&gt;accept(<font class="keyword">true</font>);
00614     QString str;
00615       QCString submime;
00616     <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=BOOKMARK))
00617         m_dragType = BOOKMARK;
00618     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=REFERENCE))
00619         m_dragType = REFERENCE;     
00620     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=MODULE))
00621         m_dragType = MODULE;    
00622     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=GROUP))
00623         m_dragType = GROUP;             
00624     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=TEXT))
00625         m_dragType = TEXT;
00626     <font class="keywordflow">else</font>
00627         m_dragType = <font class="stringliteral">""</font>;
00628   }
00629   <font class="keywordflow">else</font> {
00630     e-&gt;ignore();
00631     m_dragType = <font class="stringliteral">""</font>;
00632   }
00633 }
00634 
00636 <font class="keywordtype">void</font> CGroupManager::contentsDragMoveEvent( QDragMoveEvent* e){
00637   <font class="comment">//open folders</font>
00638   <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)itemAt( contentsToViewport(e-&gt;pos()) );         
00639   e-&gt;accept(QTextDrag::canDecode(e));       
00640     <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group &amp;&amp; !item-&gt;isOpen())
00641         item-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00642 
00643     m_afterItemDrop = item;
00644     <font class="keywordflow">if</font> (item)
00645         m_parentItemDrop = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
00646     <font class="keywordflow">else</font>
00647         m_parentItemDrop = 0;
00648     
00649     QRect tmpRect = <a class="code" href="class_c_group_manager.html#h10">drawDropVisualizer</a>(0, m_parentItemDrop, m_afterItemDrop, m_dragType );
00650     <font class="keywordflow">if</font> (tmpRect != m_oldDragRect ) {
00651         <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00652         m_oldDragRect = tmpRect;
00653         <font class="keywordflow">if</font> (tmpRect.isValid())
00654             viewport()-&gt;repaint(tmpRect);
00655     }
00656 }
00657 
00659 <font class="keywordtype">void</font> CGroupManager::contentsDragLeaveEvent( QDragLeaveEvent* e){    
00660     KListView::contentsDragLeaveEvent(e);   
00661     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00662     
00663     m_oldDragRect = QRect();
00664     m_dragType = <font class="stringliteral">""</font>;
00665 }
00666 
00670 <font class="preprocessor">#define MOVE_ITEMS  \</font>
00671 <font class="preprocessor">            for ( item = m_itemList-&gt;last(); item != 0; item = m_itemList-&gt;prev()){ \</font>
00672 <font class="preprocessor">                if ( item &amp;&amp; (item != target) ){ \</font>
00673 <font class="preprocessor">                    parentItem = dynamic_cast&lt;CGroupManagerItem*&gt;(item-&gt;parent()); \</font>
00674 <font class="preprocessor">                    if ( isChild(item, target) ) \</font>
00675 <font class="preprocessor">                        continue; \</font>
00676 <font class="preprocessor">                    if (parentItem &amp;&amp; parentItem != item) \</font>
00677 <font class="preprocessor">                        parentItem-&gt;takeItem(item); \</font>
00678 <font class="preprocessor">                    else \</font>
00679 <font class="preprocessor">                        takeItem(item); \</font>
00680 <font class="preprocessor">                    if ( target &amp;&amp; target!=item ) \</font>
00681 <font class="preprocessor">                        if (target-&gt;type()==CGroupManagerItem::Group) \</font>
00682 <font class="preprocessor">                            target-&gt;insertItem(item); \</font>
00683 <font class="preprocessor">                        else{ \</font>
00684 <font class="preprocessor">                            if (target-&gt;parent()) \</font>
00685 <font class="preprocessor">                                target-&gt;parent()-&gt;insertItem(item); \</font>
00686 <font class="preprocessor">                            else \</font>
00687 <font class="preprocessor">                                this-&gt;insertItem(item); \</font>
00688 <font class="preprocessor">                        }  \</font>
00689 <font class="preprocessor">                    else \</font>
00690 <font class="preprocessor">                        this-&gt;insertItem(item); \</font>
00691 <font class="preprocessor">                } \</font>
00692 <font class="preprocessor">            }</font>
00693 <font class="preprocessor"></font>
00695 <font class="keywordtype">void</font> CGroupManager::contentsDropEvent( QDropEvent* e){
00696   <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* target = dynamic_cast&lt;CGroupManagerItem *&gt;(itemAt(contentsToViewport(e-&gt;pos())));
00697 
00698   QString str;
00699   QCString submime;
00700   <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=BOOKMARK)){
00701     <font class="comment">//a bookmark was dragged</font>
00702     <font class="keywordflow">if</font> ( e-&gt;source() != viewport() ){
00703       <font class="keywordflow">return</font>;
00704     }
00705     <font class="keywordflow">if</font> ( !(m_itemList) ){
00706       <font class="keywordflow">return</font>;
00707     }
00708     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00709     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
00710     <font class="comment">// Bookmark dragged on module - open a presenter</font>
00711     <font class="keywordflow">if</font> ( (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00712             &amp;&amp; target &amp;&amp; (target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) ){
00713       emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>(target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(),m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );
00714     }
00715     <font class="comment">//move around bookmarks</font>
00716     <font class="keywordflow">else</font>{       
00717         MOVE_ITEMS      
00718     }<font class="comment">//else</font>
00719   }<font class="comment">//Bookmark</font>
00720   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=GROUP)){
00721     <font class="comment">//a group was dragged</font>
00722     <font class="keywordflow">if</font> ( e-&gt;source() != this-&gt;viewport() )
00723       <font class="keywordflow">return</font>;
00724     <font class="keywordflow">if</font> ( !(m_itemList) )
00725       <font class="keywordflow">return</font>;
00726     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00727     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
00728     <font class="comment">//move around groups        </font>
00729     MOVE_ITEMS
00730   }<font class="comment">//group</font>
00731   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=MODULE)){
00732     <font class="comment">//a module was dragged</font>
00733     <font class="keywordflow">if</font> ( e-&gt;source() != this-&gt;viewport() ){
00734       <font class="keywordflow">return</font>;
00735     }
00736     <font class="keywordflow">if</font> ( !(m_itemList) ){
00737       <font class="keywordflow">return</font>;
00738     }
00739     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00740     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
00741     MOVE_ITEMS
00742   }<font class="comment">//module</font>
00743   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=REFERENCE)){
00744     <font class="comment">//a reference was dragged</font>
00745         QString ref;
00746     QString mod;
00747     <a class="code" href="class_c_reference_manager.html#d3">CReferenceManager::decodeReference</a>(str,mod,ref);
00748 
00749     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* info = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(mod);
00750 <font class="comment">//    for (info = m_swordList-&gt;first(); info; info = m_swordList-&gt;next())</font>
00751 <font class="comment">//      if (info-&gt;name() == mod)</font>
00752 <font class="comment">//          break;</font>
00753     <font class="keywordflow">if</font> ( info <font class="comment">/*&amp;&amp; (info-&gt;name() == mod)*/</font> ){
00754             <font class="keywordflow">if</font> (!target){ <font class="comment">//Reference was dragged on no item</font>
00755                 createNewBookmark(0, info, ref); <font class="comment">//CREATE A NEW BOOKMARK</font>
00756             }
00757             <font class="keywordflow">else</font>{
00758                 <font class="keywordflow">switch</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()){
00759                     <font class="keywordflow">case</font> (CGroupManagerItem::Group):
00760                         <font class="keywordflow">if</font> (info)  <font class="comment">//Create a bookmark</font>
00761                             createNewBookmark(target,info, ref);
00762                         <font class="keywordflow">break</font>;
00763                     <font class="keywordflow">case</font> (CGroupManagerItem::Bookmark):
00764                         <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>())
00765                             createNewBookmark(target-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>(),info, ref);
00766                         <font class="keywordflow">else</font>
00767                             createNewBookmark(0,info, ref);                     
00768                         <font class="keywordflow">break</font>;
00769                     <font class="keywordflow">case</font> (CGroupManagerItem::Module):
00770                         <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()){
00775                             <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Bible || target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Commentary )
00776                                 emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>( target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), ref );                         
00777                             <font class="keywordflow">else</font>
00778                                 searchBookmarkedModule(ref,target);
00779                         }
00780                         <font class="keywordflow">break</font>;
00781                 }<font class="comment">//switch;</font>
00782             }<font class="comment">//(target)</font>
00783     }<font class="comment">//(info)</font>
00784   }<font class="comment">//reference</font>
00785   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=TEXT)){
00786         <font class="comment">//plain text was dragged -&gt; open searchdialog</font>
00787         <font class="keywordflow">if</font> ( target &amp;&amp; target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()==CGroupManagerItem::Module &amp;&amp; target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() )
00788             searchBookmarkedModule(str,target);
00789   }
00790     m_dragType = <font class="stringliteral">""</font>;
00791     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00792 }
00793 <font class="preprocessor">#undef MOVE_ITEMS</font>
00794 <font class="preprocessor"></font>
00796 <font class="keywordtype">void</font> CGroupManager::contentsMousePressEvent( QMouseEvent* e ) {
00797     m_pressedPos = e-&gt;pos();
00798   m_pressedItem = dynamic_cast&lt;CGroupManagerItem*&gt;(itemAt(contentsToViewport(m_pressedPos)));
00799   <font class="keyword">const</font> <font class="keywordtype">bool</font> open = m_pressedItem ? m_pressedItem-&gt;isOpen() : false;
00800     KListView::contentsMousePressEvent(e);  
00801     
00802     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00803             <font class="keywordflow">return</font>;
00804             
00805     <font class="keywordflow">if</font> (e-&gt;button() == LeftButton) {
00806         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group
00807                 &amp;&amp; m_singleClick &amp;&amp; (m_pressedItem-&gt;isOpen() == open) ) {
00808             <font class="comment">//open group with first click if it's a global setting of KDE</font>
00809             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !m_pressedItem-&gt;isOpen() );
00810         }
00811     }
00812     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;button() == RightButton &amp; m_useRMBMenu) {   
00813         m_menu = <font class="keyword">true</font>;
00814         m_popupMenu-&gt;exec( viewport()-&gt;mapToGlobal( contentsToViewport(m_pressedPos) ));
00815         m_menu = <font class="keyword">false</font>;         
00816     }
00817 }
00818 
<a name="l00820"></a><a class="code" href="class_c_group_manager.html#h12">00820</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h12">CGroupManager::contentsMouseDoubleClickEvent</a> ( QMouseEvent * e){
00821 <font class="comment">//  qDebug("CGroupManager::contentsMouseDoubleClickEvent ( QMouseEvent * e)");</font>
00822   <font class="keywordtype">bool</font> open = <font class="keyword">false</font>;    
00823   <font class="keywordflow">if</font> (m_pressedItem)
00824     open = m_pressedItem-&gt;isOpen();
00825         
00826     KListView::contentsMouseDoubleClickEvent(e);
00827 
00828     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00829             <font class="keywordflow">return</font>;
00830     <font class="keywordflow">if</font> (e-&gt;button() == LeftButton) {
00831         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group
00832                 &amp;&amp; !m_singleClick &amp;&amp; (m_pressedItem-&gt;isOpen() == open) ) {
00833             <font class="comment">//open group with first click if it's a global setting of KDE</font>
00834             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !m_pressedItem-&gt;isOpen() );
00835         }
00836     }   
00837 }
00838 
00839 <font class="keywordtype">void</font> CGroupManager::contentsMouseReleaseEvent ( QMouseEvent* e ) {
00840     KListView::contentsMouseReleaseEvent(e);    
00841   <font class="keywordflow">if</font> ( !(m_pressedItem = dynamic_cast&lt;CGroupManagerItem*&gt;(itemAt(contentsToViewport(e-&gt;pos())))) )
00842     <font class="keywordflow">return</font>; 
00843     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00844         <font class="keywordflow">return</font>;
00845 
00846     <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; (e-&gt;button() == LeftButton)) {
00847         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00848         <font class="comment">//check if module is encrypted and show dialog if it wasn't opened before       </font>
00849             QList&lt;QListViewItem&gt; items = selectedItems();           
00850             <font class="keywordflow">if</font> (items.count() &gt; 1) {
00851                 ListCSwordModuleInfo modules;
00852                 <font class="keywordflow">for</font> (items.first(); items.current(); items.next()) {
00853                     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(items.current());
00854                     <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
00855                         modules.append(i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00856                 }
00857                 emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>( modules, QString::null );                
00858             }
00859             <font class="keywordflow">else</font>
00860                 emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null );
00861                         
00862         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>()) {
00863             KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00864             <font class="keywordflow">if</font> (m_showHelpDialogs &amp;&amp; !m_config-&gt;readBoolEntry(QString::fromLatin1(<font class="stringliteral">"shown %1 encrypted"</font>).arg(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>()), <font class="keyword">false</font>))
00865                 HTML_DIALOG(HELPDIALOG_MODULE_LOCKED);
00866             <font class="keywordflow">if</font> (m_showHelpDialogs)
00867                 m_config-&gt;writeEntry(QString::fromLatin1(<font class="stringliteral">"shown %1 encrypted"</font>).arg(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>()), <font class="keyword">true</font>);
00868         }
00869         }
00870         <font class="keywordflow">else</font> <font class="keywordflow">if</font>  (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) {
00871             <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>() )
00872                 emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );
00873         }
00874     }
00875 }
00876 
<a name="l00878"></a><a class="code" href="class_c_group_manager.html#c7">00878</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c7">CGroupManager::contentsMouseMoveEvent</a> ( QMouseEvent * e) {
00879     KListView::contentsMouseMoveEvent( e ); 
00880     <font class="keywordflow">if</font> (!m_useDragDrop)
00881         <font class="keywordflow">return</font>;
00882     
00883     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* dragItem=(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *)itemAt( contentsToViewport(e-&gt;pos()) );
00884 
00885     <font class="comment">//mouse is pressed, an item is selected and the popup menu isn't opened</font>
00886     <font class="keywordflow">if</font> ( (e-&gt;state()&amp;LeftButton) &amp;&amp; (e-&gt;stateAfter()&amp;LeftButton) &amp;&amp; dragItem &amp;&amp; !m_menu) {
00887         <font class="comment">//Is it time to start a drag?</font>
00888     <font class="keywordflow">if</font> (abs(e-&gt;pos().x() - m_pressedPos.x()) &gt; KGlobalSettings::dndEventDelay() ||
00889                 abs(e-&gt;pos().y() - m_pressedPos.y()) &gt; KGlobalSettings::dndEventDelay() )   {
00890         <font class="comment">// Collect all selected items</font>
00891         ASSERT(m_itemList);
00892         m_itemList = <font class="keyword">new</font> QList&lt;CGroupManagerItem&gt;;
00893         QListViewItemIterator it( <font class="keyword">this</font> );
00894         <font class="keywordflow">for</font>( ; it.current(); it++ )
00895         <font class="keywordflow">if</font> ( it.current()-&gt;isSelected() )
00896                     m_itemList-&gt;append( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );                             
00897         QTextDrag *d = 0;
00898         <font class="keywordflow">if</font> (!dragItem)
00899             <font class="keywordflow">return</font>;
00900             <font class="keywordflow">switch</font> (dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()){
00901                 <font class="keywordflow">case</font> (CGroupManagerItem::Bookmark):
00902              <font class="keywordflow">if</font> (dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00903                 QString ref = dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>();
00904                 QString mod = dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>();
00905                     
00906                 d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(mod,ref), viewport());
00907                 d-&gt;setSubtype(BOOKMARK);
00908                     m_dragType = BOOKMARK;
00909                     }
00910                     <font class="keywordflow">break</font>;                  
00911                 <font class="keywordflow">case</font> (CGroupManagerItem::Module):
00912                     d = <font class="keyword">new</font> QTextDrag( <font class="stringliteral">""</font> , viewport());
00913                     d-&gt;setSubtype(MODULE);
00914                     m_dragType = MODULE;
00915                     <font class="keywordflow">break</font>;                  
00916                 <font class="keywordflow">case</font> (CGroupManagerItem::Group):
00917                     d = <font class="keyword">new</font> QTextDrag( <font class="stringliteral">""</font> , viewport());
00918                     d-&gt;setSubtype(GROUP);
00919                     m_dragType = GROUP;
00920                     <font class="keywordflow">break</font>;
00921             }
00922             
00923             <font class="keywordflow">if</font> (d) {
00924                 d-&gt;setPixmap( *(dragItem-&gt;pixmap(0)) );
00925                 m_menu = <font class="keyword">false</font>;
00926                 d-&gt;drag();
00927             }           
00928         }
00929     }
00930 }
00931 
<a name="l00933"></a><a class="code" href="class_c_group_manager.html#h6">00933</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h6">CGroupManager::slotCreateNewGroup</a>(){
00934     <font class="keywordtype">bool</font> isOk;
00935     QString groupname = QInputDialog::getText(i18n(<font class="stringliteral">"Enter name of folder - BibleTime"</font>),i18n(<font class="stringliteral">"Please enter the name of the folder!"</font>),<font class="stringliteral">""</font>, &amp;isOk, 0);
00936     
00937     <font class="keywordflow">if</font> (isOk) {
00938         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00939             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(m_pressedItem, groupname, QString::null, 0,0, CGroupManagerItem::Group);
00940             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00941         }
00942         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group){
00943             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>(), groupname, QString::null, 0,0, CGroupManagerItem::Group);
00944             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00945         }
00946         <font class="keywordflow">else</font> {
00947             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, groupname, QString::null, 0, 0,CGroupManagerItem::Group);
00948         }
00949     }
00950 }
00951 
<a name="l00952"></a><a class="code" href="class_c_group_manager.html#c8">00952</a> <font class="keyword">const</font> <font class="keywordtype">int</font> <a class="code" href="class_c_group_manager.html#c8">CGroupManager::parentId</a>(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *item, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem)
00953 {
00954     <font class="comment">// search parent of item and return the id of the parent</font>
00955     <font class="keywordtype">int</font> ret = -1;   <font class="comment">// the view and the parent item have id -1</font>
00956     <font class="keywordtype">int</font> index = 0;
00957     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
00958     
00959     <font class="keywordflow">if</font> (item) {
00960         <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; item != parentItem) {
00961           QListViewItemIterator it;
00962           <font class="keywordflow">if</font> (parentItem) {
00963             it = QListViewItemIterator( parentItem );       
00964           }
00965           <font class="keywordflow">else</font>
00966             it = QListViewItemIterator( <font class="keyword">this</font> );
00967             
00968             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() == parentItem)
00969                 <font class="keywordflow">return</font> -1;
00970             <font class="keywordflow">while</font> (it.current() &amp;&amp; (it.current() != item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) ) {
00971                 myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current();
00972                 <font class="keywordflow">if</font> (parentItem &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(parentItem, myItem) ) {
00973                     it++;
00974                     <font class="keywordflow">continue</font>;
00975                 }
00976                 <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00977                     index++;
00978                 }
00979                 it++;
00980             }
00981             <font class="keywordflow">if</font> (it.current())
00982                 ret = index;
00983         }
00984     }
00985     <font class="keywordflow">return</font> ret;
00986 }
00987 
<a name="l00989"></a><a class="code" href="class_c_group_manager.html#c9">00989</a> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* <a class="code" href="class_c_group_manager.html#c9">CGroupManager::findParent</a>( <font class="keyword">const</font> <font class="keywordtype">int</font> ID, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem){
00990     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
00991     <font class="keywordtype">int</font> index = 0;
00992     
00993     QListViewItemIterator it;
00994   <font class="keywordflow">if</font> (parentItem)
00995     it = QListViewItemIterator(parentItem);
00996   <font class="keywordflow">else</font>
00997       it = QListViewItemIterator( <font class="keyword">this</font> );
00998 
00999   <font class="comment">//traverse the tree and try to find the group with the id ID index using comparision</font>
01000   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01001         myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current();
01002         <font class="keywordflow">if</font> (parentItem &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(parentItem, (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current())) {
01003             <font class="keywordflow">continue</font>;
01004         }       
01005         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
01006             <font class="keywordflow">if</font> (index == ID) {
01007                 <font class="keywordflow">return</font> myItem;
01008             }
01009             <font class="keywordflow">else</font>
01010                 index++;
01011         }
01012     }       
01013     <font class="keywordflow">return</font> 0;   <font class="comment">// return 0 if parent wasn't found</font>
01014 }
01015 
<a name="l01017"></a><a class="code" href="class_c_group_manager.html#g0">01017</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g0">CGroupManager::slotUnlockModule</a>(){ 
01018     <font class="keywordtype">bool</font> ok;
01019     QString unlockKey = QInputDialog::getText(i18n(<font class="stringliteral">"BibleTime - Unlock module"</font>),i18n(<font class="stringliteral">"Enter the key to unlock the module!"</font>), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::CipherKey), &amp;ok, 0 );
01020     <font class="keywordflow">if</font> (ok) {
01021         <a class="code" href="class_c_sword_module_info.html#s24">CSwordModuleInfo::UnlockErrorCode</a> ret = m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a6">unlock</a>( unlockKey );
01022         <font class="keywordflow">if</font> ( ret != CSwordModuleInfo::noError) {
01023             <font class="comment">//an error occured</font>
01024             <font class="keywordflow">switch</font> (ret) {
01025                 <font class="keywordflow">case</font> CSwordModuleInfo::noPermission:                
01026                     <font class="keywordflow">break</font>;
01027                 <font class="keywordflow">case</font> CSwordModuleInfo::wrongUnlockKey:              
01028                     <font class="keywordflow">break</font>;
01029                 <font class="keywordflow">case</font> CSwordModuleInfo::notLocked:
01030                     <font class="keywordflow">break</font>;
01031                     
01032                 <font class="keywordflow">default</font>:
01033                     <font class="keywordflow">break</font>;
01034             }
01035         }
01036     }
01037 }
01038 
<a name="l01040"></a><a class="code" href="class_c_group_manager.html#c12">01040</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c12">CGroupManager::readSwordBookmarks</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group){
01041 <font class="comment">//  qDebug("CGroupManager::read Sword bookmarks");</font>
01042     
01043     <font class="comment">//read and create group entries</font>
01044     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*  parentItem = 0; 
01045     QStringList             groupList   = configFile-&gt;readListEntry(<font class="stringliteral">"Groups"</font>);
01046 
01047     <font class="comment">//read in all bookmarks</font>
01048     QStringList bookmarkList                            = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmarks"</font>);
01049     QStringList bookmarkModulesList             = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmark modules"</font>);
01050     QStringList bookmarkDescriptionsList    = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmark descriptions"</font>);
01051     QValueList&lt;int&gt; parentList                      = configFile-&gt;readIntListEntry(<font class="stringliteral">"Bookmark parents"</font>);
01052 
01053     QStringList::Iterator it_bookmarks  = bookmarkList.begin();
01054     QStringList::Iterator it_modules        = bookmarkModulesList.begin();
01055     QStringList::Iterator it_descriptions   = bookmarkDescriptionsList.begin();
01056     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01057 
01058     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* moduleInfo = 0;
01059     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *myItem = 0;  
01060     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *oldItem = 0;
01061 
01062     <font class="keywordflow">while</font> ( it_bookmarks != bookmarkList.end() &amp;&amp; it_parents != parentList.end()
01063                     &amp;&amp; it_modules != bookmarkModulesList.end() ) {
01064         moduleInfo = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>((*it_modules));
01065         <font class="keywordflow">if</font> ( (*it_parents) == -1) {
01066             <font class="keywordflow">if</font> (group)
01067                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_bookmarks), (*it_modules), moduleInfo, 0, CGroupManagerItem::Bookmark);
01068             <font class="keywordflow">else</font>
01069                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_bookmarks), (*it_modules), moduleInfo, 0, CGroupManagerItem::Bookmark);
01070         }
01071         <font class="keywordflow">else</font> {
01072             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents), group ? group : 0 );
01073             <font class="keywordflow">if</font> (parentItem)
01074                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01075             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group)
01076                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01077             <font class="keywordflow">else</font>
01078                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01079         }
01080         <font class="keywordflow">if</font> (myItem &amp;&amp; it_descriptions != bookmarkDescriptionsList.end())
01081             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>( *it_descriptions );
01082         <font class="keywordflow">if</font> (myItem &amp;&amp; oldItem) {    <font class="comment">//if both items exist we can move myItem behind oldItem</font>
01083             myItem-&gt;moveToJustAfter(oldItem);
01084         }
01085         oldItem = myItem;
01086 
01087         ++it_parents;
01088         ++it_modules;
01089         ++it_descriptions;
01090         ++it_bookmarks;
01091     }
01092     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01093 }
01094 
<a name="l01096"></a><a class="code" href="class_c_group_manager.html#c11">01096</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c11">CGroupManager::saveSwordBookmarks</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group){
01097     <font class="keywordtype">int</font> parentID = 0;
01098     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01099     QStringList groupList;
01100     QValueList&lt;int&gt; parentList;
01101     QStringList bookmarkList;   
01102     QStringList bookmarkModuleList; 
01103     QStringList bookmarkDescriptionList;        
01104     QListViewItemIterator it;
01105     
01106     <font class="comment">//save bookmarks</font>
01107     parentList.clear();
01108     bookmarkList.clear();
01109     bookmarkModuleList.clear();
01110     bookmarkDescriptionList.clear();
01111 
01112     <font class="keywordflow">if</font> (group)
01113         it = QListViewItemIterator ( group );
01114     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() == 0) {
01115         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01116     }
01117     <font class="keywordflow">else</font>
01118         it = QListViewItemIterator (<font class="keyword">this</font>);
01119 
01120   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01121         myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current();
01122     <font class="keywordflow">if</font> (group)
01123         <font class="keywordflow">if</font> (!<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem)) {
01124                 <font class="keywordflow">continue</font>;                   
01125             }
01126         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)  {
01127             <font class="keywordflow">if</font> (group) {
01128                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( dynamic_cast&lt;CGroupManagerItem*&gt;(it.current()),m_pressedItem );    
01129             }
01130             <font class="keywordflow">else</font> {
01131                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( dynamic_cast&lt;CGroupManagerItem*&gt;(it.current()) );  
01132             }
01133             parentList.append( parentID );
01134 
01135             <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>();                                  
01136             <font class="keywordflow">if</font> (key)    {
01137                 VerseKey* vk = dynamic_cast&lt;VerseKey*&gt;(key);
01138                 QString oldLocale;
01139                 <font class="keywordflow">if</font> (vk) {
01140                     oldLocale = QString::fromLatin1(vk-&gt;getLocale());
01141                     vk-&gt;setLocale(<font class="stringliteral">"en"</font>); <font class="comment">//save the english key names</font>
01142                 }
01143                 bookmarkList.append( key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>() );
01144                 <font class="keywordflow">if</font> (vk) {
01145                     vk-&gt;setLocale(oldLocale.latin1());
01146                 }
01147             }
01148             <font class="keywordflow">else</font>
01149                 bookmarkList.append(<font class="stringliteral">""</font>);    <font class="comment">//invalid key</font>
01150                 
01151             <font class="keywordflow">if</font> (myItem &amp;&amp; !myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>().isEmpty()) <font class="comment">//save description</font>
01152                 bookmarkDescriptionList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>() );
01153             <font class="keywordflow">else</font>
01154                 bookmarkDescriptionList.append( QString::null );
01155                 
01156             <font class="keywordflow">if</font> (myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) { <font class="comment">//save the module</font>
01157                 bookmarkModuleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>() );
01158             }
01159             <font class="keywordflow">else</font> {
01160                 bookmarkModuleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#o6">m_moduleName</a> );
01161             }
01162         }
01163     }   
01164     
01165     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmarks"</font>, bookmarkList);
01166     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark descriptions"</font>, bookmarkDescriptionList);
01167     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark modules"</font>, bookmarkModuleList);
01168     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark parents"</font>, parentList);
01169     
01170     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01171 }
01172 
<a name="l01174"></a><a class="code" href="class_c_group_manager.html#h8">01174</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h8">CGroupManager::slotImportBookmarks</a>(){
01175     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
01176         QString file = KFileDialog::getOpenFileName(QString::null, <font class="stringliteral">"*.btb | *.btb"</font>, 0, i18n(<font class="stringliteral">"Import bookmarks ..."</font>));   
01177         <font class="keywordflow">if</font> (!file.isNull()) {
01178             KSimpleConfig simpleConfig(file, <font class="keyword">false</font>);
01179             simpleConfig.setGroup(<font class="stringliteral">"Bookmarks"</font>);
01180             <font class="keywordtype">short</font> <font class="keywordtype">int</font> formatVersion = simpleConfig.readNumEntry(<font class="stringliteral">"Bookmark format version"</font>, -1);
01181             
01182             <font class="comment">//bookmark format of imported file is newer than our version            </font>
01183             <font class="keywordflow">if</font> (formatVersion &gt; BOOKMARK_FORMAT_VERSION) {
01184                 <font class="keywordtype">int</font> retValue = KMessageBox::warningContinueCancel(<font class="keyword">this</font>, i18n(<font class="stringliteral">"&lt;qt&gt;A problem occurred while importing bookmarks!&lt;BR&gt;\</font>
01185 <font class="stringliteral">The bookmarks format of the imported file is newer&lt;BR&gt;\</font>
01186 <font class="stringliteral">than the bookmarks format version of this version of BibleTime!&lt;BR&gt;\</font>
01187 <font class="stringliteral">&lt;B&gt;Importing the bookmarks may not work correctly!&lt;/B&gt;&lt;BR&gt;Do you want to continue?&lt;/qt&gt;"</font>), i18n(<font class="stringliteral">"Import of bookmarks"</font>), i18n(<font class="stringliteral">"Continue"</font>) );
01188                 <font class="keywordflow">if</font> ( retValue != KMessageBox::Continue )
01189                     <font class="keywordflow">return</font>;
01190             }
01191             
01192             <a class="code" href="class_c_group_manager.html#c16">readGroups</a>(&amp;simpleConfig, m_pressedItem);           
01193             <a class="code" href="class_c_group_manager.html#c12">readSwordBookmarks</a>(&amp;simpleConfig, m_pressedItem);
01194         }
01195     }
01196 }
01197 
<a name="l01199"></a><a class="code" href="class_c_group_manager.html#h7">01199</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h7">CGroupManager::slotExportBookmarks</a>(){
01200     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
01201         QString file = KFileDialog::getSaveFileName (QString::null, <font class="stringliteral">"*.btb | *.btb"</font>, 0, i18n(<font class="stringliteral">"Export bookmarks ..."</font>));  
01202         <font class="keywordflow">if</font> (!file.isNull()) {
01203             KSimpleConfig simpleConfig(file, <font class="keyword">false</font>);
01204             simpleConfig.setGroup(<font class="stringliteral">"Bookmarks"</font>);         
01205             simpleConfig.writeEntry(<font class="stringliteral">"Bookmark format version"</font>, BOOKMARK_FORMAT_VERSION);
01206             <a class="code" href="class_c_group_manager.html#c15">saveGroups</a>(&amp;simpleConfig, m_pressedItem);           
01207             <a class="code" href="class_c_group_manager.html#c11">saveSwordBookmarks</a>(&amp;simpleConfig, m_pressedItem);
01208             simpleConfig.sync();
01209         }
01210     }
01211 }
01212 
01213 
<a name="l01214"></a><a class="code" href="class_c_group_manager.html#c14">01214</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c14">CGroupManager::readSwordModules</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01215     <font class="keywordflow">if</font> (!m_swordList) {
01216         qWarning(<font class="stringliteral">"no sword modules, return false."</font>);
01217         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01218     }
01219     <font class="comment">//read and create group entries</font>
01220     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*  parentItem = 0; 
01221     
01222     QStringList             groupList   = configFile-&gt;readListEntry(<font class="stringliteral">"Groups"</font>);
01223     QValueList&lt;int&gt;     parentList  = configFile-&gt;readIntListEntry(<font class="stringliteral">"Group parents"</font>);
01224     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01225     
01226     <font class="comment">//read in all bookmarks</font>
01227     QStringList moduleList  = configFile-&gt;readListEntry(<font class="stringliteral">"Modules"</font>);
01228     parentList                          = configFile-&gt;readIntListEntry(<font class="stringliteral">"Module parents"</font>);
01229     
01230     QStringList::Iterator it_modules        = moduleList.begin();
01231     it_parents                                                  = parentList.begin();
01232     
01233     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* myModuleInfo = 0;
01234     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *myItem = 0;
01235     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *oldItem = 0;
01236     
01237     <font class="keywordflow">while</font> ( it_modules != moduleList.end() &amp;&amp; it_parents != parentList.end() ) {        
01238         myModuleInfo = 0;       
01239         <font class="keywordflow">if</font> ((*it_modules).isEmpty()) {
01240             ++it_parents;
01241             ++it_modules;
01242             <font class="keywordflow">continue</font>;
01243         }
01244         
01245         myModuleInfo = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(*it_modules);
01246         <font class="keywordflow">if</font> (!myModuleInfo) {    <font class="comment">//if the module was removed so we don't show it</font>
01247             ++it_parents;
01248             ++it_modules;
01249             <font class="keywordflow">continue</font>;
01250         }
01251             
01252         <font class="keywordflow">if</font> ( (*it_parents) == -1) {
01253             <font class="keywordflow">if</font> (group)
01254                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, QString::null, QString::null, myModuleInfo,0, CGroupManagerItem::Module);
01255             <font class="keywordflow">else</font>
01256                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, QString::null, QString::null, myModuleInfo,0, CGroupManagerItem::Module);
01257         }
01258         <font class="keywordflow">else</font> {
01259             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents), group ? group : 0  );
01260             <font class="keywordflow">if</font> (parentItem)
01261                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, QString::null, QString::null, myModuleInfo, 0,CGroupManagerItem::Module);    
01262             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group)
01263                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, QString::null, QString::null, myModuleInfo, 0, CGroupManagerItem::Module);
01264             <font class="keywordflow">else</font>                
01265                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, QString::null, QString::null, myModuleInfo, 0, CGroupManagerItem::Module);
01266         }
01267         <font class="keywordflow">if</font> (myItem &amp;&amp; oldItem)
01268             myItem-&gt;moveToJustAfter(oldItem);
01269         oldItem = myItem;
01270             
01271         ++it_parents;
01272         ++it_modules;
01273     }   
01274     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01275 };
01276 
<a name="l01277"></a><a class="code" href="class_c_group_manager.html#c13">01277</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c13">CGroupManager::saveSwordModules</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01278     <font class="keywordtype">int</font> parentID = 0;
01279     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01280     QValueList&lt;int&gt; parentList;
01281     QStringList moduleList; 
01282     
01283     QListViewItemIterator it;
01284     
01285     parentList.clear();
01286     moduleList.clear();
01287 
01288     <font class="keywordflow">if</font> (group)
01289         it = QListViewItemIterator ( group );
01290     <font class="keywordflow">else</font>
01291         it = QListViewItemIterator (<font class="keyword">this</font>);
01292 
01293   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01294             myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*) it.current();
01295         <font class="keywordflow">if</font> (group)
01296             <font class="keywordflow">if</font> (!<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem))
01297                     <font class="keywordflow">continue</font>;                   
01298             
01299             <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module)  {
01300                 <font class="keywordflow">if</font> (group)
01301                     parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current(),m_pressedItem );  
01302                 <font class="keywordflow">else</font>
01303                     parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );    
01304                 parentList.append( parentID );
01305                 
01306                 <font class="keywordflow">if</font> (myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
01307                     moduleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>() );              
01308                 <font class="keywordflow">else</font> {
01309                     moduleList.append( myItem-&gt;text(0) );   <font class="comment">//first column is the modulename</font>
01310                 }
01311             }
01312     }   
01313     configFile-&gt;writeEntry(<font class="stringliteral">"Modules"</font>, moduleList);
01314     configFile-&gt;writeEntry(<font class="stringliteral">"Module parents"</font>, parentList);
01315 
01316     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01317 }
01318 
<a name="l01319"></a><a class="code" href="class_c_group_manager.html#c16">01319</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c16">CGroupManager::readGroups</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01320     <font class="comment">//read and create group entries</font>
01321     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*  parentItem = 0;
01322     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*  oldItem = 0;
01323     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* newItem = 0;
01324     
01325     QStringList             groupList   = configFile-&gt;readListEntry(<font class="stringliteral">"Groups"</font>);
01326     QValueList&lt;int&gt;     parentList  = configFile-&gt;readIntListEntry(<font class="stringliteral">"Group parents"</font>);
01327     
01328     QStringList::Iterator it_groups = groupList.begin();
01329     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01330     
01331     <font class="keywordflow">while</font> ( (it_groups != groupList.end()) &amp;&amp; (it_parents != parentList.end()) ) {
01332         <font class="keywordflow">if</font> ( (*it_parents) == -1) {
01333             <font class="keywordflow">if</font> (group)
01334                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_groups), QString::null, 0,0, CGroupManagerItem::Group);
01335             <font class="keywordflow">else</font>
01336                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_groups), QString::null, 0,0, CGroupManagerItem::Group);
01337         }
01338         <font class="keywordflow">else</font> {
01339             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents),group ? group : 0  );            
01340             <font class="keywordflow">if</font> (parentItem)
01341                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, (*it_groups),QString::null,0,0, CGroupManagerItem::Group);
01342             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group)
01343                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_groups),QString::null,0, 0,CGroupManagerItem::Group);
01344             <font class="keywordflow">else</font>
01345                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_groups),QString::null,0, 0,CGroupManagerItem::Group);
01346         }
01347         <font class="keywordflow">if</font> ( newItem &amp;&amp; oldItem ) {
01348             <font class="keywordflow">if</font> ( <a class="code" href="class_c_group_manager.html#a8">isChild</a>(oldItem, newItem ) || (!newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; !oldItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) || (newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() == oldItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() )) {
01349                 newItem-&gt;moveToJustAfter( oldItem );
01350             }
01351         }
01352         ++it_parents;
01353         ++it_groups;
01354         
01355         <font class="keywordflow">if</font> (newItem) {
01356             <font class="keywordflow">while</font> (<a class="code" href="class_c_group_manager.html#c8">parentId</a>(newItem) &gt; *it_parents) {
01357                 <font class="keywordflow">if</font> ( (group &amp;&amp; <a class="code" href="class_c_group_manager.html#a8">isChild</a>(group, newItem)) || (newItem &amp;&amp; newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) )
01358                     newItem = newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
01359                 <font class="keywordflow">else</font>
01360                     <font class="keywordflow">break</font>;
01361             }
01362             oldItem = newItem;
01363         }       
01364     }   
01365     <font class="keywordflow">return</font> <font class="keyword">true</font>;    
01366 };
01367 
<a name="l01368"></a><a class="code" href="class_c_group_manager.html#c15">01368</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c15">CGroupManager::saveGroups</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01369     <font class="keywordtype">int</font> parentID = 0;
01370     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01371     QStringList groupList;
01372     QValueList&lt;int&gt; parentList;
01373     
01374     QListViewItemIterator it;
01375     
01376     <font class="comment">//save groups   </font>
01377     <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() &gt; 0)
01378         it = QListViewItemIterator ( group-&gt;firstChild() );
01379     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() == 0) {
01380         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01381     }
01382     <font class="keywordflow">else</font>
01383       it = QListViewItemIterator ( <font class="keyword">this</font> );
01384 
01385   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01386         myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*) it.current();
01387     <font class="keywordflow">if</font> (group &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem))
01388             <font class="keywordflow">continue</font>;       
01389         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)  {
01390             <font class="keywordflow">if</font> (group)
01391                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current(), m_pressedItem );
01392             <font class="keywordflow">else</font>
01393                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );
01394             groupList.append( myItem-&gt;text(0) );
01395             parentList.append( parentID );
01396         }
01397     }
01398     configFile-&gt;writeEntry(<font class="stringliteral">"Groups"</font>, groupList);
01399     configFile-&gt;writeEntry(<font class="stringliteral">"Group parents"</font>, parentList);
01400     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01401 }
01402 
<a name="l01404"></a><a class="code" href="class_c_group_manager.html#a8">01404</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#a8">CGroupManager::isChild</a>(QListViewItem* parent, QListViewItem* child){
01405     QListViewItem *myParent = child;
01406     <font class="keywordflow">while</font> (myParent &amp;&amp; myParent != parent )
01407         myParent = myParent-&gt;parent();      
01408     <font class="keywordflow">return</font> myParent == parent &amp;&amp; parent!=child;
01409 }
01410 
<a name="l01412"></a><a class="code" href="class_c_group_manager.html#h9">01412</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h9">CGroupManager::viewportPaintEvent</a>(QPaintEvent* e) {
01413   KListView::viewportPaintEvent(e);
01414 
01415   <font class="keywordflow">if</font> (m_oldDragRect.isValid())
01416   {
01417     <font class="keyword">static</font> <font class="keywordtype">bool</font> invalidated=<font class="keyword">false</font>;
01418     <font class="keywordflow">if</font> (!invalidated)
01419     {
01420       invalidated=<font class="keyword">true</font>;
01421       viewport()-&gt;repaint(m_oldDragRect);
01422     }
01423     QPainter painter(viewport());
01424     <a class="code" href="class_c_group_manager.html#h10">drawDropVisualizer</a>(&amp;painter, m_parentItemDrop, m_afterItemDrop, <font class="stringliteral">""</font>);
01425     invalidated=<font class="keyword">false</font>;
01426   }
01427 }
01428 
<a name="l01430"></a><a class="code" href="class_c_group_manager.html#h10">01430</a> <font class="keyword">const</font> QRect <a class="code" href="class_c_group_manager.html#h10">CGroupManager::drawDropVisualizer</a> (QPainter *p, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *<font class="comment">/*parent*/</font>, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *after, <font class="keyword">const</font> QString&amp; <font class="comment">/*type*/</font>){
01431   QRect insertmarker;
01432   <font class="keywordtype">bool</font> useParent = <font class="keyword">false</font>;
01433         
01434     <font class="keywordflow">if</font> ( m_dragType == BOOKMARK ) {     <font class="comment">//we are moving a module</font>
01435         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01436             insertmarker = itemRect(after);
01437         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )            
01438             insertmarker = QRect(itemRect(after));
01439         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark ) {
01440             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01441                 useParent = <font class="keyword">true</font>;
01442                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());   <font class="comment">//paint nothing</font>
01443             }
01444             <font class="keywordflow">else</font>
01445                 insertmarker = QRect();
01446         }
01447         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01448             useParent = <font class="keyword">true</font>;
01449             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());               
01450         }
01451         <font class="keywordflow">else</font> <font class="comment">//if (!after)</font>
01452             insertmarker = QRect(); <font class="comment">//this-&gt;visibleRect();      </font>
01453 <font class="comment">//      else</font>
01454 <font class="comment">//          insertmarker = QRect();</font>
01455     }
01456     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_dragType == REFERENCE ) {   <font class="comment">//we are moving a reference</font>
01457         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01458             insertmarker = itemRect(after);
01459         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )         
01460             insertmarker = QRect(itemRect(after));
01461         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark ) {
01462             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01463                 useParent = <font class="keyword">true</font>;
01464                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01465             }
01466             <font class="keywordflow">else</font>
01467                 insertmarker = QRect();     <font class="comment">//paint nothing         </font>
01468         }
01469         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01470             useParent = <font class="keyword">true</font>;
01471             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());               
01472         }
01473         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!after)
01474             insertmarker = QRect(); <font class="comment">//this-&gt;visibleRect();</font>
01475         <font class="keywordflow">else</font>
01476             insertmarker = QRect();
01477     }
01478     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_dragType == MODULE ) {  <font class="comment">//we are moving a reference</font>
01479         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01480             insertmarker = itemRect(after);
01481         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; (after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module || after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) ) {
01482             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01483                 useParent = <font class="keyword">true</font>;
01484                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01485             }
01486             <font class="keywordflow">else</font>
01487                 insertmarker = QRect();     <font class="comment">//paint nothing         </font>
01488         }       
01489         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01490             useParent = <font class="keyword">true</font>;
01491             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01492         }
01493         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!after)
01494             insertmarker = QRect();<font class="comment">//this-&gt;visibleRect();</font>
01495         <font class="keywordflow">else</font>
01496             insertmarker = QRect();
01497     }   
01498     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_dragType == TEXT) {
01499         <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )         
01500             insertmarker = QRect(itemRect(after));
01501         <font class="keywordflow">else</font>
01502             insertmarker = QRect();
01503     }
01504     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem) {
01505     <font class="keywordflow">if</font> ( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group  ) { <font class="comment">//we are moving a group</font>
01506             <font class="keywordflow">if</font> (after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01507                 insertmarker = itemRect(after);
01508             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
01509                 useParent = <font class="keyword">true</font>;
01510                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01511             }
01512             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!after)
01513                 insertmarker = QRect();<font class="comment">//this-&gt;visibleRect();</font>
01514         <font class="keywordflow">else</font>
01515             insertmarker = QRect();
01516     }
01517   }
01518 
01519   <font class="keywordflow">if</font> ( p &amp;&amp; insertmarker.isValid() )  {
01520     <font class="keywordflow">if</font> (useParent)
01521         insertmarker.setLeft( treeStepSize()*(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;depth()+(rootIsDecorated() ? 1 :0 ))+itemMargin()- contentsX());
01522     <font class="keywordflow">else</font>
01523         insertmarker.setLeft( treeStepSize()*(after-&gt;depth()+(rootIsDecorated() ? 1 :0 ))+itemMargin() - contentsX());
01524     style().drawFocusRect( p, insertmarker, colorGroup(), after-&gt;isSelected() ? &amp;colorGroup().highlight() : &amp;colorGroup().base(), after-&gt;isSelected() &amp;&amp; !useParent );
01525   }
01526   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!insertmarker.isValid()) {
01527     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
01528   }
01529   <font class="keywordflow">return</font> insertmarker;
01530 }
01531 
<a name="l01533"></a><a class="code" href="class_c_group_manager.html#h11">01533</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h11">CGroupManager::cleanDropVisualizer</a>(){
01534   <font class="keywordflow">if</font> ( m_oldDragRect.isValid() ) {
01535     QRect rect = m_oldDragRect;
01536     m_oldDragRect = QRect();
01537     viewport()-&gt;repaint(rect,<font class="keyword">true</font>);
01538   }
01539 }
01540 
<a name="l01542"></a><a class="code" href="class_c_group_manager.html#g1">01542</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g1">CGroupManager::slotReset</a>(){
01543     <font class="keywordtype">int</font> result = 0;
01544     <font class="keywordflow">if</font> (m_showHelpDialogs)
01545         result = KMessageBox:: warningContinueCancel( <font class="keyword">this</font>, i18n(<font class="stringliteral">"&lt;qt&gt;This function will reset the main index!&lt;BR&gt;This will recreate the original groups and delete all other items!&lt;BR&gt;Be sure no important bookmarks will be deleted!&lt;BR&gt;Do you want to continue?&lt;/qt&gt;"</font>), i18n(<font class="stringliteral">"BibleTime - Reset main index"</font>), i18n(<font class="stringliteral">"Continue"</font>));
01546     <font class="keywordflow">else</font>
01547         result = KMessageBox::Continue;
01548         
01549     <font class="keywordflow">if</font> (result == KMessageBox::Continue) {
01550         clear();
01551         <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
01552     }
01553 }
01554 
<a name="l01556"></a><a class="code" href="class_c_group_manager.html#h14">01556</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h14">CGroupManager::slotPrintBookmark</a>(){    
01557     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() != CGroupManagerItem::Bookmark) )
01558         <font class="keywordflow">return</font>;
01559     CExportManager::printKey( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>()-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(), QString::null, m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>() );
01560 }
01561 
<a name="l01563"></a><a class="code" href="class_c_group_manager.html#h16">01563</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h16">CGroupManager::slotDeleteSearchdialog</a>(){
01564     <font class="keywordflow">if</font> (m_searchDialog)
01565         m_searchDialog-&gt;delayedDestruct();  <font class="comment">//delete the search dialog</font>
01566     m_searchDialog = 0;
01567 }
01568 
<a name="l01570"></a><a class="code" href="class_c_group_manager.html#h15">01570</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h15">CGroupManager::resizeEvent</a>( QResizeEvent* e )  {
01571     KListView::resizeEvent(e);      
01572     setColumnWidth(0, visibleWidth() );
01573     triggerUpdate();
01574     
01575 }
01576 
<a name="l01578"></a><a class="code" href="class_c_group_manager.html#i0">01578</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#i0">CGroupManager::slotReturnPressed</a>( QListViewItem* i){
01579     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = dynamic_cast&lt;CGroupManagerItem*&gt;(i);
01580     <font class="keywordflow">if</font> (!item)
01581         <font class="keywordflow">return</font>; 
01582     <font class="keywordflow">switch</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>())    {
01583         <font class="keywordflow">case</font> CGroupManagerItem::Bookmark:
01584             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())             
01585                 emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(),item-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );          
01586             <font class="keywordflow">break</font>;
01587         <font class="keywordflow">case</font> CGroupManagerItem::Module:
01588             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
01589                 emit <a class="code" href="class_c_group_manager.html#j0">createSwordPresenter</a>(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null);           
01590             <font class="keywordflow">break</font>;
01591         <font class="keywordflow">case</font> CGroupManagerItem::Group:
01592             item-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !item-&gt;isOpen() );
01593             <font class="keywordflow">break</font>;
01594         <font class="keywordflow">default</font>:
01595             <font class="keywordflow">break</font>;
01596     }
01597 }
01598 
<a name="l01600"></a><a class="code" href="class_c_group_manager.html#g2">01600</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g2">CGroupManager::resizeContents</a>( <font class="keywordtype">int</font> w, <font class="keywordtype">int</font> h ){
01601     <font class="keywordflow">if</font> (m_useDragDrop)
01602         KListView::resizeContents(w,h+25);
01603     <font class="keywordflow">else</font>
01604         KListView::resizeContents(w,h);
01605 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
