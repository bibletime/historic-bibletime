<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cgroupmanager.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cgroupmanager.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cgroupmanager.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Wed Jan 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#define BOOKMARK_FORMAT_VERSION 1</font>
00019 <font class="preprocessor"></font>
00020 
00021 <font class="comment">//own includes</font>
00022 <font class="preprocessor">#include "cgroupmanager.h"</font>
00023 <font class="preprocessor">#include "cgroupmanageritem.h"</font>
00024 
00025 <font class="preprocessor">#include "backend/cswordbiblemoduleinfo.h"</font>
00026 <font class="preprocessor">#include "backend/cswordcommentarymoduleinfo.h"</font>
00027 <font class="preprocessor">#include "backend/cswordlexiconmoduleinfo.h"</font>
00028 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00029 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00030 <font class="preprocessor">#include "backend/creferencemanager.h"</font>
00031 <font class="preprocessor">#include "printing/cprintitem.h"</font>
00032 <font class="preprocessor">#include "printing/cprinter.h"</font>
00033 
00034 <font class="preprocessor">#include "frontend/chtmldialog.h"</font>
00035 <font class="preprocessor">#include "frontend/cinputdialog.h"</font>
00036 <font class="preprocessor">#include "frontend/searchdialog/csearchdialog.h"</font>
00037 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00038 <font class="preprocessor">#include "frontend/cexportmanager.h"</font>
00039 
00040 <font class="preprocessor">#include "whatsthisdef.h"</font>
00041 <font class="preprocessor">#include "resource.h"</font>
00042 
00043 <font class="preprocessor">#include &lt;iostream.h&gt;</font>
00044 
00045 <font class="comment">//QT includes</font>
00046 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00047 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00048 <font class="preprocessor">#include &lt;qmessagebox.h&gt;</font>
00049 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00050 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00051 <font class="preprocessor">#include &lt;qvaluelist.h&gt;</font>
00052 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00053 <font class="preprocessor">#include &lt;qinputdialog.h&gt;</font>
00054 <font class="preprocessor">#include &lt;qstyle.h&gt;</font>
00055 
00056 <font class="comment">//KDE includes</font>
00057 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00058 <font class="preprocessor">#include &lt;kstddirs.h&gt;</font>
00059 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00060 <font class="preprocessor">#include &lt;kconfig.h&gt;</font>
00061 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00062 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00063 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00064 <font class="comment">//#include &lt;kdestyle.h&gt;</font>
00065 <font class="preprocessor">#include &lt;kpassdlg.h&gt;</font>
00066 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00067 <font class="preprocessor">#include &lt;kmessagebox.h&gt;</font>
00068 
00069 
00070 CGroupManager::ToolTip::ToolTip(QWidget* parent) : QToolTip(parent) {
00071 }
00072 
<a name="l00073"></a><a class="code" href="class_c_group_manager_1_1_tool_tip.html#a1">00073</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager_1_1_tool_tip.html#a1">CGroupManager::ToolTip::maybeTip</a>(<font class="keyword">const</font> QPoint&amp; p) {
00074     <font class="keywordflow">if</font> (!parentWidget()-&gt;inherits(<font class="stringliteral">"CGroupManager"</font>))
00075         <font class="keywordflow">return</font>;
00076     
00077     <a class="code" href="class_c_group_manager.html">CGroupManager</a>* m = 0;
00078     <font class="keywordflow">if</font> ( !(m = dynamic_cast&lt;CGroupManager*&gt;(parentWidget())) )
00079         <font class="keywordflow">return</font>; 
00080     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = 0;
00081     <font class="keywordflow">if</font> ( !( i = dynamic_cast&lt;CGroupManagerItem*&gt;(m-&gt;itemAt(p))) )
00082         <font class="keywordflow">return</font>;
00083     
00084     QRect r = m-&gt;itemRect(i);
00085     <font class="keywordflow">if</font> (!r.isValid())
00086         <font class="keywordflow">return</font>;
00087     
00088     <font class="comment">//get type of item and display correct text</font>
00089     <font class="keyword">const</font> QString text = i-&gt;<a class="code" href="class_c_group_manager_item.html#a16">getToolTip</a>();
00090     <font class="keywordflow">if</font> (!text.isEmpty()) {
00091         <font class="keyword">const</font> QFont oldFont = font();               
00092         <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = dynamic_cast&lt;CSwordModuleInfo*&gt;(i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00093 
00094         <font class="comment">//Module is Unicode-based. Only set font if a bookmark should be displayed</font>
00095         <font class="keywordflow">if</font> (i-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>() &amp;&amp; m &amp;&amp; m-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>() )
00096             setFont(CBTConfig::get( CBTConfig::unicode ));
00097 
00098         tip(r, text);
00099         setFont(oldFont);
00100     }
00101 }
00102 
00103 
00104 CGroupManager::CGroupManager(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name, ListCSwordModuleInfo *swordList, <font class="keyword">const</font> <font class="keywordtype">bool</font> useBookmarks, <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>, <font class="keyword">const</font> <font class="keywordtype">bool</font> useDnD, <font class="keyword">const</font> <font class="keywordtype">bool</font> useExtendedMode, <font class="keyword">const</font> <font class="keywordtype">bool</font> useRMBMenu, <font class="keyword">const</font> <font class="keywordtype">bool</font> showHelpDialogs)
00105     : KListView(parent, name),
00106         m_swordList(swordList),     
00107         m_config( new KConfig("bt-groupmanager", false, false ) ),
00108       m_menu(false),
00109         m_searchDialog(0),      
00110         m_pressedItem(0),       
00111         m_useBookmarks(useBookmarks),
00112         m_saveSettings(<a class="code" href="class_c_group_manager.html#a5">saveSettings</a>),
00113         m_useDragDrop(useDnD),
00114         m_useExtendedMode(useExtendedMode),
00115         m_useRMBMenu(useRMBMenu),
00116         m_showHelpDialogs(showHelpDialogs)
00117 {
00118 <font class="comment">//  if (KGlobal::dirs()-&gt;addCustomized(m_config))</font>
00119 <font class="comment">//      m_config-&gt;reparseConfiguration();</font>
00120 <font class="comment">//  m_config-&gt;setGroup("test");</font>
00121 <font class="comment">//  m_config-&gt;writeEntry("d", "test");</font>
00122 <font class="comment">//  m_config-&gt;sync();</font>
00123     <a class="code" href="class_c_group_manager.html#a6">initView</a>();
00124     <a class="code" href="class_c_group_manager.html#c0">initConnections</a>();
00125     <a class="code" href="class_c_group_manager.html#a4">readSettings</a>();
00126 }
00127 
00128 CGroupManager::~CGroupManager(){    
00129     <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>();
00130     m_config-&gt;sync();
00131     <font class="keyword">delete</font> m_config;
00132     m_config = 0;
00133 }
00134 
<a name="l00136"></a><a class="code" href="class_c_group_manager.html#a2">00136</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a2">CGroupManager::setupSwordTree</a>() {
00137   qWarning(<font class="stringliteral">"CGroupManager::setupSwordTree()"</font>);
00138     <a class="code" href="class_c_group_manager.html#c16">readGroups</a>(m_config, 0);
00139     <a class="code" href="class_c_group_manager.html#c14">readSwordModules</a>(m_config, 0);  
00140     <font class="keywordflow">if</font> (m_useBookmarks)
00141         <a class="code" href="class_c_group_manager.html#c12">readSwordBookmarks</a>(m_config, 0);
00142     <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
00143 }
00144 
<a name="l00146"></a><a class="code" href="class_c_group_manager.html#a3">00146</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a3">CGroupManager::setupStandardSwordTree</a>() {
00147     qWarning(<font class="stringliteral">"CGroupManager::setupStandardSwordTree"</font>);  
00148  <font class="keywordflow">if</font> (!m_swordList || (m_swordList &amp;&amp; !m_swordList-&gt;count())) {
00149         qWarning(<font class="stringliteral">"CGroupManager::setupStandardSwordTree: m_swordList is empty or qual to NULL. return now."</font>);
00150         <font class="keywordflow">return</font>;
00151     }
00152     
00153     <font class="keyword">const</font> <font class="keywordtype">bool</font> initialized = m_config-&gt;readBoolEntry(<font class="stringliteral">"initialized"</font>, <font class="keyword">false</font>);
00154     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* moduleInfo = 0;
00155     QListViewItemIterator it( <font class="keyword">this</font> );
00156     
00157     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* bibleGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Bibles"</font>));      
00158     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* bookGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Books"</font>));    
00159     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* commentaryGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Commentaries"</font>));           
00160     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* lexiconGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(i18n(<font class="stringliteral">"Lexicons"</font>));
00161     
00162     <font class="keywordflow">for</font>(moduleInfo = m_swordList-&gt;first(); moduleInfo; moduleInfo = m_swordList-&gt;next()) {
00163         <font class="keywordtype">bool</font> alreadyCreated = <font class="keyword">false</font>;
00164     QListViewItemIterator it( <font class="keyword">this</font> );
00165         <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
00166             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
00167             <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() == moduleInfo) { <font class="comment">//already there</font>
00168                 alreadyCreated = <font class="keyword">true</font>;
00169                 <font class="keywordflow">break</font>;
00170             }
00171         }
00172         <font class="keywordflow">if</font> ( moduleInfo &amp;&amp; !alreadyCreated) { <font class="comment">//module was probably newly installed, insert it</font>
00173             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* itemParent = 0;
00174             <font class="keywordflow">switch</font> (moduleInfo-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) {
00175                 <font class="keywordflow">case</font> CSwordModuleInfo::Bible:
00176                     itemParent = bibleGroup;
00177                     <font class="keywordflow">break</font>;
00178                 <font class="keywordflow">case</font> CSwordModuleInfo::Commentary:
00179                     itemParent = commentaryGroup;
00180                     <font class="keywordflow">break</font>;
00181                 <font class="keywordflow">case</font> CSwordModuleInfo::Lexicon:
00182                     itemParent = lexiconGroup;
00183                     <font class="keywordflow">break</font>;
00184                 <font class="keywordflow">case</font> CSwordModuleInfo::GenericBook:
00185                     itemParent = bookGroup;
00186                     <font class="keywordflow">break</font>;                  
00187                 <font class="keywordflow">default</font>:
00188                     <font class="keywordflow">break</font>;
00189             }
00190             <font class="keywordflow">if</font> (itemParent)
00191                 (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(itemParent,QString::null,QString::null, moduleInfo,0, CGroupManagerItem::Module);
00192         }
00193     }
00194     <font class="keywordflow">if</font> (!initialized) {
00195         bibleGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);
00196         lexiconGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);
00197         commentaryGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);    
00198         bookGroup-&gt;sortChildItems(0,<font class="keyword">true</font>);              
00199         sort();     
00200     }
00201     
00202     <font class="comment">// Now delete the groupes which have no child items</font>
00203     <font class="keywordflow">if</font> (!bibleGroup-&gt;childCount()) {        
00204         <font class="keyword">delete</font> bibleGroup;
00205         bibleGroup = 0;
00206     }
00207     <font class="keywordflow">if</font> (!lexiconGroup-&gt;childCount()) {
00208         <font class="keyword">delete</font> lexiconGroup;
00209         lexiconGroup = 0;
00210     }
00211     <font class="keywordflow">if</font> (!commentaryGroup-&gt;childCount()) {
00212         <font class="keyword">delete</font> commentaryGroup;
00213         commentaryGroup = 0;
00214     }
00215     <font class="keywordflow">if</font> (!bookGroup-&gt;childCount()) {
00216         <font class="keyword">delete</font> bookGroup;
00217         bookGroup = 0;
00218     }   
00219 }
00220 
<a name="l00222"></a><a class="code" href="class_c_group_manager.html#c0">00222</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c0">CGroupManager::initConnections</a>(){
00223     connect(<font class="keyword">this</font>, SIGNAL(returnPressed(QListViewItem*)), SLOT(<a class="code" href="class_c_group_manager.html#i0">slotReturnPressed</a>(QListViewItem*)));
00224     <font class="keywordflow">if</font> (m_useRMBMenu)
00225         connect(m_popupMenu, SIGNAL(aboutToShow()),
00226             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h2">slotPopupAboutToShow</a>()));
00227 }
00228 
<a name="l00230"></a><a class="code" href="class_c_group_manager.html#a5">00230</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a5">CGroupManager::saveSettings</a>(){ 
00231     KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00232     <font class="keywordflow">if</font> (!m_saveSettings) {
00233         <font class="keywordflow">return</font>;
00234     }
00235             
00236     <font class="comment">//save column width </font>
00237     m_config-&gt;writeEntry(<font class="stringliteral">"initialized"</font>, <font class="keyword">true</font>);
00238     m_config-&gt;writeEntry(<font class="stringliteral">"First column"</font>, columnWidth(0));
00239     
00240   <font class="comment">//save the bookmarks and the groups   </font>
00241     <a class="code" href="class_c_group_manager.html#c15">saveGroups</a>(m_config,0);
00242     <a class="code" href="class_c_group_manager.html#c13">saveSwordModules</a>(m_config,0);
00243     <a class="code" href="class_c_group_manager.html#c11">saveSwordBookmarks</a>(m_config, 0);
00244 }
00245 
<a name="l00247"></a><a class="code" href="class_c_group_manager.html#a4">00247</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a4">CGroupManager::readSettings</a>(){
00248     KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00249     <font class="keywordflow">if</font> (m_config-&gt;readBoolEntry(<font class="stringliteral">"initialized"</font>))
00250         <a class="code" href="class_c_group_manager.html#a2">setupSwordTree</a>();
00251     <font class="keywordflow">else</font>
00252         <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
00253     setColumnWidth(0, m_config-&gt;readNumEntry(<font class="stringliteral">"First column"</font>, visibleWidth()) );
00254 }
00255 
<a name="l00257"></a><a class="code" href="class_c_group_manager.html#a6">00257</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#a6">CGroupManager::initView</a>(){
00258     m_toolTip = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_1_1_tool_tip.html">ToolTip</a>(<font class="keyword">this</font>);
00259     
00260     QWhatsThis::add(<font class="keyword">this</font>, WT_GM_WIDGET );
00261     m_singleClick = KGlobalSettings::singleClick();
00262             
00263     setBackgroundMode(PaletteBase);
00264     setSorting(-1);
00265   setFullWidth(<font class="keyword">true</font>);
00266         
00267     <font class="keywordflow">if</font> (m_useDragDrop)
00268         viewport()-&gt;setAcceptDrops(<font class="keyword">true</font>);
00269     <font class="keywordflow">if</font> (m_useExtendedMode)
00270         setSelectionModeExt(KListView::Extended);
00271     setRootIsDecorated(<font class="keyword">false</font>);
00272     setAllColumnsShowFocus(<font class="keyword">true</font>);
00273                 
00274     addColumn(i18n(<font class="stringliteral">"Caption"</font>));
00275     header()-&gt;hide();
00276     
00277     <font class="keywordflow">if</font> (!m_useRMBMenu) {
00278         m_popupMenu = 0;
00279     }
00280     <font class="keywordflow">else</font> {      
00281         m_popupMenu = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00282         m_popupMenu-&gt;insertTitle(i18n(<font class="stringliteral">"Main index"</font>));
00283         m_popupMenu-&gt;insertItem(GROUP_NEW_ICON_SMALL, i18n(<font class="stringliteral">"Create a new folder"</font>),
00284             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h6">slotCreateNewGroup</a>()),0,ID_GM_GROUP_CREATE);
00285         m_popupMenu-&gt;setWhatsThis(ID_GM_GROUP_CREATE, WT_GM_NEW_GROUP); 
00286         m_popupMenu-&gt;insertItem(GROUP_CHANGE_ICON_SMALL, i18n(<font class="stringliteral">"Change this folder"</font>),
00287             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h13">slotChangeGroup</a>()),0,ID_GM_GROUP_CHANGE);
00288         m_popupMenu-&gt;setWhatsThis(ID_GM_GROUP_CHANGE, WT_GM_CHANGE_GROUP);      
00289         m_popupMenu-&gt;insertSeparator(); 
00290         m_popupMenu-&gt;insertItem(BOOKMARK_CHANGE_ICON_SMALL,i18n(<font class="stringliteral">"Change this bookmark"</font>),
00291             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h1">slotChangeBookmark</a>()),0,ID_GM_BOOKMARK_CHANGE);
00292         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARK_CHANGE, WT_GM_CHANGE_BOOKMARK);
00293         m_popupMenu-&gt;insertItem(BOOKMARK_IMPORT_ICON_SMALL,i18n(<font class="stringliteral">"Import bookmarks"</font>),
00294             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h8">slotImportBookmarks</a>()),0,ID_GM_BOOKMARKS_IMPORT); 
00295         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARKS_IMPORT, WT_GM_IMPORT_BOOKMARKS);
00296         m_popupMenu-&gt;insertItem(BOOKMARK_EXPORT_ICON_SMALL,i18n(<font class="stringliteral">"Export bookmarks"</font>),
00297             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h7">slotExportBookmarks</a>()),0,ID_GM_BOOKMARKS_EXPORT);     
00298         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARKS_EXPORT, WT_GM_EXPORT_BOOKMARKS);  
00299         m_popupMenu-&gt;insertItem(BOOKMARK_PRINT_ICON_SMALL,i18n(<font class="stringliteral">"Print bookmark"</font>),
00300             <font class="keyword">this</font>,SLOT(<a class="code" href="class_c_group_manager.html#h14">slotPrintBookmark</a>()),0,ID_GM_BOOKMARK_PRINT);
00301         m_popupMenu-&gt;setWhatsThis(ID_GM_BOOKMARK_PRINT, WT_GM_PRINT_BOOKMARK);
00302         m_popupMenu-&gt;insertItem(ITEMS_DELETE_ICON_SMALL, i18n(<font class="stringliteral">"Remove selected item(s)"</font>),
00303             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h0">slotDeleteSelectedItems</a>()),0,ID_GM_ITEMS_DELETE);
00304         m_popupMenu-&gt;insertSeparator();
00305         m_popupMenu-&gt;insertItem(MODULE_SEARCH_ICON_SMALL,i18n(<font class="stringliteral">"Search in selected module(s)"</font>),
00306             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h3">slotSearchSelectedModules</a>()),0,ID_GM_MODULES_SEARCH);
00307         m_popupMenu-&gt;insertSeparator();
00308         m_popupMenu-&gt;insertItem(MODULE_UNLOCK_ICON_SMALL,i18n(<font class="stringliteral">"Unlock this module"</font>),
00309             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#g0">slotUnlockModule</a>()),0,ID_GM_MODULE_UNLOCK);  
00310         m_popupMenu-&gt;setWhatsThis(ID_GM_MODULE_UNLOCK, WT_GM_UNLOCK_MODULE);    
00311         m_popupMenu-&gt;insertItem(MODULE_ABOUT_ICON_SMALL, i18n(<font class="stringliteral">"About this module"</font>),
00312             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h4">slotShowAbout</a>()),0,ID_GM_MODULE_ABOUT);
00313         m_popupMenu-&gt;setWhatsThis(ID_GM_MODULE_ABOUT, WT_GM_ABOUT_MODULE);
00314     }
00315 }
00316     
<a name="l00318"></a><a class="code" href="class_c_group_manager.html#h0">00318</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h0">CGroupManager::slotDeleteSelectedItems</a>(){
00319     QListViewItemIterator it( <font class="keyword">this</font> );
00320     <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
00321         <font class="keywordflow">if</font> ( it.current()-&gt;isSelected() )
00322             <font class="keyword">delete</font> it.current();
00323     }
00324 }   
00325 
<a name="l00327"></a><a class="code" href="class_c_group_manager.html#h3">00327</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h3">CGroupManager::slotSearchSelectedModules</a>() {
00328     ListCSwordModuleInfo searchList;
00329     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *item = 0;
00330     
00331     QPtrList&lt;QListViewItem&gt; items = selectedItems();
00332     <font class="keywordflow">for</font> (items.first(); items.current(); items.next()) {
00333         item = dynamic_cast&lt;CGroupManagerItem*&gt;(items.current());
00334         <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module)
00335             searchList.append(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00336     }
00337     <a class="code" href="class_c_group_manager.html#a5">saveSettings</a>();
00338     m_config-&gt;sync();
00339 
00340     <font class="keywordflow">if</font> (!m_searchDialog)
00341         m_searchDialog = <font class="keyword">new</font> <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>(searchList,0,0);
00342     <font class="keywordflow">else</font>
00343         m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a3">setModuleList</a>(searchList);
00344     connect(m_searchDialog, SIGNAL(finished()),
00345         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h15">slotDeleteSearchdialog</a>()));  
00346     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a4">setSearchText</a>(QString::null);
00347     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#g0">show</a>();
00348     m_searchDialog-&gt;raise();
00349 }   
00350 
00351 <font class="keywordtype">void</font> CGroupManager::searchBookmarkedModule(<font class="keyword">const</font> QString&amp; text, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item) {  
00352 <font class="comment">//  qWarning("CGroupManager::searchBookmarkedModule(const QString&amp; text, CGroupManagerItem* item)");</font>
00353 <font class="comment">//  ASSERT(item);</font>
00354   <font class="keywordflow">if</font> (!item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
00355     <font class="keywordflow">return</font>;
00356     ListCSwordModuleInfo searchList;
00357     searchList.append(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00358     
00359     <font class="keywordflow">if</font> (!m_searchDialog)
00360         m_searchDialog = <font class="keyword">new</font> <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>(searchList,0,0);
00361     <font class="keywordflow">else</font>
00362         m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a3">setModuleList</a>(searchList);
00363     connect(m_searchDialog, SIGNAL(finished()),
00364         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_group_manager.html#h15">slotDeleteSearchdialog</a>()));  
00365         
00366   m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a4">setSearchText</a>(text);
00367     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#g0">show</a>();
00368     m_searchDialog-&gt;raise();
00369     m_searchDialog-&gt;<a class="code" href="class_c_search_dialog.html#a6">startSearch</a>();  
00370 }   
00371 
00373 <font class="keywordtype">void</font> CGroupManager::createNewBookmark(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parent, <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; ref){
00374     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* swordModule = dynamic_cast&lt;CSwordModuleInfo*&gt;(module);        
00375     <font class="keywordflow">if</font> (!swordModule)
00376         <font class="keywordflow">return</font>;
00377     
00378     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;  
00379     <font class="keywordtype">bool</font> ok = <font class="keyword">false</font>;
00380     <font class="keyword">const</font> QString description = <a class="code" href="class_c_input_dialog.html#d0">CInputDialog::getText</a>(i18n(<font class="stringliteral">"Bookmark description - BibleTime"</font>), i18n(<font class="stringliteral">"Please enter here the description:"</font>), QString::null, &amp;ok);
00381     <font class="keywordflow">if</font> (!ok)
00382         <font class="keywordflow">return</font>;
00383 
00384     myItem = 0;
00385   <font class="keywordflow">if</font> ( parent &amp;&amp; (parent-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
00386     myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parent,QString::null,QString::null,module, 0, CGroupManagerItem::Bookmark);
00387     parent-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00388   }
00389     <font class="keywordflow">else</font>
00390         myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>,QString::null,QString::null,module, 0, CGroupManagerItem::Bookmark);
00391         
00392     <font class="keywordflow">if</font> (myItem) {   <font class="comment">//it's a Sword module</font>
00393         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module);
00394         <font class="keywordflow">if</font> (key) {
00395             key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(ref);
00396             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a9">setBookmarkKey</a>(key);    <font class="comment">//the key is deleted by the groupmmanager item</font>
00397         }
00398     }       
00399   <font class="keywordflow">if</font> (myItem)   <font class="comment">//set the description       </font>
00400         myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>(description);
00401     setFocus();     
00402 }
00403 
00404 
<a name="l00406"></a><a class="code" href="class_c_group_manager.html#h1">00406</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h1">CGroupManager::slotChangeBookmark</a>(){
00407     <font class="keywordflow">if</font> (!m_pressedItem)
00408         <font class="keywordflow">return</font>;     
00409     <font class="keywordtype">bool</font> isOk;
00410     QString description = <a class="code" href="class_c_input_dialog.html#d0">CInputDialog::getText</a>(i18n(<font class="stringliteral">"Change bookmark description - BibleTime"</font>),i18n(<font class="stringliteral">"Please change the description of the item!"</font>), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>(), &amp;isOk);
00411     <font class="keywordflow">if</font> (isOk)
00412         m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>(description);
00413 }
00414 
<a name="l00416"></a><a class="code" href="class_c_group_manager.html#h13">00416</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h13">CGroupManager::slotChangeGroup</a>(){
00417     <font class="keywordflow">if</font> (!m_pressedItem)
00418         <font class="keywordflow">return</font>;     
00419     
00420     <font class="keywordtype">bool</font> isOk;
00421     QString description = QInputDialog::getText(i18n(<font class="stringliteral">"Change folder - BibleTime"</font>), i18n(<font class="stringliteral">"Please change the name of the group!"</font>), QLineEdit::Normal,m_pressedItem-&gt;text(0), &amp;isOk, <font class="keyword">this</font>);    
00422     <font class="keywordflow">if</font> (isOk)
00423         m_pressedItem-&gt;setText( 0, description );
00424 }
00425 
<a name="l00427"></a><a class="code" href="class_c_group_manager.html#h2">00427</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h2">CGroupManager::slotPopupAboutToShow</a>(){
00428     <font class="keywordflow">if</font> (!m_useRMBMenu)
00429         <font class="keywordflow">return</font>;
00430         
00431     m_menu = <font class="keyword">true</font>;
00432     
00433     
00434     <font class="keywordflow">if</font> (m_pressedItem) {
00435         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) {
00436             <font class="keywordtype">bool</font> moduleIsEncrypted = m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>();
00437             
00438             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">true</font>);          
00439             
00440             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">false</font>);
00441             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00442             
00443             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);
00444             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">false</font>);
00445             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, <font class="keyword">false</font>);         
00446             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);           
00447 
00448             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">false</font>);
00449                         
00450             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">true</font>);    
00451             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, moduleIsEncrypted);            
00452             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">true</font>);
00453         }
00454         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) {
00455             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">true</font>);
00456                         
00457             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">false</font>);         
00458             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00459                         
00460             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">true</font>);
00461             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">false</font>);
00462             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, <font class="keyword">false</font>);         
00463             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">true</font>);
00464             
00465             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">true</font>);                      
00466             
00467             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00468             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);            
00469             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);
00470 
00471         }
00472         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00473             m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">false</font>);
00474                         
00475             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">true</font>);
00476             m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">true</font>);
00477                                                 
00478             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);                          
00479             
00480             <font class="comment">//enable import and export only if a bookmark exists in this group</font>
00481             <font class="keywordtype">bool</font> foundBookmark = <font class="keyword">false</font>;
00482         QListViewItem * myChild = m_pressedItem-&gt;firstChild();
00483         <font class="keywordflow">while</font>( myChild &amp;&amp; !foundBookmark) {
00484             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(myChild);
00485                 <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00486                     foundBookmark = <font class="keyword">true</font>;
00487                 myChild = myChild-&gt;nextSibling();
00488         }
00489             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">true</font>);
00490             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, foundBookmark);
00491             m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);
00492                 
00493             m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">true</font>);
00494 
00495             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00496             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);
00497             m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);
00498         }       
00499     }
00500     <font class="keywordflow">else</font> { <font class="comment">//top level</font>
00501         m_popupMenu-&gt;setItemEnabled(ID_GM_PRESENTER_CREATE, <font class="keyword">false</font>);
00502                         
00503         m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CREATE, <font class="keyword">true</font>);
00504         m_popupMenu-&gt;setItemEnabled(ID_GM_GROUP_CHANGE, <font class="keyword">false</font>);
00505             
00506         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_CHANGE, <font class="keyword">false</font>);              
00507             
00508         <font class="keywordtype">bool</font> foundBookmark = <font class="keyword">false</font>; 
00509      QListViewItemIterator it( <font class="keyword">this</font> );
00510      <font class="keywordflow">for</font> ( ; it.current() &amp;&amp; !foundBookmark; ++it ) {
00511         <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
00512             <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00513                 foundBookmark = <font class="keyword">true</font>;
00514         }           
00515         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_IMPORT, <font class="keyword">true</font>);
00516         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARKS_EXPORT, foundBookmark);
00517         m_popupMenu-&gt;setItemEnabled(ID_GM_BOOKMARK_PRINT, <font class="keyword">false</font>);
00518                         
00519         m_popupMenu-&gt;setItemEnabled(ID_GM_ITEMS_DELETE, <font class="keyword">false</font>);
00520                         
00521         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULES_SEARCH, <font class="keyword">false</font>);
00522         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_UNLOCK, <font class="keyword">false</font>);            
00523         m_popupMenu-&gt;setItemEnabled(ID_GM_MODULE_ABOUT, <font class="keyword">false</font>);         
00524     }
00525 }
00526 
<a name="l00528"></a><a class="code" href="class_c_group_manager.html#h4">00528</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h4">CGroupManager::slotShowAbout</a>(){
00529     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = dynamic_cast&lt;CSwordModuleInfo*&gt;(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());    
00530     <font class="keywordflow">if</font> (!m_pressedItem || !m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() || !module)
00531         <font class="keywordflow">return</font>;
00532     QString text;   
00533 
00534   <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a10">hasVersion</a>())
00535     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00536         .arg(i18n(<font class="stringliteral">"Version"</font>))
00537         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::ModuleVersion));
00538 
00539     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;&lt;b&gt;%3:&lt;/b&gt; %4&lt;br&gt;"</font>)
00540         .arg(i18n(<font class="stringliteral">"Location"</font>))
00541 <font class="comment">//      .arg(backend()-&gt;modulePath(module-&gt;name()))</font>
00542         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::AbsoluteDataPath))
00543         .arg(i18n(<font class="stringliteral">"Language"</font>))
00544         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Lang());
00545 
00546     <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;isWritable())
00547         text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00548                             .arg(i18n(<font class="stringliteral">"Writable"</font>))
00549                             .arg(i18n(<font class="stringliteral">"yes"</font>));
00550 
00551     <font class="keywordflow">if</font> ( module-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>() )
00552         text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00553                             .arg(i18n(<font class="stringliteral">"Unlock key"</font>))
00554                             .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::CipherKey));  
00555     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>).arg(i18n(<font class="stringliteral">"Encoding"</font>)).arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>() ? i18n(<font class="stringliteral">"Unicode"</font>) : i18n(<font class="stringliteral">"iso8859-1"</font>));
00556 
00557     QString options;
00558     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> opts;
00559     <font class="keywordflow">for</font> (opts = CSwordBackend::filterOptionsMIN; opts &lt;= CSwordBackend::filterOptionsMAX; ++opts){
00560         <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a20">has</a>( (<a class="code" href="class_c_sword_backend.html#s14">CSwordBackend::FilterOptions</a>)opts)){
00561         <font class="keywordflow">if</font> (!options.isEmpty())
00562             options += QString::fromLatin1(<font class="stringliteral">", "</font>);
00563         options += <a class="code" href="class_c_sword_backend.html#d3">CSwordBackend::translatedOptionName</a>( (<a class="code" href="class_c_sword_backend.html#s14">CSwordBackend::FilterOptions</a>)opts);
00564         }
00565     }
00566     <font class="keywordflow">if</font> (!options.isEmpty())
00567         text += QString(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt; %2&lt;br&gt;"</font>)
00568             .arg(i18n(<font class="stringliteral">"Features"</font>))
00569             .arg(options);
00570 
00571     text += QString::fromLatin1(<font class="stringliteral">"&lt;b&gt;%1:&lt;/b&gt;&lt;br&gt; &lt;font size=\"-1\"&gt;%2&lt;/font&gt;"</font>)
00572                         .arg(<font class="stringliteral">"About"</font>)
00573                         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::AboutInformation));
00574 
00575     KMessageBox::about(<font class="keyword">this</font>, text, module-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::Description), <font class="keyword">false</font>);
00576 }
00577 
00579 <font class="keywordtype">void</font> CGroupManager::slotCreateNewPresenter(){
00580     <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00581         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module || m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00582             emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null );
00583     }
00584 }
00585 
00587 <font class="keywordtype">void</font> CGroupManager::contentsDragEnterEvent( QDragEnterEvent* e){
00588   <font class="keywordflow">if</font> (QTextDrag::canDecode(e)) {
00589     e-&gt;accept(<font class="keyword">true</font>);
00590     QString str;
00591       QCString submime;
00592     <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=BOOKMARK))
00593         m_dragType = BOOKMARK;
00594     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=REFERENCE))
00595         m_dragType = REFERENCE;     
00596     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=MODULE))
00597         m_dragType = MODULE;    
00598     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=GROUP))
00599         m_dragType = GROUP;             
00600     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=TEXT))
00601         m_dragType = TEXT;
00602     <font class="keywordflow">else</font>
00603         m_dragType = <font class="stringliteral">""</font>;
00604   }
00605   <font class="keywordflow">else</font> {
00606     e-&gt;ignore();
00607     m_dragType = <font class="stringliteral">""</font>;
00608   }
00609 }
00610 
00612 <font class="keywordtype">void</font> CGroupManager::contentsDragMoveEvent( QDragMoveEvent* e){
00613   <font class="comment">//open folders</font>
00614   <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)itemAt( contentsToViewport(e-&gt;pos()) );         
00615   e-&gt;accept(QTextDrag::canDecode(e));       
00616     <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group &amp;&amp; !item-&gt;isOpen())
00617         item-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00618 
00619     m_afterItemDrop = item;
00620     <font class="keywordflow">if</font> (item)
00621         m_parentItemDrop = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
00622     <font class="keywordflow">else</font>
00623         m_parentItemDrop = 0;
00624     
00625     QRect tmpRect = <a class="code" href="class_c_group_manager.html#h10">drawDropVisualizer</a>(0, m_parentItemDrop, m_afterItemDrop, m_dragType );
00626     <font class="keywordflow">if</font> (tmpRect != m_oldDragRect ) {
00627         <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00628         m_oldDragRect = tmpRect;
00629         <font class="keywordflow">if</font> (tmpRect.isValid())
00630             viewport()-&gt;repaint(tmpRect);
00631     }
00632 }
00633 
00635 <font class="keywordtype">void</font> CGroupManager::contentsDragLeaveEvent( QDragLeaveEvent* e){    
00636     KListView::contentsDragLeaveEvent(e);   
00637     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00638     
00639     m_oldDragRect = QRect();
00640     m_dragType = <font class="stringliteral">""</font>;
00641 }
00642 
00646 <font class="preprocessor">#define MOVE_ITEMS  \</font>
00647 <font class="preprocessor">            for ( item = m_itemList-&gt;last(); item != 0; item = m_itemList-&gt;prev()){ \</font>
00648 <font class="preprocessor">                if ( item &amp;&amp; (item != target) ){ \</font>
00649 <font class="preprocessor">                    parentItem = dynamic_cast&lt;CGroupManagerItem*&gt;(item-&gt;parent()); \</font>
00650 <font class="preprocessor">                    if ( isChild(item, target) ) \</font>
00651 <font class="preprocessor">                        continue; \</font>
00652 <font class="preprocessor">                    if (parentItem &amp;&amp; parentItem != item) \</font>
00653 <font class="preprocessor">                        parentItem-&gt;takeItem(item); \</font>
00654 <font class="preprocessor">                    else \</font>
00655 <font class="preprocessor">                        takeItem(item); \</font>
00656 <font class="preprocessor">                    if ( target &amp;&amp; target!=item ) \</font>
00657 <font class="preprocessor">                        if (target-&gt;type()==CGroupManagerItem::Group) \</font>
00658 <font class="preprocessor">                            target-&gt;insertItem(item); \</font>
00659 <font class="preprocessor">                        else{ \</font>
00660 <font class="preprocessor">                            if (target-&gt;parent()) \</font>
00661 <font class="preprocessor">                                target-&gt;parent()-&gt;insertItem(item); \</font>
00662 <font class="preprocessor">                            else \</font>
00663 <font class="preprocessor">                                this-&gt;insertItem(item); \</font>
00664 <font class="preprocessor">                        }  \</font>
00665 <font class="preprocessor">                    else \</font>
00666 <font class="preprocessor">                        this-&gt;insertItem(item); \</font>
00667 <font class="preprocessor">                } \</font>
00668 <font class="preprocessor">            }</font>
00669 <font class="preprocessor"></font>
00671 <font class="keywordtype">void</font> CGroupManager::contentsDropEvent( QDropEvent* e){
00672   <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* target = dynamic_cast&lt;CGroupManagerItem *&gt;(itemAt(contentsToViewport(e-&gt;pos())));
00673 
00674   QString str;
00675   QCString submime;
00676   <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=BOOKMARK)){
00677     <font class="comment">//a bookmark was dragged</font>
00678     <font class="keywordflow">if</font> ( e-&gt;source() != viewport() ){
00679       <font class="keywordflow">return</font>;
00680     }
00681     <font class="keywordflow">if</font> ( !(m_itemList) ){
00682       <font class="keywordflow">return</font>;
00683     }
00684     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00685     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
00686     <font class="comment">// Bookmark dragged on module - open a presenter</font>
00687     <font class="keywordflow">if</font> ( (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)
00688             &amp;&amp; target &amp;&amp; (target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) ){
00689       emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>(target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(),m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );
00690     }
00691     <font class="comment">//move around bookmarks</font>
00692     <font class="keywordflow">else</font>{       
00693         MOVE_ITEMS      
00694     }<font class="comment">//else</font>
00695   }<font class="comment">//Bookmark</font>
00696   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=GROUP)){
00697     <font class="comment">//a group was dragged</font>
00698     <font class="keywordflow">if</font> ( e-&gt;source() != this-&gt;viewport() )
00699       <font class="keywordflow">return</font>;
00700     <font class="keywordflow">if</font> ( !(m_itemList) )
00701       <font class="keywordflow">return</font>;
00702     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00703     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
00704     <font class="comment">//move around groups        </font>
00705     MOVE_ITEMS
00706   }<font class="comment">//group</font>
00707   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=MODULE)){
00708     <font class="comment">//a module was dragged</font>
00709     <font class="keywordflow">if</font> ( e-&gt;source() != this-&gt;viewport() ){
00710       <font class="keywordflow">return</font>;
00711     }
00712     <font class="keywordflow">if</font> ( !(m_itemList) ){
00713       <font class="keywordflow">return</font>;
00714     }
00715     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;
00716     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
00717     MOVE_ITEMS
00718   }<font class="comment">//module</font>
00719   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=REFERENCE)){
00720     <font class="comment">//a reference was dragged</font>
00721         QString ref;
00722     QString mod;
00723     <a class="code" href="class_c_reference_manager.html#d3">CReferenceManager::decodeReference</a>(str,mod,ref);
00724 
00725     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* info = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(mod);
00726     <font class="keywordflow">if</font> ( info <font class="comment">/*&amp;&amp; (info-&gt;name() == mod)*/</font> ){
00727             <font class="keywordflow">if</font> (!target){ <font class="comment">//Reference was dragged on no item</font>
00728                 createNewBookmark(0, info, ref); <font class="comment">//CREATE A NEW BOOKMARK</font>
00729             }
00730             <font class="keywordflow">else</font>{
00731                 <font class="keywordflow">switch</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()){
00732                     <font class="keywordflow">case</font> (CGroupManagerItem::Group):
00733                         <font class="keywordflow">if</font> (info)  <font class="comment">//Create a bookmark</font>
00734                             createNewBookmark(target,info, ref);
00735                         <font class="keywordflow">break</font>;
00736                     <font class="keywordflow">case</font> (CGroupManagerItem::Bookmark):
00737                         <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>())
00738                             createNewBookmark(target-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>(),info, ref);
00739                         <font class="keywordflow">else</font>
00740                             createNewBookmark(0,info, ref);                     
00741                         <font class="keywordflow">break</font>;
00742                     <font class="keywordflow">case</font> (CGroupManagerItem::Module):
00743                         <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()){
00748                             <font class="keywordflow">if</font> (target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Bible || target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Commentary )
00749                                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), ref );                          
00750                             <font class="keywordflow">else</font>
00751                                 searchBookmarkedModule(ref,target);
00752                         }
00753                         <font class="keywordflow">break</font>;
00754                 }<font class="comment">//switch;</font>
00755             }<font class="comment">//(target)</font>
00756     }<font class="comment">//(info)</font>
00757   }<font class="comment">//reference</font>
00758   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str,submime=TEXT)){
00759         <font class="comment">//plain text was dragged -&gt; open searchdialog</font>
00760         <font class="keywordflow">if</font> ( target &amp;&amp; target-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()==CGroupManagerItem::Module &amp;&amp; target-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() )
00761             searchBookmarkedModule(str,target);
00762   }
00763     m_dragType = <font class="stringliteral">""</font>;
00764     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
00765 }
00766 <font class="preprocessor">#undef MOVE_ITEMS</font>
00767 <font class="preprocessor"></font>
00769 <font class="keywordtype">void</font> CGroupManager::contentsMousePressEvent( QMouseEvent* e ) {
00770     m_pressedPos = e-&gt;pos();
00771   m_pressedItem = dynamic_cast&lt;CGroupManagerItem*&gt;(itemAt(contentsToViewport(m_pressedPos)));
00772   <font class="keyword">const</font> <font class="keywordtype">bool</font> open = m_pressedItem ? m_pressedItem-&gt;isOpen() : false;
00773     KListView::contentsMousePressEvent(e);  
00774     
00775     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00776             <font class="keywordflow">return</font>;
00777             
00778     <font class="keywordflow">if</font> (e-&gt;button() == LeftButton) {
00779         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group
00780                 &amp;&amp; m_singleClick &amp;&amp; (m_pressedItem-&gt;isOpen() == open) ) {
00781             <font class="comment">//open group with first click if it's a global setting of KDE</font>
00782             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !m_pressedItem-&gt;isOpen() );
00783         }
00784     }
00785     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e-&gt;button() == RightButton &amp; m_useRMBMenu) {   
00786         m_menu = <font class="keyword">true</font>;
00787         m_popupMenu-&gt;exec( viewport()-&gt;mapToGlobal( contentsToViewport(m_pressedPos) ));
00788         m_menu = <font class="keyword">false</font>;         
00789     }
00790 }
00791 
<a name="l00793"></a><a class="code" href="class_c_group_manager.html#h12">00793</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h12">CGroupManager::contentsMouseDoubleClickEvent</a> ( QMouseEvent * e){
00794 <font class="comment">//  qDebug("CGroupManager::contentsMouseDoubleClickEvent ( QMouseEvent * e)");</font>
00795   <font class="keywordtype">bool</font> open = <font class="keyword">false</font>;    
00796   <font class="keywordflow">if</font> (m_pressedItem)
00797     open = m_pressedItem-&gt;isOpen();
00798         
00799     KListView::contentsMouseDoubleClickEvent(e);
00800 
00801     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00802             <font class="keywordflow">return</font>;
00803     <font class="keywordflow">if</font> (e-&gt;button() == LeftButton) {
00804         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group
00805                 &amp;&amp; !m_singleClick &amp;&amp; (m_pressedItem-&gt;isOpen() == open) ) {
00806             <font class="comment">//open group with first click if it's a global setting of KDE</font>
00807             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !m_pressedItem-&gt;isOpen() );
00808         }
00809     }   
00810 }
00811 
00812 <font class="keywordtype">void</font> CGroupManager::contentsMouseReleaseEvent ( QMouseEvent* e ) {
00813     KListView::contentsMouseReleaseEvent(e);    
00814   <font class="keywordflow">if</font> ( !(m_pressedItem = dynamic_cast&lt;CGroupManagerItem*&gt;(itemAt(contentsToViewport(e-&gt;pos())))) )
00815     <font class="keywordflow">return</font>; 
00816     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00817         <font class="keywordflow">return</font>;
00818 
00819     <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; (e-&gt;button() == LeftButton)) {
00820         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00821         <font class="comment">//check if module is encrypted and show dialog if it wasn't opened before       </font>
00822             QPtrList&lt;QListViewItem&gt; items = selectedItems();            
00823             <font class="keywordflow">if</font> (items.count() &gt; 1) {
00824                 ListCSwordModuleInfo modules;
00825                 <font class="keywordflow">for</font> (items.first(); items.current(); items.next()) {
00826                     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(items.current());
00827                     <font class="keywordflow">if</font> (i &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
00828                         modules.append(i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>());
00829                 }
00830                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( modules, QString::null );             
00831             }
00832             <font class="keywordflow">else</font>
00833                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null );
00834                         
00835         <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a8">isEncrypted</a>()) {
00836             KConfigGroupSaver groupSaver(m_config, <font class="stringliteral">"Groupmanager"</font>);
00837             <font class="keywordflow">if</font> (m_showHelpDialogs &amp;&amp; !m_config-&gt;readBoolEntry(QString::fromLatin1(<font class="stringliteral">"shown %1 encrypted"</font>).arg(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>()), <font class="keyword">false</font>)) {
00838                     <a class="code" href="class_c_h_t_m_l_dialog.html">CHTMLDialog</a> dlg(HELPDIALOG_MODULE_LOCKED);
00839                     dlg.exec();             
00840                 }
00841             <font class="keywordflow">if</font> (m_showHelpDialogs)
00842                 m_config-&gt;writeEntry(QString::fromLatin1(<font class="stringliteral">"shown %1 encrypted"</font>).arg(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>()), <font class="keyword">true</font>);
00843         }
00844         }
00845         <font class="keywordflow">else</font> <font class="keywordflow">if</font>  (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) {
00846             <font class="keywordflow">if</font> (m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>() )
00847                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );
00848         }
00849     }
00850 }
00851 
<a name="l00853"></a><a class="code" href="class_c_group_manager.html#c7">00853</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c7">CGroupManager::contentsMouseMoveEvent</a> ( QMouseEvent * e) {
00854     KListView::contentsMouseMoveEvent( e ); 
00855     <font class="keywordflow">if</font> (!m_useDragDrop)
00856         <font class="keywordflow">return</font>;
00857     
00858     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* dragItem=(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *)itemAt( contentsToViewport(e-&gt;pos()) );
00859 
00860     <font class="comment">//mouse is pressed, an item is selected and the popup menu isn't opened</font>
00861     <font class="keywordflow">if</font> ( (e-&gt;state()&amp;LeftButton) &amp;&amp; (e-&gt;stateAfter()&amp;LeftButton) &amp;&amp; dragItem &amp;&amp; !m_menu) {
00862         <font class="comment">//Is it time to start a drag?</font>
00863     <font class="keywordflow">if</font> (abs(e-&gt;pos().x() - m_pressedPos.x()) &gt; KGlobalSettings::dndEventDelay() ||
00864                 abs(e-&gt;pos().y() - m_pressedPos.y()) &gt; KGlobalSettings::dndEventDelay() )   {
00865         <font class="comment">// Collect all selected items</font>
00866 <font class="comment">//      ASSERT(m_itemList);</font>
00867         m_itemList = <font class="keyword">new</font> QPtrList&lt;CGroupManagerItem&gt;;
00868         QListViewItemIterator it( <font class="keyword">this</font> );
00869         <font class="keywordflow">for</font>( ; it.current(); it++ )
00870         <font class="keywordflow">if</font> ( it.current()-&gt;isSelected() )
00871                     m_itemList-&gt;append( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );                             
00872         QTextDrag *d = 0;
00873         <font class="keywordflow">if</font> (!dragItem)
00874             <font class="keywordflow">return</font>;
00875             <font class="keywordflow">switch</font> (dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>()){
00876                 <font class="keywordflow">case</font> (CGroupManagerItem::Bookmark):
00877              <font class="keywordflow">if</font> (dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) {
00878                 QString ref = dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>();
00879                 QString mod = dragItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>();
00880                     
00881                 d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(mod,ref), viewport());
00882                 d-&gt;setSubtype(BOOKMARK);
00883                     m_dragType = BOOKMARK;
00884                     }
00885                     <font class="keywordflow">break</font>;                  
00886                 <font class="keywordflow">case</font> (CGroupManagerItem::Module):
00887                     d = <font class="keyword">new</font> QTextDrag( <font class="stringliteral">""</font> , viewport());
00888                     d-&gt;setSubtype(MODULE);
00889                     m_dragType = MODULE;
00890                     <font class="keywordflow">break</font>;                  
00891                 <font class="keywordflow">case</font> (CGroupManagerItem::Group):
00892                     d = <font class="keyword">new</font> QTextDrag( <font class="stringliteral">""</font> , viewport());
00893                     d-&gt;setSubtype(GROUP);
00894                     m_dragType = GROUP;
00895                     <font class="keywordflow">break</font>;
00896             }
00897             
00898             <font class="keywordflow">if</font> (d) {
00899                 d-&gt;setPixmap( *(dragItem-&gt;pixmap(0)) );
00900                 m_menu = <font class="keyword">false</font>;
00901                 d-&gt;drag();
00902             }           
00903         }
00904     }
00905 }
00906 
<a name="l00908"></a><a class="code" href="class_c_group_manager.html#h6">00908</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h6">CGroupManager::slotCreateNewGroup</a>(){
00909     <font class="keywordtype">bool</font> isOk;
00910     QString groupname = QInputDialog::getText(i18n(<font class="stringliteral">"Enter name of folder - BibleTime"</font>),i18n(<font class="stringliteral">"Please enter the name of the folder!"</font>),QLineEdit::Normal,QString::null, &amp;isOk);
00911     <font class="keywordflow">if</font> (isOk) {
00912         <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00913             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(m_pressedItem, groupname, QString::null, 0,0, CGroupManagerItem::Group);
00914             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00915         }
00916         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group){
00917             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>(), groupname, QString::null, 0,0, CGroupManagerItem::Group);
00918             m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>(<font class="keyword">true</font>);
00919         }
00920         <font class="keywordflow">else</font> {
00921             (void)<font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, groupname, QString::null, 0, 0,CGroupManagerItem::Group);
00922         }
00923     }
00924 }
00925 
<a name="l00926"></a><a class="code" href="class_c_group_manager.html#c8">00926</a> <font class="keyword">const</font> <font class="keywordtype">int</font> <a class="code" href="class_c_group_manager.html#c8">CGroupManager::parentId</a>(<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *item, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem)
00927 {
00928     <font class="comment">// search parent of item and return the id of the parent</font>
00929     <font class="keywordtype">int</font> ret = -1;   <font class="comment">// the view and the parent item have id -1</font>
00930     <font class="keywordtype">int</font> index = 0;
00931     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
00932     
00933     <font class="keywordflow">if</font> (item) {
00934         <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; item != parentItem) {
00935           QListViewItemIterator it;
00936           <font class="keywordflow">if</font> (parentItem) {
00937             it = QListViewItemIterator( parentItem );       
00938           }
00939           <font class="keywordflow">else</font>
00940             it = QListViewItemIterator( <font class="keyword">this</font> );
00941             
00942             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() == parentItem)
00943                 <font class="keywordflow">return</font> -1;
00944             <font class="keywordflow">while</font> (it.current() &amp;&amp; (it.current() != item-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) ) {
00945                 myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current();
00946                 <font class="keywordflow">if</font> (parentItem &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(parentItem, myItem) ) {
00947                     it++;
00948                     <font class="keywordflow">continue</font>;
00949                 }
00950                 <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00951                     index++;
00952                 }
00953                 it++;
00954             }
00955             <font class="keywordflow">if</font> (it.current())
00956                 ret = index;
00957         }
00958     }
00959     <font class="keywordflow">return</font> ret;
00960 }
00961 
<a name="l00963"></a><a class="code" href="class_c_group_manager.html#c9">00963</a> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* <a class="code" href="class_c_group_manager.html#c9">CGroupManager::findParent</a>( <font class="keyword">const</font> <font class="keywordtype">int</font> ID, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem){
00964     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
00965     <font class="keywordtype">int</font> index = 0;
00966     
00967     QListViewItemIterator it;
00968   <font class="keywordflow">if</font> (parentItem)
00969     it = QListViewItemIterator(parentItem);
00970   <font class="keywordflow">else</font>
00971       it = QListViewItemIterator(<font class="keyword">this</font>);
00972 
00973   <font class="comment">//traverse the tree and try to find the group with the id ID index using comparision</font>
00974   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
00975         myItem = dynamic_cast&lt;CGroupManagerItem*&gt;( it.current() );
00976         <font class="keywordflow">if</font> ( parentItem &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(parentItem, myItem) ) {
00977             <font class="keywordflow">continue</font>;
00978         }       
00979         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
00980             <font class="keywordflow">if</font> (index == ID) {              
00981                 <font class="keywordflow">return</font> myItem;
00982             }
00983             <font class="keywordflow">else</font>
00984                 index++;
00985         }
00986     }       
00987     <font class="keywordflow">return</font> 0;   <font class="comment">// return 0 if parent wasn't found</font>
00988 }
00989 
<a name="l00991"></a><a class="code" href="class_c_group_manager.html#g0">00991</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g0">CGroupManager::slotUnlockModule</a>(){ 
00992     <font class="keywordtype">bool</font> ok;
00993     QString unlockKey = QInputDialog::getText(i18n(<font class="stringliteral">"BibleTime - Unlock module"</font>),i18n(<font class="stringliteral">"Enter the key to unlock the module!"</font>),QLineEdit::Normal, m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>(CSwordModuleInfo::CipherKey), &amp;ok);
00994     <font class="keywordflow">if</font> (ok) {
00995         <a class="code" href="class_c_sword_module_info.html#s29">CSwordModuleInfo::UnlockErrorCode</a> ret = m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a6">unlock</a>( unlockKey );
00996         <font class="keywordflow">if</font> ( ret != CSwordModuleInfo::noError) {
00997             <font class="comment">//an error occured</font>
00998             <font class="keywordflow">switch</font> (ret) {
00999                 <font class="keywordflow">case</font> CSwordModuleInfo::noPermission:                
01000                     <font class="keywordflow">break</font>;
01001                 <font class="keywordflow">case</font> CSwordModuleInfo::wrongUnlockKey:              
01002                     <font class="keywordflow">break</font>;
01003                 <font class="keywordflow">case</font> CSwordModuleInfo::notLocked:
01004                     <font class="keywordflow">break</font>;
01005                     
01006                 <font class="keywordflow">default</font>:
01007                     <font class="keywordflow">break</font>;
01008             }
01009         }
01010     }
01011 }
01012 
<a name="l01014"></a><a class="code" href="class_c_group_manager.html#c12">01014</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c12">CGroupManager::readSwordBookmarks</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> Action){
01015     <font class="comment">//read and create group entries</font>
01016     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;  
01017     
01018     QStringList groupList = configFile-&gt;readListEntry(<font class="stringliteral">"Groups"</font>);
01019 
01020     <font class="comment">//read in all bookmarks</font>
01021     QStringList bookmarkList                            = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmarks"</font>);
01022     QStringList bookmarkModulesList             = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmark modules"</font>);
01023     QStringList bookmarkDescriptionsList    = configFile-&gt;readListEntry(<font class="stringliteral">"Bookmark descriptions"</font>);
01024     QValueList&lt;int&gt; parentList                      = configFile-&gt;readIntListEntry(<font class="stringliteral">"Bookmark parents"</font>);
01025 
01026     QStringList::Iterator it_bookmarks  = bookmarkList.begin();
01027     QStringList::Iterator it_modules        = bookmarkModulesList.begin();
01028     QStringList::Iterator it_descriptions   = bookmarkDescriptionsList.begin();
01029     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01030 
01031     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* moduleInfo = 0;
01032     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *myItem = 0;  
01033     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *oldItem = 0;
01034 
01035     <font class="keywordflow">while</font> ( it_bookmarks != bookmarkList.end() &amp;&amp; it_parents != parentList.end()
01036                     &amp;&amp; it_modules != bookmarkModulesList.end() ) {
01037         moduleInfo = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>((*it_modules));
01038         <font class="keywordflow">if</font> ( (*it_parents) == -1) {
01039             <font class="keywordflow">if</font> (group)
01040                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_bookmarks), (*it_modules), moduleInfo, 0, CGroupManagerItem::Bookmark);
01041             <font class="keywordflow">else</font>
01042                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_bookmarks), (*it_modules), moduleInfo, 0, CGroupManagerItem::Bookmark);
01043         }
01044         <font class="keywordflow">else</font> {
01045             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents), group ? group : 0 );
01046             <font class="keywordflow">if</font> (parentItem)
01047                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01048             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group)
01049                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01050             <font class="keywordflow">else</font>
01051                 myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_bookmarks), (*it_modules), moduleInfo,0, CGroupManagerItem::Bookmark);
01052         }
01053         <font class="keywordflow">if</font> (myItem &amp;&amp; it_descriptions != bookmarkDescriptionsList.end())
01054             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a15">setDescription</a>( *it_descriptions );
01055         <font class="keywordflow">if</font> (myItem &amp;&amp; oldItem) {
01056             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a17">moveAfter</a>(oldItem);
01057         }
01058         oldItem = myItem;
01059 
01060         ++it_parents;
01061         ++it_modules;
01062         ++it_descriptions;
01063         ++it_bookmarks;
01064     }
01065     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01066 }
01067 
<a name="l01069"></a><a class="code" href="class_c_group_manager.html#c11">01069</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c11">CGroupManager::saveSwordBookmarks</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> Action){
01070     <font class="keywordtype">int</font> parentID = 0;
01071     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01072     QStringList groupList;
01073     QValueList&lt;int&gt; parentList;
01074     QStringList bookmarkList;   
01075     QStringList bookmarkModuleList; 
01076     QStringList bookmarkDescriptionList;        
01077     QListViewItemIterator it;
01078     
01079     <font class="comment">//save bookmarks</font>
01080     parentList.clear();
01081     bookmarkList.clear();
01082     bookmarkModuleList.clear();
01083     bookmarkDescriptionList.clear();
01084 
01085     <font class="keywordflow">if</font> (group)
01086         it = QListViewItemIterator ( group );
01087     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() == 0) {
01088         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01089     }
01090     <font class="keywordflow">else</font>
01091         it = QListViewItemIterator (<font class="keyword">this</font>);
01092 
01093   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01094         myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current();
01095     <font class="keywordflow">if</font> (group)
01096         <font class="keywordflow">if</font> (!<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem)) {
01097                 <font class="keywordflow">continue</font>;                   
01098             }
01099         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark)  {
01100             <font class="keywordflow">if</font> (group) {
01101                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( dynamic_cast&lt;CGroupManagerItem*&gt;(it.current()),m_pressedItem );    
01102             }
01103             <font class="keywordflow">else</font> {
01104                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( dynamic_cast&lt;CGroupManagerItem*&gt;(it.current()) );  
01105             }
01106             parentList.append( parentID );
01107 
01108             <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>();                                  
01109             <font class="keywordflow">if</font> (key)    {
01110                 VerseKey* vk = dynamic_cast&lt;VerseKey*&gt;(key);
01111                 QString oldLocale;
01112                 <font class="keywordflow">if</font> (vk) {
01113                     oldLocale = QString::fromLatin1(vk-&gt;getLocale());
01114                     vk-&gt;setLocale(<font class="stringliteral">"en"</font>); <font class="comment">//save the english key names</font>
01115                 }
01116                 bookmarkList.append( key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>() );
01117                 <font class="keywordflow">if</font> (vk) {
01118                     vk-&gt;setLocale(oldLocale.latin1());
01119                 }
01120             }
01121             <font class="keywordflow">else</font>
01122                 bookmarkList.append(<font class="stringliteral">""</font>);    <font class="comment">//invalid key</font>
01123                 
01124             <font class="keywordflow">if</font> (myItem &amp;&amp; !myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>().isEmpty()) <font class="comment">//save description</font>
01125                 bookmarkDescriptionList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>() );
01126             <font class="keywordflow">else</font>
01127                 bookmarkDescriptionList.append( QString::null );
01128                 
01129             <font class="keywordflow">if</font> (myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()) { <font class="comment">//save the module</font>
01130                 bookmarkModuleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>() );
01131             }
01132             <font class="keywordflow">else</font> {
01133                 bookmarkModuleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#o6">m_moduleName</a> );
01134             }
01135         }
01136     }   
01137     
01138     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmarks"</font>, bookmarkList);
01139     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark descriptions"</font>, bookmarkDescriptionList);
01140     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark modules"</font>, bookmarkModuleList);
01141     configFile-&gt;writeEntry(<font class="stringliteral">"Bookmark parents"</font>, parentList);
01142     
01143     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01144 }
01145 
<a name="l01147"></a><a class="code" href="class_c_group_manager.html#h8">01147</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h8">CGroupManager::slotImportBookmarks</a>(){
01148     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
01149         QString file = KFileDialog::getOpenFileName(QString::null, <font class="stringliteral">"*.btb | *.btb"</font>, 0, i18n(<font class="stringliteral">"Import bookmarks ..."</font>));   
01150         <font class="keywordflow">if</font> (!file.isNull()) {
01151             KSimpleConfig simpleConfig(file, <font class="keyword">false</font>);
01152             simpleConfig.setGroup(<font class="stringliteral">"Bookmarks"</font>);
01153             <font class="keywordtype">short</font> <font class="keywordtype">int</font> formatVersion = simpleConfig.readNumEntry(<font class="stringliteral">"Bookmark format version"</font>, -1);
01154             
01155             <font class="comment">//bookmark format of imported file is newer than our version            </font>
01156             <font class="keywordflow">if</font> (formatVersion &gt; BOOKMARK_FORMAT_VERSION) {
01157                 <font class="keyword">const</font> <font class="keywordtype">int</font> retValue = KMessageBox::warningContinueCancel(<font class="keyword">this</font>, i18n(<font class="stringliteral">"&lt;qt&gt;A problem occurred while importing bookmarks!&lt;BR&gt;\</font>
01158 <font class="stringliteral">The bookmarks format of the imported file is newer&lt;BR&gt;\</font>
01159 <font class="stringliteral">than the bookmarks format version of this version of BibleTime!&lt;BR&gt;\</font>
01160 <font class="stringliteral">&lt;B&gt;Importing the bookmarks may not work correctly!&lt;/B&gt;&lt;BR&gt;Do you want to continue?&lt;/qt&gt;"</font>), i18n(<font class="stringliteral">"Import of bookmarks"</font>), i18n(<font class="stringliteral">"Continue"</font>) );
01161                 <font class="keywordflow">if</font> ( retValue != KMessageBox::Continue )
01162                     <font class="keywordflow">return</font>;
01163             }
01164             
01165             <a class="code" href="class_c_group_manager.html#c16">readGroups</a>(&amp;simpleConfig, m_pressedItem, Import);           
01166             <a class="code" href="class_c_group_manager.html#c12">readSwordBookmarks</a>(&amp;simpleConfig, m_pressedItem, Import);
01167         }
01168     }
01169 }
01170 
<a name="l01172"></a><a class="code" href="class_c_group_manager.html#h7">01172</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h7">CGroupManager::slotExportBookmarks</a>(){
01173     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) ) {
01174         QString file = KFileDialog::getSaveFileName (QString::null, <font class="stringliteral">"*.btb | *.btb"</font>, 0, i18n(<font class="stringliteral">"Export bookmarks ..."</font>));  
01175         <font class="keywordflow">if</font> (!file.isNull()) {
01176             KSimpleConfig simpleConfig(file, <font class="keyword">false</font>);
01177             simpleConfig.setGroup(<font class="stringliteral">"Bookmarks"</font>);         
01178             simpleConfig.writeEntry(<font class="stringliteral">"Bookmark format version"</font>, BOOKMARK_FORMAT_VERSION);
01179             
01180             <a class="code" href="class_c_group_manager.html#c15">saveGroups</a>(&amp;simpleConfig, m_pressedItem, Export);
01181             <a class="code" href="class_c_group_manager.html#c11">saveSwordBookmarks</a>(&amp;simpleConfig, m_pressedItem, Export);
01182             simpleConfig.sync();
01183         }
01184     }
01185 }
01186 
01187 
<a name="l01188"></a><a class="code" href="class_c_group_manager.html#c14">01188</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c14">CGroupManager::readSwordModules</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01189     <font class="keywordflow">if</font> (!m_swordList) {
01190         qWarning(<font class="stringliteral">"CGroupManager::readSwordModules: no sword modules, return and do nothing."</font>);
01191         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01192     }
01193     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;  
01194 
01195     QStringList moduleList = configFile-&gt;readListEntry(<font class="stringliteral">"Modules"</font>);
01196     QValueList&lt;int&gt; parentList = configFile-&gt;readIntListEntry(<font class="stringliteral">"Module parents"</font>);        
01197     QStringList::Iterator it_modules = moduleList.begin();
01198     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01199     
01200     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* myModuleInfo = 0;
01201     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01202     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* oldItem = 0;
01203     
01204     <font class="keywordflow">while</font> ( it_modules != moduleList.end() &amp;&amp; it_parents != parentList.end() ) {        
01205         <font class="keywordflow">if</font> ((*it_modules).isEmpty() || !( myModuleInfo = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(*it_modules) )) {  <font class="comment">//the module was removed so we don't show it</font>
01206             ++it_parents;
01207             ++it_modules;
01208             <font class="keywordflow">continue</font>;
01209         }
01210             
01211         <font class="keywordflow">if</font> ( (*it_parents) == -1) { <font class="comment">//module on top</font>
01212             parentItem = group; <font class="comment">//instead of group ? group : 0;</font>
01213         }
01214         <font class="keywordflow">else</font> {
01215             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents), group );
01216             <font class="keywordflow">if</font> (!parentItem)
01217                 parentItem = group;
01218         }
01219 
01220         <font class="keywordflow">if</font> (parentItem) {
01221             myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, QString::null, QString::null, myModuleInfo,0, CGroupManagerItem::Module);
01222         }
01223         <font class="keywordflow">else</font>
01224             myItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, QString::null, QString::null, myModuleInfo,0, CGroupManagerItem::Module);      
01225         
01226         <font class="keywordflow">if</font> (myItem &amp;&amp; oldItem)
01227             myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a17">moveAfter</a>(oldItem);
01228         
01229         oldItem = myItem;
01230             
01231         ++it_parents;
01232         ++it_modules;
01233     }   
01234     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01235 };
01236 
<a name="l01237"></a><a class="code" href="class_c_group_manager.html#c13">01237</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c13">CGroupManager::saveSwordModules</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group) {
01238     <font class="keywordtype">int</font> parentID = 0;
01239     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01240     QValueList&lt;int&gt; parentList;
01241     QStringList moduleList; 
01242     
01243     QListViewItemIterator it;
01244     
01245     parentList.clear();
01246     moduleList.clear();
01247 
01248     <font class="keywordflow">if</font> (group)
01249         it = QListViewItemIterator( group );
01250     <font class="keywordflow">else</font>
01251         it = QListViewItemIterator(<font class="keyword">this</font>);
01252 
01253   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01254             myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*) it.current();
01255         <font class="keywordflow">if</font> (group)
01256             <font class="keywordflow">if</font> (!<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem))
01257                     <font class="keywordflow">continue</font>;                   
01258             
01259             <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module)  {
01260                 <font class="keywordflow">if</font> (group)
01261                     parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current(),m_pressedItem );  
01262                 <font class="keywordflow">else</font>
01263                     parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );    
01264                 parentList.append( parentID );
01265                 
01266                 <font class="keywordflow">if</font> (myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
01267                     moduleList.append( myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>() );              
01268                 <font class="keywordflow">else</font> {
01269                     moduleList.append( myItem-&gt;text(0) );   <font class="comment">//first column is the modulename</font>
01270                 }
01271             }
01272     }   
01273     configFile-&gt;writeEntry(<font class="stringliteral">"Modules"</font>, moduleList);
01274     configFile-&gt;writeEntry(<font class="stringliteral">"Module parents"</font>, parentList);
01275 
01276     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01277 }
01278 
<a name="l01279"></a><a class="code" href="class_c_group_manager.html#c16">01279</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c16">CGroupManager::readGroups</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> Action action) {
01280     qWarning(<font class="stringliteral">"CGroupManager::readGroups(KConfig* configFile, CGroupManagerItem* group, const Action action)"</font>);
01281  <font class="comment">//read and create group entries</font>
01282     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* parentItem = 0;
01283     <font class="keywordtype">bool</font> groupExists = <font class="keyword">false</font>;   
01284     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* oldItem = 0;
01285     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* newItem = 0;
01286     
01287     QStringList groupList = configFile-&gt;readListEntry(<font class="stringliteral">"Groups"</font>);
01288     QValueList&lt;int&gt; parentList = configFile-&gt;readIntListEntry(<font class="stringliteral">"Group parents"</font>);
01289     
01290     QStringList::Iterator it_groups = groupList.begin();
01291     QValueList&lt;int&gt;::Iterator it_parents = parentList.begin();
01292     
01293     <font class="keywordflow">while</font> ( (it_groups != groupList.end()) &amp;&amp; (it_parents != parentList.end()) ) {
01294         groupExists = <font class="keyword">false</font>;
01295         <font class="keywordflow">if</font> ( (*it_parents) == -1) { <font class="comment">//no parent item saved</font>
01296             <font class="keywordflow">if</font> (action == Import) { <font class="comment">//try to find existing group</font>
01297                 <font class="keywordflow">if</font> (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* existingGroup = <a class="code" href="class_c_group_manager.html#c17">findGroup</a>(*it_groups, group, *it_parents))
01298                     groupExists = <font class="keyword">true</font>;
01299             }
01300             <font class="keywordflow">else</font>
01301                 parentItem = group;
01302         }
01303         <font class="keywordflow">else</font> {
01304             parentItem = <a class="code" href="class_c_group_manager.html#c9">findParent</a>( (*it_parents),group );
01305             <font class="keywordflow">if</font> (!parentItem)
01306                 parentItem = group;
01307         }
01308         
01309         <font class="keywordflow">if</font> (!groupExists) {         
01310             <font class="keywordflow">if</font> (parentItem) {
01311                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(parentItem, (*it_groups), QString::null, 0,0, CGroupManagerItem::Group);
01312             }
01313             <font class="keywordflow">else</font> {
01314                 newItem = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, (*it_groups), QString::null, 0,0, CGroupManagerItem::Group);
01315             }
01316         
01317             <font class="keywordflow">if</font> (newItem &amp;&amp; oldItem ) {          
01318                 newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a17">moveAfter</a>( oldItem );
01319             }
01320             <font class="keywordflow">if</font> (newItem) {
01321                 <font class="comment">/* we can't move a topgroup behind a subgroup, so we use multiple</font>
01322 <font class="comment">                 parent calls</font>
01323 <font class="comment">                */</font>
01324                 <font class="keywordflow">while</font> (<a class="code" href="class_c_group_manager.html#c8">parentId</a>(newItem) &gt; *it_parents) {
01325                     <font class="keywordflow">if</font> ( (group &amp;&amp; <a class="code" href="class_c_group_manager.html#a8">isChild</a>(group, newItem)) || (newItem &amp;&amp; newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) )
01326                         newItem = newItem-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
01327                     <font class="keywordflow">else</font>
01328                         <font class="keywordflow">break</font>;
01329                 }
01330                 oldItem = newItem;
01331             }                   
01332         }
01333         
01334         ++it_parents;
01335         ++it_groups;
01336     }   
01337     <font class="keywordflow">return</font> <font class="keyword">true</font>;    
01338 };
01339 
<a name="l01340"></a><a class="code" href="class_c_group_manager.html#c15">01340</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#c15">CGroupManager::saveGroups</a>(KConfig* configFile, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, Action normal) {
01341     <font class="keywordtype">int</font> parentID = 0;
01342     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* myItem = 0;
01343     QStringList groupList;
01344     QValueList&lt;int&gt; parentList;
01345     
01346     QListViewItemIterator it;
01347     
01348     <font class="comment">//save groups   </font>
01349     <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() &gt; 0)
01350         it = QListViewItemIterator ( group-&gt;firstChild() );
01351     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (group &amp;&amp; group-&gt;childCount() == 0) {
01352         <font class="keywordflow">return</font> <font class="keyword">false</font>;
01353     }
01354     <font class="keywordflow">else</font>
01355       it = QListViewItemIterator ( <font class="keyword">this</font> );
01356 
01357   <font class="keywordflow">for</font>( ; it.current(); it++ ) {
01358         myItem = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*) it.current();
01359     <font class="keywordflow">if</font> (group &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(m_pressedItem, myItem))
01360             <font class="keywordflow">continue</font>;       
01361         <font class="keywordflow">if</font> (myItem &amp;&amp; myItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)  {
01362             <font class="keywordflow">if</font> (group)
01363                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current(), m_pressedItem );
01364             <font class="keywordflow">else</font>
01365                 parentID = <a class="code" href="class_c_group_manager.html#c8">parentId</a>( (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)it.current() );
01366             groupList.append( myItem-&gt;text(0) );
01367             parentList.append( parentID );
01368         }
01369     }
01370     configFile-&gt;writeEntry(<font class="stringliteral">"Groups"</font>, groupList);
01371     configFile-&gt;writeEntry(<font class="stringliteral">"Group parents"</font>, parentList);
01372     <font class="keywordflow">return</font> <font class="keyword">true</font>;
01373 }
01374 
<a name="l01376"></a><a class="code" href="class_c_group_manager.html#a8">01376</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_group_manager.html#a8">CGroupManager::isChild</a>(QListViewItem* parent, QListViewItem* child){
01377     QListViewItem *myParent = child;
01378     <font class="keywordflow">while</font> (myParent &amp;&amp; myParent != parent )
01379         myParent = myParent-&gt;parent();      
01380     <font class="keywordflow">return</font> (myParent == parent) &amp;&amp; (parent != child);
01381 }
01382 
<a name="l01384"></a><a class="code" href="class_c_group_manager.html#h9">01384</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h9">CGroupManager::viewportPaintEvent</a>(QPaintEvent* e) {
01385   KListView::viewportPaintEvent(e);
01386 
01387   <font class="keywordflow">if</font> (m_oldDragRect.isValid())
01388   {
01389     <font class="keyword">static</font> <font class="keywordtype">bool</font> invalidated=<font class="keyword">false</font>;
01390     <font class="keywordflow">if</font> (!invalidated)
01391     {
01392       invalidated=<font class="keyword">true</font>;
01393 <font class="preprocessor">#warning deleting this made the drop visualization work again. No idea why. ;)</font>
01394 <font class="preprocessor"></font><font class="preprocessor">#warning please somebody with more in-depth knowledge check this.</font>
01395 <font class="preprocessor"></font><font class="comment">//      viewport()-&gt;repaint(m_oldDragRect);</font>
01396     }
01397     QPainter painter(viewport());
01398     <a class="code" href="class_c_group_manager.html#h10">drawDropVisualizer</a>(&amp;painter, m_parentItemDrop, m_afterItemDrop, <font class="stringliteral">""</font>);
01399     invalidated=<font class="keyword">false</font>;
01400   }
01401 }
01402 
<a name="l01404"></a><a class="code" href="class_c_group_manager.html#h10">01404</a> <font class="keyword">const</font> QRect <a class="code" href="class_c_group_manager.html#h10">CGroupManager::drawDropVisualizer</a> (QPainter *p, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *<font class="comment">/*parent*/</font>, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a> *after, <font class="keyword">const</font> QString&amp; <font class="comment">/*type*/</font>){
01405   QRect insertmarker;
01406   <font class="keywordtype">bool</font> useParent = <font class="keyword">false</font>;
01407         
01408     <font class="keywordflow">if</font> ( m_dragType == BOOKMARK ) {     <font class="comment">//we are moving a module</font>
01409         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01410             insertmarker = itemRect(after);
01411         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )            
01412             insertmarker = QRect(itemRect(after));
01413         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark ) {
01414             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01415                 useParent = <font class="keyword">true</font>;
01416                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());   <font class="comment">//paint nothing</font>
01417             }
01418             <font class="keywordflow">else</font>
01419                 insertmarker = QRect();
01420         }
01421         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01422             useParent = <font class="keyword">true</font>;
01423             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());               
01424         }
01425         <font class="keywordflow">else</font> <font class="comment">//if (!after)</font>
01426             insertmarker = QRect(); <font class="comment">//this-&gt;visibleRect();      </font>
01427 <font class="comment">//      else</font>
01428 <font class="comment">//          insertmarker = QRect();</font>
01429     }
01430     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_dragType == REFERENCE ) {   <font class="comment">//we are moving a reference</font>
01431         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01432             insertmarker = itemRect(after);
01433         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )         
01434             insertmarker = QRect(itemRect(after));
01435         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark ) {
01436             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01437                 useParent = <font class="keyword">true</font>;
01438                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01439             }
01440             <font class="keywordflow">else</font>
01441                 insertmarker = QRect();     <font class="comment">//paint nothing         </font>
01442         }
01443         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01444             useParent = <font class="keyword">true</font>;
01445             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());               
01446         }
01447         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!after)
01448             insertmarker = QRect(); <font class="comment">//this-&gt;visibleRect();</font>
01449         <font class="keywordflow">else</font>
01450             insertmarker = QRect();
01451     }
01452     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_dragType == MODULE ) {  <font class="comment">//we are moving a reference</font>
01453         <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01454             insertmarker = itemRect(after);
01455         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; (after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module || after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Bookmark) ) {
01456             <font class="keywordflow">if</font> (after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()) {
01457                 useParent = <font class="keyword">true</font>;
01458                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01459             }
01460             <font class="keywordflow">else</font>
01461                 insertmarker = QRect();     <font class="comment">//paint nothing         </font>
01462         }       
01463         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group ) {
01464             useParent = <font class="keyword">true</font>;
01465             insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01466         }
01467         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!after)
01468             insertmarker = QRect();<font class="comment">//this-&gt;visibleRect();</font>
01469         <font class="keywordflow">else</font>
01470             insertmarker = QRect();
01471     }   
01472     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_dragType == TEXT) {
01473         <font class="keywordflow">if</font> ( after &amp;&amp; after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module )         
01474             insertmarker = QRect(itemRect(after));
01475         <font class="keywordflow">else</font>
01476             insertmarker = QRect();
01477     }
01478     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_pressedItem) {
01479     <font class="keywordflow">if</font> ( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group  ) { <font class="comment">//we are moving a group</font>
01480             <font class="keywordflow">if</font> (after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)
01481                 insertmarker = itemRect(after);
01482             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (after &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>() &amp;&amp; after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group) {
01483                 useParent = <font class="keyword">true</font>;
01484                 insertmarker = itemRect(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>());
01485             }
01486             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!after)
01487                 insertmarker = QRect();<font class="comment">//this-&gt;visibleRect();</font>
01488         <font class="keywordflow">else</font>
01489             insertmarker = QRect();
01490     }
01491   }
01492 
01493   <font class="keywordflow">if</font> ( p &amp;&amp; insertmarker.isValid() )  {
01494     <font class="keywordflow">if</font> (useParent)
01495         insertmarker.setLeft( treeStepSize()*(after-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>()-&gt;depth()+(rootIsDecorated() ? 1 :0 ))+itemMargin()- contentsX());
01496     <font class="keywordflow">else</font>
01497         insertmarker.setLeft( treeStepSize()*(after-&gt;depth()+(rootIsDecorated() ? 1 :0 ))+itemMargin() - contentsX());
01498     style().drawPrimitive( QStyle::PE_FocusRect, p, insertmarker, colorGroup(), QStyle::Style_HasFocus);
01499 <font class="comment">//  after-&gt;isSelected() ? &amp;colorGroup().highlight() : &amp;colorGroup().base(), after-&gt;isSelected() &amp;&amp; !useParent</font>
01500   }
01501   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!insertmarker.isValid()) {
01502     <a class="code" href="class_c_group_manager.html#h11">cleanDropVisualizer</a>();
01503   }
01504   <font class="keywordflow">return</font> insertmarker;
01505 }
01506 
<a name="l01508"></a><a class="code" href="class_c_group_manager.html#h11">01508</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h11">CGroupManager::cleanDropVisualizer</a>(){
01509   <font class="keywordflow">if</font> ( m_oldDragRect.isValid() ) {
01510     QRect rect = m_oldDragRect;
01511     m_oldDragRect = QRect();
01512     viewport()-&gt;repaint(rect,<font class="keyword">true</font>);
01513   }
01514 }
01515 
<a name="l01517"></a><a class="code" href="class_c_group_manager.html#g1">01517</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g1">CGroupManager::slotReset</a>(){
01518     <font class="keywordtype">int</font> result = 0;
01519     <font class="keywordflow">if</font> (m_showHelpDialogs)
01520         result = KMessageBox:: warningContinueCancel( <font class="keyword">this</font>, i18n(<font class="stringliteral">"&lt;qt&gt;This function will reset the main index!&lt;BR&gt;This will recreate the original groups and delete all other items!&lt;BR&gt;Be sure no important bookmarks will be deleted!&lt;BR&gt;Do you want to continue?&lt;/qt&gt;"</font>), i18n(<font class="stringliteral">"BibleTime - Reset main index"</font>), i18n(<font class="stringliteral">"Continue"</font>));
01521     <font class="keywordflow">else</font>
01522         result = KMessageBox::Continue;
01523         
01524     <font class="keywordflow">if</font> (result == KMessageBox::Continue) {
01525         clear();
01526         <a class="code" href="class_c_group_manager.html#a3">setupStandardSwordTree</a>();
01527     }
01528 }
01529 
<a name="l01531"></a><a class="code" href="class_c_group_manager.html#h14">01531</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h14">CGroupManager::slotPrintBookmark</a>(){    
01532     <font class="keywordflow">if</font> (!m_pressedItem || ( m_pressedItem &amp;&amp; m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() != CGroupManagerItem::Bookmark) )
01533         <font class="keywordflow">return</font>;
01534     <a class="code" href="class_c_export_manager.html#d7">CExportManager::printKey</a>( m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a10">getBookmarkKey</a>()-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(), QString::null, m_pressedItem-&gt;<a class="code" href="class_c_group_manager_item.html#a3">description</a>() );
01535 }
01536 
<a name="l01538"></a><a class="code" href="class_c_group_manager.html#h15">01538</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#h15">CGroupManager::slotDeleteSearchdialog</a>(){
01539     <font class="keywordflow">if</font> (m_searchDialog)
01540         m_searchDialog-&gt;delayedDestruct();  <font class="comment">//delete the search dialog</font>
01541     m_searchDialog = 0;
01542 }
01543 
<a name="l01545"></a><a class="code" href="class_c_group_manager.html#i0">01545</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#i0">CGroupManager::slotReturnPressed</a>( QListViewItem* i){
01546     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = dynamic_cast&lt;CGroupManagerItem*&gt;(i);
01547     <font class="keywordflow">if</font> (!item)
01548         <font class="keywordflow">return</font>; 
01549     <font class="keywordflow">switch</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>())    {
01550         <font class="keywordflow">case</font> CGroupManagerItem::Bookmark:
01551             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())             
01552                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(),item-&gt;<a class="code" href="class_c_group_manager_item.html#a11">getKeyText</a>() );           
01553             <font class="keywordflow">break</font>;
01554         <font class="keywordflow">case</font> CGroupManagerItem::Module:
01555             <font class="keywordflow">if</font> (item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>())
01556                 emit <a class="code" href="class_c_group_manager.html#j0">createDisplayWindow</a>(item-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>(), QString::null);            
01557             <font class="keywordflow">break</font>;
01558         <font class="keywordflow">case</font> CGroupManagerItem::Group:
01559             item-&gt;<a class="code" href="class_c_group_manager_item.html#a14">setOpen</a>( !item-&gt;isOpen() );
01560             <font class="keywordflow">break</font>;
01561         <font class="keywordflow">default</font>:
01562             <font class="keywordflow">break</font>;
01563     }
01564 }
01565 
<a name="l01567"></a><a class="code" href="class_c_group_manager.html#g2">01567</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#g2">CGroupManager::resizeContents</a>( <font class="keywordtype">int</font> w, <font class="keywordtype">int</font> h ){
01568     <font class="keywordflow">if</font> (m_useDragDrop)
01569         KListView::resizeContents(w,h+25);
01570     <font class="keywordflow">else</font>
01571         KListView::resizeContents(w,h);
01572 }
01573 
<a name="l01575"></a><a class="code" href="class_c_group_manager.html#c17">01575</a> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* <a class="code" href="class_c_group_manager.html#c17">CGroupManager::findGroup</a>(<font class="keyword">const</font> QString&amp; name, <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* group, <font class="keyword">const</font> <font class="keywordtype">int</font> id){
01576     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = 0;    
01577     QListViewItemIterator it    ;
01578     <font class="keywordflow">if</font> (group)
01579         it = QListViewItemIterator(group);
01580     <font class="keywordflow">else</font>
01581         it = QListViewItemIterator(<font class="keyword">this</font>);
01582     
01583     <font class="keywordflow">for</font> ( ; it.current(); ++it ) {
01584         item = dynamic_cast&lt;CGroupManagerItem*&gt;(it.current());
01585         <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group &amp;&amp; item-&gt;text(0) == name &amp;&amp; <a class="code" href="class_c_group_manager.html#c8">parentId</a>(item, group) == id) { <font class="comment">//found the right group</font>
01586             <font class="keywordflow">if</font> (group &amp;&amp; !<a class="code" href="class_c_group_manager.html#a8">isChild</a>(group, item))
01587                 item = 0;
01588             <font class="keywordflow">else</font>
01589                 <font class="keywordflow">break</font>;
01590         }
01591         <font class="keywordflow">else</font> {
01592             item = 0;
01593         }
01594     }
01595     <font class="keywordflow">if</font> (!item) {        
01596         <font class="keywordflow">if</font> (group)
01597             item = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(group, name, QString::null, 0, 0, CGroupManagerItem::Group);
01598         <font class="keywordflow">else</font>
01599             item = <font class="keyword">new</font> <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>(<font class="keyword">this</font>, name, QString::null, 0, 0, CGroupManagerItem::Group);        
01600     }
01601   <font class="keywordflow">return</font> item;
01602 }
01603 
<a name="l01605"></a><a class="code" href="class_c_group_manager.html#c18">01605</a> <font class="keywordtype">void</font> <a class="code" href="class_c_group_manager.html#c18">CGroupManager::printTree</a>() {
01606     QListViewItemIterator it(<font class="keyword">this</font>);
01607     <font class="keywordflow">while</font> (it.current()) {
01608         QListViewItem* item = it.current();
01609         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; item-&gt;depth(); ++i) {
01610             cout &lt;&lt; <font class="stringliteral">"\t"</font>;
01611         }
01612         cout &lt;&lt; item-&gt;text(0).latin1() &lt;&lt; endl;
01613         ++it;
01614     };
01615 }
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:12 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
