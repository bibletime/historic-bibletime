<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csearchdialogmodulechooser.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csearchdialogmodulechooser.cpp</h1><div class="fragment"><pre>00001 
00002 <font class="comment">/***************************************************************************</font>
00003 <font class="comment">                          csearchdialogmodulechooser.cpp  -  description</font>
00004 <font class="comment">                             -------------------</font>
00005 <font class="comment">    begin                : Fri Mar 30 2001</font>
00006 <font class="comment">    copyright            : (C) 2001 by The BibleTime team</font>
00007 <font class="comment">    email                : info@bibletime.de</font>
00008 <font class="comment"> ***************************************************************************/</font>
00009 
00010 <font class="comment">/***************************************************************************</font>
00011 <font class="comment"> *                                                                         *</font>
00012 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00013 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00014 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00015 <font class="comment"> *   (at your option) any later version.                                   *</font>
00016 <font class="comment"> *                                                                         *</font>
00017 <font class="comment"> ***************************************************************************/</font>
00018 
00019 <font class="comment">//BibleTime's includes</font>
00020 <font class="preprocessor">#include "csearchdialogmodulechooser.h"</font>
00021 <font class="preprocessor">#include "../groupmanager/cgroupmanager.h"</font>
00022 <font class="preprocessor">#include "../groupmanager/cgroupmanageritem.h"</font>
00023 <font class="preprocessor">#include "../ctoolclass.h"</font>
00024 <font class="preprocessor">#include "../../backend/cswordbackend.h"</font>
00025 <font class="preprocessor">#include "../../whatsthisdef.h"</font>
00026 <font class="preprocessor">#include "../../tooltipdef.h"</font>
00027 
00028 <font class="comment">//Qt includes</font>
00029 <font class="preprocessor">#include &lt;qlabel.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qtoolbutton.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qlist.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qlistbox.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00036 
00037 <font class="comment">//KDE includes</font>
00038 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00039 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00040 
00041 CSearchDialogModuleChooser::CSearchDialogModuleChooser(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : QWidget(parent,name) {
00042     m_initialized = <font class="keyword">false</font>;
00043     
00044     m_moduleList = 0;
00045 <font class="comment">//  m_itemsDict.setAutoDelete(false);</font>
00046 
00047     QVBoxLayout* mainLayout = <font class="keyword">new</font> QVBoxLayout(<font class="keyword">this</font>);
00048     
00049     mainLayout-&gt;addWidget(<a class="code" href="class_c_tool_class.html#d7">CToolClass::explanationLabel</a>(<font class="keyword">this</font>, i18n(<font class="stringliteral">"Choose modules"</font>), i18n(<font class="stringliteral">"Choose the module you want to use for the search. The tree on the left contains all available modules, the tree on the right the modules for the search. Use the two arrow buttons to add or remove modules from the right tree."</font>)));
00050   mainLayout-&gt;addSpacing(5);
00051 
00052     QHBoxLayout* chooserLayout = <font class="keyword">new</font> QHBoxLayout();
00053             
00054     m_moduleIndex = <font class="keyword">new</font> <a class="code" href="class_c_group_manager.html">CGroupManager</a>(<font class="keyword">this</font>, <font class="stringliteral">"module index"</font>, backend()-&gt;moduleList(), <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>); 
00055     QWhatsThis::add(m_moduleIndex, WT_SD_MODULECHOOSER);
00056     
00057     m_moduleList = <font class="keyword">new</font> QListBox(<font class="keyword">this</font>);
00058     QWhatsThis::add(m_moduleList, WT_SD_MC_MODULELIST);
00059 
00060     QVBoxLayout* buttonLayout = <font class="keyword">new</font> QVBoxLayout();
00061     
00062     QToolButton* addButton = <font class="keyword">new</font> QToolButton(<font class="keyword">this</font>);
00063     addButton-&gt;setOnIconSet(SmallIcon(<font class="stringliteral">"forward"</font>));
00064     addButton-&gt;setOffIconSet(SmallIcon(<font class="stringliteral">"forward"</font>)); 
00065     addButton-&gt;setFixedSize( addButton-&gt;sizeHint() );   
00066     QWhatsThis::add(addButton, WT_SD_MC_ADD_MODULE);
00067     QToolTip::add(addButton, TT_SD_MC_ADD_MODULE);
00068     connect( addButton, SIGNAL(clicked()), SLOT(addCurrentItem()));
00069 
00070     QToolButton* removeButton = <font class="keyword">new</font> QToolButton(<font class="keyword">this</font>);
00071     removeButton-&gt;setOnIconSet(SmallIcon(<font class="stringliteral">"back"</font>));
00072     removeButton-&gt;setOffIconSet(SmallIcon(<font class="stringliteral">"back"</font>)); 
00073     removeButton-&gt;setFixedSize( removeButton-&gt;sizeHint() );
00074     QToolTip::add(removeButton, TT_SD_MC_REMOVE_MODULE);
00075     QWhatsThis::add(removeButton, WT_SD_MC_REMOVE_MODULE);  
00076     connect(removeButton, SIGNAL(clicked()), SLOT(removeCurrentItem()));
00077     
00078     buttonLayout-&gt;addWidget(addButton,0);
00079     buttonLayout-&gt;addSpacing(5);
00080     buttonLayout-&gt;addWidget(removeButton,0);
00081     buttonLayout-&gt;addStretch(5);
00082         
00083     chooserLayout-&gt;addWidget(m_moduleIndex,2);
00084     chooserLayout-&gt;addLayout(buttonLayout,0);
00085     chooserLayout-&gt;addWidget(m_moduleList,2);
00086 
00087     mainLayout-&gt;addLayout(chooserLayout);   
00088     
00089     QListViewItem* child = m_moduleIndex-&gt;firstChild();
00090     <font class="keywordflow">while</font> (child) {
00091         QListViewItem* nextChild = child-&gt;nextSibling();
00092         <font class="keywordflow">if</font> (child-&gt;childCount())
00093             child-&gt;setOpen(<font class="keyword">true</font>);
00094         <font class="keywordflow">else</font> {
00095             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)child;
00096             <font class="keywordflow">if</font> (i &amp;&amp; (i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)) {
00097                 <font class="keywordflow">if</font> (m_moduleIndex-&gt;isChild(child, nextChild)) {                     
00098                     <font class="keyword">delete</font> child;
00099                     nextChild = m_moduleIndex-&gt;firstChild();
00100                 }
00101                 <font class="keywordflow">else</font>
00102                     <font class="keyword">delete</font> child;
00103             }
00104         }
00105         child = nextChild;
00106     }
00107     m_initialized = <font class="keyword">true</font>;
00108 }
00109 
00110 CSearchDialogModuleChooser::~CSearchDialogModuleChooser(){
00111 }
00112 
<a name="l00114"></a><a class="code" href="class_c_search_dialog_module_chooser.html#a2">00114</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_module_chooser.html#a2">CSearchDialogModuleChooser::setChosenModules</a>(ListCSwordModuleInfo&amp; modules){
00115 <font class="comment">//  if (!modules.coun)</font>
00116 <font class="comment">//      return;</font>
00117     <font class="keywordflow">if</font> (<a class="code" href="class_c_search_dialog_module_chooser.html#a3">getChosenModules</a>() == modules)
00118         <font class="keywordflow">return</font>;
00119         
00120     m_moduleList-&gt;clear();
00121     m_itemsDict.clear();    
00122     m_moduleIndex-&gt;clear();
00123     m_moduleIndex-&gt;<a class="code" href="class_c_group_manager.html#a4">readSettings</a>();  
00124 
00125     <font class="keywordflow">for</font> (modules.first(); modules.current(); modules.next()) {
00126         <font class="keyword">const</font> QString module = modules.current()-&gt;name();
00127         QListViewItemIterator it( m_moduleIndex );
00128         <font class="keywordflow">for</font> ( ; it.current(); ++it )
00129             <font class="keywordflow">if</font> (it.current()-&gt;text(0) == module) {
00130                 m_moduleIndex-&gt;setCurrentItem(it.current());
00131                 m_moduleIndex-&gt;setSelected(it.current(), <font class="keyword">true</font>);
00132                 <a class="code" href="class_c_search_dialog_module_chooser.html#i1">addCurrentItem</a>();
00133             }
00134     }
00135 }
00136 
<a name="l00138"></a><a class="code" href="class_c_search_dialog_module_chooser.html#a3">00138</a> ListCSwordModuleInfo <a class="code" href="class_c_search_dialog_module_chooser.html#a3">CSearchDialogModuleChooser::getChosenModules</a>(){
00139     ListCSwordModuleInfo modules;
00140     <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i=0; i &lt; m_moduleList-&gt;count(); ++i) {
00141         <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(m_moduleList-&gt;text(i));
00142         <font class="keywordflow">if</font> (m)
00143             modules.append(m);
00144     }   
00145     <font class="keywordflow">return</font> modules;
00146 }
00147 
<a name="l00149"></a><a class="code" href="class_c_search_dialog_module_chooser.html#i1">00149</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_module_chooser.html#i1">CSearchDialogModuleChooser::addCurrentItem</a>(){
00150     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(m_moduleIndex-&gt;selectedItem());
00151     QListViewItem* nextItem = 0;
00152     <font class="keywordflow">if</font> (i)
00153         nextItem = i-&gt;itemBelow();
00154     <font class="keywordflow">if</font> (i &amp;&amp; !nextItem)
00155         nextItem = i-&gt;itemAbove();
00156 
00157     <font class="keywordflow">if</font> ( i &amp;&amp; (i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() ) {
00158         m_moduleList-&gt;insertItem( <a class="code" href="class_c_tool_class.html#d5">CToolClass::getIconForModule</a>(i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()), i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>(),-1 );
00159         QListViewItem* parentItem = i-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
00160         m_itemsDict.insert(i, parentItem ? (<font class="keyword">const</font> <font class="keywordtype">char</font>*)parentItem-&gt;text(0).latin1() : <font class="stringliteral">""</font>);<font class="comment">//I don't know why .local8Bit() doesn't work</font>
00161         parentItem ? parentItem-&gt;takeItem(i) : m_moduleIndex-&gt;takeItem(i);          
00162         
00163         <font class="keywordflow">if</font> (nextItem)
00164             m_moduleIndex-&gt;setSelected(nextItem, <font class="keyword">true</font>);
00165     }
00166     <font class="keywordflow">if</font> (m_initialized)
00167         emit <a class="code" href="class_c_search_dialog_module_chooser.html#j0">chosenModulesChanged</a>();
00168 }
00169 
<a name="l00171"></a><a class="code" href="class_c_search_dialog_module_chooser.html#i0">00171</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_module_chooser.html#i0">CSearchDialogModuleChooser::removeCurrentItem</a>(){
00172     <font class="keywordflow">if</font> (!m_itemsDict.count())
00173         <font class="keywordflow">return</font>;     
00174     QString text = QString::null;
00175     <font class="keywordflow">if</font> (m_moduleList-&gt;currentItem() != -1) {
00176         text = m_moduleList-&gt;text(m_moduleList-&gt;currentItem());
00177         <font class="keyword">const</font> <font class="keywordtype">int</font> currentItem = m_moduleList-&gt;currentItem();
00178         <font class="keywordtype">int</font> newIndex = currentItem;
00179         
00180         <font class="keywordflow">if</font> (currentItem+1 &lt; (int)m_moduleList-&gt;count())
00181             newIndex = currentItem+1;
00182         <font class="keywordflow">else</font>
00183             newIndex = currentItem-1;       
00184         m_moduleList-&gt;removeItem(m_moduleList-&gt;currentItem());
00185         <font class="keywordflow">if</font> (newIndex != -1)
00186             m_moduleList-&gt;setSelected(newIndex, <font class="keyword">true</font>);
00187     }
00188     <font class="keywordflow">else</font>
00189         <font class="keywordflow">return</font>;
00190 
00191     QPtrDictIterator&lt;char&gt; m_it( m_itemsDict ); <font class="comment">// iterator for dict</font>
00192     <font class="keywordflow">while</font> ( m_it.current() ) {
00193         QString parentName = QString::fromLatin1(m_it.current());
00194         <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)m_it.currentKey();
00195         <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;text(0) == text) {
00196             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* folder = 0;
00197         QListViewItemIterator l_it( m_moduleIndex );
00198             <font class="keywordflow">for</font> ( ; l_it.current(); ++l_it ) {
00199                 folder = dynamic_cast&lt;CGroupManagerItem*&gt;(l_it.current());
00200                 <font class="keywordflow">if</font> (folder &amp;&amp; folder-&gt;text(0) == parentName)
00201                     <font class="keywordflow">break</font>;
00202             }
00203             <font class="keywordflow">if</font> (folder)
00204                 folder-&gt;insertItem(item);
00205             <font class="keywordflow">else</font>
00206                 m_moduleIndex-&gt;insertItem(item);
00207             m_itemsDict.remove(item);
00208             <font class="keywordflow">break</font>;
00209         }
00210         ++m_it;
00211     }           
00212     <font class="keywordflow">if</font> (m_initialized)
00213         emit <a class="code" href="class_c_search_dialog_module_chooser.html#j0">chosenModulesChanged</a>();
00214 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:47 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
