<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csearchdialogmodulechooser.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csearchdialogmodulechooser.cpp</h1><div class="fragment"><pre>00001 
00002 <font class="comment">/***************************************************************************</font>
00003 <font class="comment">                          csearchdialogmodulechooser.cpp  -  description</font>
00004 <font class="comment">                             -------------------</font>
00005 <font class="comment">    begin                : Fri Mar 30 2001</font>
00006 <font class="comment">    copyright            : (C) 2001 by The BibleTime team</font>
00007 <font class="comment">    email                : info@bibletime.de</font>
00008 <font class="comment"> ***************************************************************************/</font>
00009 
00010 <font class="comment">/***************************************************************************</font>
00011 <font class="comment"> *                                                                         *</font>
00012 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00013 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00014 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00015 <font class="comment"> *   (at your option) any later version.                                   *</font>
00016 <font class="comment"> *                                                                         *</font>
00017 <font class="comment"> ***************************************************************************/</font>
00018 
00019 <font class="comment">//BibleTime's includes</font>
00020 <font class="preprocessor">#include "csearchdialogmodulechooser.h"</font>
00021 
00022 <font class="preprocessor">#include "backend/cswordbackend.h"</font>
00023 <font class="preprocessor">#include "frontend/groupmanager/cgroupmanager.h"</font>
00024 <font class="preprocessor">#include "frontend/groupmanager/cgroupmanageritem.h"</font>
00025 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00026 <font class="preprocessor">#include "whatsthisdef.h"</font>
00027 <font class="preprocessor">#include "tooltipdef.h"</font>
00028 
00029 <font class="comment">//Qt includes</font>
00030 <font class="preprocessor">#include &lt;qlabel.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qtoolbutton.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qlist.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qlistbox.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00037 
00038 <font class="comment">//KDE includes</font>
00039 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00040 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00041 
00042 CSearchDialogModuleChooser::CSearchDialogModuleChooser(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : QWidget(parent,name) {
00043     m_initialized = <font class="keyword">false</font>;
00044     
00045     m_moduleList = 0;
00046 <font class="comment">//  m_itemsDict.setAutoDelete(false);</font>
00047 
00048     QVBoxLayout* mainLayout = <font class="keyword">new</font> QVBoxLayout(<font class="keyword">this</font>);
00049     
00050     mainLayout-&gt;addWidget(CToolClass::explanationLabel(<font class="keyword">this</font>, i18n(<font class="stringliteral">"Choose modules"</font>), i18n(<font class="stringliteral">"Choose the module you want to use for the search. The tree on the left contains all available modules, the tree on the right the modules for the search. Use the two arrow buttons to add or remove modules from the right tree."</font>)));
00051   mainLayout-&gt;addSpacing(5);
00052 
00053     QHBoxLayout* chooserLayout = <font class="keyword">new</font> QHBoxLayout();
00054             
00055     m_moduleIndex = <font class="keyword">new</font> <a class="code" href="class_c_group_manager.html">CGroupManager</a>(<font class="keyword">this</font>, <font class="stringliteral">"module index"</font>, &amp;backend()-&gt;moduleList(), <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>, <font class="keyword">false</font>);    
00056     QWhatsThis::add(m_moduleIndex, WT_SD_MODULECHOOSER);
00057     
00058     m_moduleList = <font class="keyword">new</font> QListBox(<font class="keyword">this</font>);
00059     QWhatsThis::add(m_moduleList, WT_SD_MC_MODULELIST);
00060 
00061     QVBoxLayout* buttonLayout = <font class="keyword">new</font> QVBoxLayout();
00062     
00063     QToolButton* addButton = <font class="keyword">new</font> QToolButton(<font class="keyword">this</font>);
00064     addButton-&gt;setIconSet(SmallIcon(<font class="stringliteral">"forward"</font>));
00065 <font class="comment">//  addButton-&gt;setOffIconSet(SmallIcon("forward")); </font>
00066     addButton-&gt;setFixedSize( addButton-&gt;sizeHint() );   
00067     QWhatsThis::add(addButton, WT_SD_MC_ADD_MODULE);
00068     QToolTip::add(addButton, TT_SD_MC_ADD_MODULE);
00069     connect( addButton, SIGNAL(clicked()), SLOT(addCurrentItem()));
00070 
00071     QToolButton* removeButton = <font class="keyword">new</font> QToolButton(<font class="keyword">this</font>);
00072     removeButton-&gt;setIconSet(SmallIcon(<font class="stringliteral">"back"</font>));
00073 <font class="comment">//  removeButton-&gt;setOffIconSet(SmallIcon("back")); </font>
00074     removeButton-&gt;setFixedSize( removeButton-&gt;sizeHint() );
00075     QToolTip::add(removeButton, TT_SD_MC_REMOVE_MODULE);
00076     QWhatsThis::add(removeButton, WT_SD_MC_REMOVE_MODULE);  
00077     connect(removeButton, SIGNAL(clicked()), SLOT(removeCurrentItem()));
00078     
00079     buttonLayout-&gt;addWidget(addButton,0);
00080     buttonLayout-&gt;addSpacing(5);
00081     buttonLayout-&gt;addWidget(removeButton,0);
00082     buttonLayout-&gt;addStretch(5);
00083         
00084     chooserLayout-&gt;addWidget(m_moduleIndex,2);
00085     chooserLayout-&gt;addLayout(buttonLayout,0);
00086     chooserLayout-&gt;addWidget(m_moduleList,2);
00087 
00088     mainLayout-&gt;addLayout(chooserLayout);   
00089     
00090     QListViewItem* child = m_moduleIndex-&gt;firstChild();
00091     <font class="keywordflow">while</font> (child) {
00092         QListViewItem* nextChild = child-&gt;nextSibling();
00093         <font class="keywordflow">if</font> (child-&gt;childCount())
00094             child-&gt;setOpen(<font class="keyword">true</font>);
00095         <font class="keywordflow">else</font> {
00096             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)child;
00097             <font class="keywordflow">if</font> (i &amp;&amp; (i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Group)) {
00098                 <font class="keywordflow">if</font> (m_moduleIndex-&gt;isChild(child, nextChild)) {                     
00099                     <font class="keyword">delete</font> child;
00100                     nextChild = m_moduleIndex-&gt;firstChild();
00101                 }
00102                 <font class="keywordflow">else</font>
00103                     <font class="keyword">delete</font> child;
00104             }
00105         }
00106         child = nextChild;
00107     }
00108     m_initialized = <font class="keyword">true</font>;
00109 }
00110 
00111 CSearchDialogModuleChooser::~CSearchDialogModuleChooser(){
00112 }
00113 
<a name="l00115"></a><a class="code" href="class_c_search_dialog_module_chooser.html#a2">00115</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_module_chooser.html#a2">CSearchDialogModuleChooser::setChosenModules</a>(ListCSwordModuleInfo&amp; modules){
00116 <font class="comment">//  if (!modules.coun)</font>
00117 <font class="comment">//      return;</font>
00118     <font class="keywordflow">if</font> (<a class="code" href="class_c_search_dialog_module_chooser.html#a3">getChosenModules</a>() == modules)
00119         <font class="keywordflow">return</font>;
00120         
00121     m_moduleList-&gt;clear();
00122     m_itemsDict.clear();    
00123     m_moduleIndex-&gt;clear();
00124     m_moduleIndex-&gt;<a class="code" href="class_c_group_manager.html#a4">readSettings</a>();  
00125 
00126     <font class="keywordflow">for</font> (modules.first(); modules.current(); modules.next()) {
00127         <font class="keyword">const</font> QString module = modules.current()-&gt;name();
00128         QListViewItemIterator it( m_moduleIndex );
00129         <font class="keywordflow">for</font> ( ; it.current(); ++it )
00130             <font class="keywordflow">if</font> (it.current()-&gt;text(0) == module) {
00131                 m_moduleIndex-&gt;setCurrentItem(it.current());
00132                 m_moduleIndex-&gt;setSelected(it.current(), <font class="keyword">true</font>);
00133                 <a class="code" href="class_c_search_dialog_module_chooser.html#i1">addCurrentItem</a>();
00134             }
00135     }
00136 }
00137 
<a name="l00139"></a><a class="code" href="class_c_search_dialog_module_chooser.html#a3">00139</a> ListCSwordModuleInfo <a class="code" href="class_c_search_dialog_module_chooser.html#a3">CSearchDialogModuleChooser::getChosenModules</a>(){
00140     ListCSwordModuleInfo modules;
00141     <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i=0; i &lt; m_moduleList-&gt;count(); ++i) {
00142         <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(m_moduleList-&gt;text(i));
00143         <font class="keywordflow">if</font> (m)
00144             modules.append(m);
00145     }   
00146     <font class="keywordflow">return</font> modules;
00147 }
00148 
<a name="l00150"></a><a class="code" href="class_c_search_dialog_module_chooser.html#i1">00150</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_module_chooser.html#i1">CSearchDialogModuleChooser::addCurrentItem</a>(){
00151     <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* i = dynamic_cast&lt;CGroupManagerItem*&gt;(m_moduleIndex-&gt;selectedItem());
00152     QListViewItem* nextItem = 0;
00153     <font class="keywordflow">if</font> (i)
00154         nextItem = i-&gt;itemBelow();
00155     <font class="keywordflow">if</font> (i &amp;&amp; !nextItem)
00156         nextItem = i-&gt;itemAbove();
00157 
00158     <font class="keywordflow">if</font> ( i &amp;&amp; (i-&gt;<a class="code" href="class_c_group_manager_item.html#a13">type</a>() == CGroupManagerItem::Module) &amp;&amp; i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>() ) {
00159         m_moduleList-&gt;insertItem( <a class="code" href="class_c_tool_class.html#d4">CToolClass::getIconForModule</a>(i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()), i-&gt;<a class="code" href="class_c_group_manager_item.html#a12">moduleInfo</a>()-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>(),-1 );
00160         QListViewItem* parentItem = i-&gt;<a class="code" href="class_c_group_manager_item.html#a4">parent</a>();
00161         m_itemsDict.insert(i, parentItem ? (<font class="keyword">const</font> <font class="keywordtype">char</font>*)parentItem-&gt;text(0).latin1() : <font class="stringliteral">""</font>);<font class="comment">//I don't know why .local8Bit() doesn't work</font>
00162         parentItem ? parentItem-&gt;takeItem(i) : m_moduleIndex-&gt;takeItem(i);          
00163         
00164         <font class="keywordflow">if</font> (nextItem)
00165             m_moduleIndex-&gt;setSelected(nextItem, <font class="keyword">true</font>);
00166     }
00167     <font class="keywordflow">if</font> (m_initialized)
00168         emit <a class="code" href="class_c_search_dialog_module_chooser.html#j0">chosenModulesChanged</a>();
00169 }
00170 
<a name="l00172"></a><a class="code" href="class_c_search_dialog_module_chooser.html#i0">00172</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_module_chooser.html#i0">CSearchDialogModuleChooser::removeCurrentItem</a>(){
00173     <font class="keywordflow">if</font> (!m_itemsDict.count())
00174         <font class="keywordflow">return</font>;     
00175     QString text = QString::null;
00176     <font class="keywordflow">if</font> (m_moduleList-&gt;currentItem() != -1) {
00177         text = m_moduleList-&gt;text(m_moduleList-&gt;currentItem());
00178         <font class="keyword">const</font> <font class="keywordtype">int</font> currentItem = m_moduleList-&gt;currentItem();
00179         <font class="keywordtype">int</font> newIndex = currentItem;
00180         
00181         <font class="keywordflow">if</font> (currentItem+1 &lt; (int)m_moduleList-&gt;count())
00182             newIndex = currentItem+1;
00183         <font class="keywordflow">else</font>
00184             newIndex = currentItem-1;       
00185         m_moduleList-&gt;removeItem(m_moduleList-&gt;currentItem());
00186         <font class="keywordflow">if</font> (newIndex != -1)
00187             m_moduleList-&gt;setSelected(newIndex, <font class="keyword">true</font>);
00188     }
00189     <font class="keywordflow">else</font>
00190         <font class="keywordflow">return</font>;
00191 
00192     QPtrDictIterator&lt;char&gt; m_it( m_itemsDict ); <font class="comment">// iterator for dict</font>
00193     <font class="keywordflow">while</font> ( m_it.current() ) {
00194         QString parentName = QString::fromLatin1(m_it.current());
00195         <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* item = (<a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>*)m_it.currentKey();
00196         <font class="keywordflow">if</font> (item &amp;&amp; item-&gt;text(0) == text) {
00197             <a class="code" href="class_c_group_manager_item.html">CGroupManagerItem</a>* folder = 0;
00198         QListViewItemIterator l_it( m_moduleIndex );
00199             <font class="keywordflow">for</font> ( ; l_it.current(); ++l_it ) {
00200                 folder = dynamic_cast&lt;CGroupManagerItem*&gt;(l_it.current());
00201                 <font class="keywordflow">if</font> (folder &amp;&amp; folder-&gt;text(0) == parentName)
00202                     <font class="keywordflow">break</font>;
00203             }
00204             <font class="keywordflow">if</font> (folder)
00205                 folder-&gt;insertItem(item);
00206             <font class="keywordflow">else</font>
00207                 m_moduleIndex-&gt;insertItem(item);
00208             m_itemsDict.remove(item);
00209             <font class="keywordflow">break</font>;
00210         }
00211         ++m_it;
00212     }           
00213     <font class="keywordflow">if</font> (m_initialized)
00214         emit <a class="code" href="class_c_search_dialog_module_chooser.html#j0">chosenModulesChanged</a>();
00215 }
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:13 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
