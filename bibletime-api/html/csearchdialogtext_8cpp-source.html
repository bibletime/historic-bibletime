<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csearchdialogtext.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csearchdialogtext.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                       csearchdialogtext.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Mit Jan 19 12:57:15 CET 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 
00019 <font class="comment">//BibleTime includes</font>
00020 <font class="preprocessor">#include "csearchdialogtext.h"</font>
00021 <font class="preprocessor">#include "csearchdialogscope.h"</font>
00022 <font class="preprocessor">#include "../../whatsthisdef.h"</font>
00023 <font class="preprocessor">#include "../../tooltipdef.h"</font>
00024 <font class="preprocessor">#include "../../backend/cswordmodulesearch.h"</font>
00025 <font class="preprocessor">#include "../cbtconfig.h"</font>
00026 
00027 <font class="comment">//QT includes</font>
00028 <font class="preprocessor">#include &lt;qpixmap.h&gt;</font>
00029 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qvbuttongroup.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qhbuttongroup.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qradiobutton.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qcheckbox.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qlabel.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qgroupbox.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qhbox.h&gt;</font>
00037 <font class="preprocessor">#include &lt;qvbox.h&gt;</font>
00038 <font class="preprocessor">#include &lt;qcombobox.h&gt;</font>
00039 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00040 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00041 
00042 <font class="comment">//KDE includes</font>
00043 <font class="preprocessor">#include &lt;kcombobox.h&gt;</font>
00044 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00045 <font class="preprocessor">#include &lt;kprogress.h&gt;</font>
00046 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00047 
00048 
<a name="l00049"></a><a class="code" href="class_c_search_dialog_text.html#a0">00049</a> <a class="code" href="class_c_search_dialog_text.html#a0">CSearchDialogText::CSearchDialogText</a>(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00050     : QWidget(parent, name, 48)
00051 {
00052     <font class="comment">/* the first main Group - search text, options etc.*/</font>
00053     QGroupBox *textBox = <font class="keyword">new</font> QGroupBox(2,Qt::Vertical,i18n(<font class="stringliteral">"Search properties"</font>),<font class="keyword">this</font>,<font class="stringliteral">"textBox"</font>);
00054 
00055     m_editCombo = <font class="keyword">new</font> KHistoryCombo(textBox);
00056     m_editCombo-&gt;setInsertionPolicy(QComboBox::AtTop);  
00057     m_editCombo-&gt;setMaxCount(25);       
00058     m_editCombo-&gt;setDuplicatesEnabled(<font class="keyword">false</font>);               
00059     m_editCombo-&gt;setFocusPolicy(QWidget::StrongFocus);
00060     m_editCombo-&gt;setFocus();
00061     connect( m_editCombo, SIGNAL( activated( <font class="keyword">const</font> QString&amp; )), m_editCombo, SLOT( addToHistory( <font class="keyword">const</font> QString&amp; )));
00062     connect( m_editCombo, SIGNAL(returnPressed ( <font class="keyword">const</font> QString&amp; )),m_editCombo,  SLOT(addToHistory(<font class="keyword">const</font> QString&amp;)) );
00063     
00064     QToolTip::add(m_editCombo, TT_SD_SEARCH_TEXT_EDIT);
00065     QWhatsThis::add(m_editCombo, WT_SD_SEARCH_TEXT_EDIT);
00066     
00067     QHBox *settingsBox = <font class="keyword">new</font> QHBox(textBox,<font class="stringliteral">"settingsBox"</font>);
00068     QVBox *radioBox = <font class="keyword">new</font> QVBox(settingsBox,<font class="stringliteral">"radioBox"</font>);
00069 
00070     m_radioMultipleWords = <font class="keyword">new</font> QRadioButton( radioBox,<font class="stringliteral">"RadioButton_1"</font>);
00071     m_radioMultipleWords-&gt;setFocusPolicy(QWidget::TabFocus);
00072     m_radioMultipleWords-&gt;setText( i18n( <font class="stringliteral">"Multiple Words"</font> ) );
00073 <font class="comment">//  m_radioMultipleWords-&gt;setAutoResize( true );</font>
00074     m_radioMultipleWords-&gt;setChecked( <font class="keyword">true</font> );
00075     QToolTip::add(m_radioMultipleWords, TT_SD_SEARCH_MULTIPLE_WORDS);
00076     QWhatsThis::add(m_radioMultipleWords, WT_SD_SEARCH_MULTIPLE_WORDS); 
00077     
00078     m_radioExactSearch = <font class="keyword">new</font> QRadioButton(radioBox, <font class="stringliteral">"RadioButton_2"</font>);
00079     m_radioExactSearch-&gt;setFocusPolicy(QWidget::TabFocus);
00080     m_radioExactSearch-&gt;setText( i18n( <font class="stringliteral">"Exact Search"</font> ) );
00081 <font class="comment">//  m_radioExactSearch-&gt;setAutoResize( true );</font>
00082     QToolTip::add(m_radioExactSearch, TT_SD_SEARCH_EXACT_MATCH);
00083     QWhatsThis::add(m_radioExactSearch, WT_SD_SEARCH_EXACT_MATCH);  
00084 
00085     m_radioRegularExpression = <font class="keyword">new</font> QRadioButton(radioBox, <font class="stringliteral">"RadioButton_3"</font>);
00086     m_radioRegularExpression-&gt;setFocusPolicy(QWidget::TabFocus);
00087     m_radioRegularExpression-&gt;setText( i18n( <font class="stringliteral">"Regular Expression"</font> ) );
00088 <font class="comment">//  m_radioRegularExpression-&gt;setAutoResize( true );</font>
00089     QToolTip::add(m_radioRegularExpression, TT_SD_SEARCH_REGEXP );
00090     QWhatsThis::add(m_radioRegularExpression, WT_SD_SEARCH_REGEXP );
00091     
00092     <font class="comment">/* this widget is hidden - it is only used for exclusive radio button management*/</font>
00093     QVButtonGroup *bgroup1 = <font class="keyword">new</font> QVButtonGroup();
00094     bgroup1-&gt;insert(m_radioMultipleWords); <font class="comment">//they are automatically exclusive</font>
00095     bgroup1-&gt;insert(m_radioExactSearch);
00096     bgroup1-&gt;insert(m_radioRegularExpression);
00097 
00098     m_checkCaseSensitive = <font class="keyword">new</font> QCheckBox(settingsBox, <font class="stringliteral">"CheckBox_1"</font>);
00099     m_checkCaseSensitive-&gt;setFocusPolicy(QWidget::TabFocus);
00100     m_checkCaseSensitive-&gt;setText( i18n(<font class="stringliteral">"Case Sensitive"</font>) );
00101     QToolTip::add(m_checkCaseSensitive, TT_SD_SEARCH_CASE_SENSITIVE);
00102     QWhatsThis::add(m_checkCaseSensitive, WT_SD_SEARCH_CASE_SENSITIVE);
00103     
00104   QGroupBox *scopeBox = <font class="keyword">new</font> QGroupBox(2,Qt::Horizontal,i18n(<font class="stringliteral">"Search scope"</font>),<font class="keyword">this</font>,<font class="stringliteral">"scopeBox"</font>);
00105   <a class="code" href="class_c_search_dialog_text.html#m0">scopeChooser</a> = <font class="keyword">new</font> <a class="code" href="class_c_search_dialog_scope_chooser.html">CSearchDialogScopeChooser</a>(scopeBox, <font class="stringliteral">"scopeChooser"</font>);
00106     
00107     <font class="comment">/*the third main groupbox - progress indication */</font>
00108     QGroupBox *progressBox = <font class="keyword">new</font> QGroupBox(2,Qt::Horizontal,i18n(<font class="stringliteral">"Search progress"</font>),<font class="keyword">this</font>,<font class="stringliteral">"progressBox"</font>);
00109 
00110     <font class="comment">/* manages the 2 buttons (vertically)*/</font>
00111     QVBox *buttonBox = <font class="keyword">new</font> QVBox(progressBox,<font class="stringliteral">"currentBox"</font>);
00112 
00113     (void)<font class="keyword">new</font> QLabel(m_editCombo,i18n(<font class="stringliteral">"Current module:"</font>),buttonBox);
00114     (void)<font class="keyword">new</font> QLabel(m_editCombo,i18n(<font class="stringliteral">"Overall:"</font>),buttonBox);
00115 
00116     <font class="comment">/* manages the 2 bars (vertically) */</font>
00117     QVBox *barBox = <font class="keyword">new</font> QVBox(progressBox,<font class="stringliteral">"overallBox"</font>);
00118     m_currentProgressBar = <font class="keyword">new</font> KProgress(barBox, <font class="stringliteral">"m_currentProgressBar"</font>,0);
00119     m_overallProgressBar = <font class="keyword">new</font> KProgress(barBox, <font class="stringliteral">"m_overallProgressBar"</font>,0);
00120 <font class="comment">//  m_currentProgressBar = new KProgress(0,100,0,Horizontal,barBox, "m_currentProgressBar");</font>
00121 <font class="comment">//  m_overallProgressBar = new KProgress(0,100,0,Horizontal,barBox, "m_overallProgressBar");</font>
00122 
00123     <font class="comment">/* the main layout for the 3 groupboxes (vertical)*/</font>
00124     QVBoxLayout* layout_1 = <font class="keyword">new</font> QVBoxLayout( <font class="keyword">this</font> );
00125     layout_1-&gt;setAutoAdd(<font class="keyword">false</font>);
00126     
00127     textBox-&gt;setFixedHeight( textBox-&gt;sizeHint().height() );    
00128     layout_1-&gt;addWidget( textBox,1, Qt::AlignTop );
00129     
00130     layout_1-&gt;addWidget( scopeBox, Qt::AlignVCenter);
00131     scopeBox-&gt;setFixedHeight( scopeBox-&gt;sizeHint().height() );  
00132     
00133     progressBox-&gt;setFixedHeight( progressBox-&gt;sizeHint().height() );    
00134     layout_1-&gt;addWidget( progressBox,1,Qt::AlignBottom );
00135     
00136         
00137     <a class="code" href="class_c_search_dialog_text.html#c0">readSettings</a>();
00138 }
00139 
00140 CSearchDialogText::~CSearchDialogText() {
00141     saveSettings();
00142 }
00143     
<a name="l00144"></a><a class="code" href="class_c_search_dialog_text.html#a2">00144</a> <font class="keyword">const</font> QString <a class="code" href="class_c_search_dialog_text.html#a2">CSearchDialogText::getText</a>()<font class="keyword"> const </font>{
00145     <font class="keywordflow">return</font> m_editCombo-&gt;currentText();
00146 }
00147 
<a name="l00148"></a><a class="code" href="class_c_search_dialog_text.html#a3">00148</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_text.html#a3">CSearchDialogText::setText</a>(<font class="keyword">const</font> QString text){
00149     <font class="comment">//only insert the item to the list if it's not yet included</font>
00150     <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;
00151     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; !found &amp;&amp; i &lt; m_editCombo-&gt;count(); ++i) {
00152         <font class="keywordflow">if</font> (m_editCombo-&gt;text(i) == text)
00153             found = <font class="keyword">true</font>;
00154     }
00155     <font class="keywordflow">if</font> (!found) {
00156         m_editCombo-&gt;insertItem(text,0);
00157         m_editCombo-&gt;setCurrentItem(0);
00158     }
00159     m_editCombo-&gt;setFocus();    
00160 }
00161 
<a name="l00162"></a><a class="code" href="class_c_search_dialog_text.html#a4">00162</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_search_dialog_text.html#a4">CSearchDialogText::isCaseSensitive</a>() {
00163     <font class="keywordflow">return</font> m_checkCaseSensitive-&gt;isChecked();
00164 }
00165 
<a name="l00166"></a><a class="code" href="class_c_search_dialog_text.html#a5">00166</a> <font class="keyword">const</font> <font class="keywordtype">int</font> <a class="code" href="class_c_search_dialog_text.html#a5">CSearchDialogText::getSearchType</a>() {
00167     <font class="keywordtype">int</font> ret = CSwordModuleSearch::multipleWords;    <font class="comment">//"multiple words" is standard</font>
00168     <font class="keywordflow">if</font> (m_radioExactSearch-&gt;isChecked()) {
00169         ret = CSwordModuleSearch::exactPhrase;
00170     }
00171     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_radioRegularExpression-&gt;isChecked()) {
00172         ret = CSwordModuleSearch::regExp;
00173     }
00174     <font class="keywordflow">return</font> ret;
00175 }
00176 
<a name="l00177"></a><a class="code" href="class_c_search_dialog_text.html#a6">00177</a> <font class="keyword">const</font> QString <a class="code" href="class_c_search_dialog_text.html#a6">CSearchDialogText::getSearchTypeString</a>() {
00178     QString ret = m_radioMultipleWords-&gt;text(); <font class="comment">//"multiple words" is standard</font>
00179     <font class="keywordflow">if</font> (m_radioExactSearch-&gt;isChecked()) {
00180         ret = m_radioExactSearch-&gt;text();
00181     }
00182     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_radioRegularExpression-&gt;isChecked()) {
00183         ret = m_radioRegularExpression-&gt;text();
00184     }
00185     <font class="keywordflow">return</font> ret;
00186 
00187 }
<a name="l00188"></a><a class="code" href="class_c_search_dialog_text.html#a7">00188</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_text.html#a7">CSearchDialogText::updateCurrentProgress</a>(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> <font class="keywordtype">int</font> percent){
00189     m_currentProgressBar-&gt;setValue(percent);
00190 }
00191 
<a name="l00192"></a><a class="code" href="class_c_search_dialog_text.html#a8">00192</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_text.html#a8">CSearchDialogText::updateOverallProgress</a>(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> <font class="keywordtype">int</font> percent){
00193     m_overallProgressBar-&gt;setValue(percent);
00194 }
00195 
<a name="l00197"></a><a class="code" href="class_c_search_dialog_text.html#a9">00197</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_text.html#a9">CSearchDialogText::reset</a>(){
00198     m_currentProgressBar-&gt;setValue(0);
00199     m_overallProgressBar-&gt;setValue(0);
00200     m_editCombo-&gt;clear();
00201 }
00202 
<a name="l00204"></a><a class="code" href="class_c_search_dialog_text.html#c0">00204</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_text.html#c0">CSearchDialogText::readSettings</a>(){
00205     QStringList list = CBTConfig::get( CBTConfig::searchCompletionTexts );
00206     m_editCombo-&gt;completionObject()-&gt;setItems( list );
00207     
00208     list = CBTConfig::get(CBTConfig::searchTexts);
00209     m_editCombo-&gt;setHistoryItems( list );
00210 }
00211 
00212 <font class="keywordtype">void</font> CSearchDialogText::saveSettings(){
00213     QStringList list = m_editCombo-&gt;completionObject()-&gt;items();
00214     CBTConfig::set(CBTConfig::searchCompletionTexts, list);
00215     
00216     list = m_editCombo-&gt;historyItems();
00217     CBTConfig::set(CBTConfig::searchTexts, list);   
00218 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:09 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
