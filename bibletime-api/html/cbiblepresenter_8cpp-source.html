<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cbiblepresenter.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cbiblepresenter.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cbiblepresenter.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Mar 18 2001</font>
00005 <font class="comment">    copyright            : (C) 2001 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cbiblepresenter.h"</font>
00019 <font class="preprocessor">#include "cmodulechooserbar.h"</font>
00020 <font class="preprocessor">#include "cdisplaysettingsbutton.h"</font>
00021 
00022 <font class="preprocessor">#include "../ctoolclass.h"</font>
00023 <font class="preprocessor">#include "../cexportmanager.h"</font>
00024 <font class="preprocessor">#include "../chtmlwidget.h"</font>
00025 <font class="preprocessor">#include "../keychooser/ckeychooser.h"</font>
00026 <font class="preprocessor">#include "../../resource.h"</font>
00027 <font class="preprocessor">#include "../../backend/cswordbiblemoduleinfo.h"</font>
00028 <font class="preprocessor">#include "../../backend/cswordversekey.h"</font>
00029 <font class="preprocessor">#include "../../backend/chtmlchapterdisplay.h"</font>
00030 <font class="preprocessor">#include "../../backend/cswordbackend.h"</font>
00031 <font class="preprocessor">#include "../../backend/creferencemanager.h"</font>
00032 <font class="preprocessor">#include "../cprofile.h"</font>
00033 <font class="preprocessor">#include "../cprofilewindow.h"</font>
00034 
00035 <font class="preprocessor">#include &lt;math.h&gt;</font>
00036 
00037 <font class="comment">//Qt includes</font>
00038 <font class="preprocessor">#include &lt;qclipboard.h&gt;</font>
00039 <font class="preprocessor">#include &lt;qlist.h&gt;</font>
00040 
00041 <font class="comment">//KDE includes</font>
00042 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00043 <font class="preprocessor">#include &lt;ktoolbar.h&gt;</font>
00044 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00045 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00046 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00047 
00048 CBiblePresenter::CBiblePresenter(ListCSwordModuleInfo useModules, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00049     : <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>(useModules,parent,name)
00050 {       
00051     qWarning(<font class="stringliteral">"CBiblePresenter::CBiblePresenter"</font>);
00052     m_key = <font class="keyword">new</font> <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a>(m_moduleList.first());
00053     <a class="code" href="class_c_sword_bible_module_info.html">CSwordBibleModuleInfo</a>* bible = dynamic_cast&lt;CSwordBibleModuleInfo*&gt;(m_moduleList.first());
00054     <font class="keywordflow">if</font> (bible) {
00055         <font class="keywordflow">if</font> (bible-&gt;<a class="code" href="class_c_sword_bible_module_info.html#a8">hasTestament</a>(CSwordBibleModuleInfo::OldTestament))
00056             m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(<font class="stringliteral">"Genesis 1:1"</font>);
00057         <font class="keywordflow">else</font>
00058             m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(<font class="stringliteral">"Matthew 1:1"</font>);
00059     }
00060     
00061     initView();
00062     show(); 
00063     initConnections();
00064     
00065     setInitialized();
00066 }
00067 
00068 CBiblePresenter::~CBiblePresenter(){
00069     <font class="keyword">delete</font> m_key;
00070 }
00071 
<a name="l00073"></a><a class="code" href="class_c_bible_presenter.html#b0">00073</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#b0">CBiblePresenter::initView</a>(){
00074 <font class="comment">//  qWarning("CBiblePresenter::initView");  </font>
00075     m_mainToolBar = <font class="keyword">new</font> KToolBar(<font class="keyword">this</font>);
00076     m_keyChooser = <a class="code" href="class_c_key_chooser.html#d0">CKeyChooser::createInstance</a>(m_moduleList.first(), m_key, m_mainToolBar);
00077     m_mainToolBar-&gt;insertWidget(0,m_keyChooser-&gt;sizeHint().width(),m_keyChooser);   
00078     m_mainToolBar-&gt;setItemAutoSized(0);
00079 
00080     m_displaySettingsButton = <font class="keyword">new</font> CDisplaySettingsButton( &amp;m_displayOptions, &amp;m_moduleOptions, m_moduleList, m_mainToolBar);
00081     m_mainToolBar-&gt;insertWidget(1,m_displaySettingsButton-&gt;sizeHint().width(),m_displaySettingsButton);
00082 
00083     addToolBar(m_mainToolBar);          
00084         
00085     m_moduleChooserBar = <font class="keyword">new</font> <a class="code" href="class_c_module_chooser_bar.html">CModuleChooserBar</a>(m_moduleList, CSwordModuleInfo::Bible, <font class="keyword">this</font> );
00086     addToolBar(m_moduleChooserBar);
00087     
00088     m_htmlWidget = <font class="keyword">new</font> <a class="code" href="class_c_h_t_m_l_widget.html">CHTMLWidget</a>(<font class="keyword">true</font>, <font class="keyword">this</font>);
00089         
00090     <font class="comment">//setup popup menu</font>
00091     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00092     m_popup-&gt;insertTitle(i18n(<font class="stringliteral">"Bible window"</font>));
00093     
00094     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);
00095     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Verse"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#i1">copyVerse</a>()),0,ID_PRESENTER_COPY_ONLY_KEY);
00096     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Text of verse"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#i2">copyVerseText</a>()),0,ID_PRESENTER_COPY_KEY_TEXT);   
00097     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Verse with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#i3">copyVerseAndText</a>()),0,ID_PRESENTER_COPY_KEY);
00098     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Chapter"</font>), m_htmlWidget, SLOT(copyDocument()),0,ID_PRESENTER_COPY_CHAPTER);
00099     m_copyPopup-&gt;insertSeparator();
00100     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Selected text"</font>), m_htmlWidget, SLOT(copy()),0,ID_PRESENTER_COPY_SELECTED);
00101 
00102     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);
00103     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Verse with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#i4">printVerseAndText</a>()),0,ID_PRESENTER_PRINT_KEY);
00104     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Chapter"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#i5">printChapter</a>()),0,ID_PRESENTER_PRINT_CHAPTER);
00105 
00106     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00107     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Verse with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#i6">saveVerseAndText</a>()),0,ID_PRESENTER_SAVE_KEY);
00108     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Chapter as plain text"</font>), m_htmlWidget, SLOT(slotSaveAsText()),0,ID_PRESENTER_SAVE_CHAPTER);
00109     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Chapter as HTML"</font>), m_htmlWidget, SLOT(slotSaveAsHTML()),0,ID_PRESENTER_SAVE_CHAPTER_HTML);    
00110 
00111     m_popup-&gt;insertItem(i18n(<font class="stringliteral">"Select all"</font>), m_htmlWidget, SLOT(slotSelectAll()),0, ID_PRESENTER_SELECT_ALL);
00112   m_popup-&gt;insertItem(i18n(<font class="stringliteral">"Lookup selected text in lexicon"</font>), m_lexiconPopup, ID_PRESENTER_LOOKUP);    
00113     m_popup-&gt;insertSeparator(); 
00114     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY),i18n(<font class="stringliteral">"Copy..."</font>),  m_copyPopup, ID_PRESENTER_COPY_POPUP);  
00115     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT), i18n(<font class="stringliteral">"Add to printing queue..."</font>), m_printPopup, ID_PRESENTER_PRINT_POPUP);  
00116     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>),     m_savePopup,ID_PRESENTER_SAVE_POPUP);       
00117 
00118     m_htmlWidget-&gt;installPopup(m_popup);            
00119     m_htmlWidget-&gt;installAnchorMenu( m_popup );
00120     m_htmlWidget-&gt;setModules(m_moduleList);
00121         
00122     setCentralWidget(m_htmlWidget); 
00123     setIcon( BIBLE_ICON_SMALL );    
00124 }
00125 
<a name="l00127"></a><a class="code" href="class_c_bible_presenter.html#h2">00127</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#a2">CBiblePresenter::lookup</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>* key){
00128 <font class="comment">//  qWarning("CBiblePresenter::lookup(CSwordKey* key)");</font>
00129     setUpdatesEnabled(<font class="keyword">false</font>);   
00130     
00131     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a>* vKey = dynamic_cast&lt;CSwordVerseKey*&gt;(key);  
00132     <font class="keywordflow">if</font> (!vKey)
00133         <font class="keywordflow">return</font>;
00134 
00135     <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>( m_moduleOptions );
00136     <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a7">setDisplayOptions</a>( m_displayOptions );
00137         
00138     <font class="keywordflow">if</font> (m_moduleList.first()-&gt;getDisplay()) {   <font class="comment">//do we have a display object?</font>
00139       m_moduleList.first()-&gt;module()-&gt;SetKey(*vKey);
00140         <font class="keywordflow">if</font> (m_moduleList.count()&gt;1)
00141             m_moduleList.first()-&gt;getDisplay()-&gt;Display( &amp;m_moduleList );
00142         <font class="keywordflow">else</font>
00143             m_moduleList.first()-&gt;getDisplay()-&gt;Display( m_moduleList.first() );
00144         m_htmlWidget-&gt;setText( m_moduleList.first()-&gt;getDisplay()-&gt;getHTML() );
00145     }
00146     <font class="keywordflow">if</font> (m_key != vKey)
00147         m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(vKey-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>());
00148         
00149     m_htmlWidget-&gt;scrollToAnchor( QString::number(vKey-&gt;Verse()) );
00150     setUpdatesEnabled(<font class="keyword">true</font>);        
00151     <a class="code" href="class_c_sword_presenter.html#g2">setCaption</a>(<a class="code" href="class_c_sword_presenter.html#a4">windowCaption</a>());    
00152 }
00153 
<a name="l00155"></a><a class="code" href="class_c_bible_presenter.html#h0">00155</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#h0">CBiblePresenter::modulesChanged</a>(){
00156   m_moduleList = m_moduleChooserBar-&gt;getModuleList();
00157   <font class="keywordflow">if</font> (!m_moduleList.count()) {
00158     close();
00159   }
00160   <font class="keywordflow">else</font> {
00161         m_displaySettingsButton-&gt;reset(m_moduleList);
00162 <font class="comment">//    refreshFeatures()</font>
00163       m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a10">module</a>(m_moduleList.first());
00164       m_keyChooser-&gt;setModule(m_moduleList.first());    
00165         m_htmlWidget-&gt;setModules(m_moduleList);
00166         
00167       <a class="code" href="class_c_bible_presenter.html#a2">lookup</a>(m_key);
00168     }
00169 }
00171 <font class="keywordtype">void</font> CBiblePresenter::optionsChanged(){
00172     <a class="code" href="class_c_bible_presenter.html#a2">lookup</a>(m_key);
00173 }
00174 
00175 
<a name="l00177"></a><a class="code" href="class_c_bible_presenter.html#b1">00177</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#b1">CBiblePresenter::initConnections</a>(){
00178     connect(m_htmlWidget, SIGNAL(referenceClicked(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)),
00179         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#a2">lookup</a>(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)));    
00180     connect(m_htmlWidget, SIGNAL(<a class="code" href="class_c_sword_presenter.html#g3">referenceDropped</a>(<font class="keyword">const</font> QString&amp;)),
00181         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_sword_presenter.html#g3">referenceDropped</a>(<font class="keyword">const</font> QString&amp;)));
00182 
00183     connect(m_keyChooser, SIGNAL(keyChanged(<a class="code" href="class_c_sword_key.html">CSwordKey</a>*)),
00184         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#a2">lookup</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>*)));
00185     connect(m_popup, SIGNAL(aboutToShow()),
00186         SLOT(<a class="code" href="class_c_bible_presenter.html#i0">popupAboutToShow</a>()));
00187     connect(m_moduleChooserBar, SIGNAL( sigChanged() ),
00188         SLOT(<a class="code" href="class_c_bible_presenter.html#h0">modulesChanged</a>() ));
00189     connect(m_displaySettingsButton, SIGNAL( sigChanged() ),    
00190         SLOT(optionsChanged() ));
00191 }
00192 
<a name="l00194"></a><a class="code" href="class_c_bible_presenter.html#i0">00194</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#i0">CBiblePresenter::popupAboutToShow</a>() {
00195     m_popup-&gt;setItemEnabled(ID_PRESENTER_LOOKUP, !m_htmlWidget-&gt;selectedText().isEmpty());
00196 
00197     m_copyPopup-&gt;setItemEnabled(ID_PRESENTER_COPY_ONLY_KEY,!m_htmlWidget-&gt;getCurrentAnchor().isEmpty());    
00198     m_copyPopup-&gt;setItemEnabled(ID_PRESENTER_COPY_KEY_TEXT,!m_htmlWidget-&gt;getCurrentAnchor().isEmpty());    
00199     m_copyPopup-&gt;setItemEnabled(ID_PRESENTER_COPY_KEY,!m_htmlWidget-&gt;getCurrentAnchor().isEmpty());         
00200     m_copyPopup-&gt;setItemEnabled(ID_PRESENTER_COPY_SELECTED, !m_htmlWidget-&gt;selectedText().isEmpty());
00201     
00202     m_printPopup-&gt;setItemEnabled(ID_PRESENTER_PRINT_KEY,!m_htmlWidget-&gt;getCurrentAnchor().isEmpty());           
00203 
00204     m_savePopup-&gt;setItemEnabled(ID_PRESENTER_SAVE_KEY,!m_htmlWidget-&gt;getCurrentAnchor().isEmpty());
00205         
00206 <font class="comment">//  m_popup-&gt;setItemEnabled(ID_PRESENTER_PRINT_VERSE, !m_htmlWidget-&gt;getCurrentAnchor().isEmpty());</font>
00207 <font class="comment">//  m_popup-&gt;setItemEnabled(ID_PRESENTER_COPY_VERSE, !m_htmlWidget-&gt;getCurrentAnchor().isEmpty());  </font>
00208 }
00209 
<a name="l00211"></a><a class="code" href="class_c_bible_presenter.html#a2">00211</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#a2">CBiblePresenter::lookup</a>(<font class="keyword">const</font> QString&amp; module, <font class="keyword">const</font> QString&amp; key){
00212     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);
00213     <font class="keywordflow">if</font> (m &amp;&amp; m_moduleList.containsRef(m)) {
00214         <font class="keywordflow">if</font> (!key.isEmpty())
00215             m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00216         m_keyChooser-&gt;setKey(m_key); <font class="comment">//the key chooser does send an update signal   </font>
00217     }
00218     <font class="keywordflow">else</font> {
00219         emit lookupInModule(module, key);
00220     }
00221 }
00222 
<a name="l00224"></a><a class="code" href="class_c_bible_presenter.html#a3">00224</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#a3">CBiblePresenter::refresh</a>( ){
00225 
00226     <a class="code" href="class_c_sword_presenter.html#a2">CSwordPresenter::refresh</a>(); <font class="comment">//refreshes the display settings button</font>
00227 
00228     m_key-&gt;setLocale((<font class="keyword">const</font> <font class="keywordtype">char</font>*)<a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;booknameLanguage().local8Bit());
00229     m_keyChooser-&gt;refreshContent();
00230     <a class="code" href="class_c_bible_presenter.html#a2">lookup</a>(m_key);
00231     m_htmlWidget-&gt;refresh();        
00232 }
00233 
00234 
<a name="l00236"></a><a class="code" href="class_c_bible_presenter.html#i1">00236</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#i1">CBiblePresenter::copyVerse</a>(){
00237     QString key = QString::null;
00238     QString module = QString::null;
00239     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00240     CReferenceManager::Type type;   
00241     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00242     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00243     
00244     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00245     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00246         
00247     QClipboard *cb = KApplication::clipboard();
00248     cb-&gt;setText(vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>());
00249 }
00250 
<a name="l00252"></a><a class="code" href="class_c_bible_presenter.html#i2">00252</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#i2">CBiblePresenter::copyVerseText</a>(){
00253     QString key = QString::null;
00254     QString module = QString::null;
00255     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00256     CReferenceManager::Type type;
00257     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00258     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00259     
00260     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00261     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);  
00262     QClipboard *cb = KApplication::clipboard();
00263     cb-&gt;setText(vKey.<a class="code" href="class_c_sword_key.html#a6">strippedText</a>());
00264 }
00265 
<a name="l00267"></a><a class="code" href="class_c_bible_presenter.html#i3">00267</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#i3">CBiblePresenter::copyVerseAndText</a>(){
00268     QString key = QString::null;
00269     QString module = QString::null;
00270     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00271     CReferenceManager::Type type;   
00272     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00273     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00274     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00275     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00276     
00277     <font class="keyword">const</font> QString text = QString(<font class="stringliteral">"%1\n%2"</font>).arg(vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>()).arg(vKey.<a class="code" href="class_c_sword_key.html#a6">strippedText</a>());
00278     QClipboard *cb = KApplication::clipboard();
00279     cb-&gt;setText(text);
00280 }
00281 
00282 <font class="comment">//print functions</font>
<a name="l00284"></a><a class="code" href="class_c_bible_presenter.html#i4">00284</a> <font class="comment"></font><font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#i4">CBiblePresenter::printVerseAndText</a>(){
00285     QString key = QString::null;
00286     QString module = QString::null;
00287     <font class="keyword">const</font> QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00288     CReferenceManager::Type type;   
00289     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00290     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00291     
00292 <font class="comment">//  CSwordVerseKey* vKey = new CSwordVerseKey(m);//deleted by the print item</font>
00293 <font class="comment">//  vKey-&gt;key(key);</font>
00294     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m); 
00295     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00296 
00297 <font class="comment">//  printKey(vKey.key(), vKey.key(), m);</font>
00298     CExportManager::printKey(m, vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>());
00299 }
00300 
<a name="l00302"></a><a class="code" href="class_c_bible_presenter.html#i5">00302</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#i5">CBiblePresenter::printChapter</a>(){
00303     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> startKey(*m_key);
00304     startKey.Verse(1);
00305     
00306     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> stopKey(*m_key); 
00307 
00308     <a class="code" href="class_c_sword_bible_module_info.html">CSwordBibleModuleInfo</a>* b = dynamic_cast&lt;CSwordBibleModuleInfo*&gt;(m_moduleList.first());
00309     qWarning(<font class="stringliteral">"Versecoubnt: %i"</font>, b-&gt;<a class="code" href="class_c_sword_bible_module_info.html#a3">verseCount</a>( b-&gt;<a class="code" href="class_c_sword_bible_module_info.html#a7">bookNumber</a>(startKey.<a class="code" href="class_c_sword_verse_key.html#a9">book</a>()), startKey.Chapter() ));
00310     <font class="keywordflow">if</font> (b)
00311         stopKey.Verse( b-&gt;<a class="code" href="class_c_sword_bible_module_info.html#a3">verseCount</a>( b-&gt;<a class="code" href="class_c_sword_bible_module_info.html#a7">bookNumber</a>(startKey.<a class="code" href="class_c_sword_verse_key.html#a9">book</a>()), startKey.Chapter() ) );
00312     qWarning(<font class="stringliteral">"verse: %i"</font>, stopKey.Verse()); 
00313     CExportManager::printKey(m_moduleList.first(), startKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(), stopKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>());
00314 }
00315 
00316 <font class="comment">//save functions</font>
00317 
<a name="l00319"></a><a class="code" href="class_c_bible_presenter.html#i6">00319</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#i6">CBiblePresenter::saveVerseAndText</a>(){
00320     QString key = QString::null;
00321     QString module = QString::null;
00322     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00323     CReferenceManager::Type type;   
00324     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00325     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00326     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00327     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00328     
00329     <font class="keyword">const</font> QString text = QString::fromLatin1(<font class="stringliteral">"%1\n%2"</font>).arg(vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>()).arg(vKey.<a class="code" href="class_c_sword_key.html#a6">strippedText</a>());    
00330     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName(QString::null, i18n(<font class="stringliteral">"*.txt | Text file (*.txt)\n*.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save verse with text as ..."</font>));
00331     <font class="keywordflow">if</font> (!file.isNull())
00332         <a class="code" href="class_c_tool_class.html#d4">CToolClass::savePlainFile</a>(file, text);
00333 }
00334 
<a name="l00336"></a><a class="code" href="class_c_bible_presenter.html#d0">00336</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#d0">CBiblePresenter::insertKeyboardActions</a>(KAccel* a){
00337     a-&gt;setConfigGroup(<font class="stringliteral">"Bible window"</font>);
00338     a-&gt;insertItem(i18n(<font class="stringliteral">"Next book"</font>), <font class="stringliteral">"Next book"</font>, 0);
00339     a-&gt;insertItem(i18n(<font class="stringliteral">"Previous book"</font>), <font class="stringliteral">"Previous book"</font>, 0);   
00340     
00341     a-&gt;insertItem(i18n(<font class="stringliteral">"Next chapter"</font>), <font class="stringliteral">"Next chapter"</font>, 0);
00342     a-&gt;insertItem(i18n(<font class="stringliteral">"Previous chapter"</font>), <font class="stringliteral">"Previous chapter"</font>, 0); 
00343 
00344     a-&gt;insertItem(i18n(<font class="stringliteral">"Next verse"</font>), <font class="stringliteral">"Next verse"</font>, 0);
00345     a-&gt;insertItem(i18n(<font class="stringliteral">"Previous verse"</font>), <font class="stringliteral">"Previous verse"</font>, 0); 
00346 }
00347 
<a name="l00349"></a><a class="code" href="class_c_bible_presenter.html#b2">00349</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#b2">CBiblePresenter::initAccels</a>(){
00350     qWarning(<font class="stringliteral">"CBiblePresenter::initAccels()"</font>);
00351     ASSERT(m_accel);
00352     m_accel-&gt;setConfigGroup(<font class="stringliteral">"Bible window"</font>);
00353     
00354     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Next book"</font>), <font class="stringliteral">"Next book"</font>, 0);
00355     m_accel-&gt;connectItem(<font class="stringliteral">"Next book"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#h3">nextBook</a>()));  
00356     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Previous book"</font>), <font class="stringliteral">"Previous book"</font>, 0); 
00357     m_accel-&gt;connectItem(<font class="stringliteral">"Previous book"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#h4">previousBook</a>()));
00358         
00359     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Next chapter"</font>), <font class="stringliteral">"Next chapter"</font>, 0);
00360     m_accel-&gt;connectItem(<font class="stringliteral">"Next chapter"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#h5">nextChapter</a>()));        
00361     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Previous chapter"</font>), <font class="stringliteral">"Previous chapter"</font>, 0);   
00362     m_accel-&gt;connectItem(<font class="stringliteral">"Previous chapter"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#h6">previousChapter</a>()));    
00363 
00364     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Next verse"</font>), <font class="stringliteral">"Next verse"</font>, 0);
00365     m_accel-&gt;connectItem(<font class="stringliteral">"Next verse"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#h7">nextVerse</a>()));        
00366     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Previous verse"</font>), <font class="stringliteral">"Previous verse"</font>, 0);   
00367     m_accel-&gt;connectItem(<font class="stringliteral">"Previous verse"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_bible_presenter.html#h8">previousVerse</a>()));    
00368     
00369     m_accel-&gt;readSettings();
00370     CSwordPresenter::initAccels();  
00371 }
00372 
<a name="l00374"></a><a class="code" href="class_c_bible_presenter.html#h3">00374</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#h3">CBiblePresenter::nextBook</a>(){
00375     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseBook))
00376         m_keyChooser-&gt;setKey(m_key);    
00377 }
00378 
<a name="l00380"></a><a class="code" href="class_c_bible_presenter.html#h4">00380</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#h4">CBiblePresenter::previousBook</a>(){
00381     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a8">previous</a>(CSwordVerseKey::UseBook))
00382         m_keyChooser-&gt;setKey(m_key);
00383 }
00384 
00385 
<a name="l00387"></a><a class="code" href="class_c_bible_presenter.html#h5">00387</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#h5">CBiblePresenter::nextChapter</a>(){
00388     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseChapter))
00389         m_keyChooser-&gt;setKey(m_key);    
00390 }
00391 
<a name="l00393"></a><a class="code" href="class_c_bible_presenter.html#h6">00393</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#h6">CBiblePresenter::previousChapter</a>(){
00394     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a8">previous</a>(CSwordVerseKey::UseChapter))
00395         m_keyChooser-&gt;setKey(m_key);
00396 }
00397 
<a name="l00399"></a><a class="code" href="class_c_bible_presenter.html#h7">00399</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#h7">CBiblePresenter::nextVerse</a>(){
00400 <font class="comment">//  qWarning("CBiblePresenter::nextVerse()");</font>
00401     <font class="keywordflow">if</font> (    m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseVerse) ) 
00402         m_keyChooser-&gt;setKey(m_key);    
00403 }
00404 
<a name="l00406"></a><a class="code" href="class_c_bible_presenter.html#h8">00406</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#h8">CBiblePresenter::previousVerse</a>(){
00407     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a8">previous</a>(CSwordVerseKey::UseVerse))
00408         m_keyChooser-&gt;setKey(m_key);
00409 }
00410 
<a name="l00412"></a><a class="code" href="class_c_bible_presenter.html#a5">00412</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#a5">CBiblePresenter::storeSettings</a>( <a class="code" href="class_c_profile_window.html">CProfileWindow</a>* settings ){
00413     <a class="code" href="class_c_sword_presenter.html#a5">CSwordPresenter::storeSettings</a>(settings);
00420     <font class="keyword">const</font> <font class="keywordtype">int</font> count = m_displaySettingsButton-&gt;menuItemCount();
00421     <font class="keywordtype">int</font> result = 0;
00422     <font class="comment">//now check every item</font>
00423     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 1; i&lt;count; i++) { <font class="comment">//first item is a title</font>
00424         <font class="keywordflow">if</font> (m_displaySettingsButton-&gt;itemStatus(i)) <font class="comment">//item is checked</font>
00425             result += (int)pow(2,i-1);<font class="comment">//add 2^i (the i. digit in binary)</font>
00426     }
00427     settings-&gt;<a class="code" href="class_c_profile_window.html#a12">setWindowSettings</a>(result);
00428 }
00429 
<a name="l00431"></a><a class="code" href="class_c_bible_presenter.html#a4">00431</a> <font class="keywordtype">void</font> <a class="code" href="class_c_bible_presenter.html#a4">CBiblePresenter::applySettings</a>( <a class="code" href="class_c_profile_window.html">CProfileWindow</a>* settings ){
00432     <a class="code" href="class_c_sword_presenter.html#a6">CSwordPresenter::applySettings</a>(settings);
00433   <font class="keywordtype">int</font> result = settings-&gt;<a class="code" href="class_c_profile_window.html#a13">windowSettings</a>();
00434     <font class="keyword">const</font> <font class="keywordtype">int</font> count = m_displaySettingsButton-&gt;menuItemCount();
00435     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = count-1; i&gt;=1; i--) {
00436         <font class="keywordflow">if</font> (result-(int)pow(2,i-1)&gt;= 0) { <font class="comment">//2^i was added before, so item with index i is set</font>
00437             result -= (int)pow(2,i-1);
00438             m_displaySettingsButton-&gt;setItemStatus(i,<font class="keyword">true</font>);
00439         }
00440         <font class="keywordflow">else</font>
00441             m_displaySettingsButton-&gt;setItemStatus(i,<font class="keyword">false</font>);            
00442     }       
00443     m_displaySettingsButton-&gt;setChanged();
00444 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:45 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
