<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ccommentarypresenter.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>ccommentarypresenter.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          ccommentarypresenter.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Mar 18 2001</font>
00005 <font class="comment">    copyright            : (C) 2001 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "ccommentarypresenter.h"</font>
00019 <font class="preprocessor">#include "cmodulechooserbar.h"</font>
00020 <font class="preprocessor">#include "cdisplaysettingsbutton.h"</font>
00021 
00022 <font class="preprocessor">#include "../ctoolclass.h"</font>
00023 <font class="preprocessor">#include "../cexportmanager.h"</font>
00024 <font class="preprocessor">#include "../chtmlwidget.h"</font>
00025 <font class="preprocessor">#include "../keychooser/ckeychooser.h"</font>
00026 <font class="preprocessor">#include "../../resource.h"</font>
00027 <font class="preprocessor">#include "../../whatsthisdef.h"</font>
00028 <font class="preprocessor">#include "../../backend/cswordversekey.h"</font>
00029 <font class="preprocessor">#include "../../backend/chtmlchapterdisplay.h"</font>
00030 <font class="preprocessor">#include "../../backend/creferencemanager.h"</font>
00031 <font class="preprocessor">#include "../../backend/cswordbackend.h"</font>
00032 <font class="preprocessor">#include "../../backend/cswordcommentarymoduleinfo.h"</font>
00033 
00034 
00035 <font class="comment">//Qt includes</font>
00036 <font class="preprocessor">#include &lt;qclipboard.h&gt;</font>
00037 
00038 <font class="comment">//KDE includes</font>
00039 <font class="preprocessor">#include &lt;kmessagebox.h&gt;</font>
00040 <font class="preprocessor">#include &lt;ktoolbar.h&gt;</font>
00041 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00042 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00043 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00044 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00045 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00046 
<a name="l00047"></a><a class="code" href="class_c_commentary_presenter.html#a0">00047</a> <a class="code" href="class_c_commentary_presenter.html#a0">CCommentaryPresenter::CCommentaryPresenter</a>(ListCSwordModuleInfo useModules, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00048     : <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>(useModules, parent,name),
00049     m_key( new <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a>(m_moduleList.first()) ), m_editToolBar(0)
00050 {
00051     <a class="code" href="class_c_sword_commentary_module_info.html">CSwordCommentaryModuleInfo</a>* commentary = dynamic_cast&lt;CSwordCommentaryModuleInfo*&gt;(m_moduleList.first());
00052     <font class="keywordflow">if</font> (commentary) {
00053         <font class="keywordflow">if</font> (commentary-&gt;<a class="code" href="class_c_sword_bible_module_info.html#a8">hasTestament</a>(CSwordBibleModuleInfo::OldTestament))
00054             m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(<font class="stringliteral">"Genesis 1:1"</font>);
00055         <font class="keywordflow">else</font>
00056             m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(<font class="stringliteral">"Matthew 1:1"</font>);
00057     }
00058     
00059     <a class="code" href="class_c_commentary_presenter.html#c1">initView</a>(); 
00060     show();     
00061     <a class="code" href="class_c_commentary_presenter.html#c0">initConnections</a>();      
00062     
00063     setInitialized();
00064 }
00065 
<a name="l00066"></a><a class="code" href="class_c_commentary_presenter.html#a1">00066</a> <a class="code" href="class_c_commentary_presenter.html#a1">CCommentaryPresenter::~CCommentaryPresenter</a>(){
00067     <font class="keyword">delete</font> m_key;
00068 }
00069 
<a name="l00071"></a><a class="code" href="class_c_commentary_presenter.html#c1">00071</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#c1">CCommentaryPresenter::initView</a>(){
00072     m_mainToolBar = <font class="keyword">new</font> KToolBar(<font class="keyword">this</font>);
00073     m_keyChooser = <a class="code" href="class_c_key_chooser.html#d0">CKeyChooser::createInstance</a>(m_moduleList.first(), m_key, m_mainToolBar);
00074     m_mainToolBar-&gt;insertWidget(0,m_keyChooser-&gt;sizeHint().width(),m_keyChooser);   
00075     addToolBar(m_mainToolBar);          
00076 
00077 <font class="comment">//  m_displaySettingsButton = new CDisplaySettingsButton( &amp;m_displayOptions, &amp;m_moduleOptions, m_moduleList, m_mainToolBar);</font>
00078 <font class="comment">//  m_mainToolBar-&gt;insertWidget(1,m_displaySettingsButton-&gt;sizeHint().width(),m_displaySettingsButton);</font>
00079     
00080     m_moduleChooserBar = <font class="keyword">new</font> <a class="code" href="class_c_module_chooser_bar.html">CModuleChooserBar</a>(m_moduleList, CSwordModuleInfo::Commentary, <font class="keyword">this</font> );
00081     addToolBar(m_moduleChooserBar);
00082     
00083     presenterSync_action =  <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Synchronize..."</font>), ICON_SYNC,
00084                                                             IDK_PRESENTER_EDIT, <font class="keyword">this</font>,   SLOT(<a class="code" href="class_c_commentary_presenter.html#i1">syncToggled</a>()), actionCollection(), <font class="stringliteral">"syncComment_action"</font>);
00085     presenterSync_action-&gt;setWhatsThis( WT_PRESENTER_SYNC );
00086     presenterSync_action-&gt;plug(m_mainToolBar);
00087     
00088     presenterEdit_action =  <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Edit entry..."</font>), ICON_EDIT,
00089                                                             IDK_PRESENTER_EDIT, <font class="keyword">this</font>,   SLOT(editComment()), actionCollection(), <font class="stringliteral">"editComment_action"</font>);
00090     presenterEdit_action-&gt;setEnabled( m_moduleList.first()-&gt;module()-&gt;isWritable() );
00091     presenterEdit_action-&gt;setWhatsThis( WT_PRESENTER_EDIT );
00092     presenterEdit_action-&gt;plug(m_mainToolBar);
00093     
00094     m_htmlWidget = <font class="keyword">new</font> <a class="code" href="class_c_h_t_m_l_widget.html">CHTMLWidget</a>(<font class="keyword">true</font>, <font class="keyword">this</font>);
00095     ASSERT(m_htmlWidget);
00096     
00097     <font class="comment">//setup popup menu</font>
00098     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00099     m_popup-&gt;insertTitle(i18n(<font class="stringliteral">"Commentary window"</font>));
00100     
00101     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);
00102     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Entry"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#i3">copyEntry</a>()),0,ID_PRESENTER_COPY_ONLY_KEY);
00103     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Text of entry"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#i4">copyEntryText</a>()),0,ID_PRESENTER_COPY_KEY_TEXT);   
00104     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Entry with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#i5">copyEntryAndText</a>()),0,ID_PRESENTER_COPY_KEY);
00105     m_copyPopup-&gt;insertSeparator();
00106     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Selected text"</font>), m_htmlWidget, SLOT(copy()),0,ID_PRESENTER_COPY_SELECTED);
00107     
00108     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);
00109     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Entry with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h5">printHighlightedVerse</a>()),0,ID_PRESENTER_PRINT_KEY);
00110 
00111     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00112     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Entry as plain text"</font>), m_htmlWidget, SLOT(slotSaveAsText()),0,ID_PRESENTER_SAVE_CHAPTER);
00113     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Entry as HTML"</font>), m_htmlWidget, SLOT(slotSaveAsHTML()),0,ID_PRESENTER_SAVE_CHAPTER_HTML);  
00114 
00115     m_popup-&gt;insertItem(i18n(<font class="stringliteral">"Select all"</font>), m_htmlWidget, SLOT(slotSelectAll()),0, ID_PRESENTER_SELECT_ALL);
00116   m_popup-&gt;insertItem(i18n(<font class="stringliteral">"Lookup selected text in lexicon"</font>), m_lexiconPopup, ID_PRESENTER_LOOKUP);    
00117     m_popup-&gt;insertSeparator(); 
00118     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY),i18n(<font class="stringliteral">"Copy..."</font>),  m_copyPopup, ID_PRESENTER_COPY_POPUP);  
00119     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT), i18n(<font class="stringliteral">"Add to printing queue..."</font>), m_printPopup, ID_PRESENTER_PRINT_POPUP);  
00120     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>),     m_savePopup,ID_PRESENTER_SAVE_POPUP);       
00121 
00122 <font class="comment">//SSERT(m_htmlWidget);</font>
00123     m_htmlWidget-&gt;installPopup(m_popup);        
00124     m_htmlWidget-&gt;installAnchorMenu( m_popup );
00125     m_htmlWidget-&gt;setModules(m_moduleList); 
00126 <font class="comment">//  qWarning("before set icon");</font>
00127     setCentralWidget(m_htmlWidget); 
00128     setIcon( COMMENTARY_ICON_SMALL );
00129 }
00130 
<a name="l00132"></a><a class="code" href="class_c_commentary_presenter.html#c0">00132</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#c0">CCommentaryPresenter::initConnections</a>(){
00133     connect(m_htmlWidget, SIGNAL(referenceClicked(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)),
00134         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#g1">lookup</a>(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)));        
00135     connect(m_htmlWidget, SIGNAL(<a class="code" href="class_c_sword_presenter.html#g3">referenceDropped</a>(<font class="keyword">const</font> QString&amp;)),
00136         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_sword_presenter.html#g3">referenceDropped</a>(<font class="keyword">const</font> QString&amp;)));
00137 
00138     connect(m_htmlWidget, SIGNAL(sigDeleteDocument()),
00139         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h3">deleteText</a>()));      
00140     connect(m_htmlWidget, SIGNAL(sigSaveDocument(<font class="keyword">const</font> QString)),
00141         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#g0">saveText</a>(<font class="keyword">const</font> QString)));           
00142     connect(m_htmlWidget, SIGNAL(<a class="code" href="class_c_commentary_presenter.html#i2">insertReference</a>(<font class="keyword">const</font> QString&amp;)),
00143         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#i2">insertReference</a>(<font class="keyword">const</font> QString&amp;)));                   
00144     
00145     connect( m_keyChooser, SIGNAL(<a class="code" href="class_c_commentary_presenter.html#i7">beforeKeyChange</a>(<font class="keyword">const</font> QString&amp;)),
00146         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#i7">beforeKeyChange</a>(<font class="keyword">const</font> QString&amp;)));
00147     connect( m_keyChooser, SIGNAL(keyChanged(<a class="code" href="class_c_sword_key.html">CSwordKey</a>*)),
00148         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#g1">lookup</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>*)));        
00149     
00150     connect(m_popup,SIGNAL(aboutToShow()),
00151         SLOT(<a class="code" href="class_c_commentary_presenter.html#i0">popupAboutToShow</a>()));
00152     
00153     connect(m_moduleChooserBar, SIGNAL( sigChanged() ),
00154         SLOT( <a class="code" href="class_c_commentary_presenter.html#h1">modulesChanged</a>() ));  
00155 <font class="comment">//  connect(m_displaySettingsButton, SIGNAL( sigChanged() ),    </font>
00156 <font class="comment">//      SLOT(optionsChanged() ));</font>
00157 }
00158 
<a name="l00160"></a><a class="code" href="class_c_commentary_presenter.html#h1">00160</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h1">CCommentaryPresenter::modulesChanged</a>(){
00161   m_moduleList = m_moduleChooserBar-&gt;getModuleList();
00162 
00163   <font class="keywordflow">if</font> (!m_moduleList.count())
00164     close();
00165   <font class="keywordflow">else</font> {
00166         presenterEdit_action-&gt;setEnabled( m_moduleList.first()-&gt;module()-&gt;isWritable() );
00167 <font class="comment">//      m_displaySettingsButton-&gt;reset(m_moduleList);</font>
00168 <font class="comment">//    refreshFeatures();    </font>
00169       m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a10">module</a>(m_moduleList.first());
00170       m_keyChooser-&gt;setModule(m_moduleList.first());    
00171         m_htmlWidget-&gt;setModules(m_moduleList); 
00172       <a class="code" href="class_c_commentary_presenter.html#g1">lookup</a>(m_key);
00173     }
00174 }
00176 <font class="keywordtype">void</font> CCommentaryPresenter::optionsChanged(){
00177     <a class="code" href="class_c_commentary_presenter.html#g1">lookup</a>(m_key);
00178 }
00179 
<a name="l00181"></a><a class="code" href="class_c_commentary_presenter.html#h0">00181</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#g1">CCommentaryPresenter::lookup</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>* key){  
00182     setUpdatesEnabled(<font class="keyword">false</font>);
00183     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a>* vKey = dynamic_cast&lt;CSwordVerseKey*&gt;(key);
00184     <font class="keywordflow">if</font> (!vKey)
00185         <font class="keywordflow">return</font>;
00186 
00187     <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>( m_moduleOptions );
00188     <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a7">setDisplayOptions</a>( m_displayOptions );
00189 
00190   m_moduleList.first()-&gt;module()-&gt;SetKey(*vKey);
00191 
00192     <font class="keywordflow">if</font> (m_moduleList.first()-&gt;getDisplay()) {   <font class="comment">//do we have a display object?</font>
00193         <font class="keywordflow">if</font> (m_htmlWidget-&gt;isReadOnly())  {
00194             <font class="keywordflow">if</font> (m_moduleList.count()&gt;1)
00195                 m_moduleList.first()-&gt;getDisplay()-&gt;Display( &amp;m_moduleList );
00196             <font class="keywordflow">else</font>
00197                 m_moduleList.first()-&gt;getDisplay()-&gt;Display( m_moduleList.first() );
00198             m_htmlWidget-&gt;setText( m_moduleList.first()-&gt;getDisplay()-&gt;getHTML() );
00199         }
00200         <font class="keywordflow">else</font>
00201             m_htmlWidget-&gt;setText( QString::fromUtf8( m_moduleList.first()-&gt;module()-&gt;getRawEntry() ) );
00202     }   
00203     <font class="keywordflow">if</font> (m_key != vKey)
00204         m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(vKey-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>());
00205         
00206     m_htmlWidget-&gt;scrollToAnchor( QString::number(vKey-&gt;Verse()) );
00207     m_htmlWidget-&gt;setModified(<font class="keyword">false</font>);
00208     setUpdatesEnabled(<font class="keyword">true</font>);
00209     
00210     <a class="code" href="class_c_sword_presenter.html#g2">setCaption</a>( <a class="code" href="class_c_sword_presenter.html#a4">windowCaption</a>() );  
00211 }
00212 
<a name="l00214"></a><a class="code" href="class_c_commentary_presenter.html#i0">00214</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i0">CCommentaryPresenter::popupAboutToShow</a>(){
00215     m_popup-&gt;setItemEnabled(ID_PRESENTER_LOOKUP, !m_htmlWidget-&gt;selectedText().isEmpty());
00216     m_copyPopup-&gt;setItemEnabled(ID_PRESENTER_COPY_SELECTED, !m_htmlWidget-&gt;selectedText().isEmpty());   
00217 }
00218 
<a name="l00220"></a><a class="code" href="class_c_commentary_presenter.html#g0">00220</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#g0">CCommentaryPresenter::saveText</a>(<font class="keyword">const</font> QString text){
00221     m_moduleList.first()-&gt;module()-&gt;SetKey(m_key);
00222     <font class="keywordflow">if</font> (!text.isEmpty())
00223         *(m_moduleList.first()-&gt;module()) &lt;&lt; (<font class="keyword">const</font> <font class="keywordtype">char</font>*)text.utf8();
00224     <font class="keywordflow">else</font>
00225         m_moduleList.first()-&gt;module()-&gt;deleteEntry();      
00226     m_htmlWidget-&gt;setModified( <font class="keyword">false</font> );     
00227 }
00228 
<a name="l00230"></a><a class="code" href="class_c_commentary_presenter.html#h3">00230</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h3">CCommentaryPresenter::deleteText</a>(){
00231     m_moduleList.first()-&gt;module()-&gt;deleteEntry();
00232     m_htmlWidget-&gt;clear();
00233 }
00234 
00235 <font class="keywordtype">void</font> CCommentaryPresenter::editComment(){
00236     <font class="keywordflow">if</font> (!m_htmlWidget-&gt;isReadOnly()) {
00237         <font class="keywordflow">switch</font> (KMessageBox::warningYesNo( <font class="keyword">this</font>, i18n(<font class="stringliteral">"The text was not saved to the module. Save the changes now?"</font>)) ) {
00238             <font class="keywordflow">case</font> KMessageBox::Yes:
00239             {
00240             <a class="code" href="class_c_commentary_presenter.html#g0">saveText</a>( m_htmlWidget-&gt;text() );
00241             m_htmlWidget-&gt;setModified( <font class="keyword">false</font> );
00242                 <font class="keywordflow">break</font>;
00243             }
00244         <font class="keywordflow">default</font>: <font class="comment">//no</font>
00245             <font class="keywordflow">break</font>;
00246       }
00247     }
00248     
00249     m_htmlWidget-&gt;setReadOnly( !m_htmlWidget-&gt;isReadOnly() );   
00250     <font class="keywordflow">if</font> (!m_htmlWidget-&gt;isReadOnly() &amp;&amp; !m_editToolBar) {
00251         m_editToolBar = <font class="keyword">new</font> KToolBar(<font class="keyword">this</font>);
00252         addToolBar(m_editToolBar);      
00253         m_htmlWidget-&gt;createEditToolbar( m_editToolBar );
00254     }   
00255     <font class="keywordflow">if</font> (!m_htmlWidget-&gt;isReadOnly() &amp;&amp; !m_editToolBar)
00256         <font class="keywordflow">return</font>;
00257         
00258     <font class="keywordflow">if</font> (!m_htmlWidget-&gt;isReadOnly())
00259         m_editToolBar-&gt;show();
00260     <font class="keywordflow">else</font>
00261         m_editToolBar-&gt;hide();
00262             
00263     <a class="code" href="class_c_commentary_presenter.html#g1">lookup</a>( m_key );    
00264     m_htmlWidget-&gt;setFocus();
00265 }
00266 
<a name="l00268"></a><a class="code" href="class_c_commentary_presenter.html#g1">00268</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#g1">CCommentaryPresenter::lookup</a>(<font class="keyword">const</font> QString&amp; module, <font class="keyword">const</font> QString&amp; key){
00269     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);
00270     <font class="keywordflow">if</font> (m &amp;&amp; m_moduleList.containsRef(m)) {
00271         <font class="keywordflow">if</font> (!key.isEmpty())
00272             m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00273         m_keyChooser-&gt;setKey(m_key); <font class="comment">//the key chooser does send an update signal   </font>
00274     }
00275     <font class="keywordflow">else</font> {
00276         emit lookupInModule(module, key);
00277     }
00278 }
00279 
<a name="l00281"></a><a class="code" href="class_c_commentary_presenter.html#g2">00281</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#g2">CCommentaryPresenter::refresh</a>( ){
00282 
00283 <font class="comment">//  CSwordPresenter::refresh(); //refreshes the display settings button</font>
00284 
00285     m_key-&gt;setLocale((<font class="keyword">const</font> <font class="keywordtype">char</font>*)<a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;booknameLanguage().local8Bit());
00286     m_keyChooser-&gt;refreshContent();
00287     <a class="code" href="class_c_commentary_presenter.html#g1">lookup</a>(m_key);
00288     m_htmlWidget-&gt;refresh();        
00289 }
00290 
<a name="l00292"></a><a class="code" href="class_c_commentary_presenter.html#h5">00292</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h5">CCommentaryPresenter::printHighlightedVerse</a>(){
00293 <font class="comment">//  CSwordVerseKey key(m_moduleList.first());   //this key is deleted by the printem</font>
00294 <font class="comment">//  key-&gt;key(m_key-&gt;key()); </font>
00295 <font class="comment">//  CSwordVerseKey key(*m_key);</font>
00296     CExportManager::printKey(m_moduleList.first(), m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>());
00297 }
00298 
<a name="l00300"></a><a class="code" href="class_c_commentary_presenter.html#i1">00300</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i1">CCommentaryPresenter::syncToggled</a>(){
00301 }
00302 
<a name="l00304"></a><a class="code" href="class_c_commentary_presenter.html#a2">00304</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#a2">CCommentaryPresenter::synchronize</a>( <a class="code" href="class_c_sword_key.html">CSwordKey</a>* syncKey ){
00305     <font class="keywordflow">if</font> (!presenterSync_action-&gt;isChecked() || !syncKey)
00306         <font class="keywordflow">return</font>;
00307     <a class="code" href="class_c_commentary_presenter.html#c2">checkChanges</a>();
00308     m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(syncKey-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>());
00309     m_keyChooser-&gt;setKey(m_key);
00310 }
00311 
<a name="l00313"></a><a class="code" href="class_c_commentary_presenter.html#i2">00313</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i2">CCommentaryPresenter::insertReference</a>(<font class="keyword">const</font> QString&amp; reference){
00314     <font class="keywordflow">if</font> (m_htmlWidget-&gt;isReadOnly())
00315         <font class="keywordflow">return</font>;
00316     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vk(m_moduleList.first());
00317     vk.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(reference);
00318     m_htmlWidget-&gt;insert(vk.<a class="code" href="class_c_sword_key.html#a6">strippedText</a>());
00319 }
00320 
<a name="l00322"></a><a class="code" href="class_c_commentary_presenter.html#i3">00322</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i3">CCommentaryPresenter::copyEntry</a>(){
00323     QString key = QString::null;
00324     QString module = QString::null;
00325     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00326     CReferenceManager::Type type;
00327     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00328     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00329     
00330     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00331     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00332         
00333     QClipboard *cb = KApplication::clipboard();
00334     cb-&gt;setText(vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>());
00335 }
00336 
<a name="l00338"></a><a class="code" href="class_c_commentary_presenter.html#i4">00338</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i4">CCommentaryPresenter::copyEntryText</a>(){
00339     QString key = QString::null;
00340     QString module = QString::null; 
00341     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00342     CReferenceManager::Type type;   
00343     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00344     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00345     
00346     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00347     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00348     
00349     QClipboard *cb = KApplication::clipboard();
00350     cb-&gt;setText(vKey.<a class="code" href="class_c_sword_key.html#a6">strippedText</a>());
00351 }
00352 
<a name="l00354"></a><a class="code" href="class_c_commentary_presenter.html#i5">00354</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i5">CCommentaryPresenter::copyEntryAndText</a>(){
00355     QString key = QString::null;
00356     QString module = QString::null;
00357     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00358     CReferenceManager::Type type;   
00359     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00360     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);      
00361     
00362     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00363     vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key);
00364     
00365     <font class="keyword">const</font> QString text = QString::fromLatin1(<font class="stringliteral">"%1\n%2"</font>).arg(vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>()).arg(vKey.<a class="code" href="class_c_sword_key.html#a6">strippedText</a>());
00366     QClipboard *cb = KApplication::clipboard();
00367     cb-&gt;setText(text);
00368 }
00369 
00370 <font class="comment">//print functions</font>
<a name="l00372"></a><a class="code" href="class_c_commentary_presenter.html#i6">00372</a> <font class="comment"></font><font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i6">CCommentaryPresenter::printEntry</a>(){
00373     QString key = QString::null;
00374     QString module = QString::null;
00375     QString currentAnchor = m_htmlWidget-&gt;getCurrentAnchor();
00376     CReferenceManager::Type type;   
00377     <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(currentAnchor, module, key, type);   
00378     
00379     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);          
00380     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vKey(m);
00381     CExportManager::printKey(m, vKey.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(key));
00382 }
00383 
<a name="l00385"></a><a class="code" href="class_c_commentary_presenter.html#c2">00385</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#c2">CCommentaryPresenter::checkChanges</a>(){
00386 <font class="comment">//  qDebug("void CCommentaryPresenter::checkChanges()");</font>
00387     <font class="keywordflow">if</font> (!m_htmlWidget-&gt;isReadOnly() &amp;&amp; m_htmlWidget-&gt;isModified()) {<font class="comment">//save</font>
00388         <a class="code" href="class_c_commentary_presenter.html#g0">saveText</a>( m_htmlWidget-&gt;text() );
00389         m_htmlWidget-&gt;setModified( <font class="keyword">false</font> );
00390     }
00391 }
00392 
<a name="l00394"></a><a class="code" href="class_c_commentary_presenter.html#i7">00394</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#i7">CCommentaryPresenter::beforeKeyChange</a>(<font class="keyword">const</font> QString&amp; oldKey){
00395     qWarning(<font class="stringliteral">"CCommentaryPresenter::beforeKeyChange"</font>);
00396     <font class="keywordflow">if</font> (!m_htmlWidget-&gt;isReadOnly()) {
00397         <font class="keywordflow">switch</font> (KMessageBox::warningYesNo( <font class="keyword">this</font>, i18n(<font class="stringliteral">"The text was not saved to the module. Save the changes now?"</font>)) ) {
00398             <font class="keywordflow">case</font> KMessageBox::Yes:
00399             {
00400                 <font class="keyword">const</font> QString newKey = m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>();
00401                 m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(oldKey);
00402             <a class="code" href="class_c_commentary_presenter.html#g0">saveText</a>( m_htmlWidget-&gt;text() );
00403                 m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(newKey);             
00404                 <font class="keywordflow">break</font>;
00405             }
00406         <font class="keywordflow">default</font>: <font class="comment">//no</font>
00407             <font class="keywordflow">break</font>;
00408       }
00409     }
00410     m_htmlWidget-&gt;setModified( <font class="keyword">false</font> ); 
00411 }
00412 
<a name="l00414"></a><a class="code" href="class_c_commentary_presenter.html#d0">00414</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#d0">CCommentaryPresenter::insertKeyboardActions</a>(KAccel* a){    
00415     ASSERT(a);
00416     a-&gt;setConfigGroup(<font class="stringliteral">"Commentary window"</font>);
00417         
00418     a-&gt;insertItem(i18n(<font class="stringliteral">"Next book"</font>), <font class="stringliteral">"Next book"</font>, 0);
00419     a-&gt;insertItem(i18n(<font class="stringliteral">"Previous book"</font>), <font class="stringliteral">"Previous book"</font>, 0);   
00420     
00421     a-&gt;insertItem(i18n(<font class="stringliteral">"Next chapter"</font>), <font class="stringliteral">"Next chapter"</font>, 0);
00422     a-&gt;insertItem(i18n(<font class="stringliteral">"Previous chapter"</font>), <font class="stringliteral">"Previous chapter"</font>, 0); 
00423 
00424     a-&gt;insertItem(i18n(<font class="stringliteral">"Next verse"</font>), <font class="stringliteral">"Next verse"</font>, 0);
00425     a-&gt;insertItem(i18n(<font class="stringliteral">"Previous verse"</font>), <font class="stringliteral">"Previous verse"</font>, 0); 
00426 
00427     a-&gt;insertItem(i18n(<font class="stringliteral">"Toggle synchronize button"</font>), <font class="stringliteral">"Synchronize"</font>, 0);
00428 }
00429 
00430 
<a name="l00432"></a><a class="code" href="class_c_commentary_presenter.html#b0">00432</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#b0">CCommentaryPresenter::initAccels</a>(){
00433     qWarning(<font class="stringliteral">"CCommentaryPresenter::initAccels()"</font>);
00434     CSwordPresenter::initAccels();
00435     m_accel-&gt;setConfigGroup(<font class="stringliteral">"Commentary window"</font>);
00436     
00437     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Next book"</font>), <font class="stringliteral">"Next book"</font>, 0);
00438     m_accel-&gt;connectItem(<font class="stringliteral">"Next book"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h6">nextBook</a>()));  
00439     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Previous book"</font>), <font class="stringliteral">"Previous book"</font>, 0); 
00440     m_accel-&gt;connectItem(<font class="stringliteral">"Previous book"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h7">previousBook</a>()));
00441         
00442     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Next chapter"</font>), <font class="stringliteral">"Next chapter"</font>, 0);
00443     m_accel-&gt;connectItem(<font class="stringliteral">"Next chapter"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h8">nextChapter</a>()));        
00444     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Previous chapter"</font>), <font class="stringliteral">"Previous chapter"</font>, 0);   
00445     m_accel-&gt;connectItem(<font class="stringliteral">"Previous chapter"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h9">previousChapter</a>()));    
00446 
00447     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Next verse"</font>), <font class="stringliteral">"Next verse"</font>, 0);
00448     m_accel-&gt;connectItem(<font class="stringliteral">"Next verse"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h10">nextVerse</a>()));        
00449     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Previous verse"</font>), <font class="stringliteral">"Previous verse"</font>, 0);   
00450     m_accel-&gt;connectItem(<font class="stringliteral">"Previous verse"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h11">previousVerse</a>()));    
00451 
00452     m_accel-&gt;insertItem(i18n(<font class="stringliteral">"Toggle synchronize button"</font>), <font class="stringliteral">"Synchronize"</font>, 0);   
00453     m_accel-&gt;connectItem(<font class="stringliteral">"Synchronize"</font>, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_commentary_presenter.html#h12">toggleSynchronize</a>()));   
00454         
00455     m_accel-&gt;readSettings();
00456 }
00457 
<a name="l00459"></a><a class="code" href="class_c_commentary_presenter.html#h6">00459</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h6">CCommentaryPresenter::nextBook</a>(){
00460     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseBook))
00461         m_keyChooser-&gt;setKey(m_key);    
00462 }
00463 
<a name="l00465"></a><a class="code" href="class_c_commentary_presenter.html#h7">00465</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h7">CCommentaryPresenter::previousBook</a>(){
00466     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a8">previous</a>(CSwordVerseKey::UseBook))
00467         m_keyChooser-&gt;setKey(m_key);
00468 }
00469 
00470 
<a name="l00472"></a><a class="code" href="class_c_commentary_presenter.html#h8">00472</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h8">CCommentaryPresenter::nextChapter</a>(){
00473     <font class="keywordflow">if</font> ( m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseChapter) )
00474         m_keyChooser-&gt;setKey(m_key);    
00475 }
00476 
<a name="l00478"></a><a class="code" href="class_c_commentary_presenter.html#h9">00478</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h9">CCommentaryPresenter::previousChapter</a>(){
00479     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a8">previous</a>(CSwordVerseKey::UseChapter))
00480         m_keyChooser-&gt;setKey(m_key);
00481 }
00482 
<a name="l00484"></a><a class="code" href="class_c_commentary_presenter.html#h10">00484</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h10">CCommentaryPresenter::nextVerse</a>(){
00485     <font class="keywordflow">if</font> ( m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseVerse) )
00486         m_keyChooser-&gt;setKey(m_key);    
00487 }
00488 
<a name="l00490"></a><a class="code" href="class_c_commentary_presenter.html#h11">00490</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h11">CCommentaryPresenter::previousVerse</a>(){
00491     <font class="keywordflow">if</font> (m_key-&gt;<a class="code" href="class_c_sword_verse_key.html#a8">previous</a>(CSwordVerseKey::UseVerse))
00492         m_keyChooser-&gt;setKey(m_key);
00493 }
00494 
<a name="l00496"></a><a class="code" href="class_c_commentary_presenter.html#h12">00496</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#h12">CCommentaryPresenter::toggleSynchronize</a>(){
00497     presenterSync_action-&gt;setChecked( !presenterSync_action-&gt;isChecked() );
00498 }
00499 
<a name="l00501"></a><a class="code" href="class_c_commentary_presenter.html#a3">00501</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#a3">CCommentaryPresenter::storeSettings</a>( <a class="code" href="class_c_profile_window.html">CProfileWindow</a>* settings ){
00502     <a class="code" href="class_c_sword_presenter.html#a5">CSwordPresenter::storeSettings</a>(settings);
00503     settings-&gt;<a class="code" href="class_c_profile_window.html#a12">setWindowSettings</a>( presenterSync_action-&gt;isChecked() );   
00504 }
00505 
<a name="l00507"></a><a class="code" href="class_c_commentary_presenter.html#a4">00507</a> <font class="keywordtype">void</font> <a class="code" href="class_c_commentary_presenter.html#a4">CCommentaryPresenter::applySettings</a>( <a class="code" href="class_c_profile_window.html">CProfileWindow</a>* settings ){
00508     <a class="code" href="class_c_sword_presenter.html#a6">CSwordPresenter::applySettings</a>(settings);
00509     presenterSync_action-&gt;setChecked(settings-&gt;<a class="code" href="class_c_profile_window.html#a13">windowSettings</a>() == 1);
00510 }
00511 
<a name="l00513"></a><a class="code" href="class_c_commentary_presenter.html#g3">00513</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_commentary_presenter.html#g3">CCommentaryPresenter::queryClose</a>(){
00514     <font class="comment">//save the text</font>
00515     <font class="keywordflow">if</font> (!m_htmlWidget-&gt;isReadOnly() &amp;&amp; m_htmlWidget-&gt;isModified()) {    
00516         <font class="keywordflow">switch</font> (KMessageBox::warningYesNoCancel( <font class="keyword">this</font>, i18n(<font class="stringliteral">"Save changes to module?"</font>)) ) {
00517             <font class="keywordflow">case</font> KMessageBox::Yes:
00518             {
00519                 qWarning(<font class="stringliteral">"YES"</font>);
00520             <font class="comment">//save</font>
00521             <a class="code" href="class_c_commentary_presenter.html#g0">saveText</a>( m_htmlWidget-&gt;text() );
00522             m_htmlWidget-&gt;setModified( <font class="keyword">false</font> );
00523             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00524             }
00525         <font class="keywordflow">case</font> KMessageBox::No :
00526                 qWarning(<font class="stringliteral">"No"</font>);
00527             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00528         <font class="keywordflow">default</font>: <font class="comment">// cancel</font>
00529                 qWarning(<font class="stringliteral">"CANCEL"</font>);     
00530             <font class="keywordflow">return</font> <font class="keyword">false</font>;   
00531         }
00532     }
00533     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00534 }
</pre></div><hr><address><small>Generated on Sun Mar 10 21:52:40 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
