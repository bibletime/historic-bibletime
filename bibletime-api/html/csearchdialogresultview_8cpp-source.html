<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csearchdialogresultview.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csearchdialogresultview.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                   csearchdialogresultview.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Wed Jan 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//own includes</font>
00019 <font class="preprocessor">#include "csearchdialogresultview.h"</font>
00020 <font class="preprocessor">#include "csearchdialog.h"</font>
00021 
00022 <font class="preprocessor">#include "resource.h"</font>
00023 <font class="preprocessor">#include "whatsthisdef.h"</font>
00024 <font class="preprocessor">#include "tooltipdef.h"</font>
00025 
00026 <font class="preprocessor">#include "backend/cswordbiblemoduleinfo.h"</font>
00027 <font class="preprocessor">#include "backend/cswordlexiconmoduleinfo.h"</font>
00028 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00029 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00030 <font class="preprocessor">#include "backend/creferencemanager.h"</font>
00031 
00032 <font class="preprocessor">#include "frontend/cexportmanager.h"</font>
00033 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00034 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00035 
00036 <font class="preprocessor">#include "printing/cprintitem.h"</font>
00037 <font class="preprocessor">#include "printing/cprinter.h"</font>
00038 
00039 <font class="preprocessor">#include "util/scoped_resource.h"</font>
00040 
00041 <font class="comment">//QT includes</font>
00042 <font class="preprocessor">#include &lt;qlist.h&gt;</font>
00043 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00044 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00045 <font class="preprocessor">#include &lt;qmessagebox.h&gt;</font>
00046 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00047 <font class="preprocessor">#include &lt;qwidget.h&gt;</font>
00048 <font class="preprocessor">#include &lt;qclipboard.h&gt;</font>
00049 <font class="preprocessor">#include &lt;qprogressdialog.h&gt;</font>
00050 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00051 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00052 
00053 <font class="comment">//KDE includes</font>
00054 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00055 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00056 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00057 <font class="preprocessor">#include &lt;kapplication.h&gt;</font>
00058 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00059 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00060 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00061 
00062 <font class="comment">//Sword includes</font>
00063 <font class="preprocessor">#include &lt;listkey.h&gt;</font>
00064 <font class="preprocessor">#include &lt;swmodule.h&gt;</font>
00065 
00066 CSearchDialogResultModuleView::CSearchDialogResultModuleView(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00067     : QListView ( parent, name )    {   
00068     initView();
00069     adjustSize();
00070 }
00071 
00072 CSearchDialogResultModuleView::~CSearchDialogResultModuleView() {
00073     qDebug(<font class="stringliteral">"CSearchDialogResultModuleView::~CSearchDialogResultModuleView()"</font>);
00074 }
00075 
<a name="l00077"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a3">00077</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a3">CSearchDialogResultModuleView::setupTree</a>() {
00078     ListKey moduleSearchResult;
00079     QListViewItem   *module = 0;
00080 
00081     <font class="keywordflow">for</font> (moduleList.first(); moduleList.current(); moduleList.next()) {
00082         moduleSearchResult = moduleList.current()-&gt;searchResult();
00083         module = <font class="keyword">new</font> QListViewItem(<font class="keyword">this</font>, QString(<font class="stringliteral">"%1 [%2]"</font>).arg( moduleList.current()-&gt;name() ).arg( moduleSearchResult.Count() ));
00084         module-&gt;setPixmap(0,<a class="code" href="class_c_tool_class.html#d4">CToolClass::getIconForModule</a>(moduleList.current()) );
00085     }   
00086     setFixedWidth( sizeHint().width() );
00087 <font class="comment">//  resize(sizeHint());</font>
00088 }
00089 
00090 <font class="keywordtype">void</font> CSearchDialogResultModuleView::viewportMousePressEvent(QMouseEvent *e) {
00091     qDebug(<font class="stringliteral">"CSearchDialogResultModuleView::viewportMousePressEvent"</font>);
00092     QListView::viewportMousePressEvent(e);
00093 
00094     m_currentItem = (QListViewItem*)itemAt(e-&gt;pos());
00095     <font class="keywordflow">if</font> (!m_currentItem)
00096     {
00097         qDebug(<font class="stringliteral">"item is NULL"</font>);
00098         <font class="keywordflow">return</font>;
00099     }
00100     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00101             <font class="keywordflow">return</font>;
00102     <font class="keywordflow">for</font> (moduleList.first();moduleList.current();moduleList.next()){
00103         QString modName = m_currentItem-&gt;text(0);
00104         modName = modName.left( modName.find(<font class="stringliteral">" ["</font>) );
00105         m_currentModule = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(modName);
00106         <font class="keywordflow">if</font> (m_currentModule)
00107             emit <a class="code" href="class_c_search_dialog_result_module_view.html#j0">moduleSelected</a>(m_currentModule);
00108     }   
00109     <font class="keywordflow">if</font> (e-&gt;button() == RightButton)
00110         m_popup-&gt;popup( mapToGlobal(e-&gt;pos()) );
00111 }
00112 
<a name="l00114"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a4">00114</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a4">CSearchDialogResultModuleView::initView</a>(){
00115     QWhatsThis::add(<font class="keyword">this</font>, WT_SD_RESULT_MODULE_VIEW);
00116     
00117     setFocusPolicy(QWidget::WheelFocus);
00118     setAllColumnsShowFocus( <font class="keyword">true</font> );
00119     setRootIsDecorated( <font class="keyword">false</font> );
00120     addColumn( i18n( <font class="stringliteral">"Modules"</font> ), -1 );
00121     header()-&gt;hide();
00122     setSorting( -1 );
00123     
00124     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00125     
00126     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00127     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h2">slotCopySearchResult</a>())); 
00128     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h4">slotCopySearchResultWithKeytext</a>()));
00129     
00130     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);     
00131     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h0">printSearchResult</a>()));
00132     
00133     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);      
00134     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h1">slotSaveSearchResult</a>()));
00135     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h3">slotSaveSearchResultWithKeytext</a>()));
00136     
00137     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY), i18n(<font class="stringliteral">"Copy..."</font>),     m_copyPopup);
00138     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT), i18n(<font class="stringliteral">"Add to printing queue..."</font>), m_printPopup);
00139     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>),     m_savePopup);
00140 }
00141 
<a name="l00143"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a5">00143</a> <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* <a class="code" href="class_c_search_dialog_result_module_view.html#a5">CSearchDialogResultModuleView::getCurrentModule</a>() {
00144     <font class="keywordflow">return</font> m_currentModule;
00145 }
00146 
<a name="l00148"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a6">00148</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a6">CSearchDialogResultModuleView::resizeEvent</a>( QResizeEvent* e){
00149     QListView::resizeEvent(e);  
00150     header()-&gt;resize( visibleWidth(), header()-&gt;height() );
00151 }
00152 
<a name="l00154"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h0">00154</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h0">CSearchDialogResultModuleView::printSearchResult</a>(){
00155     CExportManager::printKeyList( &amp;(m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>()), m_currentModule, i18n(<font class="stringliteral">"Appending keys to the printing queue ..."</font>) );      
00156 }
00157 
<a name="l00159"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h2">00159</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h2">CSearchDialogResultModuleView::slotCopySearchResult</a>(){
00160     <font class="comment">//get the searched text</font>
00161 <font class="comment">//  QString searchedText;</font>
00162 <font class="comment">//  for (QObject* w = parent(); w; w = w-&gt;parent()) {</font>
00163 <font class="comment">//      if (w-&gt;isA("CSearchDialog")) {</font>
00164 <font class="comment">//          CSearchDialog*  dlg = (CSearchDialog*)w;</font>
00165 <font class="comment">//          searchedText = dlg-&gt;getSearchedText().stripWhiteSpace();</font>
00166 <font class="comment">//          break;</font>
00167 <font class="comment">//      }       </font>
00168 <font class="comment">//  }</font>
00169     CExportManager::copyKeyList(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule, i18n(<font class="stringliteral">"Copying search result to clipboard..."</font>), <font class="keyword">false</font>);
00170 }
00171 
<a name="l00173"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h1">00173</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h1">CSearchDialogResultModuleView::slotSaveSearchResult</a>(){
00174     <font class="comment">//get the searched text</font>
00175     QString searchedText;
00176     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00177         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00178             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = dynamic_cast&lt;CSearchDialog*&gt;(w);
00179             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00180             <font class="keywordflow">break</font>;
00181         }       
00182     }
00183     ListKey&amp; searchResult = m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>();
00184     <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>(&amp;searchResult, m_currentModule, i18n(<font class="stringliteral">"Saving the search result ..."</font>), <font class="keyword">false</font>, <font class="keyword">true</font>); 
00185 }
00186 
00187 
<a name="l00188"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h4">00188</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h4">CSearchDialogResultModuleView::slotCopySearchResultWithKeytext</a>(){
00189     <font class="comment">//get the searched text</font>
00190     QString searchedText;
00191     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00192         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00193             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = (<a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*)w;
00194             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00195             <font class="keywordflow">break</font>;
00196         }       
00197     }
00198     CExportManager::copyKeyList(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule, i18n(<font class="stringliteral">"Copying search result to clipboard..."</font>), <font class="keyword">true</font> );
00199 }
00200 
<a name="l00202"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h3">00202</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h3">CSearchDialogResultModuleView::slotSaveSearchResultWithKeytext</a>(){
00203     <font class="comment">//get the searched text</font>
00204     QString searchedText;
00205     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00206         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00207             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = (<a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*)w;
00208             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00209             <font class="keywordflow">break</font>;
00210         }       
00211     }
00212     <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule,i18n(<font class="stringliteral">"Saving the search result..."</font>), <font class="keyword">true</font>, <font class="keyword">true</font>);
00213 }
00214 
00215 <font class="comment">//------------class CSearchDialogResultView-----------//</font>
00216 CSearchDialogResultView::CSearchDialogResultView(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00217     : QListBox(parent,name),
00218     m_module(0),
00219     m_currentItem(0),   
00220     m_pressedPos()
00221 {
00222     <a class="code" href="class_c_search_dialog_result_module_view.html#a4">initView</a>();
00223     initConnections();
00224 }
00225 
00226 CSearchDialogResultView::~CSearchDialogResultView() {
00227 }
00228 
00230 <font class="keywordtype">void</font> CSearchDialogResultView::setupTree() {
00231     ListKey&amp; moduleSearchResult = m_module-&gt;searchResult();
00232     <font class="keyword">const</font> <font class="keywordtype">int</font> count = moduleSearchResult.Count();
00233         
00234     clear();    
00235     setUpdatesEnabled(<font class="keyword">false</font>);
00236     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index = 0; index &lt; count; index++) {
00237         insertItem( QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*moduleSearchResult.GetElement(index)), -1);
00238     }
00239     setUpdatesEnabled(<font class="keyword">true</font>);    
00240 }
00241 
00243 <font class="keywordtype">void</font> CSearchDialogResultView::initConnections() {
00244     connect(m_popup, SIGNAL(aboutToShow()),
00245         <font class="keyword">this</font>, SLOT(popupAboutToShow()));
00246 <font class="comment">//  connect(this, SIGNAL(pressed(QListBoxItem*)),</font>
00247 <font class="comment">//      this, SLOT(mousePressed(QListBoxItem*)));   </font>
00248         
00249     connect(<font class="keyword">this</font>, SIGNAL(currentChanged(QListBoxItem*)),
00250         <font class="keyword">this</font>, SLOT(mousePressed(QListBoxItem*)));   
00251         
00252     connect(<font class="keyword">this</font>, SIGNAL(rightButtonPressed(QListBoxItem*, <font class="keyword">const</font> QPoint&amp;)),
00253         <font class="keyword">this</font>, SLOT(rightButtonPressed(QListBoxItem*, <font class="keyword">const</font> QPoint&amp;)));
00254 }
00255 
00257 <font class="keywordtype">void</font> CSearchDialogResultView::initView(){
00258     QWhatsThis::add(<font class="keyword">this</font>, WT_SD_RESULT_RESULT_VIEW);
00259     setSelectionMode(QListBox::Extended);
00260     
00261     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);     
00262     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00263     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key"</font>), <font class="keyword">this</font>, SLOT(slotCopyCurrent()));    
00264     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(slotCopyCurrentWithKeytext()));
00265     
00266     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);     
00267     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(printItem()));
00268     
00269     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);      
00270     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Key"</font>), <font class="keyword">this</font>, SLOT(slotSaveCurrent()));
00271     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(slotSaveCurrentWithKeytext()));
00272     
00273     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY), i18n(<font class="stringliteral">"Copy..."</font>), m_copyPopup);
00274     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT),i18n(<font class="stringliteral">"Add to printing queue..."</font>),m_printPopup);
00275     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>), m_savePopup);       
00276     
00277     setFocusPolicy(QWidget::WheelFocus);
00278 }
00279 
00280 
00282 <font class="keywordtype">void</font> CSearchDialogResultView::popupAboutToShow(){
00283 }
00284 
00286 <font class="keywordtype">void</font> CSearchDialogResultView::viewportMouseMoveEvent(QMouseEvent *e){
00287 <font class="comment">//  qDebug("CSearchDialogResultView::viewportMouseMoveEvent(QMouseEvent *e)");</font>
00288     <font class="keywordflow">if</font> ( !(e-&gt;state() &amp; QMouseEvent::LeftButton) ){
00289       QListBox::viewportMouseMoveEvent(e);
00290         <font class="keywordflow">return</font>;
00291     }
00292         
00293     <font class="comment">//Is it time to start a drag?</font>
00294     <font class="keywordflow">if</font> (m_currentItem &amp;&amp; (abs(e-&gt;pos().x() - m_pressedPos.x()) &gt; KGlobalSettings::dndEventDelay() ||
00295         abs(e-&gt;pos().y() - m_pressedPos.y()) &gt; KGlobalSettings::dndEventDelay()) )
00296     {
00297         QString mod;
00298         QString ref;
00299         mod = m_module-&gt;name();
00300         ref = m_currentItem-&gt;text();
00301 
00302         QTextDrag *d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(mod,ref), viewport());
00303         <font class="keywordflow">if</font> (d){
00304             d-&gt;setSubtype(REFERENCE);
00305             d-&gt;setPixmap(REFERENCE_ICON_SMALL);
00306             d-&gt;drag();
00307             <font class="keywordflow">return</font>;
00308         }
00309     }
00310   <font class="keywordflow">else</font>
00311     QListBox::viewportMouseMoveEvent(e);
00312 }
00313 
00315 <font class="keywordtype">void</font> CSearchDialogResultView::printItem() {
00316     QPtrList&lt;QListBoxItem&gt; list = selectedItems();  
00317     <font class="keywordflow">if</font> (!list.count())
00318         <font class="keywordflow">return</font>;
00319     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00320         <a class="code" href="class_c_export_manager.html#d7">CExportManager::printKey</a>(m_module,list.current()-&gt;text(),QString::null);
00321     }
00322 }
00323 
00325 <font class="keywordtype">void</font> CSearchDialogResultView::itemChanged(QListBoxItem* item){
00326     m_currentItem = item;
00327 }
00328 
00330 <font class="keywordtype">void</font> CSearchDialogResultView::rightButtonPressed( QListBoxItem* item, <font class="keyword">const</font> QPoint&amp; p){
00331     m_currentItem = item;   
00332     <font class="keywordflow">if</font> (m_currentItem) {
00333         mousePressed(item);
00334         m_popup-&gt;popup(p);
00335     }
00336 }
00337 
00339 <font class="keywordtype">void</font> CSearchDialogResultView::mousePressed(QListBoxItem* item){
00340     qDebug(<font class="stringliteral">"CSearchDialogResultView::mousePressed(QListBoxItem* item)"</font>);
00341     <font class="keywordflow">if</font> (!( m_currentItem = item ))
00342         <font class="keywordflow">return</font>; 
00343     QString text = QString::null;
00344     
00345     <font class="comment">//we have to set the standard module view options for the module!!  </font>
00346     <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module));
00347     <font class="keywordflow">if</font> ( key ) {
00348         <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>( CBTConfig::getFilterOptionDefaults() );                
00349         key-&gt;key(item-&gt;text());
00350         emit keySelected(key-&gt;renderedText());
00351     }       
00352 }
00353 
00355 <font class="keywordtype">void</font> CSearchDialogResultView::slotCopyCurrent(){
00356     QString text;
00357     QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00358     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00359         text += list.current()-&gt;text()+<font class="stringliteral">"\n"</font>;
00360     }
00361     KApplication::clipboard()-&gt;setText(text);
00362 }
00363 
00365 <font class="keywordtype">void</font> CSearchDialogResultView::slotCopyCurrentWithKeytext(){
00366     QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00367     QString text;
00368     QString keyText, keyName;
00369     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00370         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module);
00371         <font class="keywordflow">if</font> (!key)
00372             <font class="keywordflow">continue</font>;
00373             
00374         key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(list.current()-&gt;text());
00375         keyName = key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>();
00376         keyText = key-&gt;<a class="code" href="class_c_sword_key.html#a6">strippedText</a>();
00377         
00378         <font class="keyword">delete</font> key;
00379         
00380         text += QString(<font class="stringliteral">"%1\n%2\n\n"</font>).arg(keyName).arg(keyText);
00381     }
00382     
00383     KApplication::clipboard()-&gt;setText(text);
00384 }
00385 
00387 <font class="keywordtype">void</font> CSearchDialogResultView::slotSaveCurrent(){
00388     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save key ..."</font>)); 
00389     <font class="keywordflow">if</font> (!file.isNull()) {
00390         QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00391         QString text;
00392         <font class="keywordflow">for</font> (list.first(); list.current(); list.next())
00393             text += list.current()-&gt;text()+<font class="stringliteral">"\n"</font>;
00394         <a class="code" href="class_c_tool_class.html#d3">CToolClass::savePlainFile</a>(file, text);
00395     }
00396 }
00397 
00399 <font class="keywordtype">void</font> CSearchDialogResultView::slotSaveCurrentWithKeytext(){
00400     QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00401     QString text;
00402     QString keyText, keyName;
00403     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00404         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module);
00405         <font class="keywordflow">if</font> (!key)
00406             <font class="keywordflow">continue</font>;
00407             
00408         key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(list.current()-&gt;text());
00409         keyName = key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>();
00410         keyText = key-&gt;<a class="code" href="class_c_sword_key.html#a6">strippedText</a>();
00411         
00412         <font class="keyword">delete</font> key;
00413         
00414         text += QString(<font class="stringliteral">"%1\n%2\n\n"</font>).arg(keyName).arg(keyText);
00415     }
00416     
00417     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save key ..."</font>)); 
00418     <font class="keywordflow">if</font> (!file.isNull()) {
00419         <a class="code" href="class_c_tool_class.html#d3">CToolClass::savePlainFile</a>( file, text);
00420     }
00421 }
00422 
00424 QPtrList&lt;QListBoxItem&gt; CSearchDialogResultView::selectedItems(){
00425     QPtrList&lt;QListBoxItem&gt; list;
00426     QListBoxItem* item = firstItem();
00427     <font class="keywordflow">while</font> (item) {
00428         <font class="keywordflow">if</font> (item-&gt;isSelected())
00429             list.append(item);
00430         item = item-&gt;next();
00431     }
00432     <font class="keywordflow">return</font> list;
00433 }
00434 
00436 <font class="keywordtype">void</font> CSearchDialogResultView::viewportMousePressEvent( QMouseEvent* e ){
00437     qDebug(<font class="stringliteral">"CSearchDialogResultView::viewportMousePressEvent( QMouseEvent* e )"</font>);
00438     m_pressedPos = e-&gt;pos();    
00439     QListBox::viewportMousePressEvent(e);
00440 }
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:13 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
