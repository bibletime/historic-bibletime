<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csearchdialogresultview.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csearchdialogresultview.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                   csearchdialogresultview.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Wed Jan 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//own includes</font>
00019 <font class="preprocessor">#include "csearchdialogresultview.h"</font>
00020 <font class="preprocessor">#include "csearchdialog.h"</font>
00021 
00022 <font class="preprocessor">#include "resource.h"</font>
00023 <font class="preprocessor">#include "whatsthisdef.h"</font>
00024 <font class="preprocessor">#include "tooltipdef.h"</font>
00025 
00026 <font class="preprocessor">#include "backend/cswordbiblemoduleinfo.h"</font>
00027 <font class="preprocessor">#include "backend/cswordlexiconmoduleinfo.h"</font>
00028 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00029 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00030 <font class="preprocessor">#include "backend/creferencemanager.h"</font>
00031 <font class="preprocessor">#include "backend/centrydisplay.h"</font>
00032 
00033 <font class="preprocessor">#include "frontend/cexportmanager.h"</font>
00034 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00035 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00036 
00037 <font class="preprocessor">#include "printing/cprintitem.h"</font>
00038 <font class="preprocessor">#include "printing/cprinter.h"</font>
00039 
00040 <font class="preprocessor">#include "util/scoped_resource.h"</font>
00041 
00042 <font class="comment">//QT includes</font>
00043 <font class="preprocessor">#include &lt;qlist.h&gt;</font>
00044 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00045 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00046 <font class="preprocessor">#include &lt;qmessagebox.h&gt;</font>
00047 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00048 <font class="preprocessor">#include &lt;qwidget.h&gt;</font>
00049 <font class="preprocessor">#include &lt;qclipboard.h&gt;</font>
00050 <font class="preprocessor">#include &lt;qprogressdialog.h&gt;</font>
00051 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00052 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00053 
00054 <font class="comment">//KDE includes</font>
00055 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00056 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00057 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00058 <font class="preprocessor">#include &lt;kapplication.h&gt;</font>
00059 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00060 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00061 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00062 
00063 <font class="comment">//Sword includes</font>
00064 <font class="preprocessor">#include &lt;listkey.h&gt;</font>
00065 <font class="preprocessor">#include &lt;swmodule.h&gt;</font>
00066 
00067 CSearchDialogResultModuleView::CSearchDialogResultModuleView(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00068     : QListView ( parent, name )    {   
00069     initView();
00070     adjustSize();
00071 }
00072 
00073 CSearchDialogResultModuleView::~CSearchDialogResultModuleView() {
00074     qDebug(<font class="stringliteral">"CSearchDialogResultModuleView::~CSearchDialogResultModuleView()"</font>);
00075 }
00076 
<a name="l00078"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a3">00078</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a3">CSearchDialogResultModuleView::setupTree</a>() {
00079     ListKey moduleSearchResult;
00080     QListViewItem   *module = 0;
00081 
00082     <font class="keywordflow">for</font> (moduleList.first(); moduleList.current(); moduleList.next()) {
00083         moduleSearchResult = moduleList.current()-&gt;searchResult();
00084         module = <font class="keyword">new</font> QListViewItem(<font class="keyword">this</font>, QString(<font class="stringliteral">"%1 [%2]"</font>).arg( moduleList.current()-&gt;name() ).arg( moduleSearchResult.Count() ));
00085         module-&gt;setPixmap(0,<a class="code" href="class_c_tool_class.html#d4">CToolClass::getIconForModule</a>(moduleList.current()) );
00086     }   
00087     setFixedWidth( sizeHint().width() );
00088 <font class="comment">//  resize(sizeHint());</font>
00089 }
00090 
00091 <font class="keywordtype">void</font> CSearchDialogResultModuleView::viewportMousePressEvent(QMouseEvent *e) {
00092     qDebug(<font class="stringliteral">"CSearchDialogResultModuleView::viewportMousePressEvent"</font>);
00093     QListView::viewportMousePressEvent(e);
00094 
00095     m_currentItem = (QListViewItem*)itemAt(e-&gt;pos());
00096     <font class="keywordflow">if</font> (!m_currentItem)
00097     {
00098         qDebug(<font class="stringliteral">"item is NULL"</font>);
00099         <font class="keywordflow">return</font>;
00100     }
00101     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00102             <font class="keywordflow">return</font>;
00103     <font class="keywordflow">for</font> (moduleList.first();moduleList.current();moduleList.next()){
00104         QString modName = m_currentItem-&gt;text(0);
00105         modName = modName.left( modName.find(<font class="stringliteral">" ["</font>) );
00106         m_currentModule = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(modName);
00107         <font class="keywordflow">if</font> (m_currentModule)
00108             emit <a class="code" href="class_c_search_dialog_result_module_view.html#j0">moduleSelected</a>(m_currentModule);
00109     }   
00110     <font class="keywordflow">if</font> (e-&gt;button() == RightButton)
00111         m_popup-&gt;popup( mapToGlobal(e-&gt;pos()) );
00112 }
00113 
<a name="l00115"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a4">00115</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a4">CSearchDialogResultModuleView::initView</a>(){
00116     QWhatsThis::add(<font class="keyword">this</font>, WT_SD_RESULT_MODULE_VIEW);
00117     
00118     setFocusPolicy(QWidget::WheelFocus);
00119     setAllColumnsShowFocus( <font class="keyword">true</font> );
00120     setRootIsDecorated( <font class="keyword">false</font> );
00121     addColumn( i18n( <font class="stringliteral">"Modules"</font> ), -1 );
00122     header()-&gt;hide();
00123     setSorting( -1 );
00124     
00125     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00126     
00127     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00128     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h2">slotCopySearchResult</a>())); 
00129     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h4">slotCopySearchResultWithKeytext</a>()));
00130     
00131     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);     
00132     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h0">printSearchResult</a>()));
00133     
00134     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);      
00135     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h1">slotSaveSearchResult</a>()));
00136     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h3">slotSaveSearchResultWithKeytext</a>()));
00137     
00138     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY), i18n(<font class="stringliteral">"Copy..."</font>),     m_copyPopup);
00139     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT), i18n(<font class="stringliteral">"Add to printing queue..."</font>), m_printPopup);
00140     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>),     m_savePopup);
00141 }
00142 
<a name="l00144"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a5">00144</a> <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* <a class="code" href="class_c_search_dialog_result_module_view.html#a5">CSearchDialogResultModuleView::getCurrentModule</a>() {
00145     <font class="keywordflow">return</font> m_currentModule;
00146 }
00147 
<a name="l00149"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a6">00149</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a6">CSearchDialogResultModuleView::resizeEvent</a>( QResizeEvent* e){
00150     QListView::resizeEvent(e);  
00151     header()-&gt;resize( visibleWidth(), header()-&gt;height() );
00152 }
00153 
<a name="l00155"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h0">00155</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h0">CSearchDialogResultModuleView::printSearchResult</a>(){
00156     CExportManager::printKeyList( &amp;(m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>()), m_currentModule, i18n(<font class="stringliteral">"Appending keys to the printing queue ..."</font>) );      
00157 }
00158 
<a name="l00160"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h2">00160</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h2">CSearchDialogResultModuleView::slotCopySearchResult</a>(){
00161     <font class="comment">//get the searched text</font>
00162 <font class="comment">//  QString searchedText;</font>
00163 <font class="comment">//  for (QObject* w = parent(); w; w = w-&gt;parent()) {</font>
00164 <font class="comment">//      if (w-&gt;isA("CSearchDialog")) {</font>
00165 <font class="comment">//          CSearchDialog*  dlg = (CSearchDialog*)w;</font>
00166 <font class="comment">//          searchedText = dlg-&gt;getSearchedText().stripWhiteSpace();</font>
00167 <font class="comment">//          break;</font>
00168 <font class="comment">//      }       </font>
00169 <font class="comment">//  }</font>
00170     CExportManager::copyKeyList(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule, i18n(<font class="stringliteral">"Copying search result to clipboard..."</font>), <font class="keyword">false</font>);
00171 }
00172 
<a name="l00174"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h1">00174</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h1">CSearchDialogResultModuleView::slotSaveSearchResult</a>(){
00175     <font class="comment">//get the searched text</font>
00176     QString searchedText;
00177     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00178         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00179             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = dynamic_cast&lt;CSearchDialog*&gt;(w);
00180             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00181             <font class="keywordflow">break</font>;
00182         }       
00183     }
00184     ListKey&amp; searchResult = m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>();
00185     <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>(&amp;searchResult, m_currentModule, i18n(<font class="stringliteral">"Saving the search result ..."</font>), <font class="keyword">false</font>, <font class="keyword">true</font>); 
00186 }
00187 
00188 
<a name="l00189"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h4">00189</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h4">CSearchDialogResultModuleView::slotCopySearchResultWithKeytext</a>(){
00190     <font class="comment">//get the searched text</font>
00191     QString searchedText;
00192     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00193         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00194             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = (<a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*)w;
00195             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00196             <font class="keywordflow">break</font>;
00197         }       
00198     }
00199     CExportManager::copyKeyList(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule, i18n(<font class="stringliteral">"Copying search result to clipboard..."</font>), <font class="keyword">true</font> );
00200 }
00201 
<a name="l00203"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h3">00203</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h3">CSearchDialogResultModuleView::slotSaveSearchResultWithKeytext</a>(){
00204     <font class="comment">//get the searched text</font>
00205     QString searchedText;
00206     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00207         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00208             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = (<a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*)w;
00209             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00210             <font class="keywordflow">break</font>;
00211         }       
00212     }
00213     <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule,i18n(<font class="stringliteral">"Saving the search result..."</font>), <font class="keyword">true</font>, <font class="keyword">true</font>);
00214 }
00215 
00216 <font class="comment">//------------class CSearchDialogResultView-----------//</font>
00217 CSearchDialogResultView::CSearchDialogResultView(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00218     : QListBox(parent,name),
00219     m_module(0),
00220     m_currentItem(0),   
00221     m_pressedPos()
00222 {
00223     <a class="code" href="class_c_search_dialog_result_module_view.html#a4">initView</a>();
00224     initConnections();
00225 }
00226 
00227 CSearchDialogResultView::~CSearchDialogResultView() {
00228 }
00229 
00231 <font class="keywordtype">void</font> CSearchDialogResultView::setupTree() {
00232     ListKey&amp; moduleSearchResult = m_module-&gt;searchResult();
00233     <font class="keyword">const</font> <font class="keywordtype">int</font> count = moduleSearchResult.Count();
00234         
00235     clear();    
00236     setUpdatesEnabled(<font class="keyword">false</font>);
00237     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index = 0; index &lt; count; index++) {
00238         insertItem( QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*moduleSearchResult.GetElement(index)), -1);
00239     }
00240     setUpdatesEnabled(<font class="keyword">true</font>);    
00241 }
00242 
00244 <font class="keywordtype">void</font> CSearchDialogResultView::initConnections() {
00245     connect(m_popup, SIGNAL(aboutToShow()),
00246         <font class="keyword">this</font>, SLOT(popupAboutToShow()));
00247 <font class="comment">//  connect(this, SIGNAL(pressed(QListBoxItem*)),</font>
00248 <font class="comment">//      this, SLOT(mousePressed(QListBoxItem*)));   </font>
00249         
00250     connect(<font class="keyword">this</font>, SIGNAL(currentChanged(QListBoxItem*)),
00251         <font class="keyword">this</font>, SLOT(mousePressed(QListBoxItem*)));   
00252         
00253     connect(<font class="keyword">this</font>, SIGNAL(rightButtonPressed(QListBoxItem*, <font class="keyword">const</font> QPoint&amp;)),
00254         <font class="keyword">this</font>, SLOT(rightButtonPressed(QListBoxItem*, <font class="keyword">const</font> QPoint&amp;)));
00255 }
00256 
00258 <font class="keywordtype">void</font> CSearchDialogResultView::initView(){
00259     QWhatsThis::add(<font class="keyword">this</font>, WT_SD_RESULT_RESULT_VIEW);
00260     setSelectionMode(QListBox::Extended);
00261     
00262     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);     
00263     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00264     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key"</font>), <font class="keyword">this</font>, SLOT(slotCopyCurrent()));    
00265     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(slotCopyCurrentWithKeytext()));
00266     
00267     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);     
00268     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(printItem()));
00269     
00270     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);      
00271     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Key"</font>), <font class="keyword">this</font>, SLOT(slotSaveCurrent()));
00272     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(slotSaveCurrentWithKeytext()));
00273     
00274     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY), i18n(<font class="stringliteral">"Copy..."</font>), m_copyPopup);
00275     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT),i18n(<font class="stringliteral">"Add to printing queue..."</font>),m_printPopup);
00276     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>), m_savePopup);       
00277     
00278     setFocusPolicy(QWidget::WheelFocus);
00279 }
00280 
00281 
00283 <font class="keywordtype">void</font> CSearchDialogResultView::popupAboutToShow(){
00284 }
00285 
00287 <font class="keywordtype">void</font> CSearchDialogResultView::viewportMouseMoveEvent(QMouseEvent *e){
00288 <font class="comment">//  qDebug("CSearchDialogResultView::viewportMouseMoveEvent(QMouseEvent *e)");</font>
00289     <font class="keywordflow">if</font> ( !(e-&gt;state() &amp; QMouseEvent::LeftButton) ){
00290       QListBox::viewportMouseMoveEvent(e);
00291         <font class="keywordflow">return</font>;
00292     }
00293         
00294     <font class="comment">//Is it time to start a drag?</font>
00295     <font class="keywordflow">if</font> (m_currentItem &amp;&amp; (abs(e-&gt;pos().x() - m_pressedPos.x()) &gt; KGlobalSettings::dndEventDelay() ||
00296         abs(e-&gt;pos().y() - m_pressedPos.y()) &gt; KGlobalSettings::dndEventDelay()) )
00297     {
00298         QString mod;
00299         QString ref;
00300         mod = m_module-&gt;name();
00301         ref = m_currentItem-&gt;text();
00302 
00303         QTextDrag *d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(mod,ref), viewport());
00304         <font class="keywordflow">if</font> (d){
00305             d-&gt;setSubtype(REFERENCE);
00306             d-&gt;setPixmap(REFERENCE_ICON_SMALL);
00307             d-&gt;drag();
00308             <font class="keywordflow">return</font>;
00309         }
00310     }
00311   <font class="keywordflow">else</font>
00312     QListBox::viewportMouseMoveEvent(e);
00313 }
00314 
00316 <font class="keywordtype">void</font> CSearchDialogResultView::printItem() {
00317     QPtrList&lt;QListBoxItem&gt; list = selectedItems();  
00318     <font class="keywordflow">if</font> (!list.count())
00319         <font class="keywordflow">return</font>;
00320     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00321         <a class="code" href="class_c_export_manager.html#d7">CExportManager::printKey</a>(m_module,list.current()-&gt;text(),QString::null);
00322     }
00323 }
00324 
00326 <font class="keywordtype">void</font> CSearchDialogResultView::itemChanged(QListBoxItem* item){
00327     m_currentItem = item;
00328 }
00329 
00331 <font class="keywordtype">void</font> CSearchDialogResultView::rightButtonPressed( QListBoxItem* item, <font class="keyword">const</font> QPoint&amp; p){
00332     m_currentItem = item;   
00333     <font class="keywordflow">if</font> (m_currentItem) {
00334         mousePressed(item);
00335         m_popup-&gt;popup(p);
00336     }
00337 }
00338 
00340 <font class="keywordtype">void</font> CSearchDialogResultView::mousePressed(QListBoxItem* item){
00341     qDebug(<font class="stringliteral">"CSearchDialogResultView::mousePressed(QListBoxItem* item)"</font>);
00342     <font class="keywordflow">if</font> (!( m_currentItem = item ))
00343         <font class="keywordflow">return</font>; 
00344     QString text = QString::null;
00345     
00346     <font class="comment">//we have to set the standard module view options for the module!!  </font>
00347 
00348     <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module));
00349     <font class="keywordflow">if</font> ( key ) {
00350         key-&gt;key(item-&gt;text());
00351 
00352     <a class="code" href="class_c_entry_display.html">CEntryDisplay</a>* display = m_module-&gt;getDisplay();
00353     <font class="keyword">const</font> QString text = display-&gt;<a class="code" href="class_c_entry_display.html#a3">previewText</a>(m_module,key-&gt;key(), QString::fromLatin1(<font class="stringliteral">"&lt;B&gt;%1&lt;/B&gt; (%2)"</font>).arg(m_module-&gt;name()).arg(m_module-&gt;config(CSwordModuleInfo::Description)));
00354         emit newPreviewText(text);
00355     }       
00356 }
00357 
00359 <font class="keywordtype">void</font> CSearchDialogResultView::slotCopyCurrent(){
00360     QString text;
00361     QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00362     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00363         text += list.current()-&gt;text()+<font class="stringliteral">"\n"</font>;
00364     }
00365     KApplication::clipboard()-&gt;setText(text);
00366 }
00367 
00369 <font class="keywordtype">void</font> CSearchDialogResultView::slotCopyCurrentWithKeytext(){
00370     QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00371     QString text;
00372     QString keyText, keyName;
00373     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00374         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module);
00375         <font class="keywordflow">if</font> (!key)
00376             <font class="keywordflow">continue</font>;
00377             
00378         key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(list.current()-&gt;text());
00379         keyName = key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>();
00380         keyText = key-&gt;<a class="code" href="class_c_sword_key.html#a7">strippedText</a>();
00381         
00382         <font class="keyword">delete</font> key;
00383         
00384         text += QString(<font class="stringliteral">"%1\n%2\n\n"</font>).arg(keyName).arg(keyText);
00385     }
00386     
00387     KApplication::clipboard()-&gt;setText(text);
00388 }
00389 
00391 <font class="keywordtype">void</font> CSearchDialogResultView::slotSaveCurrent(){
00392     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save key ..."</font>)); 
00393     <font class="keywordflow">if</font> (!file.isNull()) {
00394         QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00395         QString text;
00396         <font class="keywordflow">for</font> (list.first(); list.current(); list.next())
00397             text += list.current()-&gt;text()+<font class="stringliteral">"\n"</font>;
00398         <a class="code" href="class_c_tool_class.html#d3">CToolClass::savePlainFile</a>(file, text);
00399     }
00400 }
00401 
00403 <font class="keywordtype">void</font> CSearchDialogResultView::slotSaveCurrentWithKeytext(){
00404     QPtrList&lt;QListBoxItem&gt; list = selectedItems();
00405     QString text;
00406     QString keyText, keyName;
00407     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00408         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module);
00409         <font class="keywordflow">if</font> (!key)
00410             <font class="keywordflow">continue</font>;
00411             
00412         key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(list.current()-&gt;text());
00413         keyName = key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>();
00414         keyText = key-&gt;<a class="code" href="class_c_sword_key.html#a7">strippedText</a>();
00415         
00416         <font class="keyword">delete</font> key;
00417         
00418         text += QString(<font class="stringliteral">"%1\n%2\n\n"</font>).arg(keyName).arg(keyText);
00419     }
00420     
00421     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save key ..."</font>)); 
00422     <font class="keywordflow">if</font> (!file.isNull()) {
00423         <a class="code" href="class_c_tool_class.html#d3">CToolClass::savePlainFile</a>( file, text);
00424     }
00425 }
00426 
00428 QPtrList&lt;QListBoxItem&gt; CSearchDialogResultView::selectedItems(){
00429     QPtrList&lt;QListBoxItem&gt; list;
00430     QListBoxItem* item = firstItem();
00431     <font class="keywordflow">while</font> (item) {
00432         <font class="keywordflow">if</font> (item-&gt;isSelected())
00433             list.append(item);
00434         item = item-&gt;next();
00435     }
00436     <font class="keywordflow">return</font> list;
00437 }
00438 
00440 <font class="keywordtype">void</font> CSearchDialogResultView::viewportMousePressEvent( QMouseEvent* e ){
00441     qDebug(<font class="stringliteral">"CSearchDialogResultView::viewportMousePressEvent( QMouseEvent* e )"</font>);
00442     m_pressedPos = e-&gt;pos();    
00443     QListBox::viewportMousePressEvent(e);
00444 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:09 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
