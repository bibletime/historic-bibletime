<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csearchdialogresultview.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csearchdialogresultview.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                   csearchdialogresultview.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Wed Jan 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//own includes</font>
00019 <font class="preprocessor">#include "csearchdialogresultview.h"</font>
00020 <font class="preprocessor">#include "csearchdialog.h"</font>
00021 <font class="preprocessor">#include "../../resource.h"</font>
00022 <font class="preprocessor">#include "../../whatsthisdef.h"</font>
00023 <font class="preprocessor">#include "../../tooltipdef.h"</font>
00024 <font class="preprocessor">#include "../../backend/cswordbiblemoduleinfo.h"</font>
00025 <font class="preprocessor">#include "../../backend/cswordlexiconmoduleinfo.h"</font>
00026 <font class="preprocessor">#include "../../backend/cswordversekey.h"</font>
00027 <font class="preprocessor">#include "../../backend/cswordldkey.h"</font>
00028 <font class="preprocessor">#include "../../backend/creferencemanager.h"</font>
00029 <font class="preprocessor">#include "../cexportmanager.h"</font>
00030 <font class="preprocessor">#include "../ctoolclass.h"</font>
00031 <font class="preprocessor">#include "../cbtconfig.h"</font>
00032 <font class="preprocessor">#include "../../printing/cprintitem.h"</font>
00033 <font class="preprocessor">#include "../../printing/cprinter.h"</font>
00034 
00035 <font class="preprocessor">#include "../../util/scoped_resource.h"</font>
00036 
00037 <font class="comment">//QT includes</font>
00038 <font class="preprocessor">#include &lt;qlist.h&gt;</font>
00039 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00040 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00041 <font class="preprocessor">#include &lt;qmessagebox.h&gt;</font>
00042 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00043 <font class="preprocessor">#include &lt;qwidget.h&gt;</font>
00044 <font class="preprocessor">#include &lt;qclipboard.h&gt;</font>
00045 <font class="preprocessor">#include &lt;qprogressdialog.h&gt;</font>
00046 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00047 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00048 
00049 <font class="comment">//KDE includes</font>
00050 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00051 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00052 <font class="preprocessor">#include &lt;kstddirs.h&gt;</font>
00053 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00054 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00055 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00056 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00057 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00058 
00059 <font class="comment">//Sword includes</font>
00060 <font class="preprocessor">#include &lt;listkey.h&gt;</font>
00061 <font class="preprocessor">#include &lt;swmodule.h&gt;</font>
00062 
00063 CSearchDialogResultModuleView::CSearchDialogResultModuleView(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00064     : QListView ( parent, name )    {   
00065     initView();
00066     adjustSize();
00067 }
00068 
00069 CSearchDialogResultModuleView::~CSearchDialogResultModuleView() {
00070     qDebug(<font class="stringliteral">"CSearchDialogResultModuleView::~CSearchDialogResultModuleView()"</font>);
00071 }
00072 
<a name="l00074"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a3">00074</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a3">CSearchDialogResultModuleView::setupTree</a>() {
00075     ListKey moduleSearchResult;
00076     QListViewItem   *module = 0;
00077 
00078     <font class="keywordflow">for</font> (moduleList.first(); moduleList.current(); moduleList.next()) {
00079         moduleSearchResult = moduleList.current()-&gt;searchResult();
00080         module = <font class="keyword">new</font> QListViewItem(<font class="keyword">this</font>, QString(<font class="stringliteral">"%1 [%2]"</font>).arg( moduleList.current()-&gt;name() ).arg( moduleSearchResult.Count() ));
00081         module-&gt;setPixmap(0,<a class="code" href="class_c_tool_class.html#d5">CToolClass::getIconForModule</a>(moduleList.current()) );
00082     }   
00083     setFixedWidth( sizeHint().width() );
00084 <font class="comment">//  resize(sizeHint());</font>
00085 }
00086 
00087 <font class="keywordtype">void</font> CSearchDialogResultModuleView::viewportMousePressEvent(QMouseEvent *e) {
00088     qDebug(<font class="stringliteral">"CSearchDialogResultModuleView::viewportMousePressEvent"</font>);
00089     QListView::viewportMousePressEvent(e);
00090 
00091     m_currentItem = (QListViewItem*)itemAt(e-&gt;pos());
00092     <font class="keywordflow">if</font> (!m_currentItem)
00093     {
00094         qDebug(<font class="stringliteral">"item is NULL"</font>);
00095         <font class="keywordflow">return</font>;
00096     }
00097     <font class="keywordflow">if</font> ((e-&gt;state() &amp; ControlButton) || (e-&gt;state() &amp; ShiftButton))
00098             <font class="keywordflow">return</font>;
00099     <font class="keywordflow">for</font> (moduleList.first();moduleList.current();moduleList.next()){
00100         QString modName = m_currentItem-&gt;text(0);
00101         modName = modName.left( modName.find(<font class="stringliteral">" ["</font>) );
00102         m_currentModule = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(modName);
00103         <font class="keywordflow">if</font> (m_currentModule)
00104             emit <a class="code" href="class_c_search_dialog_result_module_view.html#j0">moduleSelected</a>(m_currentModule);
00105     }   
00106     <font class="keywordflow">if</font> (e-&gt;button() == RightButton)
00107         m_popup-&gt;popup( mapToGlobal(e-&gt;pos()) );
00108 }
00109 
<a name="l00111"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a4">00111</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a4">CSearchDialogResultModuleView::initView</a>(){
00112     QWhatsThis::add(<font class="keyword">this</font>, WT_SD_RESULT_MODULE_VIEW);
00113     
00114     setFocusPolicy(QWidget::WheelFocus);
00115     setAllColumnsShowFocus( <font class="keyword">true</font> );
00116     setRootIsDecorated( <font class="keyword">false</font> );
00117     addColumn( i18n( <font class="stringliteral">"Modules"</font> ), -1 );
00118     header()-&gt;hide();
00119     setSorting( -1 );
00120     
00121     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);
00122     
00123     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00124     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h2">slotCopySearchResult</a>())); 
00125     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h4">slotCopySearchResultWithKeytext</a>()));
00126     
00127     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);     
00128     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h0">printSearchResult</a>()));
00129     
00130     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);      
00131     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h1">slotSaveSearchResult</a>()));
00132     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Search result with text"</font>), <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_search_dialog_result_module_view.html#h3">slotSaveSearchResultWithKeytext</a>()));
00133     
00134     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY), i18n(<font class="stringliteral">"Copy..."</font>),     m_copyPopup);
00135     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT), i18n(<font class="stringliteral">"Add to printing queue..."</font>), m_printPopup);
00136     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>),     m_savePopup);
00137 }
00138 
<a name="l00140"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a5">00140</a> <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* <a class="code" href="class_c_search_dialog_result_module_view.html#a5">CSearchDialogResultModuleView::getCurrentModule</a>() {
00141     <font class="keywordflow">return</font> m_currentModule;
00142 }
00143 
<a name="l00145"></a><a class="code" href="class_c_search_dialog_result_module_view.html#a6">00145</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#a6">CSearchDialogResultModuleView::resizeEvent</a>( QResizeEvent* e){
00146     QListView::resizeEvent(e);  
00147     header()-&gt;resize( visibleWidth(), header()-&gt;height() );
00148 }
00149 
<a name="l00151"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h0">00151</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h0">CSearchDialogResultModuleView::printSearchResult</a>(){
00152     CExportManager::printKeyList( &amp;(m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>()), m_currentModule, i18n(<font class="stringliteral">"Appending keys to the printing queue ..."</font>) );      
00153 }
00154 
<a name="l00156"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h2">00156</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h2">CSearchDialogResultModuleView::slotCopySearchResult</a>(){
00157     <font class="comment">//get the searched text</font>
00158 <font class="comment">//  QString searchedText;</font>
00159 <font class="comment">//  for (QObject* w = parent(); w; w = w-&gt;parent()) {</font>
00160 <font class="comment">//      if (w-&gt;isA("CSearchDialog")) {</font>
00161 <font class="comment">//          CSearchDialog*  dlg = (CSearchDialog*)w;</font>
00162 <font class="comment">//          searchedText = dlg-&gt;getSearchedText().stripWhiteSpace();</font>
00163 <font class="comment">//          break;</font>
00164 <font class="comment">//      }       </font>
00165 <font class="comment">//  }</font>
00166     CExportManager::copyKeyList(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule, i18n(<font class="stringliteral">"Copying search result to clipboard..."</font>), <font class="keyword">false</font>);
00167 }
00168 
<a name="l00170"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h1">00170</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h1">CSearchDialogResultModuleView::slotSaveSearchResult</a>(){
00171     <font class="comment">//get the searched text</font>
00172     QString searchedText;
00173     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00174         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00175             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = dynamic_cast&lt;CSearchDialog*&gt;(w);
00176             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00177             <font class="keywordflow">break</font>;
00178         }       
00179     }
00180     ListKey&amp; searchResult = m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>();
00181     <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>(&amp;searchResult, m_currentModule, i18n(<font class="stringliteral">"Saving the search result ..."</font>), <font class="keyword">false</font>, <font class="keyword">true</font>); 
00182 }
00183 
00184 
<a name="l00185"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h4">00185</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h4">CSearchDialogResultModuleView::slotCopySearchResultWithKeytext</a>(){
00186     <font class="comment">//get the searched text</font>
00187     QString searchedText;
00188     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00189         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00190             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = (<a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*)w;
00191             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00192             <font class="keywordflow">break</font>;
00193         }       
00194     }
00195     CExportManager::copyKeyList(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule, i18n(<font class="stringliteral">"Copying search result to clipboard..."</font>), <font class="keyword">true</font> );
00196 }
00197 
<a name="l00199"></a><a class="code" href="class_c_search_dialog_result_module_view.html#h3">00199</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_result_module_view.html#h3">CSearchDialogResultModuleView::slotSaveSearchResultWithKeytext</a>(){
00200     <font class="comment">//get the searched text</font>
00201     QString searchedText;
00202     <font class="keywordflow">for</font> (QObject* w = parent(); w; w = w-&gt;parent()) {
00203         <font class="keywordflow">if</font> (w-&gt;isA(<font class="stringliteral">"CSearchDialog"</font>)) {
00204             <a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*  dlg = (<a class="code" href="class_c_search_dialog.html">CSearchDialog</a>*)w;
00205             searchedText = dlg-&gt;<a class="code" href="class_c_search_dialog.html#a5">getSearchedText</a>().stripWhiteSpace();
00206             <font class="keywordflow">break</font>;
00207         }       
00208     }
00209     <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>(&amp;m_currentModule-&gt;<a class="code" href="class_c_sword_module_info.html#a12">searchResult</a>(), m_currentModule,i18n(<font class="stringliteral">"Saving the search result..."</font>), <font class="keyword">true</font>, <font class="keyword">true</font>);
00210 }
00211 
00212 <font class="comment">//------------class CSearchDialogResultView-----------//</font>
00213 CSearchDialogResultView::CSearchDialogResultView(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00214     : QListBox(parent,name),
00215     m_currentItem(0),
00216     m_module(0),
00217     m_pressedPos()
00218 {
00219     <a class="code" href="class_c_search_dialog_result_module_view.html#a4">initView</a>();
00220     initConnections();
00221 }
00222 
00223 CSearchDialogResultView::~CSearchDialogResultView() {
00224     qDebug(<font class="stringliteral">"CSearchDialogResultView::~CSearchDialogResultView()"</font>);
00225 }
00226 
00228 <font class="keywordtype">void</font> CSearchDialogResultView::setupTree() {
00229     ListKey&amp; moduleSearchResult = m_module-&gt;searchResult();
00230     <font class="keyword">const</font> <font class="keywordtype">int</font> count = moduleSearchResult.Count();
00231         
00232     clear();    
00233     setUpdatesEnabled(<font class="keyword">false</font>);
00234     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index = 0; index &lt; count; index++) {
00235         insertItem( QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*moduleSearchResult.GetElement(index)), -1);
00236     }
00237     setUpdatesEnabled(<font class="keyword">true</font>);    
00238 }
00239 
00241 <font class="keywordtype">void</font> CSearchDialogResultView::initConnections() {
00242     connect(m_popup, SIGNAL(aboutToShow()),
00243         <font class="keyword">this</font>, SLOT(popupAboutToShow()));
00244 <font class="comment">//  connect(this, SIGNAL(pressed(QListBoxItem*)),</font>
00245 <font class="comment">//      this, SLOT(mousePressed(QListBoxItem*)));   </font>
00246         
00247     connect(<font class="keyword">this</font>, SIGNAL(currentChanged(QListBoxItem*)),
00248         <font class="keyword">this</font>, SLOT(mousePressed(QListBoxItem*)));   
00249         
00250     connect(<font class="keyword">this</font>, SIGNAL(rightButtonPressed(QListBoxItem*, <font class="keyword">const</font> QPoint&amp;)),
00251         <font class="keyword">this</font>, SLOT(rightButtonPressed(QListBoxItem*, <font class="keyword">const</font> QPoint&amp;)));
00252 }
00253 
00255 <font class="keywordtype">void</font> CSearchDialogResultView::initView(){
00256     QWhatsThis::add(<font class="keyword">this</font>, WT_SD_RESULT_RESULT_VIEW);
00257     setSelectionMode(QListBox::Extended);
00258     
00259     m_popup = <font class="keyword">new</font> KPopupMenu(<font class="keyword">this</font>);     
00260     m_copyPopup = <font class="keyword">new</font> KPopupMenu(m_popup);  
00261     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key"</font>), <font class="keyword">this</font>, SLOT(slotCopyCurrent()));    
00262     m_copyPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(slotCopyCurrentWithKeytext()));
00263     
00264     m_printPopup = <font class="keyword">new</font> KPopupMenu(m_popup);     
00265     m_printPopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(printItem()));
00266     
00267     m_savePopup = <font class="keyword">new</font> KPopupMenu(m_popup);      
00268     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Key"</font>), <font class="keyword">this</font>, SLOT(slotSaveCurrent()));
00269     m_savePopup-&gt;insertItem(i18n(<font class="stringliteral">"Key with text"</font>), <font class="keyword">this</font>, SLOT(slotSaveCurrentWithKeytext()));
00270     
00271     m_popup-&gt;insertItem(SmallIcon(ICON_EDIT_COPY), i18n(<font class="stringliteral">"Copy..."</font>), m_copyPopup);
00272     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_PRINT),i18n(<font class="stringliteral">"Add to printing queue..."</font>),m_printPopup);
00273     m_popup-&gt;insertItem(SmallIcon(ICON_FILE_SAVE), i18n(<font class="stringliteral">"Save..."</font>), m_savePopup);       
00274     
00275     setFocusPolicy(QWidget::WheelFocus);
00276 }
00277 
00278 
00280 <font class="keywordtype">void</font> CSearchDialogResultView::popupAboutToShow(){
00281 }
00282 
00284 <font class="keywordtype">void</font> CSearchDialogResultView::viewportMouseMoveEvent(QMouseEvent *e){
00285 <font class="comment">//  qDebug("CSearchDialogResultView::viewportMouseMoveEvent(QMouseEvent *e)");</font>
00286     <font class="keywordflow">if</font> ( !(e-&gt;state() &amp; QMouseEvent::LeftButton) ){
00287       QListBox::viewportMouseMoveEvent(e);
00288         <font class="keywordflow">return</font>;
00289     }
00290         
00291     <font class="comment">//Is it time to start a drag?</font>
00292     <font class="keywordflow">if</font> (m_currentItem &amp;&amp; (abs(e-&gt;pos().x() - m_pressedPos.x()) &gt; KGlobalSettings::dndEventDelay() ||
00293         abs(e-&gt;pos().y() - m_pressedPos.y()) &gt; KGlobalSettings::dndEventDelay()) )
00294     {
00295         QString mod;
00296         QString ref;
00297         mod = m_module-&gt;name();
00298         ref = m_currentItem-&gt;text();
00299 
00300         QTextDrag *d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(mod,ref), viewport());
00301         <font class="keywordflow">if</font> (d){
00302             d-&gt;setSubtype(REFERENCE);
00303             d-&gt;setPixmap(REFERENCE_ICON_SMALL);
00304             d-&gt;drag();
00305             <font class="keywordflow">return</font>;
00306         }
00307     }
00308   <font class="keywordflow">else</font>
00309     QListBox::viewportMouseMoveEvent(e);
00310 }
00311 
00313 <font class="keywordtype">void</font> CSearchDialogResultView::printItem() {
00314     QList&lt;QListBoxItem&gt; list = selectedItems(); 
00315     <font class="keywordflow">if</font> (!list.count())
00316         <font class="keywordflow">return</font>;
00317     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00318         CExportManager::printKey(m_module,list.current()-&gt;text(),QString::null);
00319     }
00320 }
00321 
00323 <font class="keywordtype">void</font> CSearchDialogResultView::itemChanged(QListBoxItem* item){
00324     m_currentItem = item;
00325 }
00326 
00328 <font class="keywordtype">void</font> CSearchDialogResultView::rightButtonPressed( QListBoxItem* item, <font class="keyword">const</font> QPoint&amp; p){
00329     m_currentItem = item;   
00330     <font class="keywordflow">if</font> (m_currentItem) {
00331         mousePressed(item);
00332         m_popup-&gt;popup(p);
00333     }
00334 }
00335 
00337 <font class="keywordtype">void</font> CSearchDialogResultView::mousePressed(QListBoxItem* item){
00338     qDebug(<font class="stringliteral">"CSearchDialogResultView::mousePressed(QListBoxItem* item)"</font>);
00339     <font class="keywordflow">if</font> (!( m_currentItem = item ))
00340         <font class="keywordflow">return</font>; 
00341     QString text = QString::null;
00342     
00343     <font class="comment">//we have to set the standard module view options for the module!!  </font>
00344     <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module));
00345     <font class="keywordflow">if</font> ( key ) {
00346         <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>( CBTConfig::getFilterOptionDefaults() );                
00347         key-&gt;key(item-&gt;text());
00348         emit keySelected(key-&gt;renderedText());
00349     }       
00350 }
00351 
00353 <font class="keywordtype">void</font> CSearchDialogResultView::slotCopyCurrent(){
00354     QString text;
00355     QList&lt;QListBoxItem&gt; list = selectedItems();
00356     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00357         text += list.current()-&gt;text()+<font class="stringliteral">"\n"</font>;
00358     }
00359     KApplication::clipboard()-&gt;setText(text);
00360 }
00361 
00363 <font class="keywordtype">void</font> CSearchDialogResultView::slotCopyCurrentWithKeytext(){
00364     QList&lt;QListBoxItem&gt; list = selectedItems();
00365     QString text;
00366     QString keyText, keyName;
00367     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00368         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module);
00369         <font class="keywordflow">if</font> (!key)
00370             <font class="keywordflow">continue</font>;
00371             
00372         key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(list.current()-&gt;text());
00373         keyName = key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>();
00374         keyText = key-&gt;<a class="code" href="class_c_sword_key.html#a6">strippedText</a>();
00375         
00376         <font class="keyword">delete</font> key;
00377         
00378         text += QString(<font class="stringliteral">"%1\n%2\n\n"</font>).arg(keyName).arg(keyText);
00379     }
00380     
00381     KApplication::clipboard()-&gt;setText(text);
00382 }
00383 
00385 <font class="keywordtype">void</font> CSearchDialogResultView::slotSaveCurrent(){
00386     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save key ..."</font>)); 
00387     <font class="keywordflow">if</font> (!file.isNull()) {
00388         QList&lt;QListBoxItem&gt; list = selectedItems();
00389         QString text;
00390         <font class="keywordflow">for</font> (list.first(); list.current(); list.next())
00391             text += list.current()-&gt;text()+<font class="stringliteral">"\n"</font>;
00392         <a class="code" href="class_c_tool_class.html#d4">CToolClass::savePlainFile</a>(file, text);
00393     }
00394 }
00395 
00397 <font class="keywordtype">void</font> CSearchDialogResultView::slotSaveCurrentWithKeytext(){
00398     QList&lt;QListBoxItem&gt; list = selectedItems();
00399     QString text;
00400     QString keyText, keyName;
00401     <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00402         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module);
00403         <font class="keywordflow">if</font> (!key)
00404             <font class="keywordflow">continue</font>;
00405             
00406         key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(list.current()-&gt;text());
00407         keyName = key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>();
00408         keyText = key-&gt;<a class="code" href="class_c_sword_key.html#a6">strippedText</a>();
00409         
00410         <font class="keyword">delete</font> key;
00411         
00412         text += QString(<font class="stringliteral">"%1\n%2\n\n"</font>).arg(keyName).arg(keyText);
00413     }
00414     
00415     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save key ..."</font>)); 
00416     <font class="keywordflow">if</font> (!file.isNull()) {
00417         <a class="code" href="class_c_tool_class.html#d4">CToolClass::savePlainFile</a>( file, text);
00418     }
00419 }
00420 
00422 QList&lt;QListBoxItem&gt; CSearchDialogResultView::selectedItems(){
00423     QList&lt;QListBoxItem&gt; list;
00424     QListBoxItem* item = firstItem();
00425     <font class="keywordflow">while</font> (item) {
00426         <font class="keywordflow">if</font> (item-&gt;selected())
00427             list.append(item);
00428         item = item-&gt;next();
00429     }
00430     <font class="keywordflow">return</font> list;
00431 }
00432 
00434 <font class="keywordtype">void</font> CSearchDialogResultView::viewportMousePressEvent( QMouseEvent* e ){
00435     qDebug(<font class="stringliteral">"CSearchDialogResultView::viewportMousePressEvent( QMouseEvent* e )"</font>);
00436     m_pressedPos = e-&gt;pos();    
00437     QListBox::viewportMousePressEvent(e);
00438 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:47 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
