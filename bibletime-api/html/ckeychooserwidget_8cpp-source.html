<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ckeychooserwidget.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>ckeychooserwidget.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          ckeychooserwidget.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Tue Sep 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 <font class="comment">//BibleTime includes</font>
00018 <font class="preprocessor">#include "ckeychooserwidget.h"</font>
00019 <font class="preprocessor">#include "cfx_btn.h"</font>
00020 <font class="preprocessor">#include "../cbtconfig.h"</font>
00021 
00022 <font class="comment">//Qt includes</font>
00023 <font class="preprocessor">#include &lt;qlineedit.h&gt;</font>
00024 <font class="preprocessor">#include &lt;qstring.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00026 <font class="preprocessor">#include &lt;qlistbox.h&gt;</font>
00027 <font class="preprocessor">#include &lt;qtoolbutton.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00029 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qpainter.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qstyle.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qpixmap.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qapplication.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qrect.h&gt;</font>
00037 
00038 <font class="preprocessor">#define WIDTH 16</font>
00039 <font class="preprocessor"></font><font class="preprocessor">#define ARROW_HEIGHT 10</font>
00040 <font class="preprocessor"></font><font class="preprocessor">#define MOVER_HEIGHT 4</font>
00041 <font class="preprocessor"></font>
00042 CKCComboBox::CKCComboBox(<font class="keywordtype">bool</font> rw,QWidget* parent,<font class="keyword">const</font> <font class="keywordtype">char</font>* name)
00043   : QComboBox(rw,parent,name){
00044     setFocusPolicy(QWidget::WheelFocus);
00045   <font class="keywordflow">if</font> (lineEdit()) {
00046     installEventFilter( lineEdit() );
00047   }
00048 }
00049 
00051 <font class="keywordtype">bool</font> CKCComboBox::eventFilter( QObject *o, QEvent *e ){         
00052 <font class="comment">//  qWarning("CKCComboBox::eventFilter( QObject *o, QEvent *e )");</font>
00053     <font class="keywordflow">if</font> (e-&gt;type() == QEvent::FocusOut) {
00054         QFocusEvent* f = static_cast&lt;QFocusEvent*&gt;(e);
00055 <font class="comment">//      qWarning("FocusOut: %d", f-&gt;reason());</font>
00056 <font class="comment">//      qWarning("Mouse: %d",(f-&gt;reason()==QFocusEvent::Mouse)?1:0);</font>
00057 <font class="comment">//    qWarning("lineedit: %d",(o == lineEdit())?1:0);</font>
00058 <font class="comment">//    qWarning("listbox: %d",(o == listBox())?1:0);</font>
00059 <font class="comment">//    qWarning("this: %d",(o == this)?1:0);</font>
00060 
00061         
00062         <font class="keywordflow">if</font> (o == lineEdit() &amp;&amp; f-&gt;reason() == QFocusEvent::Tab) {
00063         <font class="keywordtype">int</font> index = listBox()-&gt;index( listBox()-&gt;findItem(currentText()) );
00064         <font class="keywordflow">if</font> (index == -1)
00065                 index = 0;<font class="comment">// return 0 if not found</font>
00066         setCurrentItem( index );    
00067         emit focusOut( index );     
00068       }
00069       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp;*/</font> f-&gt;reason() == QFocusEvent::Popup) {
00070             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00071         }
00072       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp; */</font>f-&gt;reason() == QFocusEvent::ActiveWindow) {
00073             emit activated(currentText());
00074             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00075         }
00076       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp;*/</font> f-&gt;reason() == QFocusEvent::Mouse) {
00077             emit activated(currentText());
00078             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00079         }       
00080       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (o == listBox()) {  <font class="comment">//???</font>
00081             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00082         }
00083       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (o == <font class="keyword">this</font>) {
00084             emit activated(currentText());
00085             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00086         }       
00087     }
00088 <font class="comment">//  qWarning("not handled!");</font>
00089   <font class="keywordflow">return</font> QComboBox::eventFilter(o,e);   
00090 }
00091 
00093 <font class="keywordtype">void</font> CKCComboBox::wheelEvent( QWheelEvent* e ) {
00094     <font class="keyword">const</font> <font class="keywordtype">signed</font> <font class="keywordtype">int</font> change = (int)((float)e-&gt;delta()/(float)120);
00095     <font class="keywordtype">int</font> current = currentItem();
00096     
00097     <font class="keywordflow">if</font> ((current+change &gt;= 0) &amp;&amp; (current+change&lt;count()) ) {
00098         setCurrentItem(current+change);
00099         e-&gt;accept();
00100         emit activated( currentItem() );
00101     }
00102     <font class="keywordflow">else</font> {
00103         e-&gt;ignore();
00104     }
00105 }
00106 
00108 <font class="comment">//QSize CKCComboBox::sizeHint() const {</font>
00109 <font class="comment">//  // IMHO Qt has a bug: The sizehint is not updated if the list is refreshed with other items</font>
00110 <font class="comment">//  const QSize oldSize = QComboBox::sizeHint();</font>
00111 <font class="comment">//  QRect contentsRect = style().querySubControlMetrics( QStyle::CC_ComboBox , this, QStyle::SC_ComboBoxArrow);</font>
00113 <font class="comment">//  const int buttonWidth = (oldSize.width() - contentsRect.width());</font>
00114 <font class="comment">//</font>
00115 <font class="comment">//  if (listBox())  {</font>
00116 <font class="comment">//      return QSize( listBox()-&gt;sizeHint().width()+buttonWidth, QComboBox::sizeHint().height());</font>
00117 <font class="comment">//  }</font>
00118 <font class="comment">//  else {</font>
00119 <font class="comment">//      return QSize( QComboBox::sizeHint().width()+buttonWidth, QComboBox::sizeHint().height());   </font>
00120 <font class="comment">//  }</font>
00121 <font class="comment">//}</font>
00122 
00123 
00124 <font class="comment">//**********************************************************************************/</font>
00125 
<a name="l00126"></a><a class="code" href="class_c_key_chooser_widget.html#a1">00126</a> <a class="code" href="class_c_key_chooser_widget.html#a0">CKeyChooserWidget::CKeyChooserWidget</a>(<font class="keywordtype">int</font> count, <font class="keyword">const</font> <font class="keywordtype">bool</font> useNextPrevSignals,  QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name) : QWidget(parent,name) {
00127     m_useNextPrevSignals = useNextPrevSignals;
00128     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index=1; index &lt;= count; index++)
00129         m_list.append( QString::number(index) );    
00130     <a class="code" href="class_c_key_chooser_widget.html#a5">init</a>();
00131     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(m_list,0,<font class="keyword">false</font>);
00132 };
00133 
<a name="l00134"></a><a class="code" href="class_c_key_chooser_widget.html#a0">00134</a> <a class="code" href="class_c_key_chooser_widget.html#a0">CKeyChooserWidget::CKeyChooserWidget</a>(QStringList *list, <font class="keyword">const</font> <font class="keywordtype">bool</font> useNextPrevSignals, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : QWidget(parent,name) {
00135     m_useNextPrevSignals = useNextPrevSignals;      
00136     <font class="keywordflow">if</font> (list)
00137         m_list = *list;<font class="comment">//copy the items of list</font>
00138     <font class="keywordflow">else</font>
00139         m_list.clear();
00140     <a class="code" href="class_c_key_chooser_widget.html#a5">init</a>();
00141     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(m_list,0,<font class="keyword">false</font>);  
00142 }
00143 
<a name="l00144"></a><a class="code" href="class_c_key_chooser_widget.html#g2">00144</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g2">CKeyChooserWidget::changeCombo</a>(<font class="keywordtype">int</font> i){
00145     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00146         <font class="keywordflow">return</font>;
00147     setUpdatesEnabled(<font class="keyword">false</font>);
00148     
00149     <font class="keywordtype">int</font> current = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem();
00150 
00151     <font class="comment">//index of highest Item</font>
00152     <font class="keyword">const</font> <font class="keywordtype">int</font> count = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count()-1;
00153     <font class="keywordtype">int</font> j = current + i;
00154     <font class="keywordflow">if</font> (i &gt; 0){
00155         <font class="keywordflow">if</font> (j &lt;= count)
00156             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(j);
00157         <font class="keywordflow">else</font>
00158             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(count);
00159     }
00160     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (i &lt; 0){
00161         <font class="keywordflow">if</font> (j&gt;=0)
00162             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(j);
00163         <font class="keywordflow">else</font>
00164             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(0);
00165     }   
00166     <font class="keywordflow">if</font> (!<a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> &amp;&amp; !btn_fx-&gt;<a class="code" href="classcfx__btn.html#a1">isLocked</a>() &amp;&amp; (current != <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()))  
00167         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00168         
00169     setUpdatesEnabled(<font class="keyword">true</font>);        
00170 }
00171 
<a name="l00172"></a><a class="code" href="class_c_key_chooser_widget.html#a2">00172</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(<font class="keyword">const</font> <font class="keywordtype">int</font> count, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00173 <font class="comment">//  qWarning("CKeyChooserWidget::reset(const int count, int index, bool do_emit)");</font>
00174     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00175         <font class="keywordflow">return</font>;
00176 
00177     m_list.clear();
00178     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i &lt;= count; i++)
00179         m_list.append( QString::number(i) );
00180     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(&amp;m_list,index,do_emit);
00181 }
00182 
00183 <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(QStringList&amp; list, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00184     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00185         <font class="keywordflow">return</font>;
00186     
00187     m_list = list;
00188     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(&amp;m_list,index,do_emit);
00189     
00190     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;
00191 }
00192 
00193 
00194 <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(QStringList *list, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00195     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> || !isUpdatesEnabled())
00196         <font class="keywordflow">return</font>;
00197     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">true</font>; 
00198     setUpdatesEnabled(<font class="keyword">false</font>);
00199 <font class="comment">//  m_comboBox-&gt;setUpdatesEnabled(false);</font>
00200 
00201 <font class="comment">//  m_mainLayout-&gt;setResizeMode(QLayout::FreeResize);</font>
00202     
00203     oldKey = QString::null;
00204     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;clear();
00205     <font class="keywordflow">if</font> (list)
00206         <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;insertStringList(*list);
00207     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;resize( <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;sizeHint() );
00208 <font class="comment">//  m_comboBox-&gt;setUpdatesEnabled(true);            </font>
00209     
00210 <font class="comment">//  m_mainLayout-&gt;setResizeMode(QLayout::Minimum);</font>
00211     
00212     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setCurrentItem(index);  
00213     <font class="keywordflow">if</font> (!list || (list &amp;&amp; !list-&gt;count())) { <font class="comment">//nothing in the combobox</font>
00214         btn_up-&gt;setEnabled( <font class="keyword">true</font> );
00215         btn_fx-&gt;setEnabled( <font class="keyword">true</font> );
00216         btn_down-&gt;setEnabled( <font class="keyword">true</font> );       
00217         setEnabled(<font class="keyword">false</font>);
00218     }
00219     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!isEnabled()) { <font class="comment">//was disabled</font>
00220         setEnabled(<font class="keyword">true</font>);   
00221         <font class="keyword">const</font> <font class="keywordtype">bool</font> enableButtons = list &amp;&amp; (list-&gt;count()&gt;=1);
00222         btn_up-&gt;setEnabled( enableButtons );
00223         btn_fx-&gt;setEnabled( enableButtons );
00224         btn_down-&gt;setEnabled( list &amp;&amp; (list-&gt;count()&gt;1) );
00225     }
00226     setUpdatesEnabled(<font class="keyword">true</font>);
00227     
00228     <font class="keywordflow">if</font> (do_emit) {
00229         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;currentItem());                
00230     }
00231 
00232   <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;adjustSize();
00233     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;    
00234 }
00235 
<a name="l00236"></a><a class="code" href="class_c_key_chooser_widget.html#g0">00236</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g0">CKeyChooserWidget::lock</a>(<font class="keywordtype">void</font>){
00237     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditable(<font class="keyword">false</font>);
00238     oldKey = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentText();
00239 }
00240 
<a name="l00241"></a><a class="code" href="class_c_key_chooser_widget.html#g1">00241</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g1">CKeyChooserWidget::unlock</a>(<font class="keywordtype">void</font>){
00242     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditable(<font class="keyword">true</font>);
00243     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditText(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()));
00244     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentText() != oldKey);
00245         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00246 }
00247 
<a name="l00249"></a><a class="code" href="class_c_key_chooser_widget.html#a5">00249</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a5">CKeyChooserWidget::init</a>( ){
00250     oldKey = QString::null;
00251     btn_up = btn_down = btn_fx = 0;
00252 
00253     setFocusPolicy(QWidget::WheelFocus);            
00254             
00255     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a> = <font class="keyword">new</font> CKCComboBox( <font class="keyword">true</font>, <font class="keyword">this</font> );
00256     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setAutoCompletion( <font class="keyword">true</font> );
00257     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setInsertionPolicy(QComboBox::NoInsertion);
00258     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setFocusPolicy(QWidget::WheelFocus);    
00259     
00260     m_mainLayout = <font class="keyword">new</font> QHBoxLayout( <font class="keyword">this</font> ); 
00261 <font class="comment">//  m_mainLayout-&gt;setResizeMode(QLayout::Minimum);          </font>
00262     m_mainLayout-&gt;addWidget(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>);
00263 
00264     QVBoxLayout* m_buttonLayout = <font class="keyword">new</font> QVBoxLayout();    
00265     m_buttonLayout-&gt;setAlignment(Qt::AlignHCenter | Qt::AlignCenter);
00266         
00267     btn_up = <font class="keyword">new</font> QToolButton( <font class="keyword">this</font>, <font class="stringliteral">"btn_up"</font> ); 
00268     QIconSet iconSet = <a class="code" href="class_c_key_chooser_widget.html#b0">getUpIconSet</a>();
00269     btn_up-&gt;setIconSet( iconSet );
00270     btn_up-&gt;setFixedSize(WIDTH, ARROW_HEIGHT);
00271     btn_up-&gt;setFocusPolicy(QWidget::NoFocus);   
00272     
00273     btn_fx = <font class="keyword">new</font> <a class="code" href="classcfx__btn.html">cfx_btn</a>( <font class="keyword">this</font>, <font class="stringliteral">"btn_fx"</font> );
00274     iconSet = <a class="code" href="class_c_key_chooser_widget.html#b1">getMoverIconSet</a>();
00275 <font class="comment">//  btn_fx-&gt;setIconSet( iconSet );  </font>
00276     btn_fx-&gt;setFixedSize(WIDTH, MOVER_HEIGHT);
00277 <font class="comment">//  btn_fx-&gt;setFixedSize(iconSet.pixmap().width(), iconSet.pixmap().height());  </font>
00278     btn_fx-&gt;setFocusPolicy(QWidget::NoFocus);   
00279     
00280     btn_down = <font class="keyword">new</font> QToolButton( <font class="keyword">this</font>, <font class="stringliteral">"btn_down"</font> ); 
00281     iconSet = <a class="code" href="class_c_key_chooser_widget.html#b2">getDownIconSet</a>();
00282     btn_down-&gt;setIconSet( iconSet );
00283     btn_down-&gt;setFixedSize(WIDTH, ARROW_HEIGHT);
00284 <font class="comment">//  btn_down-&gt;setFixedSize(iconSet.pixmap().width(), iconSet.pixmap().height());    </font>
00285     btn_down-&gt;setFocusPolicy(QWidget::NoFocus); 
00286     
00287     m_buttonLayout-&gt;addWidget( btn_up );    
00288     m_buttonLayout-&gt;addWidget( btn_fx );    
00289     m_buttonLayout-&gt;addWidget( btn_down );
00290     
00291     m_mainLayout-&gt;addLayout( m_buttonLayout );
00292     m_mainLayout-&gt;addSpacing(2);
00293 
00294     setTabOrder(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, 0);
00295         
00296 <font class="comment">// signals and slots connections</font>
00297     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ) {
00298         <font class="keywordflow">if</font> (m_useNextPrevSignals) {
00299             connect(btn_up, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j1">prev_requested</a>()) );  
00300             connect(btn_down, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j0">next_requested</a>()) );
00301       }
00302       <font class="keywordflow">else</font> {
00303             connect(btn_up, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i0">previous</a>()) );  
00304             connect(btn_down, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i1">next</a>()) );    
00305       }
00306     }
00307     <font class="keywordflow">else</font> {
00308         <font class="keywordflow">if</font> (m_useNextPrevSignals) {
00309             connect(btn_up, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j0">next_requested</a>()) );  
00310             connect(btn_down, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j1">prev_requested</a>()) );
00311       }
00312       <font class="keywordflow">else</font> {
00313             connect(btn_up, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i1">next</a>()) );  
00314             connect(btn_down, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i0">previous</a>()) );    
00315         }
00316     }
00317     
00318     connect(btn_fx, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#g0">lock</a>()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g0">lock</a>()) );
00319     connect(btn_fx, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#g1">unlock</a>()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g1">unlock</a>()) );
00320     connect(btn_fx, SIGNAL(change_requested(<font class="keywordtype">int</font>)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g2">changeCombo</a>(<font class="keywordtype">int</font>)) );
00321     
00322     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(activated(<font class="keywordtype">int</font>)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#h1">slotComboChanged</a>(<font class="keywordtype">int</font>)));
00323     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(activated(<font class="keyword">const</font> QString&amp;)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#h0">slotReturnPressed</a>(<font class="keyword">const</font> QString&amp;)));
00324     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j3">focusOut</a>(<font class="keywordtype">int</font>)), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j3">focusOut</a>(<font class="keywordtype">int</font>)));  
00325         
00326     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;
00327 }
00328 
<a name="l00330"></a><a class="code" href="class_c_key_chooser_widget.html#h0">00330</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#h0">CKeyChooserWidget::slotReturnPressed</a>( <font class="keyword">const</font> QString&amp; text){
00331     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index=0; index &lt; <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count(); index++) {
00332         <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(index) == text) {
00333             <font class="keywordflow">if</font> ( text != oldKey)    <font class="comment">//if the key has changed</font>
00334                 emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(index);
00335             <font class="keywordflow">break</font>;
00336         }
00337     }
00338 }
00339 
<a name="l00341"></a><a class="code" href="class_c_key_chooser_widget.html#h1">00341</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#h1">CKeyChooserWidget::slotComboChanged</a>(<font class="keywordtype">int</font> index){
00342 <font class="comment">//  qWarning("CKeyChooserWidget::slotComboChanged(int index)");</font>
00343     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00344         <font class="keywordflow">return</font>;
00345     setUpdatesEnabled(<font class="keyword">false</font>);   
00346     
00347     <font class="keyword">const</font> QString key = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text( index );
00348     <font class="keywordflow">if</font> (oldKey.isNull() || (oldKey != key))
00349         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(index);
00350     oldKey = key;
00351 
00352     setUpdatesEnabled(<font class="keyword">true</font>);        
00353 }
00354 
00355 
<a name="l00357"></a><a class="code" href="class_c_key_chooser_widget.html#b0">00357</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b0">CKeyChooserWidget::getUpIconSet</a>(){
00358     <font class="keyword">const</font> <font class="keywordtype">int</font> x = WIDTH - 4;
00359   <font class="keyword">const</font> <font class="keywordtype">int</font> y = ARROW_HEIGHT - 4;
00360   QPixmap pix(x, y);
00361     QPainter p(&amp;pix);
00362     p.fillRect(0,0, x, y, colorGroup().background());
00363     style().drawPrimitive(QStyle::PE_ArrowUp, &amp;p, QRect(0,0, x, y), btn_up-&gt;colorGroup(), btn_up-&gt;isEnabled() ? QStyle::Style_Enabled : QStyle::Style_Default );
00364     <font class="keywordflow">return</font> QIconSet(pix);
00365 }
00366 
<a name="l00368"></a><a class="code" href="class_c_key_chooser_widget.html#b2">00368</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b2">CKeyChooserWidget::getDownIconSet</a>(){
00369     <font class="keyword">const</font> <font class="keywordtype">int</font> x = WIDTH - 4;
00370   <font class="keyword">const</font> <font class="keywordtype">int</font> y = ARROW_HEIGHT - 4;
00371   QPixmap pix(x, y);
00372     QPainter p(&amp;pix);
00373     p.fillRect(0,0, x, y, colorGroup().background());
00374     style().drawPrimitive(QStyle::PE_ArrowDown, &amp;p, QRect(0,0, x, y), btn_up-&gt;colorGroup(), btn_up-&gt;isEnabled() ? QStyle::Style_Enabled : QStyle::Style_Default );
00375     <font class="keywordflow">return</font> QIconSet(pix);
00376 }
00377 
<a name="l00379"></a><a class="code" href="class_c_key_chooser_widget.html#b1">00379</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b1">CKeyChooserWidget::getMoverIconSet</a>(){
00380   <font class="keyword">const</font> <font class="keywordtype">int</font> x = WIDTH - 2;
00381   <font class="keyword">const</font> <font class="keywordtype">int</font> y = MOVER_HEIGHT - 2;
00382   QPixmap pix(x, y);
00383     QPainter p(&amp;pix);
00384     p.fillRect(0,0, x-1, y-1, colorGroup().background());
00385     p.fillRect(2,2, x-3, y-3, colorGroup().foreground());       
00386     <font class="keywordflow">return</font> QIconSet(pix);
00387 }
00388 <font class="preprocessor">#undef WIDTH</font>
00389 <font class="preprocessor"></font><font class="preprocessor">#undef ARROW_HEIGHT</font>
00390 <font class="preprocessor"></font><font class="preprocessor">#undef MOVER_HEIGHT</font>
00391 <font class="preprocessor"></font>
00393 <font class="keywordtype">void</font> CKeyChooserWidget::adjustSize( ){
00394     setUpdatesEnabled(<font class="keyword">false</font>);
00395     QSize s = sizeHint();
00396     <font class="keywordflow">if</font> (s.width() &gt; maximumWidth())
00397         s.setWidth( maximumWidth() );
00398     
00399     resize(s);
00400     setUpdatesEnabled(<font class="keyword">true</font>);    
00401 }
00402 
<a name="l00404"></a><a class="code" href="class_c_key_chooser_widget.html#a8">00404</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a8">CKeyChooserWidget::setToolTips</a>( <font class="keyword">const</font> QString comboTip, <font class="keyword">const</font> QString nextEntryTip, <font class="keyword">const</font> QString scrollButtonTip, <font class="keyword">const</font> QString previousEntryTip){
00405     QToolTip::add(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>(),comboTip);
00406     QToolTip::add(btn_fx,  scrollButtonTip);
00407 
00408     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ){
00409         QToolTip::add(btn_down, nextEntryTip);
00410         QToolTip::add(btn_up,   previousEntryTip);
00411     }
00412     <font class="keywordflow">else</font> {
00413         QToolTip::add(btn_up,   nextEntryTip);
00414         QToolTip::add(btn_down, previousEntryTip);
00415     }
00416 }
00417 
<a name="l00419"></a><a class="code" href="class_c_key_chooser_widget.html#a7">00419</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a7">CKeyChooserWidget::setWhatsThis</a>(<font class="keyword">const</font> QString comboTip, <font class="keyword">const</font> QString nextEntryTip, <font class="keyword">const</font> QString scrollButtonTip, <font class="keyword">const</font> QString previousEntryTip){
00420     QWhatsThis::add(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>(),comboTip);
00421     QWhatsThis::add(btn_fx,  scrollButtonTip);
00422 
00423     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ) {
00424         QWhatsThis::add(btn_down, nextEntryTip);
00425         QWhatsThis::add(btn_up,   previousEntryTip);
00426     }
00427     <font class="keywordflow">else</font> {
00428         QWhatsThis::add(btn_up,   nextEntryTip);
00429         QWhatsThis::add(btn_down, previousEntryTip);
00430     }
00431 }
00432 
<a name="l00434"></a><a class="code" href="class_c_key_chooser_widget.html#a9">00434</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_key_chooser_widget.html#a9">CKeyChooserWidget::setItem</a>( <font class="keyword">const</font> QString item ){
00435     qDebug(<font class="stringliteral">"CKeyChooserWidget::setItem( const QString item )"</font>);
00436     <font class="keywordtype">bool</font> ret = <font class="keyword">false</font>;
00437     <font class="keyword">const</font> <font class="keywordtype">int</font> count = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count();
00438     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; count; ++i) {
00439         <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(i) == item) {
00440             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(i);
00441             ret = <font class="keyword">true</font>;
00442             <font class="keywordflow">break</font>;
00443         }
00444     }
00445     <font class="keywordflow">if</font> (!ret)
00446         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(-1);
00447     <font class="keywordflow">return</font> ret;
00448 }
00449 
<a name="l00451"></a><a class="code" href="class_c_key_chooser_widget.html#i1">00451</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#i1">CKeyChooserWidget::next</a>(){
00452     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem() != <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count()-1) {<font class="comment">// not last entry</font>
00453         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem( <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()+1 );
00454         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00455     }
00456 }
00457 
<a name="l00459"></a><a class="code" href="class_c_key_chooser_widget.html#i0">00459</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#i0">CKeyChooserWidget::previous</a>(){
00460     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem() != 0) {<font class="comment">// not last entry</font>
00461         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem( <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()-1 );
00462         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00463     }
00464 }
00465 
<a name="l00466"></a><a class="code" href="class_c_key_chooser_widget.html#a10">00466</a> QComboBox* <a class="code" href="class_c_key_chooser_widget.html#a10">CKeyChooserWidget::comboBox</a>(){
00467     <font class="keywordflow">return</font> <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>;
00468 }
00469 
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:09 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
