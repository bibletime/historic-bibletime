<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ckeychooserwidget.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>ckeychooserwidget.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          ckeychooserwidget.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Tue Sep 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 <font class="comment">//BibleTime includes</font>
00018 <font class="preprocessor">#include "ckeychooserwidget.h"</font>
00019 <font class="preprocessor">#include "cfx_btn.h"</font>
00020 <font class="preprocessor">#include "../cbtconfig.h"</font>
00021 
00022 <font class="comment">//Qt includes</font>
00023 <font class="preprocessor">#include &lt;qlineedit.h&gt;</font>
00024 <font class="preprocessor">#include &lt;qstring.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00026 <font class="preprocessor">#include &lt;qlistbox.h&gt;</font>
00027 <font class="preprocessor">#include &lt;qtoolbutton.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00029 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qpainter.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qstyle.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qpixmap.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qapplication.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qrect.h&gt;</font>
00037 
00038 <font class="preprocessor">#define WIDTH 16</font>
00039 <font class="preprocessor"></font><font class="preprocessor">#define ARROW_HEIGHT 10</font>
00040 <font class="preprocessor"></font><font class="preprocessor">#define MOVER_HEIGHT 4</font>
00041 <font class="preprocessor"></font>
00042 CKCComboBox::CKCComboBox(<font class="keywordtype">bool</font> rw,QWidget* parent,<font class="keyword">const</font> <font class="keywordtype">char</font>* name)
00043   : QComboBox(rw,parent,name){
00044     setFocusPolicy(QWidget::WheelFocus);
00045   <font class="keywordflow">if</font> (lineEdit()) {
00046     installEventFilter( lineEdit() );
00047   }
00048 }
00049 
00051 <font class="keywordtype">bool</font> CKCComboBox::eventFilter( QObject *o, QEvent *e ){         
00052 <font class="comment">//  qWarning("CKCComboBox::eventFilter( QObject *o, QEvent *e )");</font>
00053     <font class="keywordflow">if</font> (e-&gt;type() == QEvent::FocusOut) {
00054         QFocusEvent* f = static_cast&lt;QFocusEvent*&gt;(e);
00055 <font class="comment">//      qWarning("FocusOut: %d", f-&gt;reason());</font>
00056 <font class="comment">//      qWarning("Mouse: %d",(f-&gt;reason()==QFocusEvent::Mouse)?1:0);</font>
00057 <font class="comment">//    qWarning("lineedit: %d",(o == lineEdit())?1:0);</font>
00058 <font class="comment">//    qWarning("listbox: %d",(o == listBox())?1:0);</font>
00059 <font class="comment">//    qWarning("this: %d",(o == this)?1:0);</font>
00060 
00061         
00062         <font class="keywordflow">if</font> (o == lineEdit() &amp;&amp; f-&gt;reason() == QFocusEvent::Tab) {
00063         <font class="keywordtype">int</font> index = listBox()-&gt;index( listBox()-&gt;findItem(currentText()) );
00064         <font class="keywordflow">if</font> (index == -1)
00065                 index = 0;<font class="comment">// return 0 if not found</font>
00066         setCurrentItem( index );    
00067         emit focusOut( index );     
00068       }
00069       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp;*/</font> f-&gt;reason() == QFocusEvent::Popup) {
00070             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00071         }
00072       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp; */</font>f-&gt;reason() == QFocusEvent::ActiveWindow) {
00073             emit activated(currentText());
00074             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00075         }
00076       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp;*/</font> f-&gt;reason() == QFocusEvent::Mouse) {
00077             emit activated(currentText());
00078             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00079         }       
00080       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (o == listBox()) {  <font class="comment">//???</font>
00081             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00082         }
00083       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (o == <font class="keyword">this</font>) {
00084             emit activated(currentText());
00085             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00086         }       
00087     }
00088 <font class="comment">//  qWarning("not handled!");</font>
00089   <font class="keywordflow">return</font> QComboBox::eventFilter(o,e);   
00090 }
00091 
00093 <font class="keywordtype">void</font> CKCComboBox::wheelEvent( QWheelEvent* e ) {
00094     <font class="keyword">const</font> <font class="keywordtype">signed</font> <font class="keywordtype">int</font> change = (int)((float)e-&gt;delta()/(float)120);
00095     <font class="keywordtype">int</font> current = currentItem();
00096     
00097     <font class="keywordflow">if</font> ((current+change &gt;= 0) &amp;&amp; (current+change&lt;count()) ) {
00098         setCurrentItem(current+change);
00099         e-&gt;accept();
00100         emit activated( currentItem() );
00101     }
00102     <font class="keywordflow">else</font> {
00103         e-&gt;ignore();
00104     }
00105 }
00106 
00108 <font class="comment">//QSize CKCComboBox::sizeHint() const {</font>
00109 <font class="comment">//  // IMHO Qt has a bug: The sizehint is not updated if the list is refreshed with other items</font>
00110 <font class="comment">//  const QSize oldSize = QComboBox::sizeHint();</font>
00111 <font class="comment">//  QRect contentsRect = style().querySubControlMetrics( QStyle::CC_ComboBox , this, QStyle::SC_ComboBoxArrow);</font>
00113 <font class="comment">//  const int buttonWidth = (oldSize.width() - contentsRect.width());</font>
00114 <font class="comment">//</font>
00115 <font class="comment">//  if (listBox())  {</font>
00116 <font class="comment">//      return QSize( listBox()-&gt;sizeHint().width()+buttonWidth, QComboBox::sizeHint().height());</font>
00117 <font class="comment">//  }</font>
00118 <font class="comment">//  else {</font>
00119 <font class="comment">//      return QSize( QComboBox::sizeHint().width()+buttonWidth, QComboBox::sizeHint().height());   </font>
00120 <font class="comment">//  }</font>
00121 <font class="comment">//}</font>
00122 
00123 
00124 <font class="comment">//**********************************************************************************/</font>
00125 
<a name="l00126"></a><a class="code" href="class_c_key_chooser_widget.html#a1">00126</a> <a class="code" href="class_c_key_chooser_widget.html#a0">CKeyChooserWidget::CKeyChooserWidget</a>(<font class="keywordtype">int</font> count, <font class="keyword">const</font> <font class="keywordtype">bool</font> useNextPrevSignals,  QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name) : QWidget(parent,name) {
00127     m_useNextPrevSignals = useNextPrevSignals;
00128     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index=1; index &lt;= count; index++)
00129         m_list.append( QString::number(index) );    
00130     <a class="code" href="class_c_key_chooser_widget.html#a5">init</a>();
00131     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(m_list,0,<font class="keyword">false</font>);
00132 };
00133 
<a name="l00134"></a><a class="code" href="class_c_key_chooser_widget.html#a0">00134</a> <a class="code" href="class_c_key_chooser_widget.html#a0">CKeyChooserWidget::CKeyChooserWidget</a>(QStringList *list, <font class="keyword">const</font> <font class="keywordtype">bool</font> useNextPrevSignals, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : QWidget(parent,name) {
00135     m_useNextPrevSignals = useNextPrevSignals;      
00136     <font class="keywordflow">if</font> (list)
00137         m_list = *list;<font class="comment">//copy the items of list</font>
00138     <font class="keywordflow">else</font>
00139         m_list.clear();
00140     <a class="code" href="class_c_key_chooser_widget.html#a5">init</a>();
00141     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(m_list,0,<font class="keyword">false</font>);  
00142 }
00143 
<a name="l00144"></a><a class="code" href="class_c_key_chooser_widget.html#g2">00144</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g2">CKeyChooserWidget::changeCombo</a>(<font class="keywordtype">int</font> i){
00145     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00146         <font class="keywordflow">return</font>;
00147     setUpdatesEnabled(<font class="keyword">false</font>);
00148     
00149     <font class="keywordtype">int</font> current = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem();
00150 
00151     <font class="comment">//index of highest Item</font>
00152     <font class="keyword">const</font> <font class="keywordtype">int</font> count = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count()-1;
00153     <font class="keywordtype">int</font> j = current + i;
00154     <font class="keywordflow">if</font> (i &gt; 0){
00155         <font class="keywordflow">if</font> (j &lt;= count)
00156             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(j);
00157         <font class="keywordflow">else</font>
00158             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(count);
00159     }
00160     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (i &lt; 0){
00161         <font class="keywordflow">if</font> (j&gt;=0)
00162             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(j);
00163         <font class="keywordflow">else</font>
00164             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(0);
00165     }   
00166     <font class="keywordflow">if</font> (!<a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> &amp;&amp; !btn_fx-&gt;<a class="code" href="classcfx__btn.html#a1">isLocked</a>() &amp;&amp; (current != <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()))  
00167         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00168         
00169     setUpdatesEnabled(<font class="keyword">true</font>);        
00170 }
00171 
<a name="l00172"></a><a class="code" href="class_c_key_chooser_widget.html#a2">00172</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(<font class="keyword">const</font> <font class="keywordtype">int</font> count, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00173 <font class="comment">//  qWarning("CKeyChooserWidget::reset(const int count, int index, bool do_emit)");</font>
00174     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00175         <font class="keywordflow">return</font>;
00176 
00177     m_list.clear();
00178     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i &lt;= count; i++)
00179         m_list.append( QString::number(i) );
00180     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(&amp;m_list,index,do_emit);
00181 }
00182 
00183 <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(QStringList&amp; list, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00184     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00185         <font class="keywordflow">return</font>;
00186     
00187     m_list = list;
00188     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(&amp;m_list,index,do_emit);
00189     
00190     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;
00191 }
00192 
00193 
00194 <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(QStringList *list, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00195     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> || !isUpdatesEnabled())
00196         <font class="keywordflow">return</font>;
00197     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">true</font>; 
00198     setUpdatesEnabled(<font class="keyword">false</font>);
00199     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setUpdatesEnabled(<font class="keyword">false</font>);
00200 
00201     m_mainLayout-&gt;setResizeMode(QLayout::FreeResize);
00202     
00203     oldKey = QString::null;
00204     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;clear();
00205     <font class="keywordflow">if</font> (list)
00206         <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;insertStringList(*list);
00207     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;resize( <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;sizeHint() );
00208     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setUpdatesEnabled(<font class="keyword">true</font>);            
00209     
00210     m_mainLayout-&gt;setResizeMode(QLayout::Minimum);
00211     
00212     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setCurrentItem(index);  
00213     <font class="keywordflow">if</font> (!list || (list &amp;&amp; !list-&gt;count())) { <font class="comment">//nothing in the combobox</font>
00214         btn_up-&gt;setEnabled( <font class="keyword">true</font> );
00215         btn_fx-&gt;setEnabled( <font class="keyword">true</font> );
00216         btn_down-&gt;setEnabled( <font class="keyword">true</font> );       
00217         setEnabled(<font class="keyword">false</font>);
00218     }
00219     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!isEnabled()) { <font class="comment">//was disabled</font>
00220         setEnabled(<font class="keyword">true</font>);   
00221         <font class="keyword">const</font> <font class="keywordtype">bool</font> enableButtons = list &amp;&amp; (list-&gt;count()&gt;=1);
00222         btn_up-&gt;setEnabled( enableButtons );
00223         btn_fx-&gt;setEnabled( enableButtons );
00224         btn_down-&gt;setEnabled( list &amp;&amp; (list-&gt;count()&gt;1) );
00225     }
00226     setUpdatesEnabled(<font class="keyword">true</font>);
00227     
00228     <font class="keywordflow">if</font> (do_emit) {
00229         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;currentItem());                
00230     }
00231     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;    
00232 }
00233 
<a name="l00234"></a><a class="code" href="class_c_key_chooser_widget.html#g0">00234</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g0">CKeyChooserWidget::lock</a>(<font class="keywordtype">void</font>){
00235     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditable(<font class="keyword">false</font>);
00236     oldKey = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentText();
00237 }
00238 
<a name="l00239"></a><a class="code" href="class_c_key_chooser_widget.html#g1">00239</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g1">CKeyChooserWidget::unlock</a>(<font class="keywordtype">void</font>){
00240     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditable(<font class="keyword">true</font>);
00241     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditText(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()));
00242     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentText() != oldKey);
00243         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00244 }
00245 
<a name="l00247"></a><a class="code" href="class_c_key_chooser_widget.html#a5">00247</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a5">CKeyChooserWidget::init</a>( ){
00248     oldKey = QString::null;
00249     btn_up = btn_down = btn_fx = 0;
00250 
00251     setFocusPolicy(QWidget::StrongFocus);           
00252             
00253     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a> = <font class="keyword">new</font> CKCComboBox( <font class="keyword">true</font>, <font class="keyword">this</font> );
00254     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setAutoCompletion( <font class="keyword">true</font> );
00255     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setInsertionPolicy(QComboBox::NoInsertion);
00256     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setFocusPolicy(QWidget::WheelFocus);    
00257     
00258     m_mainLayout = <font class="keyword">new</font> QHBoxLayout( <font class="keyword">this</font> ); 
00259     m_mainLayout-&gt;setResizeMode(QLayout::Minimum);          
00260     m_mainLayout-&gt;addWidget(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>);
00261 
00262     QVBoxLayout* m_buttonLayout = <font class="keyword">new</font> QVBoxLayout();    
00263     m_buttonLayout-&gt;setAlignment(Qt::AlignHCenter | Qt::AlignCenter);
00264         
00265     btn_up = <font class="keyword">new</font> QToolButton( <font class="keyword">this</font>, <font class="stringliteral">"btn_up"</font> ); 
00266     QIconSet iconSet = <a class="code" href="class_c_key_chooser_widget.html#b0">getUpIconSet</a>();
00267     btn_up-&gt;setIconSet( iconSet );
00268     btn_up-&gt;setFixedSize(WIDTH, ARROW_HEIGHT);
00269     btn_up-&gt;setFocusPolicy(QWidget::NoFocus);   
00270     
00271     btn_fx = <font class="keyword">new</font> <a class="code" href="classcfx__btn.html">cfx_btn</a>( <font class="keyword">this</font>, <font class="stringliteral">"btn_fx"</font> );
00272     iconSet = <a class="code" href="class_c_key_chooser_widget.html#b1">getMoverIconSet</a>();
00273 <font class="comment">//  btn_fx-&gt;setIconSet( iconSet );  </font>
00274     btn_fx-&gt;setFixedSize(WIDTH, MOVER_HEIGHT);
00275 <font class="comment">//  btn_fx-&gt;setFixedSize(iconSet.pixmap().width(), iconSet.pixmap().height());  </font>
00276     btn_fx-&gt;setFocusPolicy(QWidget::NoFocus);   
00277     
00278     btn_down = <font class="keyword">new</font> QToolButton( <font class="keyword">this</font>, <font class="stringliteral">"btn_down"</font> ); 
00279     iconSet = <a class="code" href="class_c_key_chooser_widget.html#b2">getDownIconSet</a>();
00280     btn_down-&gt;setIconSet( iconSet );
00281     btn_down-&gt;setFixedSize(WIDTH, ARROW_HEIGHT);
00282 <font class="comment">//  btn_down-&gt;setFixedSize(iconSet.pixmap().width(), iconSet.pixmap().height());    </font>
00283     btn_down-&gt;setFocusPolicy(QWidget::NoFocus); 
00284     
00285     m_buttonLayout-&gt;addWidget( btn_up );    
00286     m_buttonLayout-&gt;addWidget( btn_fx );    
00287     m_buttonLayout-&gt;addWidget( btn_down );
00288     
00289     m_mainLayout-&gt;addLayout( m_buttonLayout );
00290     m_mainLayout-&gt;addSpacing(2);
00291 
00292     setTabOrder(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, 0);
00293         
00294 <font class="comment">// signals and slots connections</font>
00295     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ) {
00296         <font class="keywordflow">if</font> (m_useNextPrevSignals) {
00297             connect(btn_up, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j1">prev_requested</a>()) );  
00298             connect(btn_down, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j0">next_requested</a>()) );
00299       }
00300       <font class="keywordflow">else</font> {
00301             connect(btn_up, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i0">previous</a>()) );  
00302             connect(btn_down, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i1">next</a>()) );    
00303       }
00304     }
00305     <font class="keywordflow">else</font> {
00306         <font class="keywordflow">if</font> (m_useNextPrevSignals) {
00307             connect(btn_up, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j0">next_requested</a>()) );  
00308             connect(btn_down, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j1">prev_requested</a>()) );
00309       }
00310       <font class="keywordflow">else</font> {
00311             connect(btn_up, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i1">next</a>()) );  
00312             connect(btn_down, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i0">previous</a>()) );    
00313         }
00314     }
00315     
00316     connect(btn_fx, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#g0">lock</a>()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g0">lock</a>()) );
00317     connect(btn_fx, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#g1">unlock</a>()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g1">unlock</a>()) );
00318     connect(btn_fx, SIGNAL(change_requested(<font class="keywordtype">int</font>)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g2">changeCombo</a>(<font class="keywordtype">int</font>)) );
00319     
00320     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(activated(<font class="keywordtype">int</font>)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#h1">slotComboChanged</a>(<font class="keywordtype">int</font>)));
00321     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(activated(<font class="keyword">const</font> QString&amp;)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#h0">slotReturnPressed</a>(<font class="keyword">const</font> QString&amp;)));
00322     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j3">focusOut</a>(<font class="keywordtype">int</font>)), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j3">focusOut</a>(<font class="keywordtype">int</font>)));  
00323         
00324     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;
00325 }
00326 
<a name="l00328"></a><a class="code" href="class_c_key_chooser_widget.html#h0">00328</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#h0">CKeyChooserWidget::slotReturnPressed</a>( <font class="keyword">const</font> QString&amp; text){
00329     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index=0; index &lt; <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count(); index++) {
00330         <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(index) == text) {
00331             <font class="keywordflow">if</font> ( text != oldKey)    <font class="comment">//if the key has changed</font>
00332                 emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(index);
00333             <font class="keywordflow">break</font>;
00334         }
00335     }
00336 }
00337 
<a name="l00339"></a><a class="code" href="class_c_key_chooser_widget.html#h1">00339</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#h1">CKeyChooserWidget::slotComboChanged</a>(<font class="keywordtype">int</font> index){
00340 <font class="comment">//  qWarning("CKeyChooserWidget::slotComboChanged(int index)");</font>
00341     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00342         <font class="keywordflow">return</font>;
00343     setUpdatesEnabled(<font class="keyword">false</font>);   
00344     
00345     <font class="keyword">const</font> QString key = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text( index );
00346     <font class="keywordflow">if</font> (oldKey.isNull() || (oldKey != key))
00347         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(index);
00348     oldKey = key;
00349 
00350     setUpdatesEnabled(<font class="keyword">true</font>);        
00351 }
00352 
00353 
<a name="l00355"></a><a class="code" href="class_c_key_chooser_widget.html#b0">00355</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b0">CKeyChooserWidget::getUpIconSet</a>(){
00356     <font class="keyword">const</font> <font class="keywordtype">int</font> x = WIDTH - 4;
00357   <font class="keyword">const</font> <font class="keywordtype">int</font> y = ARROW_HEIGHT - 4;
00358   QPixmap pix(x, y);
00359     QPainter p(&amp;pix);
00360     p.fillRect(0,0, x, y, colorGroup().background());
00361     style().drawPrimitive(QStyle::PE_ArrowUp, &amp;p, QRect(0,0, x, y), btn_up-&gt;colorGroup(), btn_up-&gt;isEnabled() ? QStyle::Style_Enabled : QStyle::Style_Default );
00362     <font class="keywordflow">return</font> QIconSet(pix);
00363 }
00364 
<a name="l00366"></a><a class="code" href="class_c_key_chooser_widget.html#b2">00366</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b2">CKeyChooserWidget::getDownIconSet</a>(){
00367     <font class="keyword">const</font> <font class="keywordtype">int</font> x = WIDTH - 4;
00368   <font class="keyword">const</font> <font class="keywordtype">int</font> y = ARROW_HEIGHT - 4;
00369   QPixmap pix(x, y);
00370     QPainter p(&amp;pix);
00371     p.fillRect(0,0, x, y, colorGroup().background());
00372     style().drawPrimitive(QStyle::PE_ArrowDown, &amp;p, QRect(0,0, x, y), btn_up-&gt;colorGroup(), btn_up-&gt;isEnabled() ? QStyle::Style_Enabled : QStyle::Style_Default );
00373     <font class="keywordflow">return</font> QIconSet(pix);
00374 }
00375 
<a name="l00377"></a><a class="code" href="class_c_key_chooser_widget.html#b1">00377</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b1">CKeyChooserWidget::getMoverIconSet</a>(){
00378   <font class="keyword">const</font> <font class="keywordtype">int</font> x = WIDTH - 2;
00379   <font class="keyword">const</font> <font class="keywordtype">int</font> y = MOVER_HEIGHT - 2;
00380   QPixmap pix(x, y);
00381     QPainter p(&amp;pix);
00382     p.fillRect(0,0, x-1, y-1, colorGroup().background());
00383     p.fillRect(2,2, x-3, y-3, colorGroup().foreground());       
00384     <font class="keywordflow">return</font> QIconSet(pix);
00385 }
00386 <font class="preprocessor">#undef WIDTH</font>
00387 <font class="preprocessor"></font><font class="preprocessor">#undef ARROW_HEIGHT</font>
00388 <font class="preprocessor"></font><font class="preprocessor">#undef MOVER_HEIGHT</font>
00389 <font class="preprocessor"></font>
00391 <font class="keywordtype">void</font> CKeyChooserWidget::adjustSize( ){
00392     setUpdatesEnabled(<font class="keyword">false</font>);
00393     QSize s = sizeHint();
00394     <font class="keywordflow">if</font> (s.width() &gt; maximumWidth())
00395         s.setWidth( maximumWidth() );
00396     
00397     resize(s);
00398     setUpdatesEnabled(<font class="keyword">true</font>);    
00399 }
00400 
<a name="l00402"></a><a class="code" href="class_c_key_chooser_widget.html#a8">00402</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a8">CKeyChooserWidget::setToolTips</a>( <font class="keyword">const</font> QString comboTip, <font class="keyword">const</font> QString nextEntryTip, <font class="keyword">const</font> QString scrollButtonTip, <font class="keyword">const</font> QString previousEntryTip){
00403     QToolTip::add(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>(),comboTip);
00404     QToolTip::add(btn_fx,  scrollButtonTip);
00405 
00406     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ){
00407         QToolTip::add(btn_down, nextEntryTip);
00408         QToolTip::add(btn_up,   previousEntryTip);
00409     }
00410     <font class="keywordflow">else</font> {
00411         QToolTip::add(btn_up,   nextEntryTip);
00412         QToolTip::add(btn_down, previousEntryTip);
00413     }
00414 }
00415 
<a name="l00417"></a><a class="code" href="class_c_key_chooser_widget.html#a7">00417</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a7">CKeyChooserWidget::setWhatsThis</a>(<font class="keyword">const</font> QString comboTip, <font class="keyword">const</font> QString nextEntryTip, <font class="keyword">const</font> QString scrollButtonTip, <font class="keyword">const</font> QString previousEntryTip){
00418     QWhatsThis::add(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>(),comboTip);
00419     QWhatsThis::add(btn_fx,  scrollButtonTip);
00420 
00421     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ) {
00422         QWhatsThis::add(btn_down, nextEntryTip);
00423         QWhatsThis::add(btn_up,   previousEntryTip);
00424     }
00425     <font class="keywordflow">else</font> {
00426         QWhatsThis::add(btn_up,   nextEntryTip);
00427         QWhatsThis::add(btn_down, previousEntryTip);
00428     }
00429 }
00430 
<a name="l00432"></a><a class="code" href="class_c_key_chooser_widget.html#a9">00432</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_key_chooser_widget.html#a9">CKeyChooserWidget::setItem</a>( <font class="keyword">const</font> QString item ){
00433     qDebug(<font class="stringliteral">"CKeyChooserWidget::setItem( const QString item )"</font>);
00434     <font class="keywordtype">bool</font> ret = <font class="keyword">false</font>;
00435     <font class="keyword">const</font> <font class="keywordtype">int</font> count = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count();
00436     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; count; ++i) {
00437         <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(i) == item) {
00438             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(i);
00439             ret = <font class="keyword">true</font>;
00440             <font class="keywordflow">break</font>;
00441         }
00442     }
00443     <font class="keywordflow">if</font> (!ret)
00444         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(-1);
00445     <font class="keywordflow">return</font> ret;
00446 }
00447 
<a name="l00449"></a><a class="code" href="class_c_key_chooser_widget.html#i1">00449</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#i1">CKeyChooserWidget::next</a>(){
00450     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem() != <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count()-1) {<font class="comment">// not last entry</font>
00451         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem( <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()+1 );
00452         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00453     }
00454 }
00455 
<a name="l00457"></a><a class="code" href="class_c_key_chooser_widget.html#i0">00457</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#i0">CKeyChooserWidget::previous</a>(){
00458     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem() != 0) {<font class="comment">// not last entry</font>
00459         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem( <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()-1 );
00460         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00461     }
00462 }
00463 
<a name="l00464"></a><a class="code" href="class_c_key_chooser_widget.html#a10">00464</a> QComboBox* <a class="code" href="class_c_key_chooser_widget.html#a10">CKeyChooserWidget::comboBox</a>(){
00465     <font class="keywordflow">return</font> <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>;
00466 }
00467 
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:12 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
