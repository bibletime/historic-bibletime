<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ckeychooserwidget.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>ckeychooserwidget.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          ckeychooserwidget.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Tue Sep 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 <font class="comment">//BibleTime includes</font>
00018 <font class="preprocessor">#include "ckeychooserwidget.h"</font>
00019 <font class="preprocessor">#include "cfx_btn.h"</font>
00020 <font class="preprocessor">#include "../cbtconfig.h"</font>
00021 
00022 <font class="comment">//Qt includes</font>
00023 <font class="preprocessor">#include &lt;qlineedit.h&gt;</font>
00024 <font class="preprocessor">#include &lt;qstring.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00026 <font class="preprocessor">#include &lt;qlistbox.h&gt;</font>
00027 <font class="preprocessor">#include &lt;qtoolbutton.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00029 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qpainter.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qstyle.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qpixmap.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qapplication.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00036 
00037 CKCComboBox::CKCComboBox(<font class="keywordtype">bool</font> rw,QWidget* parent,<font class="keyword">const</font> <font class="keywordtype">char</font>* name)
00038   : QComboBox(rw,parent,name){
00039     setFocusPolicy(QWidget::WheelFocus);
00040   <font class="keywordflow">if</font> (lineEdit()) {
00041     installEventFilter( lineEdit() );
00042   }
00043 }
00044 
00046 <font class="keywordtype">bool</font> CKCComboBox::eventFilter( QObject *o, QEvent *e ){         
00047 <font class="comment">//  qWarning("CKCComboBox::eventFilter( QObject *o, QEvent *e )");</font>
00048     <font class="keywordflow">if</font> (e-&gt;type() == QEvent::FocusOut) {
00049         QFocusEvent* f = static_cast&lt;QFocusEvent*&gt;(e);
00050 <font class="comment">//      qWarning("FocusOut: %d", f-&gt;reason());</font>
00051 <font class="comment">//      qWarning("Mouse: %d",(f-&gt;reason()==QFocusEvent::Mouse)?1:0);</font>
00052 <font class="comment">//    qWarning("lineedit: %d",(o == lineEdit())?1:0);</font>
00053 <font class="comment">//    qWarning("listbox: %d",(o == listBox())?1:0);</font>
00054 <font class="comment">//    qWarning("this: %d",(o == this)?1:0);</font>
00055 
00056         
00057         <font class="keywordflow">if</font> (o == lineEdit() &amp;&amp; f-&gt;reason() == QFocusEvent::Tab) {
00058         <font class="keywordtype">int</font> index = listBox()-&gt;index( listBox()-&gt;findItem(currentText()) );
00059         <font class="keywordflow">if</font> (index == -1)
00060                 index = 0;<font class="comment">// return 0 if not found</font>
00061         setCurrentItem( index );    
00062         emit focusOut( index );     
00063       }
00064       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp;*/</font> f-&gt;reason() == QFocusEvent::Popup) {
00065             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00066         }
00067       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp; */</font>f-&gt;reason() == QFocusEvent::ActiveWindow) {
00068             emit activated(currentText());
00069             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00070         }
00071       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<font class="comment">/*o == lineEdit() &amp;&amp;*/</font> f-&gt;reason() == QFocusEvent::Mouse) {
00072             emit activated(currentText());
00073             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00074         }       
00075       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (o == listBox()) {  <font class="comment">//???</font>
00076             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00077         }
00078       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (o == <font class="keyword">this</font>) {
00079             emit activated(currentText());
00080             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00081         }       
00082     }
00083 <font class="comment">//  qWarning("not handled!");</font>
00084   <font class="keywordflow">return</font> QComboBox::eventFilter(o,e);   
00085 }
00086 
00088 <font class="keywordtype">void</font> CKCComboBox::wheelEvent( QWheelEvent* e ) {
00089     <font class="keyword">const</font> <font class="keywordtype">signed</font> <font class="keywordtype">int</font> change = (int)((float)e-&gt;delta()/(float)120);
00090     <font class="keywordtype">int</font> current = currentItem();
00091     
00092     <font class="keywordflow">if</font> ((current+change &gt;= 0) &amp;&amp; (current+change&lt;count()) ) {
00093         setCurrentItem(current+change);
00094         e-&gt;accept();
00095         emit activated( currentItem() );
00096     }
00097     <font class="keywordflow">else</font> {
00098         e-&gt;ignore();
00099     }
00100 }
00101 
00103 QSize CKCComboBox::sizeHint()<font class="keyword"> const </font>{
00104     <font class="comment">// IMHO Qt has a bug: The sizehint is not updated if the list is refreshed with other items</font>
00105     <font class="keyword">const</font> QSize oldSize = QComboBox::sizeHint();
00106     QRect contentsRect = style().comboButtonRect(0,0, oldSize.width(), oldSize.height());
00107     <font class="keyword">const</font> <font class="keywordtype">int</font> buttonWidth = (oldSize.width() - contentsRect.width());
00108 
00109     <font class="keywordflow">if</font> (listBox())  {
00110         <font class="keywordflow">return</font> QSize( listBox()-&gt;sizeHint().width()+buttonWidth, QComboBox::sizeHint().height());
00111     }
00112     <font class="keywordflow">else</font> {
00113         <font class="keywordflow">return</font> QSize( QComboBox::sizeHint().width()+buttonWidth, QComboBox::sizeHint().height());   
00114     }
00115 }
00116 
00117 
00118 <font class="comment">//**********************************************************************************/</font>
00119 
<a name="l00120"></a><a class="code" href="class_c_key_chooser_widget.html#a1">00120</a> <a class="code" href="class_c_key_chooser_widget.html#a0">CKeyChooserWidget::CKeyChooserWidget</a>(<font class="keywordtype">int</font> count, <font class="keyword">const</font> <font class="keywordtype">bool</font> useNextPrevSignals,  QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name) : QWidget(parent,name) {
00121     m_useNextPrevSignals = useNextPrevSignals;
00122     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index=1; index &lt;= count; index++)
00123         m_list.append( QString::number(index) );    
00124     <a class="code" href="class_c_key_chooser_widget.html#a5">init</a>();
00125     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(m_list,0,<font class="keyword">false</font>);
00126 };
00127 
<a name="l00128"></a><a class="code" href="class_c_key_chooser_widget.html#a0">00128</a> <a class="code" href="class_c_key_chooser_widget.html#a0">CKeyChooserWidget::CKeyChooserWidget</a>(QStringList *list, <font class="keyword">const</font> <font class="keywordtype">bool</font> useNextPrevSignals, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : QWidget(parent,name) {
00129     m_useNextPrevSignals = useNextPrevSignals;      
00130     <font class="keywordflow">if</font> (list)
00131         m_list = *list;<font class="comment">//copy the items of list</font>
00132     <font class="keywordflow">else</font>
00133         m_list.clear();
00134     <a class="code" href="class_c_key_chooser_widget.html#a5">init</a>();
00135     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(m_list,0,<font class="keyword">false</font>);  
00136 }
00137 
<a name="l00138"></a><a class="code" href="class_c_key_chooser_widget.html#g2">00138</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g2">CKeyChooserWidget::changeCombo</a>(<font class="keywordtype">int</font> i){
00139     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00140         <font class="keywordflow">return</font>;
00141     setUpdatesEnabled(<font class="keyword">false</font>);
00142     
00143     <font class="keywordtype">int</font> current = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem();
00144 
00145     <font class="comment">//index of highest Item</font>
00146     <font class="keyword">const</font> <font class="keywordtype">int</font> count = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count()-1;
00147     <font class="keywordtype">int</font> j = current + i;
00148     <font class="keywordflow">if</font> (i &gt; 0){
00149         <font class="keywordflow">if</font> (j &lt;= count)
00150             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(j);
00151         <font class="keywordflow">else</font>
00152             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(count);
00153     }
00154     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (i &lt; 0){
00155         <font class="keywordflow">if</font> (j&gt;=0)
00156             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(j);
00157         <font class="keywordflow">else</font>
00158             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(0);
00159     }   
00160     <font class="keywordflow">if</font> (!<a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> &amp;&amp; !btn_fx-&gt;<a class="code" href="classcfx__btn.html#a1">isLocked</a>() &amp;&amp; (current != <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()))  
00161         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00162         
00163     setUpdatesEnabled(<font class="keyword">true</font>);        
00164 }
00165 
<a name="l00166"></a><a class="code" href="class_c_key_chooser_widget.html#a2">00166</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(<font class="keyword">const</font> <font class="keywordtype">int</font> count, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00167 <font class="comment">//  qWarning("CKeyChooserWidget::reset(const int count, int index, bool do_emit)");</font>
00168     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00169         <font class="keywordflow">return</font>;
00170 
00171     m_list.clear();
00172     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i &lt;= count; i++)
00173         m_list.append( QString::number(i) );
00174     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(&amp;m_list,index,do_emit);
00175 }
00176 
00177 <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(QStringList&amp; list, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00178     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00179         <font class="keywordflow">return</font>;
00180     
00181     m_list = list;
00182     <a class="code" href="class_c_key_chooser_widget.html#a2">reset</a>(&amp;m_list,index,do_emit);
00183     
00184     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;
00185 }
00186 
00187 
00188 <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a2">CKeyChooserWidget::reset</a>(QStringList *list, <font class="keywordtype">int</font> index, <font class="keywordtype">bool</font> do_emit){
00189     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> || !isUpdatesEnabled())
00190         <font class="keywordflow">return</font>;
00191     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">true</font>; 
00192     setUpdatesEnabled(<font class="keyword">false</font>);
00193     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setUpdatesEnabled(<font class="keyword">false</font>);
00194 
00195     m_mainLayout-&gt;setResizeMode(QLayout::FreeResize);
00196     
00197     oldKey = QString::null;
00198     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;clear();
00199     <font class="keywordflow">if</font> (list)
00200         <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;insertStringList(*list);
00201     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;resize( <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;sizeHint() );
00202     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setUpdatesEnabled(<font class="keyword">true</font>);            
00203     
00204     m_mainLayout-&gt;setResizeMode(QLayout::Minimum);
00205     
00206     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setCurrentItem(index);  
00207     <font class="keywordflow">if</font> (!list || (list &amp;&amp; !list-&gt;count())) { <font class="comment">//nothing in the combobox</font>
00208         btn_up-&gt;setEnabled( <font class="keyword">true</font> );
00209         btn_fx-&gt;setEnabled( <font class="keyword">true</font> );
00210         btn_down-&gt;setEnabled( <font class="keyword">true</font> );       
00211         setEnabled(<font class="keyword">false</font>);
00212     }
00213     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!isEnabled()) { <font class="comment">//was disabled</font>
00214         setEnabled(<font class="keyword">true</font>);   
00215         <font class="keyword">const</font> <font class="keywordtype">bool</font> enableButtons = list &amp;&amp; (list-&gt;count()&gt;=1);
00216         btn_up-&gt;setEnabled( enableButtons );
00217         btn_fx-&gt;setEnabled( enableButtons );
00218         btn_down-&gt;setEnabled( list &amp;&amp; (list-&gt;count()&gt;1) );
00219     }
00220     setUpdatesEnabled(<font class="keyword">true</font>);
00221     
00222     <font class="keywordflow">if</font> (do_emit) {
00223         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;currentItem());                
00224     }
00225     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;    
00226 }
00227 
<a name="l00228"></a><a class="code" href="class_c_key_chooser_widget.html#g0">00228</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g0">CKeyChooserWidget::lock</a>(<font class="keywordtype">void</font>){
00229     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditable(<font class="keyword">false</font>);
00230     oldKey = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentText();
00231 }
00232 
<a name="l00233"></a><a class="code" href="class_c_key_chooser_widget.html#g1">00233</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#g1">CKeyChooserWidget::unlock</a>(<font class="keywordtype">void</font>){
00234     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditable(<font class="keyword">true</font>);
00235     <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setEditText(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()));
00236     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentText() != oldKey);
00237         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00238 }
00239 
<a name="l00241"></a><a class="code" href="class_c_key_chooser_widget.html#a5">00241</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a5">CKeyChooserWidget::init</a>( ){
00242     oldKey = QString::null;
00243     btn_up = btn_down = btn_fx = 0;
00244 
00245     setFocusPolicy(QWidget::StrongFocus);           
00246     m_mainLayout = <font class="keyword">new</font> QHBoxLayout( <font class="keyword">this</font> ); 
00247             
00248     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a> = <font class="keyword">new</font> CKCComboBox( <font class="keyword">true</font>, <font class="keyword">this</font> );
00249     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setAutoCompletion( <font class="keyword">true</font> );
00250     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setInsertionPolicy(QComboBox::NoInsertion);
00251     <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>-&gt;setFocusPolicy(QWidget::WheelFocus);    
00252 
00253   m_mainLayout-&gt;setResizeMode(QLayout::Minimum);            
00254     m_mainLayout-&gt;addWidget( <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a> );
00255 
00256     QVBoxLayout *m_buttonLayout = <font class="keyword">new</font> QVBoxLayout();    
00257     m_buttonLayout-&gt;setAlignment(Qt::AlignHCenter | Qt::AlignCenter);
00258         
00259     btn_up = <font class="keyword">new</font> QToolButton( <font class="keyword">this</font>, <font class="stringliteral">"btn_up"</font> ); 
00260     QIconSet iconSet = <a class="code" href="class_c_key_chooser_widget.html#b0">getUpIconSet</a>();
00261     btn_up-&gt;setIconSet( iconSet );
00262     btn_up-&gt;setFixedSize(iconSet.pixmap().width(), iconSet.pixmap().height());
00263     btn_up-&gt;setFocusPolicy(QWidget::NoFocus);   
00264     
00265     btn_fx = <font class="keyword">new</font> <a class="code" href="classcfx__btn.html">cfx_btn</a>( <font class="keyword">this</font>, <font class="stringliteral">"btn_fx"</font> );
00266     iconSet = <a class="code" href="class_c_key_chooser_widget.html#b1">getMoverIconSet</a>();
00267     btn_fx-&gt;setIconSet( iconSet );  
00268     btn_fx-&gt;setFixedSize(iconSet.pixmap().width(), iconSet.pixmap().height());  
00269     btn_fx-&gt;setFocusPolicy(QWidget::NoFocus);   
00270     
00271     btn_down = <font class="keyword">new</font> QToolButton( <font class="keyword">this</font>, <font class="stringliteral">"btn_down"</font> ); 
00272     iconSet = <a class="code" href="class_c_key_chooser_widget.html#b2">getDownIconSet</a>();
00273     btn_down-&gt;setIconSet( iconSet );
00274     btn_down-&gt;setFixedSize(iconSet.pixmap().width(), iconSet.pixmap().height());    
00275     btn_down-&gt;setFocusPolicy(QWidget::NoFocus); 
00276     
00277     m_buttonLayout-&gt;addWidget( btn_up );    
00278     m_buttonLayout-&gt;addWidget( btn_fx );    
00279     m_buttonLayout-&gt;addWidget( btn_down );
00280     
00281     m_mainLayout-&gt;addLayout( m_buttonLayout );
00282     m_mainLayout-&gt;addSpacing(2);
00283 
00284     setTabOrder(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, 0);
00285         
00286 <font class="comment">// signals and slots connections</font>
00287     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ) {
00288         <font class="keywordflow">if</font> (m_useNextPrevSignals) {
00289             connect(btn_up, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j1">prev_requested</a>()) );  
00290             connect(btn_down, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j0">next_requested</a>()) );
00291       }
00292       <font class="keywordflow">else</font> {
00293             connect(btn_up, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i0">previous</a>()) );  
00294             connect(btn_down, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i1">next</a>()) );    
00295       }
00296     }
00297     <font class="keywordflow">else</font> {
00298         <font class="keywordflow">if</font> (m_useNextPrevSignals) {
00299             connect(btn_up, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j0">next_requested</a>()) );  
00300             connect(btn_down, SIGNAL(clicked()), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j1">prev_requested</a>()) );
00301       }
00302       <font class="keywordflow">else</font> {
00303             connect(btn_up, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i1">next</a>()) );  
00304             connect(btn_down, SIGNAL(clicked()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#i0">previous</a>()) );    
00305         }
00306     }
00307     
00308     connect(btn_fx, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#g0">lock</a>()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g0">lock</a>()) );
00309     connect(btn_fx, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#g1">unlock</a>()), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g1">unlock</a>()) );
00310     connect(btn_fx, SIGNAL(change_requested(<font class="keywordtype">int</font>)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#g2">changeCombo</a>(<font class="keywordtype">int</font>)) );
00311     
00312     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(activated(<font class="keywordtype">int</font>)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#h1">slotComboChanged</a>(<font class="keywordtype">int</font>)));
00313     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(activated(<font class="keyword">const</font> QString&amp;)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#h0">slotReturnPressed</a>(<font class="keyword">const</font> QString&amp;)));
00314     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(returnPressed(<font class="keyword">const</font> QString&amp;)), SLOT(<a class="code" href="class_c_key_chooser_widget.html#h0">slotReturnPressed</a>(<font class="keyword">const</font> QString&amp;)));
00315     connect(<a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>, SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j3">focusOut</a>(<font class="keywordtype">int</font>)), SIGNAL(<a class="code" href="class_c_key_chooser_widget.html#j3">focusOut</a>(<font class="keywordtype">int</font>)));  
00316         
00317     <a class="code" href="class_c_key_chooser_widget.html#n0">isResetting</a> = <font class="keyword">false</font>;
00318 }
00319 
<a name="l00321"></a><a class="code" href="class_c_key_chooser_widget.html#h0">00321</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#h0">CKeyChooserWidget::slotReturnPressed</a>( <font class="keyword">const</font> QString&amp; text){
00322     qWarning(<font class="stringliteral">"Return was pressed!!"</font>);
00323     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index=0; index &lt; <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count(); index++) {
00324         <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(index) == text) {
00325             <font class="keywordflow">if</font> ( text != oldKey)    <font class="comment">//if the key has changed</font>
00326                 emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(index);
00327             <font class="keywordflow">break</font>;
00328         }
00329     }
00330 }
00331 
<a name="l00333"></a><a class="code" href="class_c_key_chooser_widget.html#h1">00333</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#h1">CKeyChooserWidget::slotComboChanged</a>(<font class="keywordtype">int</font> index){
00334 <font class="comment">//  qWarning("CKeyChooserWidget::slotComboChanged(int index)");</font>
00335     <font class="keywordflow">if</font> (!isUpdatesEnabled())
00336         <font class="keywordflow">return</font>;
00337     setUpdatesEnabled(<font class="keyword">false</font>);   
00338     
00339     <font class="keyword">const</font> QString key = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text( index );
00340     <font class="keywordflow">if</font> (oldKey.isNull() || (oldKey != key))
00341         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(index);
00342     oldKey = key;
00343 
00344     setUpdatesEnabled(<font class="keyword">true</font>);        
00345 }
00346 
00347 <font class="preprocessor">#define WIDTH 17</font>
00348 <font class="preprocessor"></font><font class="preprocessor">#define ARROW_HEIGHT 10</font>
00349 <font class="preprocessor"></font><font class="preprocessor">#define MOVER_HEIGHT 6</font>
00350 <font class="preprocessor"></font>
<a name="l00352"></a><a class="code" href="class_c_key_chooser_widget.html#b0">00352</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b0">CKeyChooserWidget::getUpIconSet</a>(){
00353   QPixmap pix(WIDTH,ARROW_HEIGHT);
00354     QPainter p(&amp;pix);
00355     p.fillRect(0,0, WIDTH-1, ARROW_HEIGHT-1, colorGroup().background());
00356     style().drawArrow(&amp;p, Qt::UpArrow, <font class="keyword">false</font>, 1,1, WIDTH-2, ARROW_HEIGHT-2, btn_up ? btn_up-&gt;colorGroup() : colorGroup(), btn_up ? btn_up-&gt;isEnabled() : <font class="keyword">true</font>);
00357     
00358     <font class="keywordflow">return</font> QIconSet(pix);
00359 }
00360 
<a name="l00362"></a><a class="code" href="class_c_key_chooser_widget.html#b2">00362</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b2">CKeyChooserWidget::getDownIconSet</a>(){
00363   QPixmap pix(WIDTH,ARROW_HEIGHT);
00364     QPainter p(&amp;pix);
00365     p.fillRect(0,0, WIDTH-1, ARROW_HEIGHT-1, colorGroup().background());
00366     style().drawArrow(&amp;p, Qt::DownArrow, <font class="keyword">false</font>, 1,1, WIDTH-2, ARROW_HEIGHT-2, btn_down ? btn_down-&gt;colorGroup() : colorGroup(), btn_down ? btn_down-&gt;isEnabled() : <font class="keyword">true</font>);
00367     
00368     <font class="keywordflow">return</font> QIconSet(pix);
00369 }
00370 
<a name="l00372"></a><a class="code" href="class_c_key_chooser_widget.html#b1">00372</a> QIconSet <a class="code" href="class_c_key_chooser_widget.html#b1">CKeyChooserWidget::getMoverIconSet</a>(){
00373   QPixmap pix(WIDTH,MOVER_HEIGHT);
00374     QPainter p(&amp;pix);
00375     p.fillRect(0,0, WIDTH-1, MOVER_HEIGHT-1, colorGroup().background());
00376     p.fillRect(2,2, WIDTH-3, MOVER_HEIGHT-3, colorGroup().foreground());        
00377     <font class="keywordflow">return</font> QIconSet(pix);
00378 }
00379 <font class="preprocessor">#undef WIDTH</font>
00380 <font class="preprocessor"></font><font class="preprocessor">#undef ARROW_HEIGHT</font>
00381 <font class="preprocessor"></font><font class="preprocessor">#undef MOVER_HEIGHT</font>
00382 <font class="preprocessor"></font>
00384 <font class="keywordtype">void</font> CKeyChooserWidget::adjustSize( ){
00385     setUpdatesEnabled(<font class="keyword">false</font>);
00386     QSize s = sizeHint();
00387     <font class="keywordflow">if</font> (s.width() &gt; maximumWidth())
00388         s.setWidth( maximumWidth() );
00389     
00390     resize(s);
00391     setUpdatesEnabled(<font class="keyword">true</font>);    
00392 }
00393 
<a name="l00395"></a><a class="code" href="class_c_key_chooser_widget.html#a8">00395</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a8">CKeyChooserWidget::setToolTips</a>( <font class="keyword">const</font> QString comboTip, <font class="keyword">const</font> QString nextEntryTip, <font class="keyword">const</font> QString scrollButtonTip, <font class="keyword">const</font> QString previousEntryTip){
00396     QToolTip::add(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>(),comboTip);
00397     QToolTip::add(btn_fx,  scrollButtonTip);
00398 
00399     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ){
00400         QToolTip::add(btn_down, nextEntryTip);
00401         QToolTip::add(btn_up,   previousEntryTip);
00402     }
00403     <font class="keywordflow">else</font> {
00404         QToolTip::add(btn_up,   nextEntryTip);
00405         QToolTip::add(btn_down, previousEntryTip);
00406     }
00407 }
00408 
<a name="l00410"></a><a class="code" href="class_c_key_chooser_widget.html#a7">00410</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#a7">CKeyChooserWidget::setWhatsThis</a>(<font class="keyword">const</font> QString comboTip, <font class="keyword">const</font> QString nextEntryTip, <font class="keyword">const</font> QString scrollButtonTip, <font class="keyword">const</font> QString previousEntryTip){
00411     QWhatsThis::add(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>(),comboTip);
00412     QWhatsThis::add(btn_fx,  scrollButtonTip);
00413 
00414     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::scroll) ) {
00415         QWhatsThis::add(btn_down, nextEntryTip);
00416         QWhatsThis::add(btn_up,   previousEntryTip);
00417     }
00418     <font class="keywordflow">else</font> {
00419         QWhatsThis::add(btn_up,   nextEntryTip);
00420         QWhatsThis::add(btn_down, previousEntryTip);
00421     }
00422 }
00423 
<a name="l00425"></a><a class="code" href="class_c_key_chooser_widget.html#a9">00425</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_key_chooser_widget.html#a9">CKeyChooserWidget::setItem</a>( <font class="keyword">const</font> QString item ){
00426     qDebug(<font class="stringliteral">"CKeyChooserWidget::setItem( const QString item )"</font>);
00427     <font class="keywordtype">bool</font> ret = <font class="keyword">false</font>;
00428     <font class="keyword">const</font> <font class="keywordtype">int</font> count = <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count();
00429     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; count; ++i) {
00430         <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;text(i) == item) {
00431             <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(i);
00432             ret = <font class="keyword">true</font>;
00433             <font class="keywordflow">break</font>;
00434         }
00435     }
00436     <font class="keywordflow">if</font> (!ret)
00437         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem(-1);
00438     <font class="keywordflow">return</font> ret;
00439 }
00440 
<a name="l00442"></a><a class="code" href="class_c_key_chooser_widget.html#i1">00442</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#i1">CKeyChooserWidget::next</a>(){
00443     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem() != <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;count()-1) {<font class="comment">// not last entry</font>
00444         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem( <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()+1 );
00445         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00446     }
00447 }
00448 
<a name="l00450"></a><a class="code" href="class_c_key_chooser_widget.html#i0">00450</a> <font class="keywordtype">void</font> <a class="code" href="class_c_key_chooser_widget.html#i0">CKeyChooserWidget::previous</a>(){
00451     <font class="keywordflow">if</font> (<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem() != 0) {<font class="comment">// not last entry</font>
00452         <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;setCurrentItem( <a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem()-1 );
00453         emit <a class="code" href="class_c_key_chooser_widget.html#j2">changed</a>(<a class="code" href="class_c_key_chooser_widget.html#a10">comboBox</a>()-&gt;currentItem());
00454     }
00455 }
00456 
<a name="l00457"></a><a class="code" href="class_c_key_chooser_widget.html#a10">00457</a> QComboBox* <a class="code" href="class_c_key_chooser_widget.html#a10">CKeyChooserWidget::comboBox</a>(){
00458     <font class="keywordflow">return</font> <a class="code" href="class_c_key_chooser_widget.html#o2">m_comboBox</a>;
00459 }
00460 
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
