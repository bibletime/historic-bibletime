<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>chtmlreaddisplay.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>chtmlreaddisplay.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          chtmlreaddisplay.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Don Mai 9 2002</font>
00005 <font class="comment">    copyright            : (C) 2002 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "chtmlreaddisplay.h"</font>
00019 
00020 <font class="preprocessor">#include "frontend/displaywindow/cdisplaywindow.h"</font>
00021 <font class="preprocessor">#include "frontend/displaywindow/creadwindow.h"</font>
00022 <font class="preprocessor">#include "backend/creferencemanager.h"</font>
00023 <font class="preprocessor">#include "backend/cswordkey.h"</font>
00024 
00025 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00026 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00027 <font class="preprocessor">#include "frontend/ctooltipmanager.h"</font>
00028 
00029 <font class="preprocessor">#include "util/scoped_resource.h"</font>
00030 
00031 <font class="preprocessor">#include "resource.h"</font>
00032 
00033 <font class="comment">//Qt includes</font>
00034 <font class="preprocessor">#include &lt;qcursor.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qwidget.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00037 <font class="preprocessor">#include &lt;qpopupmenu.h&gt;</font>
00038 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00039 
00040 <font class="comment">//KDE includes</font>
00041 <font class="preprocessor">#include &lt;kapplication.h&gt;</font>
00042 <font class="preprocessor">#include &lt;khtmlview.h&gt;</font>
00043 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00044 <font class="preprocessor">#include &lt;khtml_events.h&gt;</font>
00045 <font class="preprocessor">#include &lt;dom/dom2_range.h&gt;</font>
00046 <font class="preprocessor">#include &lt;dom/html_element.h&gt;</font>
00047 
00048 
00049 CHTMLReadDisplay::CHTMLReadDisplay(<a class="code" href="class_c_read_window.html">CReadWindow</a>* readWindow, QWidget* parentWidget) : KHTMLPart((m_view = new CHTMLReadDisplayView(this, parentWidget ? parentWidget : readWindow)), readWindow), <a class="code" href="class_c_read_display.html">CReadDisplay</a>(readWindow) {
00050     qWarning(<font class="stringliteral">"constructor of CHTMLReadDisplay"</font>);
00051   Q_ASSERT(readWindow);
00052   Q_ASSERT(parentWidget);
00053   setDNDEnabled(<font class="keyword">false</font>);
00054   m_view-&gt;setDragAutoScroll(<font class="keyword">false</font>);
00055 }
00056 
00057 CHTMLReadDisplay::~CHTMLReadDisplay(){
00058 }
00059 
<a name="l00060"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a0">00060</a> <font class="keyword">const</font> QString <a class="code" href="class_c_h_t_m_l_read_display.html#a0">CHTMLReadDisplay::text</a>( <font class="keyword">const</font> CDisplay::TextType format, <font class="keyword">const</font> CDisplay::TextPart part) {
00061 <font class="comment">//  qWarning("CHTMLReadDisplay::text( const CDisplay::TextType format, const CDisplay::TextPart part)");</font>
00062   <font class="keywordflow">switch</font> (part) {
00063     <font class="keywordflow">case</font> Document: {
00064       <font class="keywordflow">if</font> (format == HTMLText)
00065         <font class="keywordflow">return</font> document().toHTML();
00066       <font class="keywordflow">else</font> {
00067         qWarning(htmlDocument().body().innerText().string().latin1());
00068         <font class="keywordflow">return</font> htmlDocument().body().innerText().string().latin1();
00069       }
00070         }
00071 
00072     <font class="keywordflow">case</font> SelectedText: {
00073             <font class="keywordflow">if</font> (!<a class="code" href="class_c_h_t_m_l_read_display.html#a2">hasSelection</a>())
00074             <font class="keywordflow">return</font> QString::null;
00075 
00076       DOM::Range range = selection();
00077       <font class="keywordflow">if</font> (range.isNull()) {
00078         <font class="keywordflow">return</font> QString::null;
00079       }
00080       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (format == HTMLText) {
00081         <font class="keywordflow">return</font> range.toHTML().string();
00082       }
00083       <font class="keywordflow">else</font> {
00084         <font class="keywordflow">return</font> range.toString().string();
00085       }
00086         }
00087 
00088     <font class="keywordflow">case</font> AnchorOnly: {
00089             QString moduleName;
00090         QString keyName;
00091         CReferenceManager::Type type;
00092       <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(<a class="code" href="class_c_read_display.html#a3">activeAnchor</a>(), moduleName, keyName, type);
00093         <font class="keywordflow">return</font> keyName;
00094     }
00095 
00096         <font class="keywordflow">case</font> AnchorTextOnly: {
00097             QString moduleName;
00098         QString keyName;
00099         CReferenceManager::Type type;
00100       <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(<a class="code" href="class_c_read_display.html#a3">activeAnchor</a>(), moduleName, keyName, type);
00101 
00102       <font class="keywordflow">if</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(moduleName)) {
00103                 <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module) );
00104             key-&gt;key( keyName );
00105 
00106         <font class="keywordflow">return</font> key-&gt;strippedText();
00107         }
00108         <font class="keywordflow">return</font> QString::null;
00109     }
00110 
00111     <font class="keywordflow">case</font> AnchorWithText: {
00112             QString moduleName;
00113         QString keyName;
00114         CReferenceManager::Type type;
00115       <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(<a class="code" href="class_c_read_display.html#a3">activeAnchor</a>(), moduleName, keyName, type);
00116 
00117       <font class="keywordflow">if</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(moduleName)) {
00118                 <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module) );
00119             key-&gt;key( keyName );
00120 
00121         <font class="keywordflow">return</font> QString::fromLatin1(<font class="stringliteral">"%1\n\t%2"</font>).arg(key-&gt;key()).arg(key-&gt;strippedText());
00122         }
00123         <font class="keywordflow">return</font> QString::null;
00124     }
00125 
00126 
00127     <font class="keywordflow">default</font>:
00128       <font class="keywordflow">return</font> QString::null;
00129   }
00130 }
00131 
<a name="l00132"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a1">00132</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a1">CHTMLReadDisplay::setText</a>( <font class="keyword">const</font> QString&amp; newText ) {
00133   qWarning(<font class="stringliteral">"CHTMLReadDisplay::view()"</font>);
00134   begin();
00135   write(newText);
00136   end();
00137 }
00138 
<a name="l00140"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a2">00140</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a2">CHTMLReadDisplay::hasSelection</a>(){
00141   <font class="keywordflow">return</font> KHTMLPart::hasSelection();
00142 }
00143 
00144 
<a name="l00146"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a3">00146</a> QWidget* <a class="code" href="class_c_h_t_m_l_read_display.html#a3">CHTMLReadDisplay::view</a>(){
00147 <font class="comment">//  qWarning("CHTMLReadDisplay::view()");</font>
00148   <font class="keywordflow">return</font> KHTMLPart::view();
00149 }
00150 
<a name="l00151"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a4">00151</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a4">CHTMLReadDisplay::selectAll</a>() {
00152   KHTMLPart::selectAll();
00153 }
00154 
<a name="l00156"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a5">00156</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a5">CHTMLReadDisplay::moveToAnchor</a>( <font class="keyword">const</font> QString&amp; anchor ){
00157 <font class="comment">//  qWarning("nove to anchor %s", anchor.latin1());</font>
00158     gotoAnchor(anchor);
00159 }
00160 
00161 <font class="keywordtype">void</font> CHTMLReadDisplay::urlSelected( <font class="keyword">const</font> QString&amp; url, <font class="keywordtype">int</font> button, <font class="keywordtype">int</font> state, <font class="keyword">const</font> QString&amp; _target, KParts::URLArgs args){
00162   qWarning(<font class="stringliteral">"CHTMLReadDisplay::urlSelected"</font>);
00163   KHTMLPart::urlSelected(url, button, state, _target, args);
00164   <font class="keywordflow">if</font> (!url.isEmpty() &amp;&amp; <a class="code" href="class_c_reference_manager.html#d4">CReferenceManager::isHyperlink</a>(url)) {
00165     QString module;
00166     QString key;
00167     CReferenceManager::Type type;
00168     <font class="keyword">const</font> <font class="keywordtype">bool</font> ok = <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(url, module, key, type);
00169     <font class="keywordflow">if</font> (module.isEmpty())
00170       module = <a class="code" href="class_c_reference_manager.html#d5">CReferenceManager::preferredModule</a>( type );
00171 
00172 <font class="preprocessor">#warning Really bad bad work around! Otherwise the widget would scroll with the mouse moves afetr a link was clicked!</font>
00173 <font class="preprocessor"></font>    QMouseEvent me( QEvent::MouseButtonRelease, QPoint(0,0), QPoint(0,0), QMouseEvent::LeftButton, QMouseEvent::NoButton);
00174     khtml::MouseReleaseEvent kme(&amp;me, -1,-1, DOM::DOMString(), DOM::DOMString(), DOM::Node());
00175     KApplication::sendEvent( <font class="keyword">this</font>, &amp;kme );
00176 
00177         <a class="code" href="class_c_display.html#a7">connectionsProxy</a>()-&gt;emitReferenceClicked(module, key);
00178   }
00179 }
00180 
<a name="l00182"></a><a class="code" href="class_c_h_t_m_l_read_display.html#b3">00182</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#b3">CHTMLReadDisplay::khtmlMouseReleaseEvent</a>( khtml::MouseReleaseEvent* event ){
00183 <font class="comment">//  qWarning("CHTMLReadDisplay::khtmlMouseReleaseEvent( khtml::MouseReleaseEvent* event )");</font>
00184   KHTMLPart::khtmlMouseReleaseEvent(event); 
00185 
00186   m_dndData.mousePressed = <font class="keyword">false</font>;
00187   m_dndData.isDragging = <font class="keyword">false</font>;
00188   m_dndData.node = DOM::Node();
00189   m_dndData.anchor = DOM::DOMString();
00190 }
00191 
00192 <font class="keywordtype">void</font> CHTMLReadDisplay::khtmlMousePressEvent( khtml::MousePressEvent* event ){
00193   qWarning(<font class="stringliteral">"CHTMLReadDisplay::khtmlMousePressEvent( khtml::MousePressEvent* event )"</font>);  
00194   m_dndData.node = DOM::Node();
00195   m_dndData.anchor = DOM::DOMString();
00196   m_dndData.mousePressed = <font class="keyword">false</font>;
00197   m_dndData.isDragging = <font class="keyword">false</font>;
00198 
00199   <font class="keywordflow">if</font> (event-&gt;qmouseEvent()-&gt;button() == Qt::RightButton) {
00200     <a class="code" href="class_c_read_display.html#b2">setActiveAnchor</a>( event-&gt;url().string() );
00201 
00202     <font class="comment">//try to select the word under the mouse cursor!</font>
00203 <font class="comment">//    DOM::Node node = event-&gt;innerNode();</font>
00204 <font class="comment">//</font>
00205 <font class="comment">//    if (event-&gt;target().isEmpty())</font>
00206 <font class="comment">//      qWarning("TARGET is EMPTY!");</font>
00207 <font class="comment">//    qWarning("target: %s", event-&gt;target().string().latin1());</font>
00208 <font class="comment">//    qWarning("node: %s", event-&gt;innerNode().nodeName().string().latin1());</font>
00209 <font class="comment">//    qWarning("mouse node: %s",nodeUnderMouse().nodeName().string().latin1());</font>
00210 <font class="comment">//</font>
00211 <font class="comment">//    DOM::Range range = document().createRange();</font>
00213 <font class="comment">//    range.selectNode(node);</font>
00214 <font class="comment">//    if (!range.isNull() &amp;&amp; !node.isNull())</font>
00215 <font class="comment">//      setSelection(range);</font>
00216   }
00217   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (event-&gt;qmouseEvent()-&gt;button() == Qt::LeftButton) {
00218     m_dndData.node = event-&gt;innerNode();
00219     m_dndData.anchor = event-&gt;url();
00220     m_dndData.mousePressed = <font class="keyword">true</font>;
00221     m_dndData.isDragging = <font class="keyword">false</font>;
00222     m_dndData.startPos = QPoint(event-&gt;x(), event-&gt;y());
00223     m_dndData.selection = selectedText();
00224 
00225 <font class="comment">//    if (hasSelection()) {</font>
00226 <font class="comment">//      m_dndData.dragType = DNDData::Text;</font>
00227 <font class="comment">//      qWarning("# Drag the selection! %s", m_dndData.selection.latin1());</font>
00228 <font class="comment">//      return;</font>
00229 <font class="comment">//    }</font>
00230 <font class="comment">//    else</font>
00231 
00232     <font class="keywordflow">if</font> (!m_dndData.node.isNull()) { <font class="comment">//we drag a valid link</font>
00233       m_dndData.dragType = DNDData::Link;
00234     }
00235   }
00236 
00237   KHTMLPart::khtmlMousePressEvent(event);
00238 }
00239 
<a name="l00241"></a><a class="code" href="class_c_h_t_m_l_read_display.html#b5">00241</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#b5">CHTMLReadDisplay::khtmlMouseMoveEvent</a>( khtml::MouseMoveEvent* e ){
00242 <font class="comment">//  qWarning("CHTMLReadDisplay::khtmlMouseMoveEvent( khtml::MouseMoveEvent* e )");</font>
00243   <font class="keywordflow">if</font>( !(e-&gt;qmouseEvent()-&gt;state() &amp;&amp; LeftButton)) { <font class="comment">//left mouse button not pressed</font>
00244     KHTMLPart::khtmlMouseMoveEvent(e);
00245     <font class="keywordflow">return</font>;
00246   }
00247 
00248   <font class="keyword">const</font> <font class="keywordtype">int</font> delay = KGlobalSettings::dndEventDelay();
00249   QPoint newPos = QPoint(e-&gt;x(), e-&gt;y());
00250 
00251   <font class="keywordflow">if</font> ( (newPos.x() &gt; m_dndData.startPos.x()+delay || newPos.x() &lt; m_dndData.startPos.x()-delay ||
00252        newPos.y() &gt; m_dndData.startPos.y()+delay || newPos.y() &lt; m_dndData.startPos.y()-delay) &amp;&amp;
00253        !m_dndData.isDragging &amp;&amp; m_dndData.mousePressed  ) {
00254 
00255     QTextDrag* d = 0;
00256     <font class="keywordflow">if</font> (!m_dndData.anchor.isEmpty() &amp;&amp; m_dndData.dragType == DNDData::Link &amp;&amp; !m_dndData.node.isNull() ) {
00257       QString module = QString::null;
00258         QString key = QString::null;
00259         CReferenceManager::Type type;
00260         <font class="keywordflow">if</font> ( !<a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(m_dndData.anchor.string(), module, key, type) )
00261             <font class="keywordflow">return</font>;
00262         d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(module,key),KHTMLPart::view()-&gt;viewport());
00263       d-&gt;setSubtype(REFERENCE);
00264       d-&gt;setPixmap(REFERENCE_ICON_SMALL);
00265     }
00266     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_dndData.dragType == DNDData::Text &amp;&amp; !m_dndData.selection.isEmpty()) {
00267       qWarning(<font class="stringliteral">"new QTextDrag"</font>);
00268         d = <font class="keyword">new</font> QTextDrag(m_dndData.selection, KHTMLPart::view()-&gt;viewport());
00269       d-&gt;setSubtype(TEXT);
00270     }
00271 
00272     <font class="keywordflow">if</font> (d) {
00273       m_dndData.isDragging = <font class="keyword">true</font>;
00274       m_dndData.mousePressed = <font class="keyword">false</font>;
00275 
00276       d-&gt;drag();
00277       <font class="keywordflow">return</font>;
00278     }
00279   }
00280 
00281   KHTMLPart::khtmlMouseMoveEvent(e);
00282 }
00283 <font class="comment">/* -------------------------- */</font>
00284 CHTMLReadDisplayView::ToolTip::ToolTip(CHTMLReadDisplayView* view) : <a class="code" href="class_c_tool_tip.html">CToolTip</a>(view), m_view( view ) {
00285 };
00286 
00288 <font class="keywordtype">void</font> CHTMLReadDisplayView::ToolTip::maybeTip( <font class="keyword">const</font> QPoint&amp; p ){
00289   qWarning(<font class="stringliteral">"CHTMLReadDisplayView::ToolTip::maybeTip( const QPoint&amp; p )"</font>);
00290   DOM::Node node = m_view-&gt;part()-&gt;nodeUnderMouse();
00291   <font class="keywordflow">if</font> (node.isNull())
00292     <font class="keywordflow">return</font>;
00293 
00294   DOM::Node linkNode = node;
00295   <font class="keywordflow">do</font> {
00296     <font class="keywordflow">if</font> (!linkNode.isNull() &amp;&amp; linkNode.nodeName().string().upper() == <font class="stringliteral">"A"</font> ) { <font class="comment">//found right node</font>
00297       <font class="keywordflow">if</font> (linkNode.hasAttributes()) {
00298         QString link = QString::null;
00299         DOM::NamedNodeMap attributes = linkNode.attributes();
00300         <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i = 0; i &lt; attributes.length(); i++) {
00301           <font class="keywordflow">if</font> (attributes.item(i).nodeName().string().upper() == <font class="stringliteral">"HREF"</font>) {
00302             link = attributes.item(i).nodeValue().string();
00303             <font class="keywordflow">break</font>;
00304           }
00305         }
00306 
00307         <font class="keyword">const</font> QString tooltipText = <a class="code" href="class_c_tooltip_manager.html#d0">CTooltipManager::textForHyperlink</a>( link );
00308         <font class="keywordflow">if</font> (!tooltipText.isEmpty()) {
00309           QRect rect = linkNode.getRect();
00310           rect.setX( m_view-&gt;mapFromGlobal(QCursor::pos()).x() );
00311           rect.setY( m_view-&gt;mapFromGlobal(QCursor::pos()).y() );
00312             tip( m_view-&gt;mapFromGlobal(QCursor::pos()), rect, tooltipText );
00313         }
00314         <font class="keywordflow">break</font>;
00315       }
00316     }
00317   } <font class="keywordflow">while</font> ( !(linkNode = linkNode.parentNode()).isNull() );
00318 }
00319 
00320 <font class="comment">// ---------------------</font>
00321 
00322 CHTMLReadDisplayView::CHTMLReadDisplayView(<a class="code" href="class_c_h_t_m_l_read_display.html">CHTMLReadDisplay</a>* displayWidget, QWidget* parent) : KHTMLView(displayWidget, parent), m_display(displayWidget) {
00323   qWarning(<font class="stringliteral">"constructor of CHTMLReadDisplayView"</font>);
00324   Q_ASSERT(parent);
00325   viewport()-&gt;setAcceptDrops(<font class="keyword">true</font>);
00326   setMarginWidth(4);
00327   setMarginHeight(4);
00328 };
00329 
00330 
00332 <font class="keywordtype">void</font> CHTMLReadDisplayView::popupMenu( <font class="keyword">const</font> QString&amp; url, <font class="keyword">const</font> QPoint&amp; pos){   
00333 <font class="comment">//  qWarning("CHTMLReadDisplayView::popupMenu");</font>
00334     <font class="keywordflow">if</font> (!url.isEmpty()) {
00335     qWarning(url.latin1());
00336     m_display-&gt;setActiveAnchor(url);
00337     }
00338     <font class="keywordflow">if</font> (QPopupMenu* popup = m_display-&gt;installedPopup()) {
00339         popup-&gt;exec(pos);
00340   }
00341 }
00342 
00344 <font class="keywordtype">void</font> CHTMLReadDisplayView::polish(){
00345   KHTMLView::polish();
00346   connect( part(), SIGNAL(popupMenu(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QPoint&amp;)),
00347     <font class="keyword">this</font>, SLOT(popupMenu(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QPoint&amp;)));
00348 
00349   (void)<font class="keyword">new</font> ToolTip(<font class="keyword">this</font>);
00350 }
00351 
00353 <font class="keywordtype">void</font> CHTMLReadDisplayView::contentsDropEvent( QDropEvent* e ){
00354 <font class="comment">//  qWarning("CHTMLReadDisplayView::contentsDropEvent( QDropEvent* e )");</font>
00355 <font class="comment">//  KHTMLView::contentsDropEvent(e);</font>
00356   <font class="keywordflow">if</font> (QTextDrag::canDecode(e)) {
00357 <font class="comment">//    if (e-&gt;provides(REFERENCE) || e-&gt;provides(BOOKMARK))</font>
00358     {
00359       qWarning(<font class="stringliteral">"ACCEPT DROP EVENT!"</font>);
00360       QString str;
00361       QCString submime;
00362       <font class="keyword">const</font> <font class="keywordtype">bool</font> accept = QTextDrag::decode(e, str);
00363       qWarning(<font class="stringliteral">"DROP: %s"</font>, str.latin1());
00364 
00365       QString module;
00366       QString key;
00367       <a class="code" href="class_c_reference_manager.html#d3">CReferenceManager::decodeReference</a>(str, module, key );
00368 <font class="comment">//      qWarning("dropped key: %s", key.latin1());</font>
00369 
00370       e-&gt;acceptAction();
00371       m_display-&gt;connectionsProxy()-&gt;emitReferenceDropped(key);
00372       <font class="keywordflow">return</font>;
00373     }
00374   }
00375   e-&gt;acceptAction(<font class="keyword">false</font>);
00376   e-&gt;ignore();
00377 }
00378 
00380 <font class="keywordtype">void</font> CHTMLReadDisplayView::contentsDragEnterEvent( QDragEnterEvent* e ){
00381 <font class="comment">//  qWarning("CHTMLReadDisplayView::contentsDragEnterEvent( QDragEnterEvent* e )");</font>
00382 <font class="comment">//  KHTMLView::contentsDragEnterEvent(e);</font>
00383   <font class="keywordflow">if</font> (QTextDrag::canDecode(e)) {
00384 <font class="comment">//    if (e-&gt;provides(REFERENCE) || e-&gt;provides(BOOKMARK))</font>
00385     {
00386 <font class="comment">//      qWarning("ACCEPT ENTER EVENT!");</font>
00387       e-&gt;acceptAction();
00388       <font class="keywordflow">return</font>;
00389     }
00390   }
00391   e-&gt;acceptAction(<font class="keyword">false</font>);
00392   e-&gt;ignore();
00393 }
00394 
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:08 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
