<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>chtmlreaddisplay.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>chtmlreaddisplay.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          chtmlreaddisplay.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Don Mai 9 2002</font>
00005 <font class="comment">    copyright            : (C) 2002 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "chtmlreaddisplay.h"</font>
00019 
00020 <font class="preprocessor">#include "frontend/displaywindow/cdisplaywindow.h"</font>
00021 <font class="preprocessor">#include "frontend/displaywindow/creadwindow.h"</font>
00022 <font class="preprocessor">#include "backend/creferencemanager.h"</font>
00023 <font class="preprocessor">#include "backend/cswordkey.h"</font>
00024 
00025 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00026 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00027 <font class="preprocessor">#include "frontend/ctooltipmanager.h"</font>
00028 
00029 <font class="preprocessor">#include "util/scoped_resource.h"</font>
00030 
00031 <font class="preprocessor">#include "resource.h"</font>
00032 
00033 <font class="comment">//Qt includes</font>
00034 <font class="preprocessor">#include &lt;qwidget.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qpopupmenu.h&gt;</font>
00037 
00038 <font class="comment">//KDE includes</font>
00039 <font class="preprocessor">#include &lt;khtmlview.h&gt;</font>
00040 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00041 <font class="preprocessor">#include &lt;khtml_events.h&gt;</font>
00042 <font class="preprocessor">#include &lt;dom/dom2_range.h&gt;</font>
00043 <font class="preprocessor">#include &lt;dom/html_element.h&gt;</font>
00044 
00045 
00046 CHTMLReadDisplay::CHTMLReadDisplay(<a class="code" href="class_c_read_window.html">CReadWindow</a>* readWindow, <font class="keyword">const</font> <font class="keywordtype">char</font>* name ) : KHTMLPart((m_view = new CHTMLReadDisplayView(this, readWindow)),readWindow,name), <a class="code" href="class_c_read_display.html">CReadDisplay</a>(readWindow) {
00047     qWarning(<font class="stringliteral">"constructor of CHTMLReadDisplay"</font>);
00048   setDNDEnabled(<font class="keyword">false</font>);
00049 
00050 }
00051 
00052 CHTMLReadDisplay::~CHTMLReadDisplay(){
00053 }
00054 
<a name="l00055"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a0">00055</a> <font class="keyword">const</font> QString <a class="code" href="class_c_h_t_m_l_read_display.html#a0">CHTMLReadDisplay::text</a>( <font class="keyword">const</font> CDisplay::TextType format, <font class="keyword">const</font> CDisplay::TextPart part) {
00056   qWarning(<font class="stringliteral">"CHTMLReadDisplay::text( const CDisplay::TextType format, const CDisplay::TextPart part)"</font>);
00057   <font class="keywordflow">switch</font> (part) {
00058     <font class="keywordflow">case</font> Document: {
00059       <font class="keywordflow">if</font> (format == HTMLText)
00060         <font class="keywordflow">return</font> document().toHTML();
00061       <font class="keywordflow">else</font> {
00062         qWarning(htmlDocument().body().innerText().string().latin1());
00063         <font class="keywordflow">return</font> htmlDocument().body().innerText().string().latin1();
00064       }
00065         }
00066 
00067     <font class="keywordflow">case</font> SelectedText: {
00068             <font class="keywordflow">if</font> (!<a class="code" href="class_c_h_t_m_l_read_display.html#a2">hasSelection</a>())
00069             <font class="keywordflow">return</font> QString::null;
00070 
00071       DOM::Range range = selection();
00072       <font class="keywordflow">if</font> (range.isNull()) {
00073         <font class="keywordflow">return</font> QString::null;
00074       }
00075       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (format == HTMLText) {
00076         <font class="keywordflow">return</font> range.toHTML().string();
00077       }
00078       <font class="keywordflow">else</font> {
00079         <font class="keywordflow">return</font> range.toString().string();
00080       }
00081         }
00082 
00083     <font class="keywordflow">case</font> AnchorOnly:
00084         <font class="keywordflow">return</font> <a class="code" href="class_c_read_display.html#a3">activeAnchor</a>();
00085 
00086         <font class="keywordflow">case</font> AnchorTextOnly: {
00087             QString moduleName;
00088         QString keyName;
00089         CReferenceManager::Type type;
00090       <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(<a class="code" href="class_c_read_display.html#a3">activeAnchor</a>(), moduleName, keyName, type);
00091 
00092       <font class="keywordflow">if</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(moduleName)) {
00093                 <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module) );
00094             key-&gt;key( keyName );
00095 
00096         <font class="keywordflow">return</font> key-&gt;strippedText();
00097         }
00098         <font class="keywordflow">return</font> QString::null;
00099     }
00100 
00101     <font class="keywordflow">case</font> AnchorWithText: {
00102             QString moduleName;
00103         QString keyName;
00104         CReferenceManager::Type type;
00105       <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(<a class="code" href="class_c_read_display.html#a3">activeAnchor</a>(), moduleName, keyName, type);
00106 
00107       <font class="keywordflow">if</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(moduleName)) {
00108                 <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module) );
00109             key-&gt;key( keyName );
00110 
00111         <font class="keywordflow">return</font> QString::fromLatin1(<font class="stringliteral">"%1\n\t%2"</font>).arg(key-&gt;key()).arg(key-&gt;strippedText());
00112         }
00113         <font class="keywordflow">return</font> QString::null;
00114     }
00115 
00116 
00117     <font class="keywordflow">default</font>:
00118       <font class="keywordflow">return</font> QString::null;
00119   }
00120 }
00121 
<a name="l00122"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a1">00122</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a1">CHTMLReadDisplay::setText</a>( <font class="keyword">const</font> QString&amp; newText ) {
00123 <font class="comment">//  qWarning("CHTMLReadDisplay::view()");</font>
00124   begin();
00125   write(newText);
00126   end();
00127 }
00128 
<a name="l00130"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a2">00130</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a2">CHTMLReadDisplay::hasSelection</a>(){
00131   <font class="keywordflow">return</font> KHTMLPart::hasSelection();
00132 }
00133 
00134 
<a name="l00136"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a3">00136</a> QWidget* <a class="code" href="class_c_h_t_m_l_read_display.html#a3">CHTMLReadDisplay::view</a>(){
00137 <font class="comment">//  qWarning("CHTMLReadDisplay::view()");</font>
00138   <font class="keywordflow">return</font> KHTMLPart::view();
00139 }
00140 
<a name="l00141"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a4">00141</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a4">CHTMLReadDisplay::selectAll</a>() {
00142   KHTMLPart::selectAll();
00143 }
00144 
<a name="l00146"></a><a class="code" href="class_c_h_t_m_l_read_display.html#a5">00146</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#a5">CHTMLReadDisplay::moveToAnchor</a>( <font class="keyword">const</font> QString&amp; anchor ){
00147 <font class="comment">//  qWarning("nove to anchor %s", anchor.latin1());</font>
00148     gotoAnchor(anchor);
00149 }
00150 
00151 <font class="keywordtype">void</font> CHTMLReadDisplay::urlSelected( <font class="keyword">const</font> QString&amp; url, <font class="keywordtype">int</font> button, <font class="keywordtype">int</font> state, <font class="keyword">const</font> QString&amp; _target, KParts::URLArgs args){
00152 <font class="comment">//  qWarning("CHTMLReadDisplay::urlSelected");</font>
00153   KHTMLPart::urlSelected(url, button, state, _target, args);
00154   <font class="keywordflow">if</font> (!url.isEmpty() &amp;&amp; <a class="code" href="class_c_reference_manager.html#d4">CReferenceManager::isHyperlink</a>(url)) {
00155     QString module;
00156     QString key;
00157     CReferenceManager::Type type;
00158     <font class="keyword">const</font> <font class="keywordtype">bool</font> ok = <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(url, module, key, type);
00159 
00160     <font class="keywordflow">if</font> (module.isEmpty()) {
00161       module = <a class="code" href="class_c_reference_manager.html#d5">CReferenceManager::preferredModule</a>( type );
00162     }
00163         <a class="code" href="class_c_display.html#a7">connectionsProxy</a>()-&gt;emitReferenceClicked(module, key);
00164   }
00165 }
00166 
<a name="l00168"></a><a class="code" href="class_c_h_t_m_l_read_display.html#b3">00168</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#b3">CHTMLReadDisplay::khtmlMouseReleaseEvent</a>( khtml::MouseReleaseEvent* event ){
00169     m_dndData.mousePressed = <font class="keyword">false</font>;
00170   m_dndData.isDragging = <font class="keyword">false</font>;
00171   m_dndData.node = DOM::Node();
00172   m_dndData.anchor = DOM::DOMString();
00173 
00174   KHTMLPart::khtmlMouseReleaseEvent(event);
00175 }
00176 
00177 <font class="keywordtype">void</font> CHTMLReadDisplay::khtmlMousePressEvent( khtml::MousePressEvent* event ){
00178   m_dndData.node = DOM::Node();
00179   m_dndData.anchor = DOM::DOMString();
00180   m_dndData.mousePressed = <font class="keyword">false</font>;
00181   m_dndData.isDragging = <font class="keyword">false</font>;
00182 
00183   <font class="keywordflow">if</font> (event-&gt;qmouseEvent()-&gt;button() == Qt::RightButton) {
00184     <a class="code" href="class_c_read_display.html#b2">setActiveAnchor</a>( event-&gt;url().string() );
00185   }
00186   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (event-&gt;qmouseEvent()-&gt;button() == Qt::LeftButton) {
00187     m_dndData.node = event-&gt;innerNode();
00188     m_dndData.anchor = event-&gt;url();
00189     m_dndData.mousePressed = <font class="keyword">true</font>;
00190     m_dndData.isDragging = <font class="keyword">false</font>;
00191     m_dndData.startPos = QPoint(event-&gt;x(), event-&gt;y());
00192     <font class="keywordflow">if</font> (!m_dndData.node.isNull()) { <font class="comment">//we drag a valid link</font>
00193       m_dndData.dragType = DNDData::Link;
00194     }
00195   }
00196 
00197     KHTMLPart::khtmlMousePressEvent(event);
00198 }
00199 
<a name="l00201"></a><a class="code" href="class_c_h_t_m_l_read_display.html#b5">00201</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_read_display.html#b5">CHTMLReadDisplay::khtmlMouseMoveEvent</a>( khtml::MouseMoveEvent* e ){
00202   <font class="keywordflow">if</font>( !(e-&gt;qmouseEvent()-&gt;state() &amp;&amp; LeftButton)) {
00203     KHTMLPart::khtmlMouseMoveEvent(e);
00204     <font class="keywordflow">return</font>;
00205   }
00206 
00207   <font class="keyword">const</font> <font class="keywordtype">int</font> delay = KGlobalSettings::dndEventDelay();
00208   QPoint newPos = QPoint(e-&gt;x(), e-&gt;y());
00209 
00210   <font class="keywordflow">if</font> (m_dndData.anchor.isEmpty()) {
00211     KHTMLPart::khtmlMouseMoveEvent(e);
00212   }
00213   <font class="keywordflow">else</font> <font class="keywordflow">if</font>((newPos.x() &gt; m_dndData.startPos.x()+delay || newPos.x() &lt; m_dndData.startPos.x()-delay ||
00214      newPos.y() &gt; m_dndData.startPos.y()+delay || newPos.y() &lt; m_dndData.startPos.y()-delay) &amp;&amp;
00215      !m_dndData.isDragging &amp;&amp; m_dndData.mousePressed &amp;&amp; m_dndData.dragType == DNDData::Link &amp;&amp;
00216      !m_dndData.node.isNull() <font class="comment">/*&amp;&amp; !hasSelection()*/</font> )
00217   {
00218     QString module = QString::null;
00219     QString key = QString::null;
00220     CReferenceManager::Type type;
00221     <font class="keywordflow">if</font> ( !<a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(m_dndData.anchor.string(), module, key, type) )
00222         <font class="keywordflow">return</font>;
00223 
00224     QTextDrag *d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(module,key),KHTMLPart::view()-&gt;viewport());
00225     d-&gt;setSubtype(REFERENCE);
00226     d-&gt;setPixmap(REFERENCE_ICON_SMALL);
00227     m_dndData.isDragging = <font class="keyword">true</font>;
00228     m_dndData.mousePressed = <font class="keyword">false</font>;
00229     d-&gt;drag();
00230     <font class="keywordflow">return</font>;
00231   }
00232 }
00233 <font class="comment">/* -------------------------- */</font>
00234 CHTMLReadDisplayView::ToolTip::ToolTip(CHTMLReadDisplayView* view) : QToolTip(view) {
00235   m_view = <a class="code" href="class_c_h_t_m_l_read_display.html#a3">view</a>;
00236 };
00237 
00239 <font class="keywordtype">void</font> CHTMLReadDisplayView::ToolTip::maybeTip( <font class="keyword">const</font> QPoint&amp; p ){
00240 <font class="comment">//  qWarning("CHTMLReadDisplayView::ToolTip::maybeTip");</font>
00241 
00242   DOM::Node node = m_view-&gt;part()-&gt;nodeUnderMouse();
00243 <font class="comment">//  qWarning("node under mouse: %s", node.nodeName().string().latin1());</font>
00244 
00245   <font class="keywordflow">if</font> (node.isNull())
00246     <font class="keywordflow">return</font>;
00247 
00248   DOM::Node linkNode = node;
00249   <font class="keywordflow">do</font> {
00250     <font class="keywordflow">if</font> (!linkNode.isNull() &amp;&amp; linkNode.nodeName().string().upper() == <font class="stringliteral">"A"</font> ) { <font class="comment">//found right node</font>
00251       <font class="keywordflow">if</font> (linkNode.hasAttributes()) {
00252         QString link = QString::null;
00253         DOM::NamedNodeMap attributes = linkNode.attributes();
00254         <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i = 0; i &lt; attributes.length(); i++) {
00255           <font class="keywordflow">if</font> (attributes.item(i).nodeName().string().upper() == <font class="stringliteral">"HREF"</font>) {
00256             link = attributes.item(i).nodeValue().string();
00257 <font class="comment">//            qWarning("link is %s", link.latin1());</font>
00258             <font class="keywordflow">break</font>;
00259           }
00260         }
00261 
00262         <font class="keyword">const</font> QString tooltipText = <a class="code" href="class_c_tooltip_manager.html#d0">CTooltipManager::textForHyperlink</a>( link );
00263         <font class="keywordflow">if</font> (!tooltipText.isEmpty()) {
00264           QRect rect = linkNode.getRect();
00265 <font class="comment">//            rect.setX( m_view-&gt;contentsToViewport(p).x() );</font>
00266 <font class="comment">//            rect.setY( m_view-&gt;contentsToViewport(p).y() );</font>
00267           rect.setX( p.x() );
00268           rect.setY( p.y() );
00269           rect.setWidth( linkNode.getRect().width() );
00270           rect.setHeight( linkNode.getRect().height() );
00271 
00272             tip( rect, tooltipText );
00273         }
00274 
00275 <font class="comment">//        QString module = QString::null;</font>
00276 <font class="comment">//        QString ref = QString::null;</font>
00277 <font class="comment">//        CReferenceManager::Type type;</font>
00278 <font class="comment">//        const bool ok = CReferenceManager::decodeHyperlink(link, module, ref, type);</font>
00279 <font class="comment">//        qWarning("decoded hyperlink!");</font>
00280 <font class="comment">//        if (!ok || ref.isEmpty())</font>
00281 <font class="comment">//          return;</font>
00282 <font class="comment">//</font>
00283 <font class="comment">//        CSwordModuleInfo* m = 0;</font>
00284 <font class="comment">//        if (module.isEmpty()) {</font>
00285 <font class="comment">//          module = CReferenceManager::preferredModule( type );</font>
00286 <font class="comment">//        }</font>
00287 <font class="comment">//</font>
00288 <font class="comment">//        if (( m = backend()-&gt;findModuleByName(module) )) {</font>
00294 <font class="comment">//          util::scoped_ptr&lt;CSwordKey&gt; key( CSwordKey::createInstance( m ) );</font>
00295 <font class="comment">//          if (key) {</font>
00296 <font class="comment">//            backend()-&gt;setFilterOptions( CBTConfig::getFilterOptionDefaults() );</font>
00297 <font class="comment">//            key-&gt;key(ref);</font>
00298 <font class="comment">//</font>
00299 <font class="comment">//            QRect rect = linkNode.getRect();</font>
00302 <font class="comment">//            rect.setX( p.x() );</font>
00303 <font class="comment">//            rect.setY( p.y() );</font>
00304 <font class="comment">//            rect.setWidth( linkNode.getRect().width() );</font>
00305 <font class="comment">//            rect.setHeight( linkNode.getRect().height() );</font>
00306 <font class="comment">//</font>
00307 <font class="comment">//            qWarning("rect is %i / %i / %i / %i", rect.x(), rect.y(), rect.width(), rect.height());</font>
00308 <font class="comment">//          }</font>
00309 <font class="comment">//        }</font>
00310         <font class="keywordflow">break</font>;
00311       }
00312     }
00313   } <font class="keywordflow">while</font> ( !(linkNode = linkNode.parentNode()).isNull() );
00314 }
00315 
00316 <font class="comment">// ---------------------</font>
00317 
00318 CHTMLReadDisplayView::CHTMLReadDisplayView(<a class="code" href="class_c_h_t_m_l_read_display.html">CHTMLReadDisplay</a>* displayWidget, QWidget* parent) : KHTMLView(displayWidget, parent) {
00319   m_display = displayWidget;
00320   viewport()-&gt;setAcceptDrops(<font class="keyword">true</font>);
00321 };
00322 
00323 
00325 <font class="keywordtype">void</font> CHTMLReadDisplayView::popupMenu( <font class="keyword">const</font> QString&amp; url, <font class="keyword">const</font> QPoint&amp; pos){   
00326     qWarning(<font class="stringliteral">"CHTMLReadDisplayView::popupMenu"</font>);
00327     <font class="keywordflow">if</font> (!url.isEmpty()) {
00328     qWarning(url.latin1());
00329     m_display-&gt;setActiveAnchor(url);
00330     }
00331     <font class="keywordflow">if</font> (QPopupMenu* popup = m_display-&gt;installedPopup()) {
00332         popup-&gt;exec(pos);
00333   }
00334 }
00335 
00337 <font class="keywordtype">void</font> CHTMLReadDisplayView::polish(){
00338   KHTMLView::polish();
00339   connect( part(), SIGNAL(popupMenu(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QPoint&amp;)),
00340     <font class="keyword">this</font>, SLOT(popupMenu(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QPoint&amp;)));
00341 
00342   (void)<font class="keyword">new</font> ToolTip(<font class="keyword">this</font>);
00343 }
00344 
00346 <font class="keywordtype">void</font> CHTMLReadDisplayView::contentsDropEvent( QDropEvent* e ){
00347 <font class="comment">//  qWarning("CHTMLReadDisplayView::contentsDropEvent( QDropEvent* e )");</font>
00348 <font class="comment">//  KHTMLView::contentsDropEvent(e);</font>
00349   <font class="keywordflow">if</font> (QTextDrag::canDecode(e)) {
00350 <font class="comment">//    if (e-&gt;provides(REFERENCE) || e-&gt;provides(BOOKMARK))</font>
00351     {
00352       qWarning(<font class="stringliteral">"ACCEPT DROP EVENT!"</font>);
00353       QString str;
00354       QCString submime;
00355       <font class="keyword">const</font> <font class="keywordtype">bool</font> accept = QTextDrag::decode(e, str);
00356       qWarning(<font class="stringliteral">"DROP: %s"</font>, str.latin1());
00357 
00358       QString module;
00359       QString key;
00360       <a class="code" href="class_c_reference_manager.html#d3">CReferenceManager::decodeReference</a>(str, module, key );
00361 <font class="comment">//      qWarning("dropped key: %s", key.latin1());</font>
00362 
00363       e-&gt;acceptAction();
00364       m_display-&gt;connectionsProxy()-&gt;emitReferenceDropped(key);
00365       <font class="keywordflow">return</font>;
00366     }
00367   }
00368   e-&gt;acceptAction(<font class="keyword">false</font>);
00369   e-&gt;ignore();
00370 }
00371 
00373 <font class="keywordtype">void</font> CHTMLReadDisplayView::contentsDragEnterEvent( QDragEnterEvent* e ){
00374 <font class="comment">//  qWarning("CHTMLReadDisplayView::contentsDragEnterEvent( QDragEnterEvent* e )");</font>
00375 <font class="comment">//  KHTMLView::contentsDragEnterEvent(e);</font>
00376   <font class="keywordflow">if</font> (QTextDrag::canDecode(e)) {
00377 <font class="comment">//    if (e-&gt;provides(REFERENCE) || e-&gt;provides(BOOKMARK))</font>
00378     {
00379 <font class="comment">//      qWarning("ACCEPT ENTER EVENT!");</font>
00380       e-&gt;acceptAction();
00381       <font class="keywordflow">return</font>;
00382     }
00383   }
00384   e-&gt;acceptAction(<font class="keyword">false</font>);
00385   e-&gt;ignore();
00386 }
00387 
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:12 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
