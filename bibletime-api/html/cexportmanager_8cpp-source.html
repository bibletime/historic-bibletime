<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cexportmanager.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cexportmanager.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cexportmanager.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Mon Feb 25 2002</font>
00005 <font class="comment">    copyright            : (C) 2002 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cexportmanager.h"</font>
00019 <font class="preprocessor">#include "../backend/cswordkey.h"</font>
00020 <font class="preprocessor">#include "../backend/cswordmoduleinfo.h"</font>
00021 <font class="preprocessor">#include "../printing/cprintitem.h"</font>
00022 <font class="preprocessor">#include "../printing/cprinter.h"</font>
00023 <font class="preprocessor">#include "../util/scoped_resource.h"</font>
00024 <font class="preprocessor">#include "ctoolclass.h"</font>
00025 
00026 <font class="comment">//Qt includes</font>
00027 <font class="preprocessor">#include &lt;qprogressdialog.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qclipboard.h&gt;</font>
00029 
00030 <font class="comment">//KDE includes</font>
00031 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00032 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00033 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00034 
00035 <font class="comment">//Sword includes</font>
00036 <font class="preprocessor">#include &lt;swkey.h&gt;</font>
00037 <font class="preprocessor">#include &lt;listkey.h&gt;</font>
00038 
<a name="l00040"></a><a class="code" href="class_c_export_manager.html#d0">00040</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_export_manager.html#d0">CExportManager::saveKey</a>( <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key, <font class="keyword">const</font> <font class="keywordtype">bool</font> withText ) {
00041 
00042 }
00043 
<a name="l00045"></a><a class="code" href="class_c_export_manager.html#d1">00045</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>( ListKey* list, <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; label, <font class="keyword">const</font> <font class="keywordtype">bool</font> withText, <font class="keyword">const</font> <font class="keywordtype">bool</font> showProgress ){
00046     <font class="keywordtype">bool</font> ret = <font class="keyword">false</font>;
00047     
00048     qDebug(<font class="stringliteral">"CExportManager::saveKeyList( ListKey* keys, const QString&amp; caption, const QString&amp; description, const bool withText, const bool showProgress )"</font>);   
00049     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName(QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save search result ..."</font>));    
00050     <font class="keywordflow">if</font> (! file.isEmpty()) {
00051         QProgressDialog progress( label, i18n(<font class="stringliteral">"Cancel"</font>), list-&gt;Count(), 0,<font class="stringliteral">"progress"</font>, <font class="keyword">true</font> );   
00052         progress.setProgress(0);    
00053         progress.setMinimumDuration(0); 
00054         progress.show();
00055     
00056         <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module));
00057     
00058         QString text;   
00059         <font class="keywordtype">int</font> index = 0;
00060         *list = TOP;
00061         <font class="keywordflow">while</font> (!list-&gt;Error() &amp;&amp; !progress.wasCancelled()) {
00062             key-&gt;key((<font class="keyword">const</font> <font class="keywordtype">char</font>*)(*list));
00063             <font class="keywordflow">if</font> (!key)
00064                 <font class="keywordflow">break</font>;
00065             progress.setProgress(index++);
00066             KApplication::kApplication()-&gt;processEvents(10); <font class="comment">//do not lock the GUI!                                                                     </font>
00067         
00068             <font class="keywordflow">if</font> (withText)
00069                 text += QString::fromLatin1(<font class="stringliteral">"%1:\n\t%2\n"</font>).arg( key-&gt;key() ).arg( key-&gt;strippedText() );
00070             <font class="keywordflow">else</font>
00071                 text += key-&gt;key() + <font class="stringliteral">"\n"</font>;
00072 
00073             (*list)++;
00074             }
00075         <font class="comment">//  delete key;</font>
00076     
00077         <font class="keywordflow">if</font> (! progress.wasCancelled()) {
00078             progress.setProgress(index);    
00079             <a class="code" href="class_c_tool_class.html#d4">CToolClass::savePlainFile</a>(file, text);
00080             ret = <font class="keyword">true</font>;
00081         }
00082     }
00083     
00084         <font class="keywordflow">return</font> ret;
00085 }
00086 
00087 <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_export_manager.html#d1">CExportManager::saveKeyList</a>( QList&lt;CSwordKey&gt;&amp; list, <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; label, <font class="keyword">const</font> <font class="keywordtype">bool</font> withText, <font class="keyword">const</font> <font class="keywordtype">bool</font> showProgress ){
00088     <font class="keywordtype">bool</font> ret = <font class="keyword">false</font>;
00089     qDebug(<font class="stringliteral">"CExportManager::saveKeyList( ListKey* keys, const QString&amp; caption, const QString&amp; description, const bool withText, const bool showProgress )"</font>);   
00090     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName(QString::null, i18n(<font class="stringliteral">"*.txt | Text files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save search result ..."</font>));    
00091     <font class="keywordflow">if</font> (! file.isEmpty()){
00092     
00093         QProgressDialog progress( label, i18n(<font class="stringliteral">"Cancel"</font>), list.count(), 0,<font class="stringliteral">"progress"</font>, <font class="keyword">true</font> );    
00094         progress.setProgress(0);    
00095         progress.setMinimumDuration(0); 
00096         progress.show();
00097 
00098         QString text;   
00099         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = 0;
00100         <font class="keywordflow">for</font> (list.first(); list.current(); list.next()) {
00101             key = list.current();
00102             <font class="keywordflow">if</font> (!key)
00103                 <font class="keywordflow">break</font>;
00104             progress.setProgress(list.at());
00105             KApplication::kApplication()-&gt;processEvents(10); <font class="comment">//do not lock the GUI!</font>
00106             
00107             <font class="keywordflow">if</font> (withText)
00108                 text += QString::fromLatin1(<font class="stringliteral">"%1:\n\t%2\n"</font>).arg( key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>() ).arg( key-&gt;<a class="code" href="class_c_sword_key.html#a6">strippedText</a>() );
00109             <font class="keywordflow">else</font>
00110                 text += key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>() + <font class="stringliteral">"\n"</font>;
00111         }
00112         
00113         <font class="keywordflow">if</font> (!progress.wasCancelled()) {
00114             progress.setProgress(list.count()); 
00115             <a class="code" href="class_c_tool_class.html#d4">CToolClass::savePlainFile</a>(file, text);
00116         }
00117     }
00118     
00119     <font class="keywordflow">return</font> ret;
00120 }
00121 
00122 
00124 <font class="keyword">const</font> <font class="keywordtype">bool</font> CExportManager::copyKey( <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key, <font class="keyword">const</font> <font class="keywordtype">bool</font> withText ) {
00125     <font class="keywordtype">bool</font> ret = <font class="keyword">true</font>;
00126     
00127 <font class="comment">//  qDebug("CExportManager::copyKey( CSwordKey* key, const bool withText )");</font>
00128 <font class="comment">//  ASSERT(key);    </font>
00129 
00130     QString text = (withText) ? QString::fromLatin1(<font class="stringliteral">"%1:\n\t%2"</font>).arg(key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>()).arg(key-&gt;<a class="code" href="class_c_sword_key.html#a6">strippedText</a>()) : key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>()+<font class="stringliteral">"\n"</font>;
00131 
00132     KApplication::clipboard()-&gt;setText(text);
00133 
00134     <font class="keywordflow">return</font> ret;
00135 }
00136 
00137 <font class="keyword">const</font> <font class="keywordtype">bool</font> CExportManager::copyKeyList( ListKey* list, <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; label, <font class="keyword">const</font> <font class="keywordtype">bool</font> withText, <font class="keyword">const</font> <font class="keywordtype">bool</font> showProgress ){
00138 <font class="comment">//  qDebug("CExportManager::copyKeyList( ListKey* keys, const QString&amp; caption, const QString&amp; description, const bool withText, const bool showProgress )");   </font>
00139     
00140     QProgressDialog progress( label, i18n(<font class="stringliteral">"Cancel"</font>), list-&gt;Count(), 0,<font class="stringliteral">"progress"</font>, <font class="keyword">true</font> );   
00141     progress.setProgress(0);    
00142     progress.setMinimumDuration(0); 
00143     progress.show();
00144     
00145     QString text;   
00146     <font class="keywordtype">int</font> index = 0;  
00147     <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module) );
00148     *list = TOP;
00149     <font class="keywordflow">while</font> (!list-&gt;Error() &amp;&amp; !progress.wasCancelled()) {
00150         key-&gt;key((<font class="keyword">const</font> <font class="keywordtype">char</font>*)(*list));
00151         <font class="keywordflow">if</font> (!key)
00152             <font class="keywordflow">break</font>;
00153         progress.setProgress(index++);
00154         KApplication::kApplication()-&gt;processEvents(10); <font class="comment">//do not lock the GUI!                                                                     </font>
00155         
00156         text += (withText) ? QString::fromLatin1(<font class="stringliteral">"%1:\n\t%2\n"</font>).arg(key-&gt;key()).arg(key-&gt;strippedText()) : key-&gt;key()+<font class="stringliteral">"\n"</font>;
00157         (*list)++;
00158     }
00159     <font class="keywordflow">if</font> (progress.wasCancelled())
00160         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00161         
00162     progress.setProgress(index);    
00163     KApplication::clipboard()-&gt;setText(text);       
00164     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00165 }
00166 
00167 
00169 
00170 <font class="keyword">const</font> <font class="keywordtype">bool</font> CExportManager::printKey( <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; startKey, <font class="keyword">const</font> QString&amp; stopKey, <font class="keyword">const</font> QString&amp; description ){
00171     <a class="code" href="class_c_pointers.html#d0">printer</a>()-&gt;appendItem( <font class="keyword">new</font> <a class="code" href="class_c_print_item.html">CPrintItem</a>(module, startKey, stopKey, description) );    
00172     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00173 }
00174 
00175 <font class="keyword">const</font> <font class="keywordtype">bool</font> CExportManager::printKeyList( ListKey* list, <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; label, <font class="keyword">const</font> <font class="keywordtype">bool</font> showProgress ){
00176     QProgressDialog progress( label, i18n(<font class="stringliteral">"Cancel"</font>), list-&gt;Count(), 0,<font class="stringliteral">"progress"</font>, <font class="keyword">true</font> );   
00177     progress.setProgress(0);    
00178     progress.setMinimumDuration(0); 
00179     progress.show();
00180     
00181     <font class="keywordtype">int</font> index = 0;  
00182     QList&lt;CPrintItem&gt; itemList;
00183     QString startKey, stopKey;
00184     
00185     *list = TOP;
00186     <font class="keywordflow">while</font> (!list-&gt;Error() &amp;&amp; !progress.wasCancelled()) {
00187         VerseKey* vk = dynamic_cast&lt;VerseKey*&gt;(list);
00188         <font class="keywordflow">if</font> (vk) {
00189             startKey = QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)(vk-&gt;LowerBound()) );
00190             stopKey = QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)(vk-&gt;UpperBound()) );
00191         }
00192         <font class="keywordflow">else</font> {
00193             startKey = QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*list);
00194             stopKey = QString::null;
00195         }
00196         itemList.append( <font class="keyword">new</font> <a class="code" href="class_c_print_item.html">CPrintItem</a>(module, startKey, stopKey) );
00197         
00198         progress.setProgress(index++);
00199         KApplication::kApplication()-&gt;processEvents(10); <font class="comment">//do not lock the GUI!</font>
00200                 
00201         (*list)++;
00202     }
00203     
00204     <font class="comment">//add all items to the queue</font>
00205     <font class="keywordflow">if</font> (progress.wasCancelled()) {
00206         itemList.setAutoDelete(<font class="keyword">true</font>);   
00207         itemList.clear();<font class="comment">//delete all items     </font>
00208         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00209     }
00210     
00211     progress.setProgress(list-&gt;Count());    
00212     <a class="code" href="class_c_pointers.html#d0">printer</a>()-&gt;appendItems(itemList);   
00213     
00214     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00215 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
