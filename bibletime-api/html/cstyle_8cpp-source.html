<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cstyle.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cstyle.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cstyle.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Aug 20 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cstyle.h"</font>
00019 <font class="preprocessor">#include "cstylelist.h"</font>
00020 
00021 
00022 <font class="comment">//Qt includes</font>
00023 <font class="preprocessor">#include &lt;qapp.h&gt;</font>
00024 <font class="preprocessor">#include &lt;qdom.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qfile.h&gt;</font>
00026 <font class="preprocessor">#include &lt;qlistview.h&gt;</font>
00027 <font class="preprocessor">#include &lt;qstring.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qtextstream.h&gt;</font>
00029 
00030 <font class="comment">//KDE includes</font>
00031 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00032 
00033 <font class="preprocessor">#define CURRENT_SYNTAX_VERSION 1</font>
00034 <font class="preprocessor"></font>
00035 CStyle::Format::Format(<font class="keyword">const</font> CStyle::StyleType type) : m_frame(0), m_type(type) {
00036     clearData();
00037 }
00038 
00039 CStyle::Format::Format(<font class="keyword">const</font> Format&amp; f) {
00040     m_BGColor = f.m_BGColor;
00041     m_FGColor = f.m_FGColor;
00042     m_alignment = f.m_alignment;
00043     m_font = f.m_font;
00044     m_hasFrame = f.m_hasFrame;          
00045     m_frame = 0;
00046     <font class="keywordflow">if</font> (m_hasFrame) {
00047         Frame* newFrame = frame();<font class="comment">//create</font>
00048         *newFrame = *f.m_frame; <font class="comment">//copy content</font>
00049     }
00050     m_type = f.m_type;
00051 };
00052 
00053 CStyle::Format::~Format(){
00054     <font class="keyword">delete</font> m_frame;
00055 }
00056 
00058 <font class="keyword">const</font> QFont&amp; CStyle::Format::font()<font class="keyword"> const </font>{
00059     <font class="keywordflow">return</font> m_font;
00060 }
00061 
00063 <font class="keywordtype">void</font> CStyle::Format::setFont( QFont newFont ) {
00064     m_font = newFont;
00065 }
00066 
00068 <font class="keyword">const</font> QColor&amp; CStyle::Format::color( <font class="keyword">const</font> Color type )<font class="keyword"> const </font>{
00069     <font class="keywordflow">switch</font> (type) {
00070         <font class="keywordflow">case</font> Foreground:
00071             <font class="keywordflow">return</font> m_FGColor;
00072         <font class="keywordflow">case</font> Background:
00073             <font class="keywordflow">return</font> m_BGColor;       
00074     };
00075     <font class="keywordflow">return</font> Qt::white; <font class="comment">//shouldn't be executed</font>
00076 }
00077 
00079 <font class="keywordtype">void</font> CStyle::Format::setColor( <font class="keyword">const</font> Color type, <font class="keyword">const</font> QColor&amp; newColor ) {
00080     <font class="keywordflow">switch</font> (type) {
00081         <font class="keywordflow">case</font> Foreground:
00082             m_FGColor = newColor;
00083             <font class="keywordflow">break</font>;
00084         <font class="keywordflow">case</font> Background:
00085             m_BGColor = newColor;
00086             <font class="keywordflow">break</font>;
00087     };
00088 }
00089 
00091 CStyle::Format::Frame* <font class="keyword">const</font> CStyle::Format::frame() {
00092     <font class="keywordflow">if</font> (m_hasFrame)
00093         <font class="keywordflow">return</font> !m_frame ? (m_frame = <font class="keyword">new</font> CStyle::Format::Frame) : m_frame;
00094     <font class="keywordflow">return</font> 0;
00095 }
00096 
00098 <font class="keywordtype">void</font> CStyle::Format::setFrameEnabled( <font class="keyword">const</font> <font class="keywordtype">bool</font> hasFrame ) {
00099     m_hasFrame = hasFrame;
00100     <font class="keywordflow">if</font> (!m_hasFrame) {
00101         <font class="keyword">delete</font> m_frame;
00102         m_frame = 0;
00103     };
00104 }
00105 
00107 <font class="keyword">const</font> CStyle::Format::Alignment&amp; CStyle::Format::alignment()<font class="keyword"> const </font>{
00108     <font class="keywordflow">return</font> m_alignment;
00109 }
00110 
00112 <font class="keywordtype">void</font> CStyle::Format::setAlignment( <font class="keyword">const</font> Alignment newAlignment) {
00113     m_alignment = newAlignment;
00114 }
00115 
00117 <font class="keywordtype">void</font> CStyle::Format::clearData(){
00118     m_BGColor = Qt::white;
00119     m_FGColor = Qt::black;  
00120     <font class="keyword">delete</font> m_frame;
00121     m_frame = 0;    
00122     m_hasFrame = <font class="keyword">false</font>;
00123     m_font = QApplication::font();
00124     m_alignment = Format::Left;
00125 }
00126 
00127 <font class="keyword">const</font> CStyle::StyleType CStyle::Format::type()<font class="keyword"> const </font>{
00128     <font class="keywordflow">return</font> m_type;
00129 }
00130 
00131 CStyle::Format::Frame::Frame() {
00132     m_thickness = 1;
00133     m_color = Qt::black;
00134     m_lineStyle = Qt::SolidLine;
00135 }
00136 
00137 CStyle::Format::Frame::Frame(<font class="keyword">const</font> Frame&amp; f) {
00138     m_thickness = f.m_thickness;
00139     m_color = f.m_color;
00140     m_lineStyle = f.m_lineStyle;
00141 }
00142 
00144 <font class="keyword">const</font> <font class="keywordtype">int</font>&amp; CStyle::Format::Frame::thickness()<font class="keyword"> const </font>{
00145     <font class="keywordflow">return</font> m_thickness;
00146 }
00147 
00149 <font class="keywordtype">void</font> CStyle::Format::Frame::setThickness( <font class="keyword">const</font> <font class="keywordtype">int</font> newThickness ) {
00150     m_thickness = newThickness;
00151 }
00152 
00154 <font class="keyword">const</font> Qt::PenStyle&amp; CStyle::Format::Frame::lineStyle()<font class="keyword"> const </font>{
00155     <font class="keywordflow">return</font> m_lineStyle;
00156 }
00157 
00159 <font class="keywordtype">void</font> CStyle::Format::Frame::setLineStyle( <font class="keyword">const</font> Qt::PenStyle newLineStyle ){
00160     m_lineStyle = newLineStyle;
00161 }
00162 
00164 <font class="keyword">const</font> QColor&amp; CStyle::Format::Frame::color()<font class="keyword"> const </font>{
00165     <font class="keywordflow">return</font> m_color;
00166 }
00167 
00169 <font class="keywordtype">void</font> CStyle::Format::Frame::setColor( <font class="keyword">const</font> QColor&amp; newColor ) {
00170     m_color = newColor;
00171 }
00172 
00173 CStyle::CStyle() :
00174     m_headerFormat(new Format(CStyle::Header)),
00175     m_descriptionFormat(new Format(CStyle::Description)),
00176     m_moduleTextFormat(new Format(CStyle::ModuleText))
00177 {
00178 
00179     <font class="comment">//dummy command to translate names of standard styles</font>
00180 <font class="comment">//  i18n("Standard");</font>
00181 <font class="comment">//  i18n("Colored style for larger text portions");</font>
00182 <font class="comment">//18n("Black&amp;White for larger text portions");</font>
00183     
00184     m_listViewItem = 0;
00185     m_isHeaderFormatEnabled = m_isDescriptionFormatEnabled = m_isModuleTextFormatEnabled = <font class="keyword">true</font>;
00186 
00187     setStyleName( i18n(<font class="stringliteral">"unknown name"</font>) );
00188 };
00189 
00190 CStyle::CStyle( <font class="keyword">const</font> QString text ) :
00191     m_headerFormat(new Format(CStyle::Header)),
00192     m_descriptionFormat(new Format(CStyle::Description)),
00193     m_moduleTextFormat(new Format(CStyle::ModuleText))
00194 {
00195     m_listViewItem = 0;
00196     m_isHeaderFormatEnabled = m_isDescriptionFormatEnabled = m_isModuleTextFormatEnabled = <font class="keyword">true</font>;
00197     
00198     loadFromText(text); 
00199 }
00200 
00201 CStyle::~CStyle(){
00202 }
00203 
00205 CStyle::Format* <font class="keyword">const</font> CStyle::formatForType( <font class="keyword">const</font> CStyle::StyleType type) {
00206     <font class="keywordflow">switch</font> (type) {
00207         <font class="keywordflow">case</font> Header:
00208             <font class="keywordflow">return</font> m_headerFormat;
00209         <font class="keywordflow">case</font> Description:
00210             <font class="keywordflow">return</font> m_descriptionFormat;     
00211         <font class="keywordflow">case</font> ModuleText:
00212             <font class="keywordflow">return</font> m_moduleTextFormat;      
00213         <font class="keywordflow">default</font>:
00214             <font class="keywordflow">return</font> 0;
00215     }
00216 }
00217 
00219 <font class="keyword">const</font> <font class="keywordtype">bool</font> CStyle::hasFormatTypeEnabled( <font class="keyword">const</font> CStyle::StyleType type)<font class="keyword"> const </font>{  
00220     <font class="keywordflow">switch</font> (type) {
00221         <font class="keywordflow">case</font> Header:
00222             <font class="keywordflow">return</font> m_isHeaderFormatEnabled;
00223         <font class="keywordflow">case</font> Description:
00224             <font class="keywordflow">return</font> m_isDescriptionFormatEnabled;        
00225         <font class="keywordflow">case</font> ModuleText:
00226             <font class="keywordflow">return</font> m_isModuleTextFormatEnabled;         
00227         <font class="keywordflow">default</font>:
00228             <font class="keywordflow">return</font> <font class="keyword">false</font>;
00229     }
00230 }
00231 
00233 <font class="keywordtype">void</font> CStyle::setFormatTypeEnabled( <font class="keyword">const</font> CStyle::StyleType type, <font class="keyword">const</font> <font class="keywordtype">bool</font> setEnabled) {
00234     <font class="keywordflow">switch</font> (type) {
00235         <font class="keywordflow">case</font> Header:
00236             m_isHeaderFormatEnabled = setEnabled;
00237             <font class="keywordflow">break</font>;
00238         
00239         <font class="keywordflow">case</font> Description:
00240             m_isDescriptionFormatEnabled = setEnabled;      
00241             <font class="keywordflow">break</font>;
00242         
00243         <font class="keywordflow">case</font> ModuleText:
00244             m_isModuleTextFormatEnabled = setEnabled;       
00245             <font class="keywordflow">break</font>;
00246         
00247         <font class="keywordflow">default</font>:
00248             <font class="keywordflow">break</font>;
00249     }
00250 }
00251 
00253 QListViewItem* <font class="keyword">const</font> CStyle::listViewItem( <a class="code" href="class_c_style_list.html">CStyleList</a>* <font class="keyword">const</font> list ){
00254     <font class="keywordflow">if</font> (!list) {
00255         <font class="keywordflow">if</font> (!m_listViewItem)
00256             <font class="keywordflow">return</font> 0;
00257         <font class="keywordflow">else</font>
00258             <font class="keywordflow">return</font> m_listViewItem;
00259     }
00260     deleteListViewItem();
00261     m_listViewItem = <font class="keyword">new</font> QListViewItem( list );
00262     updateListViewItem();   
00263     <font class="keywordflow">return</font> m_listViewItem;
00264 }
00265 
00267 <font class="keyword">const</font> QString&amp; CStyle::styleName()<font class="keyword"> const</font>{
00268     <font class="keywordflow">return</font> m_name;
00269 }
00270 
00272 <font class="keywordtype">void</font> CStyle::setStyleName( <font class="keyword">const</font> QString name ){
00273     m_name = name;
00274 }
00275 
00277 <font class="keywordtype">void</font> CStyle::clearData(){
00278 <font class="comment">//  qDebug("CStyle::clearData()");</font>
00279     deleteListViewItem();
00280     m_name = QString::null;
00281     m_isDescriptionFormatEnabled = m_isHeaderFormatEnabled = m_isModuleTextFormatEnabled = <font class="keyword">true</font>;        
00282 }
00283 
00285 <font class="keywordtype">void</font> CStyle::updateListViewItem(){
00286 <font class="comment">//  qWarning("CStyle::updateListViewItem() for %s", m_name.latin1());</font>
00287     m_listViewItem-&gt;setText(0, styleName() );
00288 }
00289 
00291 <font class="keywordtype">void</font> CStyle::deleteListViewItem(){
00292     <font class="keyword">delete</font> m_listViewItem;
00293     m_listViewItem = 0;
00294 }
00295 
00297 <font class="keyword">const</font> <font class="keywordtype">bool</font> CStyle::loadFromFile(<font class="keyword">const</font> QString&amp; filename){
00298     QFile file(filename);
00299     <font class="keywordflow">if</font> (!file.exists()) {
00300         qWarning(<font class="stringliteral">"file doesn't exist"</font>);
00301         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00302     }
00303     
00304     <font class="keywordflow">if</font> (file.open(IO_ReadOnly)) {   
00305         QTextStream t(&amp;file);
00306         t.setEncoding(QTextStream::UnicodeUTF8);        
00307         loadFromText( t.read() );
00308         file.close();   
00309     }
00310     <font class="keywordflow">else</font> {
00311         qWarning(<font class="stringliteral">"CStyle::load: unable to open file %s"</font>, filename.latin1());
00312         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00313     };
00314 }
00315 
00316 <font class="keyword">const</font> <font class="keywordtype">bool</font> CStyle::loadFromText(<font class="keyword">const</font> QString&amp; text){
00329     QDomDocument doc;       
00330   doc.setContent(text);
00331     
00332   QDomElement document = doc.documentElement();
00333   <font class="keywordflow">if</font>(document.tagName() != <font class="stringliteral">"BibleTimePrintingStyle"</font>) {
00334         qWarning(<font class="stringliteral">"CProfile::load: Missing BibleTime doc"</font>);
00335         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00336     }
00337     <font class="keywordflow">if</font> (document.hasAttribute(<font class="stringliteral">"name"</font>)) { <font class="comment">//name of the printing style</font>
00338         m_name = document.attribute(<font class="stringliteral">"name"</font>);
00339         <font class="keywordflow">if</font> (document.hasAttribute(<font class="stringliteral">"translate"</font>) &amp;&amp; document.attribute(<font class="stringliteral">"translate"</font>).toInt()) {
00340             m_name = i18n(m_name.local8Bit()); <font class="comment">//standard styles should be translated</font>
00341         }
00342     }
00343     
00344     QDomElement elem = document.firstChild().toElement();
00345     <font class="keywordflow">while</font> (!elem.isNull()) {
00346         StyleType type = Unknown;
00347         <font class="keywordflow">if</font> (elem.tagName() == <font class="stringliteral">"HEADER"</font>) {
00348             type = Header;
00349         }
00350         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (elem.tagName() == <font class="stringliteral">"DESCRIPTION"</font>) {
00351             type = Description;
00352         }
00353         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (elem.tagName() == <font class="stringliteral">"MODULETEXT"</font>) {
00354             type = ModuleText;
00355         }
00356         Format* p = formatForType(type);
00357 
00358         <font class="keywordflow">if</font> (!p || type == Unknown)
00359             <font class="keywordflow">continue</font>;
00360         
00361         <font class="keywordflow">if</font> (elem.hasAttribute(<font class="stringliteral">"enabled"</font>)) {
00362             setFormatTypeEnabled(type, elem.attribute(<font class="stringliteral">"enabled"</font>).toInt());
00363         }
00364         <font class="keywordflow">if</font> (elem.hasAttribute(<font class="stringliteral">"alignment"</font>)) {       
00365             <font class="keyword">const</font> <font class="keywordtype">int</font> align = elem.attribute(<font class="stringliteral">"alignment"</font>).toInt();
00366             p-&gt;setAlignment( static_cast&lt;Format::Alignment&gt;(align) );
00367         }
00368         
00369         QDomElement object = elem.namedItem(<font class="stringliteral">"COLORS"</font>).toElement();
00370         <font class="keywordflow">if</font> (!object.isNull()) {
00371             <font class="keywordflow">if</font> (object.hasAttribute(<font class="stringliteral">"bgcolor"</font>))
00372                 p-&gt;setColor(Format::Background, QColor(object.attribute(<font class="stringliteral">"bgcolor"</font>)));
00373             <font class="keywordflow">if</font> (object.hasAttribute(<font class="stringliteral">"fgcolor"</font>))
00374                 p-&gt;setColor(Format::Foreground, QColor(object.attribute(<font class="stringliteral">"fgcolor"</font>)));               
00375         }
00376 
00377         object = elem.namedItem(<font class="stringliteral">"FONT"</font>).toElement();
00378         <font class="keywordflow">if</font> (!object.isNull()) {
00379             QString family = object.hasAttribute(<font class="stringliteral">"family"</font>) ? object.attribute(<font class="stringliteral">"family"</font>) : QApplication::font().family();
00380             <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> size = object.hasAttribute(<font class="stringliteral">"pointsize"</font>) ? object.attribute(<font class="stringliteral">"pointsize"</font>).toInt() : QApplication::font().pointSize();
00381             <font class="keyword">const</font> <font class="keywordtype">int</font> weight = object.hasAttribute(<font class="stringliteral">"weight"</font>) ? object.attribute(<font class="stringliteral">"weight"</font>).toInt() : QFont::Normal;
00382             <font class="keyword">const</font> <font class="keywordtype">bool</font> italic = object.hasAttribute(<font class="stringliteral">"italic"</font>) ? static_cast&lt;bool&gt;(object.attribute(<font class="stringliteral">"italic"</font>).toInt()) : <font class="keyword">false</font>;
00383             
00384             <font class="keywordflow">if</font> (family.isEmpty())
00385                 family = QApplication::font().family();
00386             <font class="keywordflow">if</font> (!size)
00387                 size = QApplication::font().pointSize();
00388             
00389             p-&gt;setFont( QFont(family, size, weight, italic) );          
00390         }   
00391 
00392         object = elem.namedItem(<font class="stringliteral">"FRAME"</font>).toElement();
00393         <font class="keywordflow">if</font> (!object.isNull()) { <font class="comment">//frame-section exists</font>
00394             <font class="keyword">const</font> <font class="keywordtype">bool</font> enabled = object.hasAttribute(<font class="stringliteral">"enabled"</font>) ? object.attribute(<font class="stringliteral">"enabled"</font>).toInt() : false;          
00395             p-&gt;setFrameEnabled(enabled);
00396             <font class="keywordflow">if</font> (Format::Frame* frame = p-&gt;frame()) {
00397                 <font class="keyword">const</font> QColor color = object.hasAttribute(<font class="stringliteral">"color"</font>) ? QColor(object.attribute(<font class="stringliteral">"color"</font>)) : Qt::white;
00398                 Qt::PenStyle style = object.hasAttribute(<font class="stringliteral">"style"</font>) ? static_cast&lt;Qt::PenStyle&gt;(object.attribute(<font class="stringliteral">"style"</font>).toInt()) : Qt::SolidLine;
00399                 <font class="keyword">const</font> <font class="keywordtype">int</font> thickness = object.hasAttribute(<font class="stringliteral">"thickness"</font>) ? object.attribute(<font class="stringliteral">"thickness"</font>).toInt() : 1;         
00400                 
00401                 frame-&gt;setColor(color);
00402                 frame-&gt;setLineStyle(style);
00403                 frame-&gt;setThickness(thickness);
00404             }
00405         }
00406         elem = elem.nextSibling().toElement();  
00407     }
00408     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00409 }
00410 
00411 <font class="keyword">const</font> <font class="keywordtype">bool</font> CStyle::saveToFile( <font class="keyword">const</font> QString&amp; filename ){
00412 <font class="comment">/* Saved file should look like this:</font>
00413 <font class="comment"></font>
00414 <font class="comment"> &lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE DOC &gt;</font>
00415 <font class="comment"> &lt;BibleTimePrintingStyle syntaxVersion="1" name="Standard" translate="1"&gt;</font>
00416 <font class="comment">  &lt;HEADER enabled="1" alignment="center"&gt;</font>
00417 <font class="comment">    &lt;COLORS bgcolor="black" fgcolor="white"&gt;</font>
00418 <font class="comment">    &lt;FONT family="Arial" charset="2" pointsize="10" weight="1" italic="0"&gt;</font>
00419 <font class="comment">    &lt;FRAME enabled="1" color="blue" style="1" thickness="2"&gt;</font>
00420 <font class="comment">  &lt;/HEADER&gt;</font>
00421 <font class="comment">  // same for DESCRIPTION and MODULETEXT</font>
00422 <font class="comment"></font>
00423 <font class="comment"> &lt;/BibleTimePrintingStyle&gt;</font>
00424 <font class="comment">*/</font>
00425     <font class="keywordtype">bool</font> ret = <font class="keyword">false</font>;
00426     
00427   QDomDocument doc(<font class="stringliteral">"DOC"</font>);
00428   doc.appendChild( doc.createProcessingInstruction( <font class="stringliteral">"xml"</font>, <font class="stringliteral">"version=\"1.0\" encoding=\"UTF-8\""</font> ) );
00429 
00430   QDomElement content = doc.createElement(<font class="stringliteral">"BibleTimePrintingStyle"</font>);
00431   content.setAttribute(<font class="stringliteral">"syntaxVersion"</font>, CURRENT_SYNTAX_VERSION);
00432   content.setAttribute(<font class="stringliteral">"name"</font>, m_name);
00433   content.setAttribute(<font class="stringliteral">"translate"</font>, 0); <font class="comment">//don't trabslate styles except of prinstalled ones</font>
00434   doc.appendChild(content);
00435 
00436   <font class="keywordflow">for</font> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i = Header; i &lt;= ModuleText; ++i) {
00437         QDomElement elem;
00438             
00439         <font class="keyword">const</font> StyleType type = static_cast&lt;StyleType&gt;(i);
00440         <font class="keywordflow">switch</font> (type) {
00441             <font class="keywordflow">case</font> Header:
00442                 elem = doc.createElement(<font class="stringliteral">"HEADER"</font>);
00443                 <font class="keywordflow">break</font>;
00444             <font class="keywordflow">case</font> Description:
00445                 elem = doc.createElement(<font class="stringliteral">"DESCRIPTION"</font>);            
00446                 <font class="keywordflow">break</font>;
00447             <font class="keywordflow">case</font> ModuleText:
00448                 elem = doc.createElement(<font class="stringliteral">"MODULETEXT"</font>);
00449                 <font class="keywordflow">break</font>;
00450             <font class="keywordflow">default</font>:
00451                 <font class="keywordflow">break</font>;
00452         };      
00453         <font class="keywordflow">if</font> (elem.isNull()) <font class="comment">//shouldn't happen</font>
00454             <font class="keywordflow">continue</font>;
00455         content.appendChild(elem);
00456             
00457         Format* format = formatForType(type);           
00458         
00459         elem.setAttribute(<font class="stringliteral">"enabled"</font>, hasFormatTypeEnabled(type));
00460         elem.setAttribute(<font class="stringliteral">"alignment"</font>, static_cast&lt;int&gt;(format-&gt;alignment()));
00461         
00462         QDomElement object = doc.createElement(<font class="stringliteral">"COLORS"</font>);
00463         object.setAttribute(<font class="stringliteral">"bgcolor"</font>, format-&gt;color(Format::Background).name());
00464         object.setAttribute(<font class="stringliteral">"fgcolor"</font>, format-&gt;color(Format::Foreground).name());
00465         elem.appendChild(object);       
00466                 
00467         QFont font = format-&gt;font();
00468         object = doc.createElement(<font class="stringliteral">"FONT"</font>);
00469         object.setAttribute(<font class="stringliteral">"family"</font>, font.family());
00470         object.setAttribute(<font class="stringliteral">"pointsize"</font>, font.pointSize());     
00471         object.setAttribute(<font class="stringliteral">"weight"</font>, font.weight());
00472         object.setAttribute(<font class="stringliteral">"italic"</font>, font.italic());
00473         elem.appendChild(object);
00474                         
00475         object = doc.createElement(<font class="stringliteral">"FRAME"</font>);        
00476         Format::Frame* frame = format-&gt;frame();
00477         object.setAttribute(<font class="stringliteral">"enabled"</font>, static_cast&lt;bool&gt;(frame) );
00478         <font class="keywordflow">if</font> (frame) {
00479             object.setAttribute(<font class="stringliteral">"color"</font>, frame-&gt;color().name());
00480             object.setAttribute(<font class="stringliteral">"thickness"</font>, frame-&gt;thickness());
00481             object.setAttribute(<font class="stringliteral">"style"</font>, static_cast&lt;int&gt;(frame-&gt;lineStyle()) );
00482     }       
00483         elem.appendChild(object);
00484   };
00485   ret = <font class="keyword">false</font>;
00486 
00487 
00488     QFile file(filename);
00489     <font class="keywordflow">if</font> (file.open(IO_WriteOnly)) {
00490         ret = <font class="keyword">true</font>;
00491         QTextStream t( &amp;file );        <font class="comment">// use a text stream</font>
00492         t.setEncoding(QTextStream::UnicodeUTF8);
00493         t &lt;&lt; doc.toString();
00494         file.close();
00495     }
00496     <font class="keywordflow">return</font> ret;
00497 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:09 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
