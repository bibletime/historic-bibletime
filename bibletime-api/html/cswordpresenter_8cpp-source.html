<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cswordpresenter.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cswordpresenter.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cswordpresenter.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Mar 18 2001</font>
00005 <font class="comment">    copyright            : (C) 2001 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cswordpresenter.h"</font>
00019 <font class="preprocessor">#include "../keychooser/ckeychooser.h"</font>
00020 <font class="preprocessor">#include "../chtmlwidget.h"</font>
00021 <font class="preprocessor">#include "../../backend/cswordkey.h"</font>
00022 <font class="preprocessor">#include "../../printing/cprintitem.h"</font>
00023 <font class="preprocessor">#include "../../printing/cprinter.h"</font>
00024 <font class="preprocessor">#include "../cbtconfig.h"</font>
00025 <font class="preprocessor">#include "cdisplaysettingsbutton.h"</font>
00026 
00027 <font class="comment">//Qt includes</font>
00028 <font class="preprocessor">#include &lt;qpopupmenu.h&gt;</font>
00029 
00030 <font class="comment">//KDE includes</font>
00031 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00032 
<a name="l00033"></a><a class="code" href="class_c_sword_presenter.html#a0">00033</a> <a class="code" href="class_c_sword_presenter.html#a0">CSwordPresenter::CSwordPresenter</a>(ListCSwordModuleInfo useModules, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00034     : KMainWindow(parent,name,0), m_moduleList(useModules), m_htmlWidget(0),
00035     m_keyChooser(0), m_mainToolBar(0), m_moduleChooserBar(0), m_popup(0),m_savePopup(0),m_copyPopup(0),
00036     m_printPopup(0), m_features(0), m_accel(0),
00037     m_lexiconPopup(new QPopupMenu(this)),
00038     m_moduleOptions( <a class="code" href="class_c_b_t_config.html">CBTConfig</a>::getFilterOptionDefaults() ),
00039     m_displayOptions( <a class="code" href="class_c_b_t_config.html">CBTConfig</a>::getDisplayOptionDefaults() ),
00040     m_displaySettingsButton(0),
00041     m_initialized(false)
00042 
00043 {       
00044     <font class="keywordflow">for</font> (<a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a2">moduleList</a>()-&gt;first(); <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a2">moduleList</a>()-&gt;current(); <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a2">moduleList</a>()-&gt;next()) {
00045         <font class="keywordflow">if</font> (<a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a2">moduleList</a>()-&gt;current()-&gt;type() == CSwordModuleInfo::Lexicon) {
00046             m_lexiconPopup-&gt;insertItem( <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;moduleList()-&gt;current()-&gt;name() );
00047         }
00048     }   
00049     connect(m_lexiconPopup, SIGNAL(activated(<font class="keywordtype">int</font>)),<font class="keyword">this</font>, SLOT(lookupWord(<font class="keywordtype">int</font>)));
00050     resize(350,350);    
00051     <a class="code" href="class_c_sword_presenter.html#g2">setCaption</a>(<a class="code" href="class_c_sword_presenter.html#a4">windowCaption</a>());    
00052     
00053     setFocusPolicy(QWidget::WheelFocus);
00054 }
00055 
00056 
<a name="l00058"></a><a class="code" href="class_c_sword_presenter.html#a1">00058</a> <font class="keywordtype">int</font> <a class="code" href="class_c_sword_presenter.html#a1">CSwordPresenter::getFeatures</a>(){
00059     <font class="keywordflow">return</font> m_features;
00060 }
00061 
00063 <font class="comment">//void CSwordPresenter::refresh( ){ </font>
00064 <font class="comment">//}</font>
00065 
00067 <font class="comment">//void CSwordPresenter::printKey(const QString&amp; startKey, const QString&amp; stopKey, CSwordModuleInfo* module) {</font>
00069 <font class="comment">//  CExportManager::printKey(module, startKey, stopKey);</font>
00070 <font class="comment">//}</font>
00071 
00073 <font class="comment">//void CSwordPresenter::refreshFeatures(){</font>
00074 <font class="comment">//  m_features = 0; </font>
00075 <font class="comment">//  for (m_moduleList.first(); m_moduleList.current(); m_moduleList.next()) {</font>
00076 <font class="comment">//      if (m_moduleList.current()-&gt;supportsFeature( CSwordBackend::strongNumbers )){</font>
00077 <font class="comment">//          if (m_features != 0)</font>
00078 <font class="comment">//              m_features |= strongNumbers;</font>
00079 <font class="comment">//          else</font>
00080 <font class="comment">//              m_features = strongNumbers;</font>
00081 <font class="comment">//      }</font>
00082 <font class="comment">//      if (m_moduleList.current()-&gt;supportsFeature( CSwordBackend::footnotes )){</font>
00083 <font class="comment">//          if (m_features != 0)</font>
00084 <font class="comment">//              m_features |= footnotes;</font>
00085 <font class="comment">//          else</font>
00086 <font class="comment">//              m_features = footnotes;</font>
00087 <font class="comment">//      }</font>
00088 <font class="comment">//      if (m_moduleList.current()-&gt;supportsFeature( CSwordBackend::headings )){</font>
00089 <font class="comment">//          if (m_features != 0)</font>
00090 <font class="comment">//              m_features |= headings;</font>
00091 <font class="comment">//          else</font>
00092 <font class="comment">//              m_features = headings;</font>
00093 <font class="comment">//      }</font>
00094 <font class="comment">//      if (m_moduleList.current()-&gt;supportsFeature( CSwordBackend::morphTags )){</font>
00095 <font class="comment">//          if (m_features != 0)</font>
00096 <font class="comment">//              m_features |= morphTags;</font>
00097 <font class="comment">//          else</font>
00098 <font class="comment">//              m_features = morphTags;</font>
00099 <font class="comment">//      }       </font>
00100 <font class="comment">//  }</font>
00101 <font class="comment">//}</font>
00102 
00103 <font class="keywordtype">void</font> CSwordPresenter::lookupWord(<font class="keywordtype">int</font> moduleID){
00104     <font class="keyword">const</font> QString module = m_lexiconPopup-&gt;text(moduleID);  
00105     <font class="keyword">const</font> QString text = m_htmlWidget-&gt;selectedText();
00106     <font class="keywordflow">if</font> (!text.isEmpty())
00107         emit lookupInLexicon(text,module);
00108 }
00109 
<a name="l00111"></a><a class="code" href="class_c_sword_presenter.html#g0">00111</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#g0">CSwordPresenter::lookup</a>(<font class="keyword">const</font> QString&amp; module, <font class="keyword">const</font> QString&amp; key){
00112 
00113 }
00114 
<a name="l00116"></a><a class="code" href="class_c_sword_presenter.html#a3">00116</a> ListCSwordModuleInfo&amp; <a class="code" href="class_c_sword_presenter.html#a3">CSwordPresenter::getModuleList</a>() {
00117     <font class="keywordflow">return</font> m_moduleList;
00118 }
00119 
<a name="l00121"></a><a class="code" href="class_c_sword_presenter.html#g1">00121</a> <a class="code" href="class_c_key_chooser.html">CKeyChooser</a>* <a class="code" href="class_c_sword_presenter.html#g1">CSwordPresenter::keyChooser</a>()<font class="keyword"> const </font>{
00122     <font class="keywordflow">return</font> m_keyChooser;
00123 }
00124 
<a name="l00126"></a><a class="code" href="class_c_sword_presenter.html#a4">00126</a> <font class="keyword">const</font> QString <a class="code" href="class_c_sword_presenter.html#a4">CSwordPresenter::windowCaption</a>() {
00127     QString ret;
00128     <font class="keywordflow">if</font> (!m_moduleList.count())  {
00129         <font class="keywordflow">return</font> QString::null;
00130     }
00131     ret = m_moduleList.first()-&gt;name();     
00132     <font class="keywordflow">if</font> (m_moduleList.count() &gt; 1) {
00133         <font class="keywordflow">for</font> (m_moduleList.next(); m_moduleList.current(); m_moduleList.next())   {
00134             ret += <font class="stringliteral">" | "</font> + m_moduleList.current()-&gt;name();  
00135         }
00136     }
00137     <font class="keywordflow">return</font> ret;
00138 }
00139 
<a name="l00141"></a><a class="code" href="class_c_sword_presenter.html#g2">00141</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#g2">CSwordPresenter::setCaption</a>(<font class="keyword">const</font> QString&amp;){
00142     QWidget::setCaption( <a class="code" href="class_c_sword_presenter.html#a4">windowCaption</a>() ); <font class="comment">//set everytime our own caption</font>
00143 }
00144 
<a name="l00146"></a><a class="code" href="class_c_sword_presenter.html#a6">00146</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#a6">CSwordPresenter::applySettings</a>( <a class="code" href="class_c_profile_window.html">CProfileWindow</a>* settings ){
00147     setUpdatesEnabled(<font class="keyword">false</font>);
00148     
00149     <font class="keywordflow">if</font> (settings-&gt;<a class="code" href="class_c_profile_window.html#a14">maximized</a>()) {
00150         showMaximized();
00151     }
00152     <font class="keywordflow">else</font> {  
00153         <font class="keyword">const</font> QRect rect = settings-&gt;<a class="code" href="class_c_profile_window.html#a6">geometry</a>();
00154         resize(rect.width(), rect.height());
00155         parentWidget()-&gt;move(rect.x(), rect.y());
00156         <font class="comment">//setGeometry( settings-&gt;geometry() );</font>
00157     }
00158     m_htmlWidget-&gt;horizontalScrollBar()-&gt;setValue( settings-&gt;<a class="code" href="class_c_profile_window.html#a15">scrollbarPositions</a>().horizontal );
00159     m_htmlWidget-&gt;verticalScrollBar()-&gt;setValue( settings-&gt;<a class="code" href="class_c_profile_window.html#a15">scrollbarPositions</a>().vertical );
00160     
00161     setUpdatesEnabled(<font class="keyword">true</font>);    
00162 }
00163 
<a name="l00165"></a><a class="code" href="class_c_sword_presenter.html#a5">00165</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#a5">CSwordPresenter::storeSettings</a>( <a class="code" href="class_c_profile_window.html">CProfileWindow</a>* settings ){
00166     QRect rect;
00167     rect.setX(parentWidget()-&gt;x());
00168     rect.setY(parentWidget()-&gt;y());
00169     rect.setWidth(width());
00170     rect.setHeight(height());
00171     settings-&gt;<a class="code" href="class_c_profile_window.html#a5">setGeometry</a>(rect);
00172         
00173     settings-&gt;<a class="code" href="class_c_profile_window.html#a10">setScrollbarPositions</a>( m_htmlWidget-&gt;horizontalScrollBar()-&gt;value(), m_htmlWidget-&gt;verticalScrollBar()-&gt;value() );
00174     settings-&gt;<a class="code" href="class_c_profile_window.html#a4">setType</a>(m_moduleList.first()-&gt;type());
00175     settings-&gt;<a class="code" href="class_c_profile_window.html#a11">setMaximized</a>(isMaximized() || parentWidget()-&gt;isMaximized());
00176     
00177     <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_presenter.html#g1">keyChooser</a>()-&gt;<a class="code" href="class_c_key_chooser.html#g2">key</a>();
00178     <font class="keywordflow">if</font> (key) {
00179         VerseKey* vk = dynamic_cast&lt;VerseKey*&gt;(key);
00180         QString oldLang;
00181         <font class="keywordflow">if</font> (vk) {
00182              oldLang = QString::fromLatin1(vk-&gt;getLocale());    
00183             vk-&gt;setLocale(<font class="stringliteral">"en"</font>); <font class="comment">//save english locale names as default!        </font>
00184         }
00185         settings-&gt;<a class="code" href="class_c_profile_window.html#a8">setKey</a>( key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>() );
00186         <font class="keywordflow">if</font> (vk) {
00187             vk-&gt;setLocale(oldLang.latin1());
00188         }
00189     }
00190         
00191     QStringList modules;
00192     <font class="keywordflow">for</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = m_moduleList.first(); m; m = m_moduleList.next()) {
00193         modules.append(m-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>());
00194     }   
00195     settings-&gt;<a class="code" href="class_c_profile_window.html#a2">setModules</a>(modules);
00196 }
00197 
<a name="l00199"></a><a class="code" href="class_c_sword_presenter.html#b0">00199</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#b0">CSwordPresenter::closeEvent</a>(QCloseEvent* e) {
00200     <font class="keywordflow">if</font> (!<a class="code" href="class_c_sword_presenter.html#g4">queryClose</a>()) {
00201         e-&gt;ignore();        
00202     }   
00203     <font class="keywordflow">else</font> {
00204         e-&gt;accept();
00205         emit(closePresenter(<font class="keyword">this</font>));
00206     }
00207 }
00208 
<a name="l00210"></a><a class="code" href="class_c_sword_presenter.html#g6">00210</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#g6">CSwordPresenter::insertKeyboardActions</a>( KAccel* a ){
00211     a-&gt;setConfigGroup(<font class="stringliteral">"General window"</font>);    
00212 }
00213 
00214 <font class="keywordtype">void</font> CSwordPresenter::initAccels(){
00215 }
00216 
00218 <font class="keywordtype">void</font> CSwordPresenter::polish(){
00219     KMainWindow::polish();      
00220     m_accel = <font class="keyword">new</font> KAccel(<font class="keyword">this</font>); 
00221     initAccels();
00222 }
00223 
00225 <font class="keywordtype">void</font> CSwordPresenter::focusInEvent( QFocusEvent* e ){
00226     KMainWindow::focusInEvent(e);
00227     <font class="keywordflow">if</font> (m_accel)
00228         m_accel-&gt;setEnabled(<font class="keyword">true</font>);
00229 }
00230 
00232 <font class="keywordtype">void</font> CSwordPresenter::focusOutEvent( QFocusEvent* e ){
00233 <font class="comment">//  qDebug("CSwordPresenter::focusOutEvent( QFocusEvent* e )"); </font>
00234     KMainWindow::focusOutEvent(e);  
00235     <font class="keywordflow">if</font> (m_accel)
00236         m_accel-&gt;setEnabled(<font class="keyword">false</font>);
00237 }
00238 
<a name="l00240"></a><a class="code" href="class_c_sword_presenter.html#a2">00240</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#a2">CSwordPresenter::refresh</a>(){
00241 <font class="comment">//  qWarning("CSwordPresenter::refresh()");</font>
00242     m_moduleOptions = CBTConfig::getFilterOptionDefaults();
00243     m_displayOptions = CBTConfig::getDisplayOptionDefaults();
00244 
00245     <font class="keywordflow">if</font> (m_displaySettingsButton)
00246         m_displaySettingsButton-&gt;reset(m_moduleList);
00247 }
00248 
<a name="l00250"></a><a class="code" href="class_c_sword_presenter.html#g3">00250</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_presenter.html#g3">CSwordPresenter::referenceDropped</a>(<font class="keyword">const</font> QString&amp; ref){
00251     <a class="code" href="class_c_sword_presenter.html#g0">lookup</a>(m_moduleList.first()-&gt;name(), ref);
00252 }
00253 
<a name="l00255"></a><a class="code" href="class_c_sword_presenter.html#g4">00255</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_sword_presenter.html#g4">CSwordPresenter::queryClose</a>(){
00256     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00257 }
00258 
<a name="l00260"></a><a class="code" href="class_c_sword_presenter.html#g5">00260</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_sword_presenter.html#g5">CSwordPresenter::initialized</a>(){
00261     <font class="keywordflow">return</font> m_initialized;
00262 }
00263 
00265 <font class="keywordtype">void</font> CSwordPresenter::setInitialized(){
00266     m_initialized = <font class="keyword">true</font>;
00267 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:47 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
