<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cprintitem.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cprintitem.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cprintitem.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Aug 20 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 
00019 <font class="preprocessor">#include "cprintitem.h"</font>
00020 <font class="preprocessor">#include "cprintitemlist.h"</font>
00021 <font class="preprocessor">#include "cstyle.h"</font>
00022 <font class="preprocessor">#include "cstyleformat.h"</font>
00023 <font class="preprocessor">#include "cstyleformatframe.h"</font>
00024 <font class="preprocessor">#include "../backend/cswordmoduleinfo.h"</font>
00025 <font class="preprocessor">#include "../backend/cswordversekey.h"</font>
00026 <font class="preprocessor">#include "../backend/cswordldkey.h"</font>
00027 <font class="preprocessor">#include "../backend/chtmlentrydisplay.h"</font>
00028 <font class="preprocessor">#include "../frontend/cbtconfig.h"</font>
00029 <font class="preprocessor">#include "../util/scoped_resource.h"</font>
00030 
00031 
00032 <font class="comment">//Qt includes</font>
00033 <font class="preprocessor">#include &lt;qsimplerichtext.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qlistview.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qregexp.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qstylesheet.h&gt;</font>
00037 
00038 <font class="comment">//Sword includes</font>
00039 <font class="preprocessor">#include &lt;swmodule.h&gt;</font>
00040 <font class="preprocessor">#include &lt;swkey.h&gt;</font>
00041 <font class="preprocessor">#include &lt;versekey.h&gt;</font>
00042 
00043 
00044 <font class="preprocessor">#define PARAGRAPH_SPACE 10 // Space between different paragraphs</font>
00045 <font class="preprocessor"></font><font class="preprocessor">#define STYLE_PART_SPACE 1  //Space between the different parts (header, moduletext ...)</font>
00046 <font class="preprocessor"></font><font class="preprocessor">#define BORDER_SPACE 3  //border between text and rectangle</font>
00047 <font class="preprocessor"></font>
00048 
00049 CPrintItem::ListViewItem::ListViewItem( QListView* parent, <a class="code" href="class_c_print_item.html">CPrintItem</a>* printItem )
00050     : QListViewItem(parent), m_printItem(printItem) {
00051     
00052 };
00053 
00054 <font class="comment">//CPrintItem::ListViewItem::~ListViewItem() {</font>
00055 <font class="comment">//</font>
00056 <font class="comment">//};</font>
00057 
00058 <a class="code" href="class_c_print_item.html">CPrintItem</a>* <font class="keyword">const</font> CPrintItem::ListViewItem::printItem()<font class="keyword"> const </font>{
00059     <font class="keywordflow">return</font> m_printItem;
00060 };
00061 
00062 CStyle* <font class="keyword">const</font> <a class="code" href="class_c_print_item.html#a2">CPrintItem::ListViewItem::style</a>()<font class="keyword"> const </font>{
00063     <font class="keywordflow">return</font> (m_printItem) ? m_printItem-&gt;style() : 0;
00064 };
00065 
00066 
00067 CPrintItem::CPrintItem(<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; startKey, <font class="keyword">const</font> QString&amp; stopKey, <font class="keyword">const</font> QString&amp; description) :
00068     m_listViewItem(0), m_module(module), m_style(0), m_startKey(startKey),
00069     m_headerText(QString::null), m_description(description), m_moduleText(QString::null)    
00070 {   
00071     m_startEmpty = startKey.isEmpty();  
00072     m_stopKey = (!m_startEmpty &amp;&amp; (startKey != stopKey) ) ? stopKey : QString::null;
00073     m_stopEmpty  = m_stopKey.isEmpty(); 
00074     
00075     headerText();
00076     moduleText(); <font class="comment">//cache the module text, makes printing faster (at least the user thinks this :)</font>
00077 }
00078 
<a name="l00080"></a><a class="code" href="class_c_print_item.html#c1">00080</a> <font class="keyword">const</font> QString&amp; <a class="code" href="class_c_print_item.html#c1">CPrintItem::moduleText</a>() {
00086     <font class="keywordflow">if</font> (!m_moduleText.isEmpty())
00087         <font class="keywordflow">return</font> m_moduleText;
00088     <font class="keywordflow">if</font> (m_startEmpty || !m_module)
00089         <font class="keywordflow">return</font> QString::null;
00090 
00091     <font class="keywordflow">if</font> (m_stopEmpty) {<font class="comment">//only one key</font>
00092         <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module));
00093         key-&gt;key(m_startKey);
00094         m_moduleText = key-&gt;renderedText();         
00095         <font class="comment">//delete key;</font>
00096     }
00097     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Bible  || m_module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Commentary ) {
00098         <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordVerseKey&gt;</a> startKey(  dynamic_cast&lt;CSwordVerseKey*&gt;(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module)) );
00099         <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordVerseKey&gt;</a> stopKey( dynamic_cast&lt;CSwordVerseKey*&gt;(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module)) );
00100         
00101         startKey-&gt;key(m_startKey);      
00102         stopKey-&gt;key(m_stopKey);        
00103     
00104         <font class="keyword">const</font> QString format = QString::fromLatin1(<font class="stringliteral">" &lt;FONT SIZE=\"-2\"&gt;&lt;NOBR&gt;%1&lt;/NOBR&gt;&lt;/FONT&gt;"</font>);                    
00105         <font class="keywordflow">while</font> (*startKey &lt; *stopKey) {
00106             startKey-&gt;next(CSwordVerseKey::UseVerse);
00107             m_moduleText += format.arg(startKey-&gt;Verse()) + startKey-&gt;renderedText();
00108         }
00109     }       
00110 
00111     m_moduleText.replace(QRegExp(<font class="stringliteral">"$\n+"</font>), <font class="stringliteral">""</font>);
00112     m_moduleText.replace(QRegExp(<font class="stringliteral">"$&lt;BR&gt;+"</font>), <font class="stringliteral">""</font>);    
00113     <font class="keywordflow">return</font> m_moduleText;
00114 }
00115 
<a name="l00117"></a><a class="code" href="class_c_print_item.html#a1">00117</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a1">CPrintItem::setStyle</a>( CStyle* newStyle ) {
00118     m_style = newStyle;
00119 }
00120 
<a name="l00121"></a><a class="code" href="class_c_print_item.html#a2">00121</a> CStyle*<font class="keyword">const</font> <a class="code" href="class_c_print_item.html#a2">CPrintItem::style</a>()<font class="keyword"> const </font>{
00122     <font class="keywordflow">return</font> m_style;
00123 }
00124 
<a name="l00126"></a><a class="code" href="class_c_print_item.html#a3">00126</a> QListViewItem* <a class="code" href="class_c_print_item.html#a5">CPrintItem::listViewItem</a>( <a class="code" href="class_c_print_item_list.html">CPrintItemList</a>* list ) {
00127     <a class="code" href="class_c_print_item.html#a6">deleteListViewItem</a>();
00128     m_listViewItem = <font class="keyword">new</font> ListViewItem( list, <font class="keyword">this</font> );
00129     <a class="code" href="class_c_print_item.html#a4">updateListViewItem</a>();
00130     <font class="keywordflow">return</font> m_listViewItem;
00131 }
00132 
<a name="l00134"></a><a class="code" href="class_c_print_item.html#a4">00134</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a4">CPrintItem::updateListViewItem</a>(){
00135     <font class="keywordflow">if</font> (m_module)
00136         m_listViewItem-&gt;setText(0, m_module-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>() );
00137     
00138     <font class="keywordflow">if</font> (!m_startEmpty)
00139         m_listViewItem-&gt;setText(1,m_startKey);
00140     
00141     <font class="keywordflow">if</font> (!m_stopEmpty)
00142         m_listViewItem-&gt;setText(2,m_stopKey);
00143     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!m_startEmpty)
00144         m_listViewItem-&gt;setText(2,m_startKey);
00145     
00146     <font class="keywordflow">if</font> (m_style)
00147         m_listViewItem-&gt;setText(3, m_style-&gt;styleName() );
00148 }
00149 
<a name="l00151"></a><a class="code" href="class_c_print_item.html#a5">00151</a> QListViewItem* <font class="keyword">const</font> <a class="code" href="class_c_print_item.html#a5">CPrintItem::listViewItem</a>()<font class="keyword"> const </font>{
00152     <font class="keywordflow">return</font> m_listViewItem;
00153 }
00154 
<a name="l00156"></a><a class="code" href="class_c_print_item.html#a6">00156</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a6">CPrintItem::deleteListViewItem</a>(){
00157     <font class="keyword">delete</font> m_listViewItem;
00158     m_listViewItem = 0;
00159 }
00160 
<a name="l00162"></a><a class="code" href="class_c_print_item.html#a7">00162</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a7">CPrintItem::draw</a>(QPainter* p, CPrinter* printer){
00170     QFont font;
00171     QColor fgColor;
00172     QColor bgColor;
00173     <a class="code" href="class_c_style_format.html">CStyleFormat</a>* format = 0;
00174     <a class="code" href="class_c_style_format_frame.html">CStyleFormatFrame</a>* frame = 0;
00175     <font class="keywordtype">int</font> frameThickness = 0;
00176     CStyleFormat::Alignement alignement;    
00177     CStyle::styleType type = CStyle::Unknown;
00178     QString text;
00179     
00180     QColorGroup cg;
00181     QPen pen;
00182     QBrush brush;
00183 
00184     <font class="keyword">const</font> <font class="keywordtype">bool</font> isUnicode    = (m_module &amp;&amp; m_module-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>());
00185     <font class="keyword">const</font> <font class="keywordtype">int</font> leftMargin    = printer-&gt;leftMargin();
00186     <font class="keyword">const</font> <font class="keywordtype">int</font> rightMargin = printer-&gt;rightMargin();
00187     <font class="keyword">const</font> <font class="keywordtype">int</font> upperMargin = printer-&gt;upperMargin();
00188     <font class="keyword">const</font> <font class="keywordtype">int</font> lowerMargin = printer-&gt;lowerMargin();             
00189     
00190     <font class="keyword">const</font> QRect pageSize =  printer-&gt;contentSize();
00191     <font class="keyword">const</font> <font class="keywordtype">int</font> pageHeight    = pageSize.height();
00192     <font class="keyword">const</font> <font class="keywordtype">int</font> pageWidth     = pageSize.width();
00193     
00194 <font class="comment">//moved out of the loop for optimization    </font>
00195     <font class="keywordtype">int</font> verticalPos = printer-&gt;verticalPos();       
00196     <font class="keywordtype">int</font> arguments   = 0;
00197     QRect boundingRect; <font class="comment">//rectangle for the content</font>
00198     QRect br;   
00199     QRect view;
00200     QPen framePen;
00201     <font class="keywordtype">int</font> movePixs;
00202     
00203     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 3; ++i) {       
00204         type = static_cast&lt;CStyle::styleType&gt;(i);
00205         
00206         <font class="keywordflow">if</font> (!m_style-&gt;hasFormatTypeEnabled(type)) <font class="comment">//jump to next part if this is not enabled</font>
00207             <font class="keywordflow">continue</font>;
00208                 
00209         format  = m_style-&gt;formatForType( type );
00210         fgColor = format-&gt;<a class="code" href="class_c_style_format.html#a2">color</a>( CStyleFormat::Foreground );
00211         bgColor = format-&gt;<a class="code" href="class_c_style_format.html#a2">color</a>( CStyleFormat::Background );
00212         pen.setColor(fgColor);
00213         font = format-&gt;<a class="code" href="class_c_style_format.html#a5">getFont</a>();
00214         <font class="keywordflow">if</font> (isUnicode) { <font class="comment">//enable unicode</font>
00215             font.setCharSet( QFont::Unicode );
00216         }
00217         
00218         frame = <font class="comment">/*format-&gt;hasFrame() ?*/</font> format-&gt;<a class="code" href="class_c_style_format.html#a9">frame</a>() <font class="comment">/*: 0*/</font>;
00219         frameThickness = frame ? frame-&gt;<a class="code" href="class_c_style_format_frame.html#a6">thickness</a>() : 0;        
00220         alignement = format-&gt;<a class="code" href="class_c_style_format.html#a7">alignement</a>();
00221 <font class="comment">//      identation = format-&gt;getIdentation();</font>
00222         <font class="keywordflow">if</font> (type == CStyle::Header)
00223             text = <a class="code" href="class_c_print_item.html#c0">headerText</a>();
00224         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (type == CStyle::Description)
00225             text = m_description;
00226         <font class="keywordflow">else</font>
00227             text = <a class="code" href="class_c_print_item.html#c1">moduleText</a>();
00228 
00229         p-&gt;setFont(font);
00230         p-&gt;setPen(pen);
00231         cg.setColor(QColorGroup::Text, fgColor);
00232                 
00233         arguments = Qt::WordBreak;      
00234         <font class="keywordflow">if</font> (alignement == CStyleFormat::Left)
00235             arguments |= Qt::AlignLeft;
00236         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alignement == CStyleFormat::Center)
00237             arguments |= Qt::AlignHCenter;
00238         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alignement == CStyleFormat::Right)
00239             arguments |= Qt::AlignRight;
00240                 
00241         <font class="keywordflow">if</font> ((type == CStyle::Header || type == CStyle::Description) &amp;&amp; !text.isEmpty()) {
00242             boundingRect = p-&gt;boundingRect (
00243                 leftMargin, <font class="comment">//x of upper left corner</font>
00244                 verticalPos, <font class="comment">//y of upper left corner</font>
00245                 pageWidth - 2*BORDER_SPACE - 2*frameThickness, <font class="comment">//pixels to the right from the upper left corner</font>
00246                 pageHeight - 2*BORDER_SPACE - 2*frameThickness - verticalPos + upperMargin, <font class="comment">//pixels down from upper left corner</font>
00247                 arguments, text
00248             );
00249             
00250             <font class="comment">//check if the new text fits into the current page page</font>
00251             <font class="comment">//WARNING: use 2* or 1* frameThickness here??</font>
00252             <font class="keywordflow">if</font> (        ( boundingRect.height() + 2*BORDER_SPACE + 2*frameThickness + STYLE_PART_SPACE )
00253                         &gt; ( pageHeight - verticalPos  + upperMargin ) )
00254             {
00255                 <font class="comment">//this part doesn't fit on the current page</font>
00256                 printer-&gt;newPage();
00257                 verticalPos = printer-&gt;verticalPos();
00258                 boundingRect = p-&gt;boundingRect(
00259                     leftMargin,
00260                     verticalPos,
00261                     pageWidth - 2*BORDER_SPACE - 2*frameThickness,
00262                     pageHeight- 2*BORDER_SPACE - 2*frameThickness - verticalPos + upperMargin,
00263                     arguments, text
00264                 );
00265             }
00266             br = boundingRect;  <font class="comment">//rectangle for the background fill     </font>
00267             br.setLeft(leftMargin);
00268             br.setWidth(pageWidth-frameThickness); <font class="comment">//because we move in the next lines</font>
00269             br.setHeight(br.height()+BORDER_SPACE); <font class="comment">//because we move in the next lines</font>
00270             br.moveBy(frameThickness, frameThickness);          
00271             p-&gt;fillRect(br, bgColor);
00272 
00273             br = boundingRect;  <font class="comment">// the rect for the border      </font>
00278 <font class="comment"></font>            <font class="keyword">const</font> <font class="keywordtype">int</font> halfWidth = (int)((float)frameThickness/2);
00279 
00280 <font class="comment">//          br.setHeight( br.height() + 2*halfWidth  + BORDER_SPACE );                      </font>
00281             br.setLeft( leftMargin + halfWidth );
00282             br.setTop( br.top() + halfWidth ); <font class="comment">//boundingRect is moved by 2*halfWidth down -&gt; use +halfWidth !!</font>
00283             br.setWidth( pageWidth - 2*halfWidth);
00284             br.setHeight( br.height() + 2*halfWidth  + BORDER_SPACE );                      
00285             
00286 <font class="comment">//          boundingRect.setWidth(boundingRect.width()+5);//HACK to avoid cut letters</font>
00287             boundingRect.moveBy(BORDER_SPACE + frameThickness, frameThickness);
00288 <font class="comment">//          arguments |= Qt::AlignVCenter; //WARNING: Right here? Will it change the boundingrect??</font>
00289             p-&gt;drawText(boundingRect, arguments, text);
00290             printer-&gt;setVerticalPos(boundingRect.top() + boundingRect.height() + 2*frameThickness + STYLE_PART_SPACE);
00291             verticalPos = printer-&gt;verticalPos();
00292             
00293             <font class="keywordflow">if</font> (frame) {
00294                 framePen = pen;
00295                 framePen.setWidth( frameThickness );
00296                 framePen.setColor( frame-&gt;<a class="code" href="class_c_style_format_frame.html#a2">color</a>() );
00297                 framePen.setStyle( frame-&gt;<a class="code" href="class_c_style_format_frame.html#a4">lineStyle</a>() );
00298                 p-&gt;setPen( framePen );
00299 
00300                 p-&gt;drawRect( br );
00301             }                       
00302         }
00303         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (type == CStyle::ModuleText) {      
00304             p-&gt;save();
00305             <font class="keywordflow">if</font> (isUnicode)
00306                 font = CBTConfig::get( CBTConfig::unicode );
00307 
00308             <font class="keywordflow">if</font> (alignement == CStyleFormat::Center)     
00309                 text = QString::fromLatin1(<font class="stringliteral">"&lt;CENTER&gt;%1&lt;/CENTER&gt;"</font>).arg(text);
00310             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alignement == CStyleFormat::Right)     
00311                 text = QString::fromLatin1(<font class="stringliteral">"&lt;P ALIGN=\"RIGHT\"&gt;%1&lt;/P&gt;"</font>).arg(text);
00312         QSimpleRichText richText(
00313             text,
00314             font,
00315             QString::null,
00316             QStyleSheet::defaultSheet(),
00317             QMimeSourceFactory::defaultFactory(),
00318                 pageHeight-verticalPos-2*frameThickness + upperMargin
00319             );
00320 
00321         richText.setWidth( p, pageWidth-2*frameThickness-2*BORDER_SPACE );
00322         view = QRect( <font class="comment">//add BORDER_SPACE</font>
00323             leftMargin+frameThickness, <font class="comment">//why not use leftMargin here?</font>
00324             upperMargin+frameThickness,  <font class="comment">//same for rightMargin??</font>
00325             pageWidth-2*frameThickness,
00326             pageHeight-2*frameThickness
00327         );
00328         <font class="keywordtype">int</font> translated = 0;
00329         <font class="keywordflow">do</font> {
00330             <font class="keywordflow">if</font> ((int)(richText.height()-translated + verticalPos) &lt; (int)(pageHeight+upperMargin) )
00331                 br = QRect(
00332                             leftMargin,
00333                             verticalPos,
00334                             pageWidth,
00335                             richText.height()+frameThickness
00336                         );
00337             <font class="keywordflow">else</font> { <font class="comment">//fill to bottom of the page</font>
00338                 br = QRect (
00339                         leftMargin,
00340                         verticalPos,
00341                         pageWidth,
00342                         pageHeight-verticalPos+upperMargin
00343                     );
00344                 br.moveBy(0, translated);
00345             }
00346             p-&gt;setClipRect(
00347                 upperMargin,
00348                 leftMargin,
00349                 pageWidth,
00350                 pageHeight
00351             );
00352             p-&gt;fillRect(br,QBrush(bgColor));
00353                 <font class="keywordflow">if</font> (frame) {
00354                     br.moveBy( (<font class="keywordtype">int</font>)((<font class="keywordtype">float</font>)-frameThickness/2), (<font class="keywordtype">int</font>)((<font class="keywordtype">float</font>)-frameThickness/2) );  
00355                 
00356                     framePen = pen;
00357                     framePen.setWidth( frameThickness );
00358                     framePen.setColor( frame-&gt;<a class="code" href="class_c_style_format_frame.html#a2">color</a>() );
00359                     framePen.setStyle( frame-&gt;<a class="code" href="class_c_style_format_frame.html#a4">lineStyle</a>() );                                    
00360                     p-&gt;setPen( framePen );
00361 
00362                     p-&gt;drawRect(br);
00363                 }                                   
00364             p-&gt;setClipping(<font class="keyword">false</font>);
00365         richText.draw(p, leftMargin+frameThickness+BORDER_SPACE, verticalPos+frameThickness, view, cg);
00366                 movePixs =
00367                         (((int)richText.height()-translated)
00368                     &gt; (int)(pageHeight-verticalPos+ upperMargin ))
00369                     ? (pageHeight-verticalPos + upperMargin )
00370                     : richText.height()-translated + 2*frameThickness;
00371 
00372             printer-&gt;setVerticalPos(verticalPos+movePixs);                  
00373 
00374             view.moveBy( 0,movePixs);
00375         p-&gt;translate( 0,-movePixs);
00376         translated+=movePixs;
00377         <font class="keywordflow">if</font> ( view.top() &gt;= richText.height() ) { <font class="comment">//bottom or top(default)</font>
00378                 <font class="keywordflow">break</font>;
00379             }
00380             printer-&gt;newPage();
00381             verticalPos = printer-&gt;verticalPos();           
00382         } <font class="keywordflow">while</font> (true);
00383             p-&gt;restore();
00384     }
00385     }
00386     printer-&gt;setVerticalPos(printer-&gt;verticalPos() + PARAGRAPH_SPACE);  
00387 }
00388 
<a name="l00390"></a><a class="code" href="class_c_print_item.html#c0">00390</a> <font class="keyword">const</font> QString&amp; <a class="code" href="class_c_print_item.html#c0">CPrintItem::headerText</a>() {
00391     <font class="keywordflow">if</font> (!m_headerText.isEmpty())  <font class="comment">// cached?</font>
00392         <font class="keywordflow">return</font> m_headerText;
00393 
00394   <font class="keywordflow">if</font> (m_startEmpty)
00395     <font class="keywordflow">return</font> QString::null;   
00396     <font class="keywordflow">if</font> (m_stopEmpty)
00397         m_headerText = m_startKey;
00398     <font class="keywordflow">else</font> {<font class="comment">//start and stop key do exist and are different</font>
00399         m_headerText = QString::fromLatin1(<font class="stringliteral">"%1 - %2"</font>).arg(m_startKey).arg(m_stopKey);
00400     }   
00401     <font class="keywordflow">return</font> m_headerText;
00402 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
