<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cprintitem.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cprintitem.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cprintitem.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Aug 20 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 
00019 <font class="preprocessor">#include "cprintitem.h"</font>
00020 <font class="preprocessor">#include "cprintitemlist.h"</font>
00021 <font class="preprocessor">#include "cstyle.h"</font>
00022 <font class="preprocessor">#include "backend/cswordmoduleinfo.h"</font>
00023 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00024 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00025 <font class="comment">//#include "backend/chtmlentrydisplay.h"</font>
00026 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00027 <font class="preprocessor">#include "util/scoped_resource.h"</font>
00028 
00029 
00030 <font class="comment">//Qt includes</font>
00031 <font class="preprocessor">#include &lt;qsimplerichtext.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qlistview.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qregexp.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qstylesheet.h&gt;</font>
00035 
00036 <font class="comment">//Sword includes</font>
00037 <font class="preprocessor">#include &lt;swmodule.h&gt;</font>
00038 <font class="preprocessor">#include &lt;swkey.h&gt;</font>
00039 <font class="preprocessor">#include &lt;versekey.h&gt;</font>
00040 
00041 
00042 <font class="preprocessor">#define PARAGRAPH_SPACE 10 // Space between different paragraphs</font>
00043 <font class="preprocessor"></font><font class="preprocessor">#define STYLE_PART_SPACE 1  //Space between the different parts (header, moduletext ...)</font>
00044 <font class="preprocessor"></font><font class="preprocessor">#define BORDER_SPACE 3  //border between text and rectangle</font>
00045 <font class="preprocessor"></font>
00046 
00047 CPrintItem::ListViewItem::ListViewItem( QListView* parent, <a class="code" href="class_c_print_item.html">CPrintItem</a>* printItem )
00048     : QListViewItem(parent), m_printItem(printItem) {
00049     
00050 };
00051 
00052 <a class="code" href="class_c_print_item.html">CPrintItem</a>* <font class="keyword">const</font> CPrintItem::ListViewItem::printItem()<font class="keyword"> const </font>{
00053     <font class="keywordflow">return</font> m_printItem;
00054 };
00055 
00056 CStyle* <font class="keyword">const</font> <a class="code" href="class_c_print_item.html#a2">CPrintItem::ListViewItem::style</a>()<font class="keyword"> const </font>{
00057     <font class="keywordflow">return</font> (m_printItem) ? m_printItem-&gt;style() : 0;
00058 };
00059 
00060 
00061 CPrintItem::CPrintItem(<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; startKey, <font class="keyword">const</font> QString&amp; stopKey, <font class="keyword">const</font> QString&amp; description,<font class="keyword">const</font> CSwordBackend::DisplayOptionsBool displayOptions, <font class="keyword">const</font> CSwordBackend::FilterOptionsBool filterOptions) :
00062   m_style(0), m_headerText(QString::null), m_description(description),  m_moduleText(QString::null),
00063   m_startKey(startKey),  m_module(module), m_listViewItem(0),
00064   m_displayOptions(displayOptions), m_filterOptions(filterOptions)
00065 {   
00066     m_startEmpty = startKey.isEmpty();  
00067     m_stopKey = (!m_startEmpty &amp;&amp; (startKey != stopKey) ) ? stopKey : QString::null;
00068     m_stopEmpty  = m_stopKey.isEmpty(); 
00069     
00070     headerText();
00071     moduleText(); <font class="comment">//cache the module text, makes printing faster (at least the user thinks this :)</font>
00072 }
00073 
<a name="l00075"></a><a class="code" href="class_c_print_item.html#c1">00075</a> <font class="keyword">const</font> QString&amp; <a class="code" href="class_c_print_item.html#c1">CPrintItem::moduleText</a>() {
00081     <font class="keywordflow">if</font> (!m_moduleText.isEmpty()) <font class="comment">//cached text</font>
00082         <font class="keywordflow">return</font> m_moduleText;
00083 
00084     <font class="keywordflow">if</font> (m_startEmpty || !m_module)
00085         <font class="keywordflow">return</font> QString::null;
00086 
00087     <a class="code" href="class_c_pointers.html#d1">CPointers::backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a7">setDisplayOptions</a>(m_displayOptions);
00088     <a class="code" href="class_c_pointers.html#d1">CPointers::backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>(m_filterOptions);    
00089     
00090     <font class="keywordflow">if</font> (m_stopEmpty) {<font class="comment">//only start key</font>
00091         <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module));
00092         key-&gt;key(m_startKey);
00093         m_moduleText = key-&gt;renderedText();         
00094     }
00095     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Bible || m_module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Commentary ) {
00096         <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordVerseKey&gt;</a> startKey(dynamic_cast&lt;CSwordVerseKey*&gt;(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module)));
00097         <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordVerseKey&gt;</a> stopKey(dynamic_cast&lt;CSwordVerseKey*&gt;(<a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m_module)));
00098         
00099         startKey-&gt;key(m_startKey);
00100         stopKey-&gt;key(m_stopKey);
00101     
00102 <font class="comment">//      const QString format = QString::fromLatin1(" &lt;FONT SIZE=\"-2\"&gt;&lt;NOBR&gt;%1&lt;/NOBR&gt;&lt;/FONT&gt;");</font>
00103         <font class="keyword">const</font> QString format = QString::fromLatin1(<font class="stringliteral">" &lt;FONT SIZE=\"-3\"&gt;&lt;NOBR&gt;%1&lt;/NOBR&gt;&lt;/FONT&gt; "</font>);
00104         <font class="keywordflow">while</font> ( (*startKey) &lt; (*stopKey) || (*startKey) == (*stopKey) ) {
00105             m_moduleText += (m_displayOptions.verseNumbers ? format.arg(startKey-&gt;Verse()) : QString::null)
00106 + startKey-&gt;renderedText() + (<font class="comment">/*m_displayOptions.lineBreaks ?*/</font> <font class="stringliteral">"&lt;BR&gt;\n"</font><font class="comment">/* : QString::null*/</font>);
00107             startKey-&gt;next(CSwordVerseKey::UseVerse);
00108         }
00109     }       
00110     
00111     m_moduleText.replace(QRegExp(<font class="stringliteral">"$\n\n+"</font>), <font class="stringliteral">""</font>);
00112     m_moduleText.replace(QRegExp(<font class="stringliteral">"$&lt;BR&gt;&lt;BR&gt;+"</font>), <font class="stringliteral">""</font>);    
00113     <font class="keywordflow">return</font> m_moduleText;
00114 }
00115 
<a name="l00117"></a><a class="code" href="class_c_print_item.html#a1">00117</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a1">CPrintItem::setStyle</a>( CStyle* newStyle ) {
00118     m_style = newStyle;
00119 }
00120 
<a name="l00121"></a><a class="code" href="class_c_print_item.html#a2">00121</a> CStyle*<font class="keyword">const</font> <a class="code" href="class_c_print_item.html#a2">CPrintItem::style</a>()<font class="keyword"> const </font>{
00122     <font class="keywordflow">return</font> m_style;
00123 }
00124 
<a name="l00126"></a><a class="code" href="class_c_print_item.html#a3">00126</a> QListViewItem* <a class="code" href="class_c_print_item.html#a5">CPrintItem::listViewItem</a>( <a class="code" href="class_c_print_item_list.html">CPrintItemList</a>* list ) {
00127     <a class="code" href="class_c_print_item.html#a6">deleteListViewItem</a>();
00128     m_listViewItem = <font class="keyword">new</font> ListViewItem( list, <font class="keyword">this</font> );
00129     <a class="code" href="class_c_print_item.html#a4">updateListViewItem</a>();
00130     <font class="keywordflow">return</font> m_listViewItem;
00131 }
00132 
<a name="l00134"></a><a class="code" href="class_c_print_item.html#a4">00134</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a4">CPrintItem::updateListViewItem</a>(){
00135     <font class="keywordflow">if</font> (m_module)
00136         m_listViewItem-&gt;setText(0, m_module-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>() );
00137     
00138     <font class="keywordflow">if</font> (!m_startEmpty)
00139         m_listViewItem-&gt;setText(1,m_startKey);
00140     
00141     <font class="keywordflow">if</font> (!m_stopEmpty)
00142         m_listViewItem-&gt;setText(2,m_stopKey);
00143     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!m_startEmpty)
00144         m_listViewItem-&gt;setText(2,m_startKey);
00145     
00146     <font class="keywordflow">if</font> (m_style)
00147         m_listViewItem-&gt;setText(3, m_style-&gt;styleName() );
00148 }
00149 
<a name="l00151"></a><a class="code" href="class_c_print_item.html#a5">00151</a> QListViewItem* <font class="keyword">const</font> <a class="code" href="class_c_print_item.html#a5">CPrintItem::listViewItem</a>()<font class="keyword"> const </font>{
00152     <font class="keywordflow">return</font> m_listViewItem;
00153 }
00154 
<a name="l00156"></a><a class="code" href="class_c_print_item.html#a6">00156</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a6">CPrintItem::deleteListViewItem</a>(){
00157     <font class="keyword">delete</font> m_listViewItem;
00158     m_listViewItem = 0;
00159 }
00160 
<a name="l00162"></a><a class="code" href="class_c_print_item.html#a7">00162</a> <font class="keywordtype">void</font> <a class="code" href="class_c_print_item.html#a7">CPrintItem::draw</a>(QPainter* p, CPrinter* printer){
00170     QFont font;
00171     QColor fgColor;
00172     QColor bgColor;
00173     CStyle::Format* format;
00174     CStyle::Format::Frame* frame = 0;
00175     <font class="keywordtype">int</font> frameThickness = 0;
00176     CStyle::Format::Alignment alignment;    
00177     CStyle::StyleType type = CStyle::Unknown;
00178     QString text;
00179     
00180     QColorGroup cg;
00181     QPen pen;
00182     QBrush brush;
00183 
00184     <font class="keyword">const</font> <font class="keywordtype">bool</font> isUnicode    = (m_module &amp;&amp; m_module-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>());
00185     <font class="keyword">const</font> <font class="keywordtype">int</font> leftMargin    = printer-&gt;pageMargins().left;
00186     <font class="keyword">const</font> <font class="keywordtype">int</font> upperMargin = printer-&gt;pageMargins().top; 
00187     <font class="keyword">const</font> QRect pageSize =  printer-&gt;contentSize();
00188     <font class="keyword">const</font> <font class="keywordtype">int</font> pageHeight    = pageSize.height();
00189     <font class="keyword">const</font> <font class="keywordtype">int</font> pageWidth     = pageSize.width();
00190     
00191 <font class="comment">//moved out of the loop for optimization    </font>
00192     <font class="keywordtype">int</font> verticalPos = printer-&gt;verticalPos();       
00193     <font class="keywordtype">int</font> arguments   = 0;
00194     QRect boundingRect; <font class="comment">//rectangle for the content</font>
00195     QRect br;   
00196     QRect view;
00197     QPen framePen;
00198     <font class="keywordtype">int</font> movePixs;
00199     
00200     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; 3; ++i) {       
00201         type = static_cast&lt;CStyle::StyleType&gt;(i);
00202         
00203         <font class="keywordflow">if</font> (!m_style-&gt;hasFormatTypeEnabled(type)) <font class="comment">//jump to next part if this is not enabled</font>
00204             <font class="keywordflow">continue</font>;
00205                 
00206         format  = m_style-&gt;formatForType( type );
00207         fgColor = format-&gt;color( CStyle::Format::Foreground );
00208         bgColor = format-&gt;color( CStyle::Format::Background );
00209         pen.setColor(fgColor);
00210         font = format-&gt;font();
00211         
00212         frame = format-&gt;frame();
00213         frameThickness = frame ? frame-&gt;thickness() : 0;        
00214         alignment = format-&gt;alignment();
00215         <font class="keywordflow">if</font> (type == CStyle::Header)
00216             text = <a class="code" href="class_c_print_item.html#c0">headerText</a>();
00217         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (type == CStyle::Description)
00218             text = m_description;
00219         <font class="keywordflow">else</font>
00220             text = <a class="code" href="class_c_print_item.html#c1">moduleText</a>();
00221 
00222         p-&gt;setFont(font);
00223         p-&gt;setPen(pen);
00224         cg.setColor(QColorGroup::Text, fgColor);
00225                 
00226         arguments = Qt::WordBreak;      
00227         <font class="keywordflow">if</font> (alignment == CStyle::Format::Left)
00228             arguments |= Qt::AlignLeft;
00229         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alignment == CStyle::Format::Center)
00230             arguments |= Qt::AlignHCenter;
00231         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alignment == CStyle::Format::Right)
00232             arguments |= Qt::AlignRight;
00233                 
00234         <font class="keywordflow">if</font> ((type == CStyle::Header || type == CStyle::Description) &amp;&amp; !text.isEmpty()) {
00235             boundingRect = p-&gt;boundingRect (
00236                 leftMargin, <font class="comment">//x of upper left corner</font>
00237                 verticalPos, <font class="comment">//y of upper left corner</font>
00238                 pageWidth - 2*BORDER_SPACE - 2*frameThickness, <font class="comment">//pixels to the right from the upper left corner</font>
00239                 pageHeight - 2*BORDER_SPACE - 2*frameThickness - verticalPos + upperMargin, <font class="comment">//pixels down from upper left corner</font>
00240                 arguments, text
00241             );
00242             
00243             <font class="comment">//check if the new text fits into the current page page</font>
00244             <font class="comment">//WARNING: use 2* or 1* frameThickness here??</font>
00245             <font class="keywordflow">if</font> (        ( boundingRect.height() + 2*BORDER_SPACE + 2*frameThickness + STYLE_PART_SPACE )
00246                         &gt; ( pageHeight - verticalPos  + upperMargin ) )
00247             {
00248                 <font class="comment">//this part doesn't fit on the current page</font>
00249                 printer-&gt;newPage();
00250                 verticalPos = printer-&gt;verticalPos();
00251                 boundingRect = p-&gt;boundingRect(
00252                     leftMargin,
00253                     verticalPos,
00254                     pageWidth - 2*BORDER_SPACE - 2*frameThickness,
00255                     pageHeight- 2*BORDER_SPACE - 2*frameThickness - verticalPos + upperMargin,
00256                     arguments, text
00257                 );
00258             }
00259             br = boundingRect;  <font class="comment">//rectangle for the background fill     </font>
00260             br.setLeft(leftMargin);
00261             br.setWidth(pageWidth-frameThickness); <font class="comment">//because we move in the next lines</font>
00262             br.setHeight(br.height()+BORDER_SPACE); <font class="comment">//because we move in the next lines</font>
00263             br.moveBy(frameThickness, frameThickness);          
00264             p-&gt;fillRect(br, bgColor);
00265 
00266             br = boundingRect;  <font class="comment">// the rect for the border      </font>
00271 <font class="comment"></font>            <font class="keyword">const</font> <font class="keywordtype">int</font> halfWidth = (int)((float)frameThickness/2);
00272 
00273 <font class="comment">//          br.setHeight( br.height() + 2*halfWidth  + BORDER_SPACE );                      </font>
00274             br.setLeft( leftMargin + halfWidth );
00275             br.setTop( br.top() + halfWidth ); <font class="comment">//boundingRect is moved by 2*halfWidth down -&gt; use +halfWidth !!</font>
00276             br.setWidth( pageWidth - 2*halfWidth);
00277             br.setHeight( br.height() + 2*halfWidth  + BORDER_SPACE );                      
00278             
00279 <font class="comment">//          boundingRect.setWidth(boundingRect.width()+5);//HACK to avoid cut letters</font>
00280             boundingRect.moveBy(BORDER_SPACE + frameThickness, frameThickness);
00281 <font class="comment">//          arguments |= Qt::AlignVCenter; //WARNING: Right here? Will it change the boundingrect??</font>
00282 
00283             p-&gt;setClipRect(
00284                 upperMargin,
00285                 leftMargin,
00286                 pageWidth,
00287                 pageHeight
00288             );
00289 
00290             p-&gt;drawText(boundingRect, arguments, text);
00291             
00292             p-&gt;setClipping(<font class="keyword">false</font>);
00293             
00294             printer-&gt;setVerticalPos(boundingRect.top() + boundingRect.height() + 2*frameThickness + STYLE_PART_SPACE);
00295             verticalPos = printer-&gt;verticalPos();
00296             
00297             <font class="keywordflow">if</font> (frame) {
00298                 framePen = pen;
00299                 framePen.setWidth( frameThickness );
00300                 framePen.setColor( frame-&gt;color() );
00301                 framePen.setStyle( frame-&gt;lineStyle() );
00302                 p-&gt;setPen( framePen );
00303 
00304                 p-&gt;drawRect( br );
00305             }                       
00306         }
00307         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (type == CStyle::ModuleText) {      
00308             p-&gt;save();
00309             
00310             <font class="keywordflow">if</font> (isUnicode)
00311                 font = CBTConfig::get( CBTConfig::unicode );
00312 
00313             <font class="keywordflow">if</font> (alignment == CStyle::Format::Center)        
00314                 text = QString::fromLatin1(<font class="stringliteral">"&lt;CENTER&gt;%1&lt;/CENTER&gt;"</font>).arg(text);
00315             <font class="keywordflow">else</font> <font class="keywordflow">if</font> (alignment == CStyle::Format::Right)        
00316                 text = QString::fromLatin1(<font class="stringliteral">"&lt;P ALIGN=\"RIGHT\"&gt;%1&lt;/P&gt;"</font>).arg(text);
00317         QSimpleRichText richText(
00318             text,
00319             font,
00320             QString::null,
00321             QStyleSheet::defaultSheet(),
00322             QMimeSourceFactory::defaultFactory(),
00323                 pageHeight + upperMargin - verticalPos - 2*frameThickness - 2*BORDER_SPACE
00324             );
00325 
00326         richText.setWidth( p, pageWidth-2*frameThickness-2*BORDER_SPACE );
00327         view = QRect( <font class="comment">//the content area of the whole page</font>
00328             leftMargin + frameThickness  + BORDER_SPACE,
00329             upperMargin + frameThickness + BORDER_SPACE,
00330             pageWidth - 2*frameThickness - 2*BORDER_SPACE,
00331             pageHeight - 2*frameThickness - 2*BORDER_SPACE
00332         );
00333         
00334         <font class="keywordtype">int</font> translated = 0;
00335         <font class="keywordflow">do</font> {
00336             <font class="keywordflow">if</font> ((int)(verticalPos - upperMargin + richText.height() - translated) &lt;= (int)(pageHeight) ) {
00337                 <font class="comment">//text fits on current page</font>
00338                     br = QRect (
00339                     leftMargin + frameThickness,
00340                     verticalPos + frameThickness,
00341                     pageWidth - frameThickness,
00342                     richText.height() - translated + frameThickness + BORDER_SPACE
00343                 );
00344                 }
00345             <font class="keywordflow">else</font> { <font class="comment">//doesn't fit completely on current page, fill to bottom of the page         </font>
00346                 br = QRect(
00347                     leftMargin + frameThickness,
00348                     verticalPos + frameThickness,
00349                     pageWidth - frameThickness,
00350                     pageHeight - verticalPos + upperMargin - frameThickness
00351                 );
00352             }
00353                 br.moveBy(0,translated); <font class="comment">//we have to move down as far as the painter moved         </font>
00354             p-&gt;setClipRect(
00355                 upperMargin,
00356                 leftMargin,
00357                 pageWidth,
00358                 pageHeight
00359             );
00360             p-&gt;fillRect(br,QBrush(bgColor)); <font class="comment">//fill rect with background color</font>
00361                 <font class="keywordflow">if</font> (frame) {
00362                     br.moveBy( (<font class="keywordtype">int</font>)(-(<font class="keywordtype">float</font>)frameThickness/2), (<font class="keywordtype">int</font>)(-(<font class="keywordtype">float</font>)frameThickness/2) );  
00363 
00364                     framePen = pen;
00365                     framePen.setWidth( frameThickness );
00366                     framePen.setColor( frame-&gt;color() );
00367                     framePen.setStyle( frame-&gt;lineStyle() );
00368                     p-&gt;setPen( framePen );
00369 
00370                     p-&gt;drawRect(br);
00371                 }                                   
00372             p-&gt;setClipping(<font class="keyword">false</font>);
00373             
00374         richText.draw(p, leftMargin+frameThickness+BORDER_SPACE, verticalPos+frameThickness+BORDER_SPACE, view, cg);
00375                 movePixs = <font class="comment">//move down the painted area height</font>
00376                         (((int)richText.height()-translated) &gt; (int)(pageHeight - verticalPos + upperMargin ))
00377                     ? (pageHeight - verticalPos + upperMargin) <font class="comment">//move to bottom of page</font>
00378                     : richText.height() - translated + 2*frameThickness + 2*BORDER_SPACE; <font class="comment">//only move the painted area</font>
00379 
00380             printer-&gt;setVerticalPos(verticalPos + movePixs);                    
00381 
00382             view.moveBy( 0,movePixs);
00383         p-&gt;translate( 0,-movePixs);
00384         translated += movePixs;
00385         <font class="keywordflow">if</font> ( view.top() &gt;= richText.height() ) <font class="comment">//bottom or top(default)</font>
00386                 <font class="keywordflow">break</font>;
00387 
00388             printer-&gt;newPage();
00389             verticalPos = printer-&gt;verticalPos();           
00390         } <font class="keywordflow">while</font> (true);
00391             p-&gt;restore();
00392     }
00393     }
00394     printer-&gt;setVerticalPos(printer-&gt;verticalPos() + PARAGRAPH_SPACE);  
00395 }
00396 
<a name="l00398"></a><a class="code" href="class_c_print_item.html#c0">00398</a> <font class="keyword">const</font> QString&amp; <a class="code" href="class_c_print_item.html#c0">CPrintItem::headerText</a>() {
00399     <font class="keywordflow">if</font> (!m_headerText.isEmpty())  <font class="comment">// cached?</font>
00400         <font class="keywordflow">return</font> m_headerText;
00401 
00402   <font class="keywordflow">if</font> (m_startEmpty)
00403     <font class="keywordflow">return</font> QString::null;   
00404     <font class="keywordflow">if</font> (m_stopEmpty)
00405         m_headerText = m_startKey;
00406     <font class="keywordflow">else</font> {<font class="comment">//start and stop key do exist and are different</font>
00407         m_headerText = QString::fromLatin1(<font class="stringliteral">"%1 - %2"</font>).arg(m_startKey).arg(m_stopKey);
00408     }   
00409     <font class="keywordflow">return</font> m_headerText;
00410 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:09 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
