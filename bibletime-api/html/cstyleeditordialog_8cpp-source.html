<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cstyleeditordialog.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cstyleeditordialog.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cstyleeditordialog.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Aug 20 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cstyleeditordialog.h"</font>
00019 
00020 <font class="comment">//KDE includes</font>
00021 <font class="preprocessor">#include &lt;kcombobox.h&gt;</font>
00022 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00023 <font class="preprocessor">#include &lt;kcolorbutton.h&gt;</font>
00024 <font class="preprocessor">#include &lt;kfontdialog.h&gt;</font>
00025 
00026 <font class="comment">//Qt includes</font>
00027 <font class="preprocessor">#include &lt;qlineedit.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00029 <font class="preprocessor">#include &lt;qlabel.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qgroupbox.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qcheckbox.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qwidget.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qbuttongroup.h&gt;</font>
00034 <font class="preprocessor">#include &lt;qvbuttongroup.h&gt;</font>
00035 <font class="preprocessor">#include &lt;qhbuttongroup.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qradiobutton.h&gt;</font>
00037 <font class="preprocessor">#include &lt;qspinbox.h&gt;</font>
00038 
00039 CStyleEditorDialog::CStyleEditorDialog(CStyle* style, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00040     : KDialogBase(parent,name, true, i18n("style editor")) {
00041     m_style = style;
00042     m_formatEnabled =  <font class="keyword">false</font>;
00043     
00044     initView(); 
00045     <a class="code" href="class_c_search_dialog_text.html#c0">readSettings</a>(); 
00046     styleTypeChanged(<font class="stringliteral">"Header"</font>);
00047 }
00048 
00049 CStyleEditorDialog::~CStyleEditorDialog(){
00050     saveSettings();
00051 }
00052 
00054 <font class="keywordtype">void</font> CStyleEditorDialog::initView(){
00055   enableButtonSeparator( <font class="keyword">true</font> );
00056   QFrame *mainWidget = makeMainWidget();
00057   QLabel* label = 0;
00058 
00059   QVBoxLayout *topLayout = <font class="keyword">new</font> QVBoxLayout( mainWidget, 5, 5 );
00060     
00061     QHBoxLayout *hboxLayout = <font class="keyword">new</font> QHBoxLayout(0, 5, 5);
00062   m_styleNameEdit = <font class="keyword">new</font> QLineEdit( mainWidget );
00063     label = <font class="keyword">new</font> QLabel(m_styleNameEdit, i18n(<font class="stringliteral">"Name of style:"</font>), <font class="keyword">this</font>);
00064     hboxLayout-&gt;addWidget(label);
00065     hboxLayout-&gt;addWidget(m_styleNameEdit); 
00066 
00067   topLayout-&gt;addLayout(hboxLayout);
00068 
00069     hboxLayout = <font class="keyword">new</font> QHBoxLayout(0, 5, 5);  
00070   m_styleTypeChooser = <font class="keyword">new</font> KComboBox( mainWidget, <font class="stringliteral">"styleTypeChooser"</font> );
00071   label = <font class="keyword">new</font> QLabel( m_styleTypeChooser, i18n(<font class="stringliteral">"Choose the part of the style:"</font>), mainWidget );
00072   hboxLayout-&gt;addWidget(label);
00073   m_styleTypeChooser-&gt;insertItem( i18n(<font class="stringliteral">"Header"</font>) );
00074   m_styleTypeChooser-&gt;insertItem( i18n(<font class="stringliteral">"Description"</font>) );
00075   m_styleTypeChooser-&gt;insertItem( i18n(<font class="stringliteral">"Module text"</font>) );
00076   connect(m_styleTypeChooser, SIGNAL(activated(<font class="keyword">const</font> QString&amp;)), SLOT(styleTypeChanged(<font class="keyword">const</font> QString&amp;)));
00077   m_currentFormat = m_style-&gt;formatForType( CStyle::Header );
00078   hboxLayout-&gt;addWidget( m_styleTypeChooser );
00079 
00080   m_setEnabledBox = <font class="keyword">new</font> QCheckBox( mainWidget );
00081   m_setEnabledBox-&gt;setText( i18n(<font class="stringliteral">"Enable this part"</font>));
00082   connect( m_setEnabledBox, SIGNAL(clicked()), SLOT(enableBoxClicked()));
00083   hboxLayout-&gt;addWidget( m_setEnabledBox );
00084 
00085   topLayout-&gt;addLayout( hboxLayout );
00086 
00087 
00088     hboxLayout = <font class="keyword">new</font> QHBoxLayout(0, 5, 5);
00089     topLayout-&gt;addLayout(hboxLayout);
00090 
00091   m_alignRadios.buttongroup = <font class="keyword">new</font> QVButtonGroup( mainWidget );
00092     m_alignRadios.leftRB = <font class="keyword">new</font> QRadioButton( i18n(<font class="stringliteral">"Left"</font>), m_alignRadios.buttongroup);
00093     m_alignRadios.centerRB = <font class="keyword">new</font> QRadioButton( i18n(<font class="stringliteral">"Center"</font>), m_alignRadios.buttongroup);
00094     m_alignRadios.rightRB = <font class="keyword">new</font> QRadioButton(i18n(<font class="stringliteral">"Right"</font>),m_alignRadios.buttongroup);
00095     m_alignRadios.buttongroup-&gt;setFixedHeight( m_alignRadios.buttongroup-&gt;sizeHint().height());
00096   hboxLayout-&gt;addWidget( m_alignRadios.buttongroup );
00097 
00098     QButtonGroup* box = <font class="keyword">new</font> QButtonGroup( mainWidget );
00099     QVBoxLayout* boxLayout = <font class="keyword">new</font> QVBoxLayout( box, 5, 5 );
00100     
00101     QHBoxLayout* layout1 = <font class="keyword">new</font> QHBoxLayout(0, 1, 1);
00102     m_colors.foregroundChooser = <font class="keyword">new</font> KColorButton( box );
00103     label = <font class="keyword">new</font> QLabel(m_colors.foregroundChooser, <font class="stringliteral">"label"</font>, box);
00104     label-&gt;setText(i18n(<font class="stringliteral">"Foreground:"</font>));    
00105     layout1-&gt;addWidget(label);
00106   layout1-&gt;addStretch(2);   
00107     layout1-&gt;addWidget(m_colors.foregroundChooser);
00108     
00109   boxLayout-&gt;addLayout(layout1);
00110   boxLayout-&gt;addStretch(3);
00111     
00112     layout1 = <font class="keyword">new</font> QHBoxLayout(0, 1, 1);
00113     m_colors.backgroundChooser = <font class="keyword">new</font> KColorButton(box);
00114     label = <font class="keyword">new</font> QLabel(m_colors.backgroundChooser, <font class="stringliteral">"label"</font>, box);
00115     label-&gt;setText(i18n(<font class="stringliteral">"Background:"</font>));
00116     layout1-&gt;addWidget(label);  
00117   layout1-&gt;addStretch(2);   
00118     layout1-&gt;addWidget(m_colors.backgroundChooser);
00119         
00120   boxLayout-&gt;addLayout(layout1);
00121   boxLayout-&gt;addStretch(3);
00122   hboxLayout-&gt;addWidget(box);
00123 
00124   hboxLayout = <font class="keyword">new</font> QHBoxLayout();
00125     m_font.fontButton = <font class="keyword">new</font> QPushButton(mainWidget);
00126     m_font.fontButton-&gt;setText(i18n(<font class="stringliteral">"Choose font"</font>));
00127     connect(m_font.fontButton, SIGNAL(clicked()), SLOT(showFontChooser())); 
00128   m_font.fontDisplay = <font class="keyword">new</font> QLabel(m_font.fontButton, <font class="stringliteral">""</font>, mainWidget);   
00129   m_font.fontDisplay-&gt;setText(i18n(<font class="stringliteral">"Font preview"</font>));
00130   hboxLayout-&gt;addWidget(m_font.fontDisplay);
00131   hboxLayout-&gt;addWidget(m_font.fontButton);
00132 
00133 <font class="comment">//  m_font.identation = new QSpinBox(mainWidget);</font>
00134 <font class="comment">//  label = new QLabel(m_font.identation, "identation", mainWidget);</font>
00135 <font class="comment">//  label-&gt;setText(i18n("Identation (in mm):"));</font>
00136 <font class="comment">//  hboxLayout-&gt;addStretch(2);</font>
00137 <font class="comment">//  hboxLayout-&gt;addWidget(label);</font>
00138 <font class="comment">//  hboxLayout-&gt;addWidget(m_font.identation);</font>
00139 
00140   topLayout-&gt;addLayout(hboxLayout);
00141 
00142   m_frame.useFrame = <font class="keyword">new</font> QCheckBox(mainWidget);
00143   m_frame.useFrame-&gt;setText( i18n(<font class="stringliteral">"Use frame"</font>) );
00144   topLayout-&gt;addWidget(m_frame.useFrame);
00145   connect(m_frame.useFrame, SIGNAL(clicked()), SLOT(useFrameClicked()));
00146 
00147   m_frame.groupbox = <font class="keyword">new</font> QGroupBox(mainWidget);
00148     boxLayout = <font class="keyword">new</font> QVBoxLayout(m_frame.groupbox);
00149     
00150     hboxLayout = <font class="keyword">new</font> QHBoxLayout();
00151   m_frame.lineThicknessChooser = <font class="keyword">new</font> QSpinBox( m_frame.groupbox );
00152   m_frame.lineThicknessChooser-&gt;setMinValue(1);
00153   label = <font class="keyword">new</font> QLabel(m_frame.lineThicknessChooser, <font class="stringliteral">"label"</font>, m_frame.groupbox);
00154   label-&gt;setText( i18n(<font class="stringliteral">"Line thickness (in point):"</font>) );
00155   hboxLayout-&gt;addWidget(label);
00156     hboxLayout-&gt;addWidget(m_frame.lineThicknessChooser);    
00157     boxLayout-&gt;addLayout(hboxLayout);
00158     
00159     hboxLayout = <font class="keyword">new</font> QHBoxLayout();
00160     m_frame.colorChooser = <font class="keyword">new</font> KColorButton(m_frame.groupbox);
00161     label = <font class="keyword">new</font> QLabel(m_frame.colorChooser, <font class="stringliteral">""</font>, m_frame.groupbox);
00162     label-&gt;setText(i18n(<font class="stringliteral">"Frame color:"</font>));
00163     hboxLayout-&gt;addWidget(label);
00164     hboxLayout-&gt;addWidget(m_frame.colorChooser);
00165     boxLayout-&gt;addLayout(hboxLayout);
00166 
00167     hboxLayout = <font class="keyword">new</font> QHBoxLayout();
00168     m_frame.lineStyleChooser = <font class="keyword">new</font> QComboBox(m_frame.groupbox);
00169     label = <font class="keyword">new</font> QLabel(m_frame.lineStyleChooser, <font class="stringliteral">""</font>, m_frame.groupbox);
00170     label-&gt;setText(i18n(<font class="stringliteral">"Line style:"</font>));
00171     hboxLayout-&gt;addWidget(label);
00172     hboxLayout-&gt;addWidget(m_frame.lineStyleChooser);
00173     boxLayout-&gt;addLayout(hboxLayout);
00174             
00175     topLayout-&gt;addWidget(m_frame.groupbox);
00176     topLayout-&gt;addStretch(3);
00177     
00178     QPainter p;
00179     QPen pen(Qt::black, 2, Qt::SolidLine);
00180     QBrush brush(Qt::white);        
00181     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=1; i &lt;= 5; i++) {  <font class="comment">// from Qt::SolidLine to Qt::DashDotDotLine</font>
00182         QPixmap* pix = <font class="keyword">new</font> QPixmap(<font class="comment">/*m_frame.lineStyleChooser-&gt;width()*/</font>150,15);
00183         pen.setStyle((Qt::PenStyle)i);
00184         p.begin(pix);
00185         p.setPen(pen);
00186         p.fillRect(0,0, pix-&gt;width(), pix-&gt;height(), brush);
00187         p.drawLine(0,(<font class="keywordtype">int</font>)((<font class="keywordtype">float</font>)pix-&gt;height()/2),pix-&gt;width(),(int)((float)pix-&gt;height()/2));
00188         p.end();
00189         m_frame.lineStyleChooser-&gt;insertItem(*pix); 
00190     }
00191     
00192     m_currentFormat = m_style-&gt;formatForType( CStyle::Header ); 
00193     setupWithFormat( m_currentFormat );
00194     enableBoxClicked();
00195 }
00196 
00198 <font class="keywordtype">void</font> CStyleEditorDialog::readSettings(){
00199     m_styleNameEdit-&gt;setText( m_style-&gt;styleName() );
00200     <font class="keywordflow">if</font> (m_styleNameEdit-&gt;text() == i18n(<font class="stringliteral">"Standard"</font>))
00201         m_styleNameEdit-&gt;setEnabled(<font class="keyword">false</font>); <font class="comment">//you can't change the name of the standard style</font>
00202 }
00203 
00205 <font class="keywordtype">void</font> CStyleEditorDialog::saveSettings(){
00206     applySettingsToFormat( m_currentFormat );
00207 <font class="comment">//  m_style-&gt;setFormatForType(m_currentFormat.type(), m_currentFormat );</font>
00208   m_style-&gt;setStyleName( m_styleNameEdit-&gt;text() ); 
00209 }
00210 
00212 <font class="keywordtype">void</font> CStyleEditorDialog::showFontChooser(){
00213     <font class="keywordtype">int</font> result = KFontDialog::getFont( m_font.font );
00214     <font class="keywordflow">if</font> ( result == KFontDialog::Accepted ) {
00215         setupFontWidgets( m_font.font );
00216     }
00217 }
00218 
00220 <font class="keywordtype">void</font> CStyleEditorDialog::useFrameClicked(){
00221     m_frame.groupbox-&gt;setEnabled( m_frame.useFrame-&gt;isChecked() );
00222 }
00223 
00225 <font class="keywordtype">void</font> CStyleEditorDialog::setupWithFormat( CStyle::Format* <font class="keyword">const</font> format ){
00226     <font class="keyword">const</font> CStyle::StyleType type = format-&gt;type();
00227     <font class="keywordflow">if</font> (type == CStyle::Unknown)
00228         <font class="keywordflow">return</font>;
00229     m_formatEnabled = m_style-&gt;hasFormatTypeEnabled(type);
00230     
00231   m_styleNameEdit-&gt;setText( m_style-&gt;styleName());  
00232     <font class="comment">//setup alignement</font>
00233     <font class="keywordflow">switch</font>(format-&gt;alignment()) {
00234         <font class="keywordflow">case</font> CStyle::Format::Left:
00235             m_alignRadios.leftRB-&gt;setChecked(<font class="keyword">true</font>);
00236             <font class="keywordflow">break</font>;
00237         <font class="keywordflow">case</font> CStyle::Format::Center:
00238             m_alignRadios.centerRB-&gt;setChecked(<font class="keyword">true</font>);
00239             <font class="keywordflow">break</font>;
00240         <font class="keywordflow">case</font> CStyle::Format::Right:
00241             m_alignRadios.rightRB-&gt;setChecked(<font class="keyword">true</font>);
00242             <font class="keywordflow">break</font>;
00243         <font class="keywordflow">default</font>:
00244             m_alignRadios.leftRB-&gt;setChecked(<font class="keyword">true</font>);
00245             <font class="keywordflow">break</font>;
00246     }
00247     m_alignRadios.buttongroup-&gt;setEnabled(m_formatEnabled); 
00248     m_setEnabledBox-&gt;setChecked(m_formatEnabled);
00249     
00250     <font class="comment">//setup colors</font>
00251     m_colors.backgroundChooser-&gt;setColor( format-&gt;color( CStyle::Format::Background ) );
00252     m_colors.backgroundChooser-&gt;setEnabled(m_formatEnabled);        
00253     
00254     m_colors.foregroundChooser-&gt;setColor( format-&gt;color( CStyle::Format::Foreground ) );
00255     m_colors.foregroundChooser-&gt;setEnabled(m_formatEnabled);
00256         
00257     <font class="comment">//setup fonts</font>
00258     m_font.font = format-&gt;font();
00259     setupFontWidgets( m_font.font );
00260     
00261     <font class="comment">//setup frame part</font>
00262     CStyle::Format::Frame* frame = format-&gt;frame();
00263     m_frame.useFrame-&gt;setChecked(frame);
00264     m_frame.useFrame-&gt;setEnabled(m_formatEnabled);      
00265     useFrameClicked();
00266     
00267     <font class="keywordflow">if</font> (frame) {
00268         m_frame.colorChooser-&gt;setColor( frame-&gt;color() );
00269         m_frame.lineThicknessChooser-&gt;setValue( frame-&gt;thickness() );   
00270         m_frame.lineStyleChooser-&gt;setCurrentItem((<font class="keywordtype">int</font>)(frame-&gt;lineStyle())-1);
00271     }
00272     
00273     m_frame.groupbox-&gt;setEnabled(m_formatEnabled);          
00274 }
00275 
00277 <font class="keywordtype">void</font> CStyleEditorDialog::setupFontWidgets( QFont&amp; font ){
00278     QFont dummy(font);
00279     dummy.setPointSize(12);
00280     m_font.fontDisplay-&gt;setFont( dummy );
00281     m_font.fontDisplay-&gt;setText( QString::fromLatin1(<font class="stringliteral">"%1 - %2"</font>).arg(m_font.font.family()).arg(m_font.font.pointSize()) );
00282     m_font.fontDisplay-&gt;setEnabled(m_formatEnabled);    
00283     m_font.fontButton-&gt;setEnabled(m_formatEnabled);
00284 }
00285 
00287 <font class="keywordtype">void</font> CStyleEditorDialog::styleTypeChanged( <font class="keyword">const</font> QString&amp; name ){
00288     applySettingsToFormat( m_currentFormat );
00289     <font class="keywordflow">if</font> (name == i18n(<font class="stringliteral">"Header"</font>)) {
00290         m_currentFormat = m_style-&gt;formatForType(CStyle::Header );
00291         m_formatEnabled = m_style-&gt;hasFormatTypeEnabled( CStyle::Header );
00292     }
00293     <font class="keywordflow">else</font>    <font class="keywordflow">if</font> (name == i18n(<font class="stringliteral">"Description"</font>)) {
00294         m_currentFormat = m_style-&gt;formatForType( CStyle::Description );
00295         m_formatEnabled = m_style-&gt;hasFormatTypeEnabled( CStyle::Description );
00296     }
00297     <font class="keywordflow">else</font>    <font class="keywordflow">if</font> (name == i18n(<font class="stringliteral">"Module text"</font>)) {
00298         m_currentFormat = m_style-&gt;formatForType(CStyle::ModuleText );  
00299         m_formatEnabled = m_style-&gt;hasFormatTypeEnabled( CStyle::ModuleText );  
00300     }
00301     setupWithFormat( m_currentFormat );
00302 }
00303 
00305 <font class="keywordtype">void</font> CStyleEditorDialog::applySettingsToFormat( CStyle::Format* <font class="keyword">const</font> format ){
00306     m_style-&gt;setStyleName(m_styleNameEdit-&gt;text());
00307     
00308     <font class="comment">//apply alignement settings</font>
00309     <font class="keywordflow">if</font> (m_alignRadios.buttongroup-&gt;selected() == m_alignRadios.leftRB ) {
00310         format-&gt;setAlignment( CStyle::Format::Left);
00311     }
00312     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_alignRadios.buttongroup-&gt;selected() == m_alignRadios.centerRB) {
00313         format-&gt;setAlignment( CStyle::Format::Center );
00314     }
00315     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_alignRadios.buttongroup-&gt;selected() == m_alignRadios.rightRB ) {
00316         format-&gt;setAlignment( CStyle::Format::Right );
00317     }
00318     
00319     <font class="comment">//apply color settings</font>
00320     format-&gt;setColor( CStyle::Format::Background, m_colors.backgroundChooser-&gt;color() );
00321     format-&gt;setColor( CStyle::Format::Foreground, m_colors.foregroundChooser-&gt;color() );
00322     
00323     <font class="comment">//apply font settings</font>
00324     format-&gt;setFont( m_font.font );
00325     
00326     <font class="comment">//apply frame settings</font>
00327     format-&gt;setFrameEnabled( m_frame.useFrame-&gt;isChecked() );   
00328     <font class="keywordflow">if</font> (CStyle::Format::Frame* frame = format-&gt;frame()){
00329         frame-&gt;setColor( m_frame.colorChooser-&gt;color() );   
00330         frame-&gt;setThickness( m_frame.lineThicknessChooser-&gt;value() );
00331         
00332         <font class="comment">//the position in the list equal to the position in Qt::PenStyle+1</font>
00333         frame-&gt;setLineStyle(static_cast&lt;Qt::PenStyle&gt;(m_frame.lineStyleChooser-&gt;currentItem()+1));
00334     }
00335 }
00336 
00338 <font class="keywordtype">void</font> CStyleEditorDialog::enableBoxClicked() {
00339     <font class="keyword">const</font> CStyle::StyleType styleType = m_currentFormat-&gt;type();        
00340     m_style-&gt;setFormatTypeEnabled(styleType, m_setEnabledBox-&gt;isChecked()); 
00341     
00342     applySettingsToFormat(m_style-&gt;formatForType(styleType));
00343     setupWithFormat( m_currentFormat );
00344 }
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:13 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
