<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>qstylesheet.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>qstylesheet.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/****************************************************************************</font>
00002 <font class="comment">** $Id$</font>
00003 <font class="comment">**</font>
00004 <font class="comment">** Implementation of the QStyleSheet class</font>
00005 <font class="comment">**</font>
00006 <font class="comment">** Created : 990101</font>
00007 <font class="comment">**</font>
00008 <font class="comment">** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.</font>
00009 <font class="comment">**</font>
00010 <font class="comment">** This file is part of the kernel module of the Qt GUI Toolkit.</font>
00011 <font class="comment">**</font>
00012 <font class="comment">** This file may be distributed under the terms of the Q Public License</font>
00013 <font class="comment">** as defined by Trolltech AS of Norway and appearing in the file</font>
00014 <font class="comment">** LICENSE.QPL included in the packaging of this file.</font>
00015 <font class="comment">**</font>
00016 <font class="comment">** This file may be distributed and/or modified under the terms of the</font>
00017 <font class="comment">** GNU General Public License version 2 as published by the Free Software</font>
00018 <font class="comment">** Foundation and appearing in the file LICENSE.GPL included in the</font>
00019 <font class="comment">** packaging of this file.</font>
00020 <font class="comment">**</font>
00021 <font class="comment">** Licensees holding valid Qt Enterprise Edition or Qt Professional Edition</font>
00022 <font class="comment">** licenses may use this file in accordance with the Qt Commercial License</font>
00023 <font class="comment">** Agreement provided with the Software.</font>
00024 <font class="comment">**</font>
00025 <font class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</font>
00026 <font class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</font>
00027 <font class="comment">**</font>
00028 <font class="comment">** See http://www.trolltech.com/pricing.html or email sales@trolltech.com for</font>
00029 <font class="comment">**   information about Qt Commercial License Agreements.</font>
00030 <font class="comment">** See http://www.trolltech.com/qpl/ for QPL licensing information.</font>
00031 <font class="comment">** See http://www.trolltech.com/gpl/ for GPL licensing information.</font>
00032 <font class="comment">**</font>
00033 <font class="comment">** Contact info@trolltech.com if any conditions of this licensing are</font>
00034 <font class="comment">** not clear to you.</font>
00035 <font class="comment">**</font>
00036 <font class="comment">**********************************************************************/</font>
00037 
00038 <font class="preprocessor">#include "qstylesheet.h"</font>
00039 
00040 <font class="preprocessor">#ifndef QT_NO_RICHTEXT</font>
00041 <font class="preprocessor"></font>
00042 <font class="preprocessor">#include "qrichtext_p.h"</font>
00043 <font class="preprocessor">#include "qlayout.h"</font>
00044 <font class="preprocessor">#include "qpainter.h"</font>
00045 <font class="preprocessor">#include "qcleanuphandler.h"</font>
00046 
00047 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00048 
00049 <font class="keyword">using</font> <font class="keyword">namespace </font>Qt3;
00050 
00051 <font class="keyword">class </font><a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>::Data
00052 {
00053 <font class="keyword">public</font>:
00054     QStyleSheetItem::DisplayMode disp;
00055     <font class="keywordtype">int</font> fontitalic;
00056     <font class="keywordtype">int</font> fontunderline;
00057     <font class="keywordtype">int</font> fontweight;
00058     <font class="keywordtype">int</font> fontsize;
00059     <font class="keywordtype">int</font> fontsizelog;
00060     <font class="keywordtype">int</font> fontsizestep;
00061     <font class="keywordtype">int</font> lineSpacing;
00062     QString fontfamily;
00063     <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a> *parentstyle;
00064     QString stylename;
00065     <font class="keywordtype">int</font> ncolumns;
00066     QColor col;
00067     <font class="keywordtype">bool</font> anchor;
00068     <font class="keywordtype">int</font> align;
00069     <font class="keywordtype">int</font> margin[5];
00070     QStyleSheetItem::ListStyle list;
00071     QStyleSheetItem::WhiteSpaceMode whitespacemode;
00072     QString contxt;
00073     <font class="keywordtype">bool</font> selfnest;
00074     <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>* sheet;
00075 };
00076 
00123 QStyleSheetItem::QStyleSheetItem( <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>* parent, <font class="keyword">const</font> QString&amp; name )
00124 {
00125     d = <font class="keyword">new</font> Data;
00126     d-&gt;stylename = name.lower();
00127     d-&gt;sheet = parent;
00128     init();
00129     <font class="keywordflow">if</font> (parent)
00130     parent-&gt;insert( <font class="keyword">this</font> );
00131 }
00132 
00137 QStyleSheetItem::QStyleSheetItem( <font class="keyword">const</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a> &amp; other )
00138 {
00139     d = <font class="keyword">new</font> Data;
00140     *d = *other.d;
00141 }
00142 
00143 
00148 QStyleSheetItem::~QStyleSheetItem()
00149 {
00150     <font class="keyword">delete</font> d;
00151 }
00152 
00153 
00154 
00158 <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>* QStyleSheetItem::styleSheet()
00159 {
00160     <font class="keywordflow">return</font> d-&gt;sheet;
00161 }
00162 
00166 <font class="keyword">const</font> <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>* QStyleSheetItem::styleSheet()<font class="keyword"> const</font>
00167 <font class="keyword"></font>{
00168     <font class="keywordflow">return</font> d-&gt;sheet;
00169 }
00170 
00175 <font class="keywordtype">void</font> QStyleSheetItem::init()
00176 {
00177     d-&gt;disp = DisplayInline;
00178 
00179     d-&gt;fontitalic = Undefined;
00180     d-&gt;fontunderline = Undefined;
00181     d-&gt;fontweight = Undefined;
00182     d-&gt;fontsize = Undefined;
00183     d-&gt;fontsizelog = Undefined;
00184     d-&gt;fontsizestep = 0;
00185     d-&gt;ncolumns = Undefined;
00186     d-&gt;col = QColor(); <font class="comment">// !isValid()</font>
00187     d-&gt;anchor = FALSE;
00188     d-&gt;align = Undefined;
00189     d-&gt;margin[0] = Undefined;
00190     d-&gt;margin[1] = Undefined;
00191     d-&gt;margin[2] = Undefined;
00192     d-&gt;margin[3] = Undefined;
00193     d-&gt;margin[4] = Undefined;
00194     d-&gt;list = QStyleSheetItem::ListDisc;
00195     d-&gt;whitespacemode = QStyleSheetItem::WhiteSpaceNormal;
00196     d-&gt;selfnest = TRUE;
00197     d-&gt;lineSpacing = Undefined;
00198 }
00199 
00203 QString QStyleSheetItem::name()<font class="keyword"> const</font>
00204 <font class="keyword"></font>{
00205     <font class="keywordflow">return</font> d-&gt;stylename;
00206 }
00207 
00213 QStyleSheetItem::DisplayMode QStyleSheetItem::displayMode()<font class="keyword"> const</font>
00214 <font class="keyword"></font>{
00215     <font class="keywordflow">return</font> d-&gt;disp;
00216 }
00217 
00239 <font class="keywordtype">void</font> QStyleSheetItem::setDisplayMode(DisplayMode m)
00240 {
00241     d-&gt;disp=m;
00242 }
00243 
00244 
00251 <font class="keywordtype">int</font> QStyleSheetItem::alignment()<font class="keyword"> const</font>
00252 <font class="keyword"></font>{
00253     <font class="keywordflow">return</font> d-&gt;align;
00254 }
00255 
00264 <font class="keywordtype">void</font> QStyleSheetItem::setAlignment( <font class="keywordtype">int</font> f )
00265 {
00266     d-&gt;align = f;
00267 }
00268 
00269 
00275 <font class="keywordtype">bool</font> QStyleSheetItem::fontItalic()<font class="keyword"> const</font>
00276 <font class="keyword"></font>{
00277     <font class="keywordflow">return</font> d-&gt;fontitalic &gt; 0;
00278 }
00279 
00285 <font class="keywordtype">void</font> QStyleSheetItem::setFontItalic(<font class="keywordtype">bool</font> italic)
00286 {
00287     d-&gt;fontitalic = italic?1:0;
00288 }
00289 
00296 <font class="keywordtype">bool</font> QStyleSheetItem::definesFontItalic()<font class="keyword"> const</font>
00297 <font class="keyword"></font>{
00298     <font class="keywordflow">return</font> d-&gt;fontitalic != Undefined;
00299 }
00300 
00306 <font class="keywordtype">bool</font> QStyleSheetItem::fontUnderline()<font class="keyword"> const</font>
00307 <font class="keyword"></font>{
00308     <font class="keywordflow">return</font> d-&gt;fontunderline &gt; 0;
00309 }
00310 
00316 <font class="keywordtype">void</font> QStyleSheetItem::setFontUnderline(<font class="keywordtype">bool</font> underline)
00317 {
00318     d-&gt;fontunderline = underline?1:0;
00319 }
00320 
00327 <font class="keywordtype">bool</font> QStyleSheetItem::definesFontUnderline()<font class="keyword"> const</font>
00328 <font class="keyword"></font>{
00329     <font class="keywordflow">return</font> d-&gt;fontunderline != Undefined;
00330 }
00331 
00332 
00339 <font class="keywordtype">int</font> QStyleSheetItem::fontWeight()<font class="keyword"> const</font>
00340 <font class="keyword"></font>{
00341     <font class="keywordflow">return</font> d-&gt;fontweight;
00342 }
00343 
00350 <font class="keywordtype">void</font> QStyleSheetItem::setFontWeight(<font class="keywordtype">int</font> w)
00351 {
00352     d-&gt;fontweight = w;
00353 }
00354 
00361 <font class="keywordtype">int</font> QStyleSheetItem::logicalFontSize()<font class="keyword"> const</font>
00362 <font class="keyword"></font>{
00363     <font class="keywordflow">return</font> d-&gt;fontsizelog;
00364 }
00365 
00366 
00373 <font class="keywordtype">void</font> QStyleSheetItem::setLogicalFontSize(<font class="keywordtype">int</font> s)
00374 {
00375     d-&gt;fontsizelog = s;
00376 }
00377 
00386 <font class="keywordtype">int</font> QStyleSheetItem::logicalFontSizeStep()<font class="keyword"> const</font>
00387 <font class="keyword"></font>{
00388     <font class="keywordflow">return</font> d-&gt;fontsizestep;
00389 }
00390 
00396 <font class="keywordtype">void</font> QStyleSheetItem::setLogicalFontSizeStep( <font class="keywordtype">int</font> s )
00397 {
00398     d-&gt;fontsizestep = s;
00399 }
00400 
00401 
00402 
00408 <font class="keywordtype">void</font> QStyleSheetItem::setFontSize(<font class="keywordtype">int</font> s)
00409 {
00410     d-&gt;fontsize = s;
00411 }
00412 
00419 <font class="keywordtype">int</font> QStyleSheetItem::fontSize()<font class="keyword"> const</font>
00420 <font class="keyword"></font>{
00421     <font class="keywordflow">return</font> d-&gt;fontsize;
00422 }
00423 
00424 
00431 QString QStyleSheetItem::fontFamily()<font class="keyword"> const</font>
00432 <font class="keyword"></font>{
00433     <font class="keywordflow">return</font> d-&gt;fontfamily;
00434 }
00435 
00441 <font class="keywordtype">void</font> QStyleSheetItem::setFontFamily( <font class="keyword">const</font> QString&amp; fam)
00442 {
00443     d-&gt;fontfamily = fam;
00444 }
00445 
00446 
00453 <font class="keywordtype">int</font> QStyleSheetItem::numberOfColumns()<font class="keyword"> const</font>
00454 <font class="keyword"></font>{
00455     <font class="keywordflow">return</font> d-&gt;ncolumns;
00456 }
00457 
00458 
00468 <font class="keywordtype">void</font> QStyleSheetItem::setNumberOfColumns(<font class="keywordtype">int</font> ncols)
00469 {
00470     <font class="keywordflow">if</font> (ncols &gt; 0)
00471     d-&gt;ncolumns = ncols;
00472 }
00473 
00474 
00481 QColor QStyleSheetItem::color()<font class="keyword"> const</font>
00482 <font class="keyword"></font>{
00483     <font class="keywordflow">return</font> d-&gt;col;
00484 }
00485 
00491 <font class="keywordtype">void</font> QStyleSheetItem::setColor( <font class="keyword">const</font> QColor &amp;c)
00492 {
00493     d-&gt;col = c;
00494 }
00495 
00501 <font class="keywordtype">bool</font> QStyleSheetItem::isAnchor()<font class="keyword"> const</font>
00502 <font class="keyword"></font>{
00503     <font class="keywordflow">return</font> d-&gt;anchor;
00504 }
00505 
00512 <font class="keywordtype">void</font> QStyleSheetItem::setAnchor(<font class="keywordtype">bool</font> anc)
00513 {
00514     d-&gt;anchor = anc;
00515 }
00516 
00517 
00523 QStyleSheetItem::WhiteSpaceMode QStyleSheetItem::whiteSpaceMode()<font class="keyword"> const</font>
00524 <font class="keyword"></font>{
00525     <font class="keywordflow">return</font> d-&gt;whitespacemode;
00526 }
00527 
00543 <font class="keywordtype">void</font> QStyleSheetItem::setWhiteSpaceMode(WhiteSpaceMode m)
00544 {
00545     d-&gt;whitespacemode = m;
00546 }
00547 
00548 
00558 <font class="keywordtype">int</font> QStyleSheetItem::margin(Margin m)<font class="keyword"> const</font>
00559 <font class="keyword"></font>{
00560     <font class="keywordflow">return</font> d-&gt;margin[m];
00561 }
00562 
00563 
00573 <font class="keywordtype">void</font> QStyleSheetItem::setMargin(Margin m, <font class="keywordtype">int</font> v)
00574 {
00575     <font class="keywordflow">if</font> (m == MarginAll ) {
00576     d-&gt;margin[0] = v;
00577     d-&gt;margin[1] = v;
00578     d-&gt;margin[2] = v;
00579     d-&gt;margin[3] = v;
00580     d-&gt;margin[4] = v;
00581     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m == MarginVertical ) {
00582     d-&gt;margin[MarginTop] = v;
00583     d-&gt;margin[MarginBottom] = v;
00584     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m == MarginHorizontal ) {
00585     d-&gt;margin[MarginLeft] = v;
00586     d-&gt;margin[MarginRight] = v;
00587     } <font class="keywordflow">else</font> {
00588     d-&gt;margin[m] = v;
00589     }
00590 }
00591 
00592 
00598 QStyleSheetItem::ListStyle QStyleSheetItem::listStyle()<font class="keyword"> const</font>
00599 <font class="keyword"></font>{
00600     <font class="keywordflow">return</font> d-&gt;list;
00601 }
00602 
00623 <font class="keywordtype">void</font> QStyleSheetItem::setListStyle(ListStyle s)
00624 {
00625     d-&gt;list=s;
00626 }
00627 
00628 
00636 QString QStyleSheetItem::contexts()<font class="keyword"> const</font>
00637 <font class="keyword"></font>{
00638     <font class="keywordflow">return</font> d-&gt;contxt;
00639 }
00640 
00648 <font class="keywordtype">void</font> QStyleSheetItem::setContexts( <font class="keyword">const</font> QString&amp; c)
00649 {
00650     d-&gt;contxt = QChar(<font class="charliteral">' '</font>) + c + QChar(<font class="charliteral">' '</font>);
00651 }
00652 
00659 <font class="keywordtype">bool</font> QStyleSheetItem::allowedInContext( <font class="keyword">const</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>* s)<font class="keyword"> const</font>
00660 <font class="keyword"></font>{
00661     <font class="keywordflow">if</font> ( d-&gt;contxt.isEmpty() )
00662     <font class="keywordflow">return</font> TRUE;
00663     <font class="keywordflow">return</font> d-&gt;contxt.find( QChar(<font class="charliteral">' '</font>)+s-&gt;name()+QChar(<font class="charliteral">' '</font>)) != -1;
00664 }
00665 
00666 
00672 <font class="keywordtype">bool</font> QStyleSheetItem::selfNesting()<font class="keyword"> const</font>
00673 <font class="keyword"></font>{
00674     <font class="keywordflow">return</font> d-&gt;selfnest;
00675 }
00676 
00686 <font class="keywordtype">void</font> QStyleSheetItem::setSelfNesting( <font class="keywordtype">bool</font> nesting )
00687 {
00688     d-&gt;selfnest = nesting;
00689 }
00690 
00693 <font class="keywordtype">void</font> QStyleSheetItem::setLineSpacing( <font class="keywordtype">int</font> ls )
00694 {
00695     d-&gt;lineSpacing = ls;
00696 }
00697 
00700 <font class="keywordtype">int</font> QStyleSheetItem::lineSpacing()<font class="keyword"> const</font>
00701 <font class="keyword"></font>{
00702     <font class="keywordflow">return</font> d-&gt;lineSpacing;
00703 }
00704 
00705 <font class="comment">//************************************************************************</font>
00706 
00707 
00708 
00709 
00710 <font class="comment">//************************************************************************</font>
00711 
00712 
00922 QStyleSheet::QStyleSheet( QObject *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00923     : QObject( parent, name )
00924 {
00925     init();
00926 }
00927 
00932 QStyleSheet::~QStyleSheet()
00933 {
00934 }
00935 
00940 <font class="keywordtype">void</font> QStyleSheet::init()
00941 {
00942     styles.setAutoDelete( TRUE );
00943 
00944     nullstyle  = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>,
00945     QString::fromLatin1(<font class="stringliteral">""</font>) );
00946 
00947     <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>*  style;
00948 
00949     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, <font class="stringliteral">"qml"</font> ); <font class="comment">// compatibility</font>
00950     style-&gt;setDisplayMode( QStyleSheetItem::DisplayBlock );
00951 
00952     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"qt"</font>) );
00953     style-&gt;setDisplayMode( QStyleSheetItem::DisplayBlock );
00954     <font class="comment">//style-&gt;setMargin( QStyleSheetItem::MarginAll, 4 );</font>
00955 
00956     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"a"</font>) );
00957     style-&gt;setAnchor( TRUE );
00958 
00959     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"em"</font>) );
00960     style-&gt;setFontItalic( TRUE );
00961 
00962     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"i"</font>) );
00963     style-&gt;setFontItalic( TRUE );
00964 
00965     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"big"</font>) );
00966     style-&gt;setLogicalFontSizeStep( 1 );
00967     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"large"</font>) ); <font class="comment">// compatibility</font>
00968     style-&gt;setLogicalFontSizeStep( 1 );
00969 
00970     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"small"</font>) );
00971     style-&gt;setLogicalFontSizeStep( -1 );
00972 
00973     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"strong"</font>) );
00974     style-&gt;setFontWeight( QFont::Bold);
00975 
00976     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"b"</font>) );
00977     style-&gt;setFontWeight( QFont::Bold);
00978 
00979     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"h1"</font>) );
00980     style-&gt;setFontWeight( QFont::Bold);
00981     style-&gt;setLogicalFontSize(6);
00982     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
00983     style-&gt; setMargin(QStyleSheetItem::MarginTop, 12);
00984     style-&gt; setMargin(QStyleSheetItem::MarginBottom, 6);
00985 
00986     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"h2"</font>) );
00987     style-&gt;setFontWeight( QFont::Bold);
00988     style-&gt;setLogicalFontSize(5);
00989     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
00990     style-&gt; setMargin(QStyleSheetItem::MarginTop, 10);
00991     style-&gt; setMargin(QStyleSheetItem::MarginBottom, 5);
00992 
00993     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"h3"</font>) );
00994     style-&gt;setFontWeight( QFont::Bold);
00995     style-&gt;setLogicalFontSize(4);
00996     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
00997     style-&gt; setMargin(QStyleSheetItem::MarginTop, 8);
00998     style-&gt; setMargin(QStyleSheetItem::MarginBottom, 4);
00999 
01000     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"p"</font>) );
01001     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01002     style-&gt; setMargin(QStyleSheetItem::MarginVertical, 4);
01003     style-&gt;setSelfNesting( FALSE );
01004 
01005     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"center"</font>) );
01006     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01007     style-&gt;setAlignment( AlignCenter );
01008 
01009     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"twocolumn"</font>) );
01010     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01011     style-&gt;setNumberOfColumns( 2 );
01012 
01013     style =  <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"multicol"</font>) );
01014     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01015     (void) <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"font"</font>) );
01016 
01017     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"ul"</font>) );
01018     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01019     style-&gt; setMargin(QStyleSheetItem::MarginVertical, 4);
01020 
01021     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"ol"</font>) );
01022     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01023     style-&gt;setListStyle( QStyleSheetItem::ListDecimal );
01024     style-&gt; setMargin(QStyleSheetItem::MarginVertical, 4);
01025 
01026     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"li"</font>) );
01027     style-&gt;setDisplayMode(QStyleSheetItem::DisplayListItem);
01028     style-&gt;setSelfNesting( FALSE );
01029     style-&gt;setContexts(QString::fromLatin1(<font class="stringliteral">"ol ul"</font>));
01030     style-&gt; setMargin(QStyleSheetItem::MarginVertical, 4);
01031 
01032     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"code"</font>) );
01033     style-&gt;setFontFamily( QString::fromLatin1(<font class="stringliteral">"courier"</font>) );
01034 
01035     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"tt"</font>) );
01036     style-&gt;setFontFamily( QString::fromLatin1(<font class="stringliteral">"courier"</font>) );
01037 
01038     <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>(<font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"img"</font>));
01039     <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>(<font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"br"</font>));
01040     <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>(<font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"hr"</font>));
01041 
01042     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"pre"</font>) );
01043     style-&gt;setFontFamily( QString::fromLatin1(<font class="stringliteral">"courier"</font>) );
01044     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01045     style-&gt;setWhiteSpaceMode(QStyleSheetItem::WhiteSpacePre);
01046     style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"blockquote"</font>) );
01047     style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01048     style-&gt;setMargin(QStyleSheetItem::MarginHorizontal, 40 );
01049 
01050      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"head"</font>) );
01051      style-&gt;setDisplayMode(QStyleSheetItem::DisplayNone);
01052      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"div"</font>) );
01053      style-&gt;setDisplayMode(QStyleSheetItem::DisplayInline ); <font class="comment">// #### set this to DisplayBlock after the parser in the new engine has been fixed for div</font>
01054      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"dl"</font>) );
01055      style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01056      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"dt"</font>) );
01057      style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01058      style-&gt;setContexts(QString::fromLatin1(<font class="stringliteral">"dl"</font>) );
01059      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"dd"</font>) );
01060      style-&gt;setDisplayMode(QStyleSheetItem::DisplayBlock);
01061      style-&gt;setMargin(QStyleSheetItem::MarginLeft, 30);
01062      style-&gt;setContexts(QString::fromLatin1(<font class="stringliteral">"dt dl"</font>) );
01063      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"u"</font>) );
01064      style-&gt;setFontUnderline( TRUE);
01065      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"nobr"</font>) );
01066      style-&gt;setWhiteSpaceMode( QStyleSheetItem::WhiteSpaceNoWrap );
01067 
01068      <font class="comment">// tables</font>
01069      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"table"</font>) );
01070      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"tr"</font>) );
01071      style-&gt;setContexts(QString::fromLatin1(<font class="stringliteral">"table"</font>));
01072      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"td"</font>) );
01073      style-&gt;setContexts(QString::fromLatin1(<font class="stringliteral">"tr"</font>));
01074      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"th"</font>) );
01075      style-&gt;setFontWeight( QFont::Bold );
01076      style-&gt;setAlignment( Qt::AlignCenter );
01077      style-&gt;setContexts(QString::fromLatin1(<font class="stringliteral">"tr"</font>));
01078 
01079      style = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>( <font class="keyword">this</font>, QString::fromLatin1(<font class="stringliteral">"html"</font>) );
01080 }
01081 
01082 
01083 
01084 <font class="keyword">static</font> <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>* defaultsheet = 0;
01085 <font class="keyword">static</font> QCleanupHandler&lt;QStyleSheet&gt; qt_cleanup_stylesheet;
01086 
01097 <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>* QStyleSheet::defaultSheet()
01098 {
01099     <font class="keywordflow">if</font> (!defaultsheet) {
01100     defaultsheet = <font class="keyword">new</font> <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>();
01101     qt_cleanup_stylesheet.add( defaultsheet );
01102     }
01103     <font class="keywordflow">return</font> defaultsheet;
01104 }
01105 
01112 <font class="keywordtype">void</font> QStyleSheet::setDefaultSheet( <a class="code" href="class_q_style_sheet.html">QStyleSheet</a>* sheet)
01113 {
01114     <font class="keywordflow">if</font> ( defaultsheet != sheet ) {
01115     <font class="keywordflow">if</font> ( defaultsheet )
01116         qt_cleanup_stylesheet.remove( defaultsheet );
01117     <font class="keyword">delete</font> defaultsheet;
01118     <font class="keywordflow">if</font> ( sheet )
01119         qt_cleanup_stylesheet.add( sheet );
01120     }
01121     defaultsheet = sheet;
01122 }
01123 
01129 <font class="keywordtype">void</font> QStyleSheet::insert( <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>* style )
01130 {
01131     styles.insert(style-&gt;name(), style);
01132 }
01133 
01134 
01138 <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>* QStyleSheet::item( <font class="keyword">const</font> QString&amp; name)
01139 {
01140     <font class="keywordflow">if</font> ( name.isNull() )
01141     <font class="keywordflow">return</font> 0;
01142     <font class="keywordflow">return</font> styles[name];
01143 }
01144 
01148 <font class="keyword">const</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>* QStyleSheet::item( <font class="keyword">const</font> QString&amp; name)<font class="keyword"> const</font>
01149 <font class="keyword"></font>{
01150     <font class="keywordflow">if</font> ( name.isNull() )
01151     <font class="keywordflow">return</font> 0;
01152     <font class="keywordflow">return</font> styles[name];
01153 }
01154 
01155 
01163 QTextCustomItem* QStyleSheet::tag(  <font class="keyword">const</font> QString&amp; name,
01164                    <font class="keyword">const</font> QMap&lt;QString, QString&gt; &amp;attr,
01165                    <font class="keyword">const</font> QString&amp; context,
01166                    <font class="keyword">const</font> QMimeSourceFactory&amp; factory,
01167                    <font class="keywordtype">bool</font> <font class="comment">/*emptyTag */</font>, QTextDocument *doc )<font class="keyword"> const</font>
01168 <font class="keyword"></font>{
01169     <font class="keyword">static</font> QString s_img = QString::fromLatin1(<font class="stringliteral">"img"</font>);
01170     <font class="keyword">static</font> QString s_hr = QString::fromLatin1(<font class="stringliteral">"hr"</font>);
01171 
01172     <font class="keyword">const</font> <a class="code" href="class_q_style_sheet_item.html">QStyleSheetItem</a>* style = item( name );
01173     <font class="comment">// first some known  tags</font>
01174     <font class="keywordflow">if</font> ( !style )
01175     <font class="keywordflow">return</font> 0;
01176     <font class="keywordflow">if</font> ( style-&gt;name() == s_img )
01177     <font class="keywordflow">return</font> <font class="keyword">new</font> QTextImage( doc, attr, context, (QMimeSourceFactory&amp;)factory);
01178     <font class="keywordflow">if</font> ( style-&gt;name() == s_hr )
01179     <font class="keywordflow">return</font> <font class="keyword">new</font> QTextHorizontalLine( doc );
01180    <font class="keywordflow">return</font> 0;
01181 }
01182 
01183 
01188 QString QStyleSheet::convertFromPlainText( <font class="keyword">const</font> QString&amp; plain)
01189 {
01190     <font class="keywordtype">int</font> col = 0;
01191     QString rich;
01192     rich += <font class="stringliteral">"&lt;p&gt;"</font>;
01193     <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; int(plain.length()); ++i ) {
01194     <font class="keywordflow">if</font> ( plain[i] == <font class="charliteral">'\n'</font> ){
01195         <font class="keywordflow">if</font> ( col == 1 )
01196         rich += <font class="stringliteral">"&lt;p&gt;&lt;/p&gt;"</font>;
01197         <font class="keywordflow">else</font>
01198         rich += <font class="stringliteral">"&lt;br&gt;"</font>;
01199         col = 0;
01200     }
01201     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( plain[i] == <font class="charliteral">'\t'</font> ){
01202         rich += 0x00a0U;
01203         <font class="comment">// while ( col / 4.0 != int( col/4 ) ) { // weird</font>
01204         <font class="keywordflow">while</font> ( col % 4 ) {
01205         rich += 0x00a0U;
01206         ++col;
01207         }
01208     }
01209     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( plain[i].isSpace() )
01210         rich += 0x00a0U;
01211     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( plain[i] == <font class="charliteral">'&lt;'</font> )
01212         rich +=<font class="stringliteral">"&amp;lt;"</font>;
01213     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( plain[i] == <font class="charliteral">'&gt;'</font> )
01214         rich +=<font class="stringliteral">"&amp;gt;"</font>;
01215     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( plain[i] == <font class="charliteral">'&amp;'</font> )
01216         rich +=<font class="stringliteral">"&amp;amp;"</font>;
01217     <font class="keywordflow">else</font>
01218         rich += plain[i];
01219     ++col;
01220     }
01221     rich += <font class="stringliteral">"&lt;/p&gt;"</font>;
01222     <font class="keywordflow">return</font> rich;
01223 }
01224 
01225 <font class="comment">// Must doc this enum somewhere, and it is logically related to QStyleSheet</font>
01226 
01255 <font class="keywordtype">bool</font> QStyleSheet::mightBeRichText( <font class="keyword">const</font> QString&amp; text)
01256 {
01257     <font class="keywordflow">if</font> ( text.isEmpty() )
01258     <font class="keywordflow">return</font> FALSE;
01259     <font class="keywordflow">if</font> ( text.left(5).lower() == <font class="stringliteral">"&lt;!doc"</font> )
01260     <font class="keywordflow">return</font> TRUE;
01261     <font class="keywordtype">int</font> open = 0;
01262     <font class="keywordflow">while</font> ( open &lt; int(text.length()) &amp;&amp; text[open] != <font class="charliteral">'&lt;'</font>
01263         &amp;&amp; text[open] != <font class="charliteral">'\n'</font> &amp;&amp; text[open] != <font class="charliteral">'&amp;'</font>)
01264     ++open;
01265     <font class="keywordflow">if</font> ( text[open] == <font class="charliteral">'&amp;'</font> ) {
01266     <font class="keywordflow">if</font> ( text.mid(open+1,3) == <font class="stringliteral">"lt;"</font> )
01267         <font class="keywordflow">return</font> TRUE; <font class="comment">// support desperate attempt of user to see &lt;...&gt;</font>
01268     } <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( text[open] == <font class="charliteral">'&lt;'</font> ) {
01269     <font class="keywordtype">int</font> close = text.find(<font class="charliteral">'&gt;'</font>, open);
01270     <font class="keywordflow">if</font> ( close &gt; -1 ) {
01271         QString tag;
01272         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = open+1; i &lt; close; ++i) {
01273         <font class="keywordflow">if</font> ( text[i].isDigit() || text[i].isLetter() )
01274             tag += text[i];
01275         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( !tag.isEmpty() &amp;&amp; text[i].isSpace() )
01276             <font class="keywordflow">break</font>;
01277         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( !text[i].isSpace() &amp;&amp; (!tag.isEmpty() || text[i] != <font class="charliteral">'!'</font> ) )
01278             <font class="keywordflow">return</font> FALSE; <font class="comment">// that's not a tag</font>
01279         }
01280         <font class="keywordflow">return</font> defaultSheet()-&gt;item( tag.lower() ) != 0;
01281     }
01282     }
01283     <font class="keywordflow">return</font> FALSE;
01284 }
01285 
01286 
01299 <font class="keywordtype">void</font> QStyleSheet::error( <font class="keyword">const</font> QString&amp; )<font class="keyword"> const</font>
01300 <font class="keyword"></font>{
01301 }
01302 
01303 
01316 <font class="keywordtype">void</font> QStyleSheet::scaleFont( QFont&amp; font, <font class="keywordtype">int</font> logicalSize )<font class="keyword"> const</font>
01317 <font class="keyword"></font>{
01318     <font class="keywordflow">if</font> ( logicalSize &lt; 1 )
01319     logicalSize = 1;
01320     <font class="keywordflow">if</font> ( logicalSize &gt; 7 )
01321     logicalSize = 7;
01322     <font class="keywordtype">int</font> basePointSize = font.pointSize();
01323     <font class="keywordtype">int</font> s;
01324     <font class="keywordflow">switch</font> ( logicalSize ) {
01325     <font class="keywordflow">case</font> 1:
01326     s =  basePointSize/2;
01327     <font class="keywordflow">break</font>;
01328     <font class="keywordflow">case</font> 2:
01329     s = (8 * basePointSize) / 10;
01330     <font class="keywordflow">break</font>;
01331     <font class="keywordflow">case</font> 4:
01332     s =  (12 * basePointSize) / 10;
01333     <font class="keywordflow">break</font>;
01334     <font class="keywordflow">case</font> 5:
01335     s = (15 * basePointSize) / 10;
01336     <font class="keywordflow">break</font>;
01337     <font class="keywordflow">case</font> 6:
01338     s = 2 * basePointSize;
01339     <font class="keywordflow">break</font>;
01340     <font class="keywordflow">case</font> 7:
01341     s = (24 * basePointSize) / 10;
01342     <font class="keywordflow">break</font>;
01343     <font class="keywordflow">default</font>:
01344     s = basePointSize;
01345     }
01346     font.setPointSize( s );
01347 }
01348 
01349 <font class="preprocessor">#endif // QT_NO_RICHTEXT</font>
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:49 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
