<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cbooktreechooser.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cbooktreechooser.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cbooktreechooser.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sat Jan 26 2002</font>
00005 <font class="comment">    copyright            : (C) 2002 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cbooktreechooser.h"</font>
00019 <font class="preprocessor">#include "../../backend/cswordtreekey.h"</font>
00020 <font class="preprocessor">#include "../../backend/cswordbookmoduleinfo.h"</font>
00021 
00022 <font class="comment">//Qt includes</font>
00023 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00024 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qlistview.h&gt;</font>
00026 
00028 
00029 CBookTreeChooser::TreeItem::TreeItem(QListViewItem* parent, QListViewItem* after, <font class="keyword">const</font> QString caption, <font class="keyword">const</font> QString key)
00030     : KListViewItem(parent, after, caption) {   
00031     m_key = <a class="code" href="class_c_display_window.html#a16">key</a>;
00032 };
00033 
00034 CBookTreeChooser::TreeItem::TreeItem(QListViewItem* parent,<font class="keyword">const</font> QString caption, <font class="keyword">const</font> QString key)
00035     : KListViewItem(parent, caption) {  
00036     m_key = <a class="code" href="class_c_display_window.html#a16">key</a>;
00037 };
00038 
00039 CBookTreeChooser::TreeItem::TreeItem(QListView* view, QListViewItem* after, <font class="keyword">const</font> QString caption, <font class="keyword">const</font> QString key)
00040     : KListViewItem(view,after, caption) {  
00041     m_key = <a class="code" href="class_c_display_window.html#a16">key</a>;
00042 };
00043 
00044 <font class="keyword">const</font> QString&amp; <a class="code" href="class_c_book_tree_chooser.html#a4">CBookTreeChooser::TreeItem::key</a>()<font class="keyword"> const </font>{
00045     <font class="keywordflow">return</font> m_key;
00046 };  
00047 
00049 
00050 CBookTreeChooser::CBookTreeChooser(<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a> *module, <a class="code" href="class_c_sword_key.html">CSwordKey</a> *key, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00051     : <a class="code" href="class_c_key_chooser.html">CKeyChooser</a>(module, key, parent,name) {
00052     <font class="keywordflow">if</font> ( module &amp;&amp; (module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::GenericBook) ) {
00053         m_module = dynamic_cast&lt;CSwordBookModuleInfo*&gt;(module);     
00054         m_key = dynamic_cast&lt;CSwordTreeKey*&gt;(key);
00055     }
00056     <font class="keywordflow">else</font> {
00057         m_module = 0;
00058         m_key = 0;
00059     }       
00060 
00061     <font class="comment">//now setup the keychooser widgets</font>
00062     QHBoxLayout* layout = <font class="keyword">new</font> QHBoxLayout(<font class="keyword">this</font>);
00063     m_treeView = <font class="keyword">new</font> KListView(<font class="keyword">this</font>);
00064     layout-&gt;addWidget(m_treeView);
00065     
00066     connect( m_treeView, SIGNAL(executed(QListViewItem*)), SLOT(itemClicked(QListViewItem*)));
00067     m_treeView-&gt;addColumn(<font class="stringliteral">"Tree"</font>);  
00068     m_treeView-&gt;header()-&gt;resizeSection( 0,m_treeView-&gt;sizeHint().width());
00069     m_treeView-&gt;header()-&gt;setResizeEnabled(-1);
00070     m_treeView-&gt;header()-&gt;hide();
00071     m_treeView-&gt;setSorting(-1);
00072     m_treeView-&gt;setRootIsDecorated(<font class="keyword">true</font>);
00073     
00074     setModule(module);
00075 }
00076 
00077 CBookTreeChooser::~CBookTreeChooser(){
00078 }
00079 
<a name="l00081"></a><a class="code" href="class_c_book_tree_chooser.html#a5">00081</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a5">CBookTreeChooser::setKey</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>* newKey){
00082 }
00083 
<a name="l00085"></a><a class="code" href="class_c_book_tree_chooser.html#a6">00085</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a5">CBookTreeChooser::setKey</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>* newKey, <font class="keyword">const</font> <font class="keywordtype">bool</font> emitSignal){
00086     <font class="keywordflow">if</font> (m_key != newKey )
00087         m_key = dynamic_cast&lt;CSwordTreeKey*&gt;(newKey);
00088     
00089     <font class="keyword">const</font> QString key = m_key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>();
00090     
00091     QStringList siblings;
00092     <font class="keywordflow">if</font> (m_key &amp;&amp; !key.isEmpty())
00093         siblings = QStringList::split(<font class="stringliteral">"/"</font>,key,<font class="keyword">false</font>);
00094     
00095     <font class="comment">//find the right listview item</font>
00096     <font class="keyword">const</font> <font class="keywordtype">int</font> count = siblings.count();
00097     <font class="keywordtype">int</font> index = 0;
00098     QString currentSibling = siblings[index];
00099     
00100   QListViewItem* child = m_treeView-&gt;firstChild();
00101   <font class="keywordflow">while</font>( child &amp;&amp; index &lt; count ) {
00102 <font class="comment">//      qWarning("trying to find %s", currentSibling.latin1() );</font>
00103 
00104     <font class="keywordflow">if</font> (child-&gt;text(0) == currentSibling) { <font class="comment">//found parent of our item</font>
00105         <font class="comment">//found right entry?</font>
00106         TreeItem* i = dynamic_cast&lt;TreeItem*&gt;(child);
00107         <font class="keywordflow">if</font> (!i || i-&gt;key() == key) {
00108 <font class="comment">//              qWarning("found!");</font>
00109             <font class="keywordflow">break</font>;
00110         }
00111         child = child-&gt;firstChild();
00112         currentSibling = siblings[++index];
00113     }
00114     <font class="keywordflow">else</font>
00115             child = child-&gt;nextSibling();
00116   }
00117     
00118   m_treeView-&gt;setCurrentItem( child );
00119   m_treeView-&gt;ensureItemVisible(child);
00120     <font class="keywordflow">if</font> (emitSignal)
00121         emit <a class="code" href="class_c_key_chooser.html#j0">keyChanged</a>(m_key);
00122 }
00123 
<a name="l00125"></a><a class="code" href="class_c_book_tree_chooser.html#a4">00125</a> <a class="code" href="class_c_sword_key.html">CSwordKey</a>* <font class="keyword">const</font> <a class="code" href="class_c_book_tree_chooser.html#a4">CBookTreeChooser::key</a>(){
00126     <font class="keywordflow">return</font> m_key;
00127 }
00128 
<a name="l00130"></a><a class="code" href="class_c_book_tree_chooser.html#a3">00130</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a3">CBookTreeChooser::setModule</a>(<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module){
00131     m_module = dynamic_cast&lt;CSwordBookModuleInfo*&gt;(module);
00132     
00133     <font class="keywordflow">if</font> (m_module &amp;&amp; m_key) {
00134         m_treeView-&gt;clear();
00135     
00136         m_key-&gt;root();
00137         m_key-&gt;firstChild();
00138         <a class="code" href="class_c_book_tree_chooser.html#b0">setupTree</a>(0,0,m_key);
00139         
00140         <a class="code" href="class_c_book_tree_chooser.html#g0">updateKey</a>(m_key);
00141     }
00142 }
00143 
<a name="l00145"></a><a class="code" href="class_c_book_tree_chooser.html#a2">00145</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a2">CBookTreeChooser::refreshContent</a>(){
00146     <font class="keywordflow">if</font> (m_key)
00147         <a class="code" href="class_c_book_tree_chooser.html#g0">updateKey</a>( m_key ); <font class="comment">//refresh with current key</font>
00148 }
00149 
<a name="l00151"></a><a class="code" href="class_c_book_tree_chooser.html#b0">00151</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#b0">CBookTreeChooser::setupTree</a>( QListViewItem* parent, QListViewItem* after, <a class="code" href="class_c_sword_tree_key.html">CSwordTreeKey</a>* key ){
00152 <font class="comment">//  ASSERT(key);</font>
00153     QListViewItem* item = 0;
00154     <font class="keywordflow">if</font> (parent)
00155         item = <font class="keyword">new</font> TreeItem(parent, after, key-&gt;getLocalName(), key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>());
00156     <font class="keywordflow">else</font>
00157         item = <font class="keyword">new</font> TreeItem(m_treeView, after, key-&gt;getLocalName(), key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>());
00158     
00159     <font class="keywordflow">if</font> (key-&gt;firstChild()) {
00160         <a class="code" href="class_c_book_tree_chooser.html#b0">setupTree</a>(item, 0, key);
00161         key-&gt;parent();
00162     }
00163     <font class="keywordflow">if</font> (key-&gt;nextSibling())
00164         <a class="code" href="class_c_book_tree_chooser.html#b0">setupTree</a>(parent, item, key);
00165 }
00166 
<a name="l00168"></a><a class="code" href="class_c_book_tree_chooser.html#h0">00168</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#h0">CBookTreeChooser::itemClicked</a>( QListViewItem* item ){
00169     TreeItem* i = dynamic_cast&lt;TreeItem*&gt;(item);
00170 <font class="comment">//  ASSERT(i);</font>
00171     <font class="keywordflow">if</font> (!i)
00172         <font class="keywordflow">return</font>;
00173 
00174     <font class="keyword">const</font> QString key = i-&gt;key();
00175     m_key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>(key);
00176     
00177     emit <a class="code" href="class_c_key_chooser.html#j0">keyChanged</a>(m_key);
00178 }
00179 
<a name="l00181"></a><a class="code" href="class_c_book_tree_chooser.html#g0">00181</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#g0">CBookTreeChooser::updateKey</a>( <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key ){ 
00182     <a class="code" href="class_c_book_tree_chooser.html#a5">setKey</a>(key, <font class="keyword">false</font>);
00183 }
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:12 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
