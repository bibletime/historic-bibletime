<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cbooktreechooser.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cbooktreechooser.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cbooktreechooser.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sat Jan 26 2002</font>
00005 <font class="comment">    copyright            : (C) 2002 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cbooktreechooser.h"</font>
00019 <font class="preprocessor">#include "backend/cswordtreekey.h"</font>
00020 <font class="preprocessor">#include "backend/cswordbookmoduleinfo.h"</font>
00021 
00022 <font class="comment">//Qt includes</font>
00023 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00024 <font class="preprocessor">#include &lt;qheader.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qlistview.h&gt;</font>
00026 
00028 
00029 CBookTreeChooser::TreeItem::TreeItem(QListViewItem* parent, QListViewItem* after, <font class="keyword">const</font> QString caption, <font class="keyword">const</font> QString key)
00030     : KListViewItem(parent, after, caption) {   
00031     m_key = <a class="code" href="class_c_display_window.html#a16">key</a>;
00032 };
00033 
00034 CBookTreeChooser::TreeItem::TreeItem(QListViewItem* parent,<font class="keyword">const</font> QString caption, <font class="keyword">const</font> QString key)
00035     : KListViewItem(parent, caption) {  
00036     m_key = <a class="code" href="class_c_display_window.html#a16">key</a>;
00037 };
00038 
00039 CBookTreeChooser::TreeItem::TreeItem(QListView* view, QListViewItem* after, <font class="keyword">const</font> QString caption, <font class="keyword">const</font> QString key)
00040     : KListViewItem(view,after, caption) {  
00041     m_key = <a class="code" href="class_c_display_window.html#a16">key</a>;
00042 };
00043 
00044 <font class="keyword">const</font> QString&amp; <a class="code" href="class_c_book_tree_chooser.html#a4">CBookTreeChooser::TreeItem::key</a>()<font class="keyword"> const </font>{
00045     <font class="keywordflow">return</font> m_key;
00046 };  
00047 
00049 
00050 CBookTreeChooser::CBookTreeChooser(ListCSwordModuleInfo modules, <a class="code" href="class_c_sword_key.html">CSwordKey</a> *key, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00051     : <a class="code" href="class_c_key_chooser.html">CKeyChooser</a>(modules, key, parent,name) {
00052   <a class="code" href="class_c_display_window.html#b8">setModules</a>(<a class="code" href="class_c_display_window.html#a2">modules</a>, <font class="keyword">false</font>);   
00053   m_key = dynamic_cast&lt;CSwordTreeKey*&gt;(key);
00054   <font class="keywordflow">if</font> (!<a class="code" href="class_c_display_window.html#a2">modules</a>.count()) {
00055         m_modules.clear();
00056         m_key = 0;
00057     }
00058 
00059     <font class="comment">//now setup the keychooser widgets</font>
00060     QHBoxLayout* layout = <font class="keyword">new</font> QHBoxLayout(<font class="keyword">this</font>);
00061     
00062   m_treeView = <font class="keyword">new</font> KListView(<font class="keyword">this</font>);
00063     layout-&gt;addWidget(m_treeView);  
00064     connect( m_treeView, SIGNAL(executed(QListViewItem*)), SLOT(itemClicked(QListViewItem*)));
00065     m_treeView-&gt;addColumn(<font class="stringliteral">"Tree"</font>);  
00066     m_treeView-&gt;header()-&gt;resizeSection( 0,m_treeView-&gt;sizeHint().width());
00067     m_treeView-&gt;header()-&gt;setResizeEnabled(-1);
00068     m_treeView-&gt;header()-&gt;hide();
00069     m_treeView-&gt;setSorting(-1);
00070     m_treeView-&gt;setRootIsDecorated(<font class="keyword">true</font>);
00071   m_treeView-&gt;setFullWidth(<font class="keyword">true</font>);
00072 
00073   <a class="code" href="class_c_display_window.html#b8">setModules</a>(<a class="code" href="class_c_display_window.html#a2">modules</a>); <font class="comment">//fill the tree</font>
00074 }
00075 
00076 CBookTreeChooser::~CBookTreeChooser(){
00077 }
00078 
<a name="l00080"></a><a class="code" href="class_c_book_tree_chooser.html#a5">00080</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a5">CBookTreeChooser::setKey</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>* newKey){
00081 }
00082 
<a name="l00084"></a><a class="code" href="class_c_book_tree_chooser.html#a6">00084</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a5">CBookTreeChooser::setKey</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>* newKey, <font class="keyword">const</font> <font class="keywordtype">bool</font> emitSignal){
00085     <font class="keywordflow">if</font> (m_key != newKey )
00086         m_key = dynamic_cast&lt;CSwordTreeKey*&gt;(newKey);
00087     
00088     <font class="keyword">const</font> QString key = m_key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>();
00089     
00090     QStringList siblings;
00091     <font class="keywordflow">if</font> (m_key &amp;&amp; !key.isEmpty())
00092         siblings = QStringList::split(<font class="stringliteral">"/"</font>,key,<font class="keyword">false</font>);
00093     
00094     <font class="comment">//find the right listview item</font>
00095     <font class="keyword">const</font> <font class="keywordtype">int</font> count = siblings.count();
00096     <font class="keywordtype">int</font> index = 0;
00097     QString currentSibling = siblings[index];
00098     
00099   QListViewItem* child = m_treeView-&gt;firstChild();
00100   <font class="keywordflow">while</font>( child &amp;&amp; index &lt; count ) {
00101     <font class="keywordflow">if</font> (child-&gt;text(0) == currentSibling) { <font class="comment">//found parent of our item</font>
00102         <font class="comment">//found right entry?</font>
00103         TreeItem* i = dynamic_cast&lt;TreeItem*&gt;(child);
00104         <font class="keywordflow">if</font> (!i || i-&gt;key() == key) {
00105             <font class="keywordflow">break</font>;
00106         }
00107         child = child-&gt;firstChild();
00108         currentSibling = siblings[++index];
00109     }
00110     <font class="keywordflow">else</font>
00111             child = child-&gt;nextSibling();
00112   }
00113     
00114   m_treeView-&gt;setCurrentItem( child );
00115   m_treeView-&gt;ensureItemVisible(child);
00116     <font class="keywordflow">if</font> (emitSignal)
00117         emit <a class="code" href="class_c_key_chooser.html#j0">keyChanged</a>(m_key);
00118 }
00119 
<a name="l00121"></a><a class="code" href="class_c_book_tree_chooser.html#a4">00121</a> <a class="code" href="class_c_sword_key.html">CSwordKey</a>* <font class="keyword">const</font> <a class="code" href="class_c_book_tree_chooser.html#a4">CBookTreeChooser::key</a>(){
00122     <font class="keywordflow">return</font> m_key;
00123 }
00124 
<a name="l00126"></a><a class="code" href="class_c_book_tree_chooser.html#a3">00126</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a3">CBookTreeChooser::setModules</a>(ListCSwordModuleInfo modules, <font class="keyword">const</font> <font class="keywordtype">bool</font> refresh){
00127   m_modules.clear();
00128   <font class="keywordflow">for</font> (modules.first(); modules.current(); modules.next()) {
00129     <font class="keywordflow">if</font> (<a class="code" href="class_c_sword_book_module_info.html">CSwordBookModuleInfo</a>* book = dynamic_cast&lt;CSwordBookModuleInfo*&gt;(modules.current())) {
00130       m_modules.append(book);
00131     }
00132   }
00133     
00134     <font class="keywordflow">if</font> (refresh &amp;&amp; m_modules.count() &amp;&amp; m_key) {
00135         m_treeView-&gt;clear();
00136     
00137     <font class="keyword">const</font> QString oldKey = m_key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>();
00138         m_key-&gt;root();
00139         m_key-&gt;firstChild();
00140         <a class="code" href="class_c_book_tree_chooser.html#b0">setupTree</a>(0,0,m_key);
00141 
00142     m_key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>(oldKey);
00143         
00144         <a class="code" href="class_c_book_tree_chooser.html#g0">updateKey</a>(m_key);
00145     }
00146 }
00147 
<a name="l00149"></a><a class="code" href="class_c_book_tree_chooser.html#a2">00149</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#a2">CBookTreeChooser::refreshContent</a>(){
00150     <font class="keywordflow">if</font> (m_key)
00151         <a class="code" href="class_c_book_tree_chooser.html#g0">updateKey</a>( m_key ); <font class="comment">//refresh with current key</font>
00152 }
00153 
<a name="l00155"></a><a class="code" href="class_c_book_tree_chooser.html#b0">00155</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#b0">CBookTreeChooser::setupTree</a>( QListViewItem* parent, QListViewItem* after, <a class="code" href="class_c_sword_tree_key.html">CSwordTreeKey</a>* key ){
00156     QListViewItem* item = 0;
00157     <font class="keywordflow">if</font> (parent)
00158         item = <font class="keyword">new</font> TreeItem(parent, after, key-&gt;getLocalName(), key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>());
00159     <font class="keywordflow">else</font>
00160         item = <font class="keyword">new</font> TreeItem(m_treeView, after, key-&gt;getLocalName(), key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>());
00161     
00162     <font class="keywordflow">if</font> (key-&gt;firstChild()) {
00163         <a class="code" href="class_c_book_tree_chooser.html#b0">setupTree</a>(item, 0, key);
00164         key-&gt;parent();
00165     }
00166     <font class="keywordflow">if</font> (key-&gt;nextSibling())
00167         <a class="code" href="class_c_book_tree_chooser.html#b0">setupTree</a>(parent, item, key);
00168 }
00169 
<a name="l00171"></a><a class="code" href="class_c_book_tree_chooser.html#h0">00171</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#h0">CBookTreeChooser::itemClicked</a>( QListViewItem* item ){
00172     TreeItem* i = dynamic_cast&lt;TreeItem*&gt;(item);
00173     <font class="keywordflow">if</font> (!i)
00174         <font class="keywordflow">return</font>;
00175 
00176     <font class="keyword">const</font> QString key = i-&gt;key();
00177     m_key-&gt;<a class="code" href="class_c_sword_tree_key.html#a4">key</a>(key);
00178     
00179     emit <a class="code" href="class_c_key_chooser.html#j0">keyChanged</a>(m_key);
00180 }
00181 
<a name="l00183"></a><a class="code" href="class_c_book_tree_chooser.html#g0">00183</a> <font class="keywordtype">void</font> <a class="code" href="class_c_book_tree_chooser.html#g0">CBookTreeChooser::updateKey</a>( <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key ){ 
00184     <a class="code" href="class_c_book_tree_chooser.html#a5">setKey</a>(key, <font class="keyword">false</font>);
00185 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:08 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
