<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>chtmlwidget.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>chtmlwidget.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          chtmlwidget.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Feb 27 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "chtmlwidget.h"</font>
00019 <font class="preprocessor">#include "ctoolclass.h"</font>
00020 <font class="preprocessor">#include "../backend/creferencemanager.h"</font>
00021 <font class="preprocessor">#include "../backend/cswordldkey.h"</font>
00022 <font class="preprocessor">#include "../backend/cswordversekey.h"</font>
00023 <font class="preprocessor">#include "../backend/cswordbackend.h"</font>
00024 <font class="preprocessor">#include "../backend/cswordmoduleinfo.h"</font>
00025 <font class="preprocessor">#include "presenters/cswordpresenter.h"</font>
00026 <font class="preprocessor">#include "thirdparty/qt3stuff/qt3stuff.h"</font>
00027 <font class="preprocessor">#include "thirdparty/qt3stuff/qrichtext_p.h"</font>
00028 <font class="preprocessor">#include "../resource.h"</font>
00029 <font class="preprocessor">#include "../tooltipdef.h"</font>
00030 <font class="preprocessor">#include "../whatsthisdef.h"</font>
00031 <font class="preprocessor">#include "cbtconfig.h"</font>
00032 
00033 <font class="preprocessor">#include "../util/scoped_resource.h"</font>
00034 
00035 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00036 
00037 <font class="comment">//QT includes</font>
00038 <font class="preprocessor">#include &lt;qurl.h&gt;</font>
00039 <font class="preprocessor">#include &lt;qfile.h&gt;</font>
00040 <font class="preprocessor">#include &lt;qtextstream.h&gt;</font>
00041 <font class="preprocessor">#include &lt;qclipboard.h&gt;</font>
00042 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00043 <font class="preprocessor">#include &lt;qdragobject.h&gt;</font>
00044 <font class="preprocessor">#include &lt;qpixmapcache.h&gt;</font>
00045 <font class="preprocessor">#include &lt;qstylesheet.h&gt;</font>
00046 <font class="preprocessor">#include &lt;qwidget.h&gt;</font>
00047 <font class="preprocessor">#include &lt;qtoolbutton.h&gt;</font>
00048 <font class="preprocessor">#include &lt;qapplication.h&gt;</font>
00049 
00050 <font class="comment">//KDE includes</font>
00051 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00052 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00053 <font class="preprocessor">#include &lt;kstdaction.h&gt;</font>
00054 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00055 <font class="preprocessor">#include &lt;kurl.h&gt;</font>
00056 <font class="preprocessor">#include &lt;kfiledialog.h&gt;</font>
00057 <font class="preprocessor">#include &lt;kcmenumngr.h&gt;</font>
00058 <font class="preprocessor">#include &lt;kglobal.h&gt;</font>
00059 <font class="preprocessor">#include &lt;kcursor.h&gt;</font>
00060 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00061 <font class="preprocessor">#include &lt;kglobalsettings.h&gt;</font>
00062 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00063 <font class="preprocessor">#include &lt;ktoolbar.h&gt;</font>
00064 <font class="preprocessor">#include &lt;kcolorbutton.h&gt;</font>
00065 
00066 <font class="comment">//Sword includes</font>
00067 <font class="preprocessor">#include &lt;swmodule.h&gt;</font>
00068 
00069 CHTMLWidget::ToolTip::ToolTip(QWidget* parent)
00070     : QToolTip(parent) {
00071 
00072 }
00073 
00074 <font class="keywordtype">void</font> CHTMLWidget::ToolTip::maybeTip(<font class="keyword">const</font> QPoint&amp; p) {
00075 <font class="comment">//  qWarning("void CHTMLWidget::ToolTip::maybeTip(const QPoint&amp; p) ");</font>
00076     <font class="keywordflow">if</font> (!parentWidget()-&gt;inherits(<font class="stringliteral">"CHTMLWidget"</font>))
00077         <font class="keywordflow">return</font>;
00078 
00079     <a class="code" href="class_c_h_t_m_l_widget.html">CHTMLWidget</a>* htmlWidget = dynamic_cast&lt;CHTMLWidget*&gt;(parentWidget());   
00080     ASSERT(htmlWidget);
00081     QPoint p1 = htmlWidget-&gt;viewportToContents(p);
00082     QString link = QString::null;
00083     QString text = QString::null;
00084 
00085   link = htmlWidget-&gt;anchorAt(p1);
00086     <font class="keywordflow">if</font> ( link.isEmpty() )
00087         <font class="keywordflow">return</font>;
00088     <font class="keywordflow">else</font> {
00089 <font class="comment">//      qWarning("link is valid");</font>
00090       Qt3::QTextCursor c( htmlWidget-&gt;<a class="code" href="class_c_h_t_m_l_widget.html#a10">getDocument</a>() );
00091       htmlWidget-&gt;<a class="code" href="class_c_h_t_m_l_widget.html#a11">placeCursor</a>( p1, &amp;c );
00092         QRect rect = c.parag()-&gt;rect();
00093         
00094         <font class="comment">//map rect coordinates to widget's ones</font>
00095     rect.setX( htmlWidget-&gt;contentsToViewport(rect.topLeft()).x() );
00096     rect.setY( htmlWidget-&gt;contentsToViewport(rect.topLeft()).y() );
00097     rect.setWidth( htmlWidget-&gt;contentsToViewport(rect.bottomRight()).x() - rect.x() );
00098     rect.setHeight( htmlWidget-&gt;contentsToViewport(rect.bottomLeft()).y() - rect.y() );
00099                         
00100         QString module = QString::null;
00101         QString ref = QString::null;
00102         CReferenceManager::Type type;       
00103         <font class="keyword">const</font> <font class="keywordtype">bool</font> ok = <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(link, module, ref, type);
00104         <font class="keywordflow">if</font> (ref.isEmpty())
00105             <font class="keywordflow">return</font>;
00106 
00107         <font class="keyword">const</font> QFont oldFont = font();               
00108         
00109         <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = 0;
00110         <font class="keywordflow">if</font> (module.isEmpty() || module.isNull()) {
00111             module = <a class="code" href="class_c_reference_manager.html#d5">CReferenceManager::preferredModule</a>( type );
00112         }       
00113         m = backend()-&gt;findModuleByName(module);
00114         <font class="keywordflow">if</font> (m){
00115             <font class="keywordflow">if</font> (m-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Bible || m-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>() == CSwordModuleInfo::Commentary) {
00116                 <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = htmlWidget-&gt;<a class="code" href="class_c_h_t_m_l_widget.html#a13">modules</a>().first();
00117                 <font class="keywordflow">if</font> (module) {
00118                     ref = <a class="code" href="class_c_reference_manager.html#d7">CReferenceManager::parseVerseReference</a>(ref<font class="comment">/*, module-&gt;module()-&gt;Lang(), backend()-&gt;booknameLanguage()*/</font> );
00119                 }
00120             }
00121             <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>( m ) );
00122             <font class="keywordflow">if</font> (key) {
00123                 backend()-&gt;setFilterOptions( CBTConfig::getFilterOptionDefaults() );                
00124                 
00125                 key-&gt;key(ref);
00126                 text = key-&gt;renderedText();
00127             }
00128             <font class="keywordflow">if</font> (m-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>()) {
00129                 setFont( CBTConfig::get(CBTConfig::unicode) );
00130             }
00131         }
00132         <font class="keywordflow">if</font> (!text.isEmpty()) {
00133             text = QString::fromLatin1(<font class="stringliteral">"&lt;B&gt;%1&lt;/B&gt;&lt;HR&gt;%2"</font>).arg(ref).arg(text);
00134             tip(rect, text);
00135         }
00136         setFont(oldFont);
00137     }
00138 }
00139 
<a name="l00140"></a><a class="code" href="class_c_h_t_m_l_widget.html#a0">00140</a> <a class="code" href="class_c_h_t_m_l_widget.html#a0">CHTMLWidget::CHTMLWidget</a>(<font class="keyword">const</font> <font class="keywordtype">bool</font> useColorsAndFonts,QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00141     : <a class="code" href="class_q_text_edit.html">QTextEdit</a>(parent, name),m_moduleList( new ListCSwordModuleInfo ) {
00142     
00143     m_popup = 0;
00144     m_anchor = QString::null;
00145     m_anchorMenu = 0;
00146     m_selectedWord = <font class="keyword">false</font>;
00147     mousePressed = inDoubleClick = <font class="keyword">false</font>;       
00148     setTextFormat( Qt::RichText );
00149     <a class="code" href="class_c_h_t_m_l_widget.html#a8">setReadOnly</a>(<font class="keyword">true</font>);
00150 
00151     QFont unicodeFont = CBTConfig::get(CBTConfig::unicode);
00152     <font class="keywordflow">if</font> (!document()-&gt;charsetMap-&gt;contains(unicodeFont.family()))
00153         document()-&gt;charsetMap-&gt;insert(unicodeFont.family(), QFont::Unicode);
00154         
00155     <a class="code" href="class_c_h_t_m_l_widget.html#b3">initView</a>(); 
00156     <a class="code" href="class_c_h_t_m_l_widget.html#b2">initConnections</a>();
00157     <font class="keywordflow">if</font> (useColorsAndFonts) {
00158         initColors();
00159         <a class="code" href="class_c_h_t_m_l_widget.html#b1">initFonts</a>();    
00160     }
00161 }
00162 
00163 CHTMLWidget::~CHTMLWidget(){
00164     <font class="keyword">delete</font> m_moduleList;
00165     m_moduleList = 0;
00166 }
00167 
00169 <font class="keywordtype">void</font> CHTMLWidget::initColors(){
00170 <font class="comment">//  qDebug("CHTMLWidget::initColors()");</font>
00171 <font class="comment">//  setLinkColor( m_config-&gt;readColorEntry("Versenumber/URL", &amp;Qt::darkBlue) );     </font>
00172 <font class="comment">//  QColor textColor = m_config-&gt;readColorEntry("Normal Text", &amp;Qt::red);   </font>
00173     <font class="keyword">const</font> QColor bgColor = CBTConfig::get(CBTConfig::backgroundColor);
00174     setPaper(QBrush(bgColor));
00175     
00176 <font class="comment">//using a standard text color doesn't work at the moment!</font>
00177 
00178 <font class="comment">//  QPalette p = palette();</font>
00179 <font class="comment">//  p.setBrush( QPalette::Active, QColorGroup::Base, QBrush(bgColor) ); </font>
00180 <font class="comment">//  QColorGroup cg = p.active();</font>
00181 <font class="comment">//  p.setColor(QPalette::Active, QColorGroup::Text, textColor);</font>
00182 <font class="comment">//  cg.setColor(QColorGroup::Base, bgColor);</font>
00183 <font class="comment">//  p.setActive(cg);    </font>
00184 <font class="comment">//  setPalette(p);      </font>
00185 <font class="comment">//  refresh();</font>
00186 }
00187 
<a name="l00189"></a><a class="code" href="class_c_h_t_m_l_widget.html#b1">00189</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b1">CHTMLWidget::initFonts</a>(){
00190 <font class="comment">// ACHTUNG: CBTCONFIG benutzen</font>
00191 <font class="comment">//  ConfigGroupSaver groupSaver(m_config, "Fonts");     </font>
00192 <font class="comment">//  if (document()-&gt;charsetMap-&gt;contains(font().family())) { //remove old standard font</font>
00193 <font class="comment">//      document()-&gt;charsetMap-&gt;remove(font().family());</font>
00194 <font class="comment">//  }</font>
00195 <font class="comment">//  </font>
00196 <font class="comment">//  QFont f = m_config-&gt;readFontEntry(i18n("Display window"));  </font>
00197 <font class="comment">//  document()-&gt;setDefaultFont( f );</font>
00198 <font class="comment">//  setFont(f);</font>
00199 <font class="comment">//  </font>
00200 <font class="comment">//  document()-&gt;charsetMap-&gt;replace(f.family(), f.charSet());</font>
00201 }
00202 
<a name="l00204"></a><a class="code" href="class_c_h_t_m_l_widget.html#b3">00204</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b3">CHTMLWidget::initView</a>(){
00205     m_toolTip = <font class="keyword">new</font> ToolTip(<font class="keyword">this</font>);
00206     disconnect(dragStartTimer, SIGNAL(timeout()),
00207         <font class="keyword">this</font>, SLOT(startDrag()));
00208     
00209 <font class="comment">//  QStringList paths;  </font>
00210     
00211     setAcceptDrops(<font class="keyword">true</font>);
00212     viewport()-&gt;setAcceptDrops(<font class="keyword">true</font>);
00213 }
00214 
00215 
<a name="l00217"></a><a class="code" href="class_c_h_t_m_l_widget.html#b2">00217</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b2">CHTMLWidget::initConnections</a>(){
00218     connect( <font class="keyword">this</font>, SIGNAL( linkClicked( <font class="keyword">const</font> QString &amp; ) ),
00219         <font class="keyword">this</font>, SLOT( <a class="code" href="class_c_h_t_m_l_widget.html#g3">setSource</a>( <font class="keyword">const</font> QString &amp; ) ) );   
00220     <font class="keywordflow">if</font> (!<a class="code" href="class_c_h_t_m_l_widget.html#a7">isReadOnly</a>()) {
00221         connect(<font class="keyword">this</font>, SIGNAL(<a class="code" href="class_q_text_edit.html#j2">currentFontChanged</a>(<font class="keyword">const</font> QFont&amp;)),
00222             SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h8">slotCurrentFontChanged</a>(<font class="keyword">const</font> QFont&amp;)));
00223         connect(<font class="keyword">this</font>, SIGNAL(<a class="code" href="class_q_text_edit.html#j3">currentColorChanged</a>(<font class="keyword">const</font> QColor&amp;)),
00224             SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h7">slotCurrentColorChanged</a>(<font class="keyword">const</font> QColor&amp;)));
00225         connect(<font class="keyword">this</font>, SIGNAL(<a class="code" href="class_q_text_edit.html#j4">currentAlignmentChanged</a>(<font class="keywordtype">int</font>)),
00226             SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h9">slotCurrentAlignementChanged</a>(<font class="keywordtype">int</font>)));   
00227     }
00228     <font class="keywordflow">else</font> {
00229         disconnect(<font class="keyword">this</font>, SIGNAL(<a class="code" href="class_q_text_edit.html#j2">currentFontChanged</a>(<font class="keyword">const</font> QFont&amp;)),
00230             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h8">slotCurrentFontChanged</a>(<font class="keyword">const</font> QFont&amp;)));
00231         disconnect(<font class="keyword">this</font>, SIGNAL(<a class="code" href="class_q_text_edit.html#j3">currentColorChanged</a>(<font class="keyword">const</font> QColor&amp;)),
00232             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h7">slotCurrentColorChanged</a>(<font class="keyword">const</font> QColor&amp;)));
00233         disconnect(<font class="keyword">this</font>, SIGNAL(<a class="code" href="class_q_text_edit.html#j4">currentAlignmentChanged</a>(<font class="keywordtype">int</font>)),
00234             <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h9">slotCurrentAlignementChanged</a>(<font class="keywordtype">int</font>)));     
00235     }
00236 }
00237 
<a name="l00239"></a><a class="code" href="class_c_h_t_m_l_widget.html#a2">00239</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a2">CHTMLWidget::refresh</a>(){
00240 <font class="comment">//  qDebug("CHTMLWidget::refresh()");</font>
00241     initColors();
00242     <a class="code" href="class_c_h_t_m_l_widget.html#b1">initFonts</a>();
00243 }
00244 
<a name="l00246"></a><a class="code" href="class_c_h_t_m_l_widget.html#a3">00246</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a3">CHTMLWidget::setHTMLSource</a>(<font class="keyword">const</font> QString&amp; url){
00247     qWarning(url.local8Bit());
00248     <font class="keywordflow">if</font> (url.left(1) != <font class="stringliteral">"/"</font>) {   <font class="comment">//a filename without path</font>
00249         QString myFile = <a class="code" href="class_c_tool_class.html#d0">CToolClass::locatehtml</a>( url );
00250         <font class="keywordflow">if</font> (QFile::exists(myFile)) {
00251             KURL kurl(myFile);
00252         mimeSourceFactory()-&gt;addFilePath( kurl.directory() );
00253             
00254             <font class="comment">//read in the HTML file and use setText()</font>
00255             QFile file(myFile);
00256             <font class="keywordflow">if</font> ( file.open(IO_ReadOnly) ) {    <font class="comment">// file opened successfully</font>
00257                 QTextStream t( &amp;file );        <font class="comment">// use a text stream</font>
00258                 <font class="keyword">const</font> QString text = t.read();
00259                 file.close();
00260                 setText( text<font class="comment">/*, kurl.directory()*/</font> );
00261             }
00262         }
00263         <font class="keywordflow">else</font>
00264             setText( i18n(<font class="stringliteral">"Unable to find the page %1!"</font>).arg(url) );
00265     }
00266     <font class="keywordflow">else</font> {
00267         <font class="keywordflow">if</font> (QFile::exists(url)) {
00268             <font class="comment">//read in the HTML file and use setText()</font>
00269             KURL kurl(url);
00270         mimeSourceFactory()-&gt;addFilePath( kurl.directory() );           
00271             QFile file(url);
00272             <font class="keywordflow">if</font> ( file.open(IO_ReadOnly) ) {    <font class="comment">// file opened successfully</font>
00273                 QTextStream t( &amp;file );        <font class="comment">// use a text stream</font>
00274                 <font class="keyword">const</font> QString text = t.read();
00275                 file.close();
00276                 setText( text<font class="comment">/*, kurl.directory()*/</font> );
00277             }
00278         }
00279     }
00280 }
00281 
<a name="l00283"></a><a class="code" href="class_c_h_t_m_l_widget.html#g0">00283</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#g0">CHTMLWidget::slotSaveAsHTML</a>(){
00284     QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.html *.htm *.shtml *.shtm | HTML files\n *.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save text as HTML page ..."</font>));   
00285     <font class="keywordflow">if</font> (!file.isNull())
00286         <a class="code" href="class_c_tool_class.html#d4">CToolClass::savePlainFile</a>( file, text().utf8());
00287 }
00288 
<a name="l00290"></a><a class="code" href="class_c_h_t_m_l_widget.html#g1">00290</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#g1">CHTMLWidget::slotSaveAsText</a>(){
00291     <font class="keyword">const</font> QString file = KFileDialog::getSaveFileName (QString::null, i18n(<font class="stringliteral">"*.txt | Text file (*.txt)\n*.* | All files (*.*)"</font>), 0, i18n(<font class="stringliteral">"Save text as plain text ..."</font>));
00292 
00293     <font class="keywordflow">if</font> (!file.isNull()) {
00294         QString html = document()-&gt;plainText();
00295         <a class="code" href="class_c_tool_class.html#d4">CToolClass::savePlainFile</a>( file, html);
00296     }
00297 }
00298 
00299 <font class="comment">//**  */</font>
<a name="l00300"></a><a class="code" href="class_c_h_t_m_l_widget.html#b4">00300</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b4">CHTMLWidget::contentsDragEnterEvent</a>(QDragEnterEvent* e){
00301     QTextEdit::contentsDragEnterEvent(e);
00302   e-&gt;accept(QTextDrag::canDecode(e));
00303 }
00304 
<a name="l00306"></a><a class="code" href="class_c_h_t_m_l_widget.html#b5">00306</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b5">CHTMLWidget::contentsDragMoveEvent</a>(QDragMoveEvent* e){
00307     QTextEdit::contentsDragMoveEvent(e);
00308   e-&gt;accept(QTextDrag::canDecode(e));
00309 }
00310 
<a name="l00312"></a><a class="code" href="class_c_h_t_m_l_widget.html#b6">00312</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b6">CHTMLWidget::contentsDropEvent</a>(QDropEvent* e){
00313     QString str;
00314     QCString submime;
00315 
00316     <font class="keywordflow">if</font> (<a class="code" href="class_c_h_t_m_l_widget.html#a7">isReadOnly</a>()) {
00317         <font class="keywordflow">if</font> ( ( QTextDrag::decode(e,str,submime=BOOKMARK) || QTextDrag::decode(e,str,submime=REFERENCE) ) &amp;&amp; !str.isEmpty() ){
00318             QString ref = QString::null;
00319             QString mod = QString::null;        
00320             <a class="code" href="class_c_reference_manager.html#d3">CReferenceManager::decodeReference</a>(str,mod,ref);
00321             emit <a class="code" href="class_c_h_t_m_l_widget.html#j3">referenceDropped</a>(<font class="comment">/*mod,*/</font> ref);
00322         }
00323         <font class="keywordflow">else</font>
00324             e-&gt;ignore();
00325     }
00326     <font class="keywordflow">else</font> {
00327         QString text = QString::null;
00328         <font class="keywordflow">if</font> ( ( QTextDrag::decode(e,str,submime=BOOKMARK) || QTextDrag::decode(e,str,submime=REFERENCE) ) &amp;&amp; !str.isEmpty() ){
00329             QString ref = QString::null;
00330             QString mod = QString::null;
00331             <a class="code" href="class_c_reference_manager.html#d3">CReferenceManager::decodeReference</a>(str,mod,ref);
00332             <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(mod);
00333             <font class="keywordflow">if</font> (module) {                   
00334                 <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module);;                    
00335                 key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(ref);
00336                 text = key-&gt;<a class="code" href="class_c_sword_key.html#a6">strippedText</a>();
00337                 <font class="keyword">delete</font> key;
00338             }
00339         }
00340         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (QTextDrag::decode(e,str) &amp;&amp; !str.isEmpty())
00341             text = str;
00342 
00343         <font class="keywordflow">if</font> (!text.isEmpty())
00344             <a class="code" href="class_q_text_edit.html#a14">insert</a>(text);
00345         <font class="keywordflow">else</font> {
00346             e-&gt;ignore();
00347         }
00348     }
00349 }
00350 
00351 
<a name="l00353"></a><a class="code" href="class_c_h_t_m_l_widget.html#b7">00353</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b7">CHTMLWidget::contentsMousePressEvent</a>(QMouseEvent* e) { 
00354   m_pressedPos = e-&gt;pos();
00355   m_anchor = anchorAt(e-&gt;pos());
00356     viewport()-&gt;setCursor(anchorAt(e-&gt;pos()).isEmpty() ? arrowCursor : KCursor::handCursor() );
00357     QTextEdit::contentsMousePressEvent(e);
00358         
00359     <font class="keywordflow">if</font> (!onLink.isEmpty() &amp;&amp; (e-&gt;button() == RightButton) &amp;&amp; m_anchorMenu) {    <font class="comment">//popup installed menu  </font>
00360         m_anchorMenu-&gt;exec( e-&gt;globalPos() );
00361   }
00362   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (m_popup &amp;&amp; e-&gt;button() == RightButton){ <font class="comment">//popup normal menu</font>
00363     m_selectedWord = <font class="keyword">false</font>;
00364     QString selectedWord = QString::null;
00365 
00366     drawCursor(<font class="keyword">false</font>);
00367     <a class="code" href="class_c_h_t_m_l_widget.html#a11">placeCursor</a>(e-&gt;pos());      
00368     <a class="code" href="class_q_text_edit.html#b1">ensureCursorVisible</a>();
00369         emit <a class="code" href="class_q_text_edit.html#j5">cursorPositionChanged</a>(cursor);
00370         
00371     <font class="keywordflow">if</font> (selectedText().isEmpty()) {
00372         Qt3::QTextCursor c1 = *cursor;
00373         Qt3::QTextCursor c2 = *cursor;
00374         c1.gotoWordLeft();
00375         c2.gotoWordRight();
00376         doc-&gt;setSelectionStart( Qt3::QTextDocument::Standard, &amp;c1 );
00377         doc-&gt;setSelectionEnd( Qt3::QTextDocument::Standard, &amp;c2 );
00378         *cursor = c2;
00379         selectedWord = selectedText();
00380             emit <a class="code" href="class_q_text_edit.html#j5">cursorPositionChanged</a>(cursor);             
00381         <a class="code" href="class_q_text_edit.html#b1">ensureCursorVisible</a>();          
00382         repaintChanged();
00383         m_selectedWord = <font class="keyword">true</font>;
00384       }
00385         m_popup-&gt;exec( e-&gt;globalPos() );        
00386         <font class="keywordflow">if</font> (m_selectedWord &amp;&amp; (selectedWord == selectedText()) ) {
00387             m_selectedWord = <font class="keyword">false</font>;
00388             selectAll(<font class="keyword">false</font>);
00389         }       
00390   } 
00391 }
00392 
<a name="l00394"></a><a class="code" href="class_c_h_t_m_l_widget.html#b8">00394</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#b8">CHTMLWidget::contentsMouseMoveEvent</a>(QMouseEvent* e) {
00395   <font class="keywordflow">if</font> ( mousePressed ) {
00396         <font class="keywordflow">if</font> ( mightStartDrag ) { <font class="comment">//we might start a drag</font>
00397         dragStartTimer-&gt;stop();
00398         <font class="keywordflow">if</font> ( ( e-&gt;pos() - dragStartPos ).manhattanLength() &gt; KApplication::startDragDistance() )
00399                 startDrag();
00400         <font class="keywordflow">if</font> ( !<a class="code" href="class_c_h_t_m_l_widget.html#a7">isReadOnly</a>() )
00401                 viewport()-&gt;setCursor( ibeamCursor );
00402         <font class="keywordflow">return</font>;
00403         }
00404         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!m_anchor.isEmpty()) {
00405             QString module = QString::null;
00406             QString key = QString::null;
00407             CReferenceManager::Type type;           
00408             <font class="keyword">const</font> <font class="keywordtype">bool</font> ok = <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(m_anchor, module, key, type);
00409             <font class="keywordflow">if</font> (!ok)
00410                 <font class="keywordflow">return</font>;
00411             
00412             mousePressed = <font class="keyword">false</font>;
00413             inDoubleClick = <font class="keyword">false</font>;                              
00414             mightStartDrag = <font class="keyword">false</font>;
00415                     
00416             QTextDrag *d = <font class="keyword">new</font> QTextDrag(<a class="code" href="class_c_reference_manager.html#d2">CReferenceManager::encodeReference</a>(module,key),viewport());
00417         d-&gt;setSubtype(REFERENCE);
00418         d-&gt;setPixmap(REFERENCE_ICON_SMALL);
00419         d-&gt;drag();
00420             <font class="keywordflow">return</font>;
00421         }       
00422         mousePos = e-&gt;pos();
00423         doAutoScroll();
00424         oldMousePos = mousePos;
00425     }
00426 
00427     <font class="keywordflow">if</font> ( !<a class="code" href="class_c_h_t_m_l_widget.html#a7">isReadOnly</a>() &amp;&amp; !mousePressed ) {
00428         <font class="keywordflow">if</font> ( doc-&gt;hasSelection( Qt3::QTextDocument::Standard ) &amp;&amp; doc-&gt;inSelection( Qt3::QTextDocument::Standard, e-&gt;pos() ) )
00429         viewport()-&gt;setCursor( arrowCursor );
00430         <font class="keywordflow">else</font>
00431         viewport()-&gt;setCursor( ibeamCursor );
00432     }
00433     <font class="keywordflow">if</font> ( <a class="code" href="class_c_h_t_m_l_widget.html#a7">isReadOnly</a>() &amp;&amp; <a class="code" href="class_c_h_t_m_l_widget.html#b9">linksEnabled</a>() ) {
00434         Qt3::QTextCursor c = *cursor;
00435         <a class="code" href="class_c_h_t_m_l_widget.html#a11">placeCursor</a>( e-&gt;pos(), &amp;c );
00436         <font class="keywordflow">if</font> ( c.parag() &amp;&amp; c.parag()-&gt;at( c.index() ) &amp;&amp;
00437          !anchorAt(e-&gt;pos()).isEmpty() ) {
00438             viewport()-&gt;setCursor( pointingHandCursor );
00439         onLink = c.parag()-&gt;at( c.index() )-&gt;format()-&gt;anchorHref();
00440         QUrl u( doc-&gt;context(), onLink, <font class="keyword">true</font> );
00441             m_hoverPos = e-&gt;pos();
00442         <a class="code" href="class_c_h_t_m_l_widget.html#c1">emitHighlighted</a>( u.toString( <font class="keyword">false</font>, <font class="keyword">false</font> ) );          
00443         } <font class="keywordflow">else</font> {
00444         viewport()-&gt;setCursor( <a class="code" href="class_c_h_t_m_l_widget.html#a7">isReadOnly</a>() ? arrowCursor : ibeamCursor );
00445         onLink = QString::null;
00446         <a class="code" href="class_c_h_t_m_l_widget.html#c1">emitHighlighted</a>( QString::null );
00447         }
00448     }
00449 }
00450 
<a name="l00452"></a><a class="code" href="class_c_h_t_m_l_widget.html#a4">00452</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a4">CHTMLWidget::installAnchorMenu</a>( QPopupMenu* anchorMenu ){
00453 <font class="comment">//  qDebug("CHTMLWidget::installAnchorMenu( QPopupMenu* anchorMenu )");</font>
00454     ASSERT( anchorMenu );
00455     m_anchorMenu = anchorMenu;
00456 }
00457 
<a name="l00459"></a><a class="code" href="class_c_h_t_m_l_widget.html#a5">00459</a> QString <a class="code" href="class_c_h_t_m_l_widget.html#a5">CHTMLWidget::getCurrentAnchor</a>(){
00460     <font class="keywordflow">return</font> anchorAt(m_pressedPos);
00461 }
00462 
<a name="l00464"></a><a class="code" href="class_c_h_t_m_l_widget.html#a6">00464</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a6">CHTMLWidget::installPopup</a>( QPopupMenu* popup ){
00465     ASSERT(popup);
00466     m_popup = popup;
00467 }
00468 
<a name="l00470"></a><a class="code" href="class_c_h_t_m_l_widget.html#a8">00470</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a8">CHTMLWidget::setReadOnly</a>( <font class="keyword">const</font> <font class="keywordtype">bool</font> readOnly ){
00471     m_readOnly = readOnly;
00472     <a class="code" href="class_c_h_t_m_l_widget.html#b2">initConnections</a>();
00473         
00474     viewport()-&gt;setCursor( m_readOnly ? arrowCursor : ibeamCursor );
00475     viewport()-&gt;update();   
00476 }
00477 
<a name="l00479"></a><a class="code" href="class_c_h_t_m_l_widget.html#a7">00479</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_h_t_m_l_widget.html#a7">CHTMLWidget::isReadOnly</a>()<font class="keyword"> const </font>{
00480     <font class="keywordflow">return</font> m_readOnly;
00481 }
00482 
<a name="l00484"></a><a class="code" href="class_c_h_t_m_l_widget.html#a9">00484</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a9">CHTMLWidget::createEditToolbar</a>( KToolBar* bar ){
00485     ASSERT(bar);
00486     <font class="keywordflow">if</font> (!bar)
00487         <font class="keywordflow">return</font>;
00488 
00489     m_docSaveAction = <font class="keyword">new</font> KAction(i18n(<font class="stringliteral">"Save"</font>), ICON_FILE_SAVE, 0, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h0">slotSaveDocument</a>()),bar, <font class="stringliteral">"saveDoc_action"</font>);   
00490     m_docSaveAction-&gt;setToolTip( TT_PRESENTER_EDIT_SAVE );
00491     m_docSaveAction-&gt;setWhatsThis( WT_PRESENTER_EDIT_SAVE );    
00492     m_docSaveAction-&gt;plug(bar);
00493     
00494     m_docDeleteAction = <font class="keyword">new</font> KAction(i18n(<font class="stringliteral">"Delete"</font>), ICON_FILE_DELETE, 0, <font class="keyword">this</font>, SIGNAL(sigDeleteDocument()),bar, <font class="stringliteral">"deleteDoc_action"</font>);    
00495     m_docDeleteAction-&gt;setToolTip( TT_PRESENTER_EDIT_DELETE );
00496     m_docDeleteAction-&gt;setWhatsThis( WT_PRESENTER_EDIT_DELETE );    
00497     m_docDeleteAction-&gt;plug(bar);
00498             
00499     m_colorChooser = <font class="keyword">new</font> KColorButton(black, bar);
00500     connect(m_colorChooser, SIGNAL(changed(<font class="keyword">const</font> QColor&amp;)),SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h6">slotSetCurrentColor</a>(<font class="keyword">const</font> QColor&amp;)));       
00501     m_fontAction = <font class="keyword">new</font> KFontAction(i18n(<font class="stringliteral">"Choose a font:"</font>), 0, bar);
00502     connect(m_fontAction, SIGNAL(activated(<font class="keyword">const</font> QString&amp;)), SLOT(slotSetCurrentFont(<font class="keyword">const</font> QString&amp;)));
00503     m_fontAction-&gt;plug(bar);
00504     
00505     m_fontSizeAction = <font class="keyword">new</font> KFontSizeAction(i18n(<font class="stringliteral">"Choose font size"</font>), 0, bar);       
00506     connect(m_fontSizeAction, SIGNAL(fontSizeChanged(<font class="keywordtype">int</font>)), SLOT(<a class="code" href="class_q_text_edit.html#g13">setPointSize</a>(<font class="keywordtype">int</font>)));
00507     m_fontSizeAction-&gt;plug(bar);
00508     
00509     m_boldAction = <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Bold"</font>), ICON_EDIT_BOLD,0,<font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h1">slotToggleBold</a>()), bar);
00510     m_boldAction-&gt;plug(bar);
00511     m_italicAction = <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Italic"</font>), ICON_EDIT_ITALIC,0, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h2">slotToggleItalic</a>()),bar); 
00512     m_italicAction-&gt;plug(bar);  
00513     m_underlineAction = <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Underlined"</font>), ICON_EDIT_UNDER,0, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h3">slotToggleUnderline</a>()),bar);    
00514     m_underlineAction-&gt;plug(bar);
00515             
00516     m_alignLeftAction = <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Left"</font>), ICON_EDIT_LEFT,0, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h12">slotAlignLeft</a>()),bar);
00517     m_alignLeftAction-&gt;plug(bar);
00518     m_alignCenterAction = <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Center"</font>), ICON_EDIT_CENTER,0, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h11">slotAlignCenter</a>()),bar);
00519     m_alignCenterAction-&gt;plug(bar);
00520     m_alignRightAction = <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Right"</font>), ICON_EDIT_RIGHT,0, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h10">slotAlignRight</a>()),bar);
00521     m_alignRightAction-&gt;plug(bar);
00522     m_alignJustifyAction = <font class="keyword">new</font> KToggleAction(i18n(<font class="stringliteral">"Justify"</font>), ICON_EDIT_JUST,0, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_h_t_m_l_widget.html#h13">slotAlignJustify</a>()),bar);
00523     m_alignJustifyAction-&gt;plug(bar);
00524 }
00525 
<a name="l00527"></a><a class="code" href="class_c_h_t_m_l_widget.html#h0">00527</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h0">CHTMLWidget::slotSaveDocument</a>(){
00528     emit sigSaveDocument(text());
00529 }
00530 
<a name="l00532"></a><a class="code" href="class_c_h_t_m_l_widget.html#h1">00532</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h1">CHTMLWidget::slotToggleBold</a>(){
00533     <a class="code" href="class_q_text_edit.html#g10">QTextEdit::setBold</a>( !<a class="code" href="class_q_text_edit.html#a5">bold</a>() );
00534     m_boldAction-&gt;setChecked(<a class="code" href="class_q_text_edit.html#a5">bold</a>());   
00535 }
00536 
<a name="l00538"></a><a class="code" href="class_c_h_t_m_l_widget.html#h2">00538</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h2">CHTMLWidget::slotToggleItalic</a>(){
00539     <a class="code" href="class_q_text_edit.html#g9">QTextEdit::setItalic</a>(!<a class="code" href="class_q_text_edit.html#a4">italic</a>() );
00540     m_italicAction-&gt;setChecked(<a class="code" href="class_q_text_edit.html#a4">italic</a>());   
00541 }
00542 
<a name="l00544"></a><a class="code" href="class_c_h_t_m_l_widget.html#h3">00544</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h3">CHTMLWidget::slotToggleUnderline</a>(){
00545     <a class="code" href="class_q_text_edit.html#g11">QTextEdit::setUnderline</a>( !<a class="code" href="class_q_text_edit.html#a6">underline</a>() );
00546     m_underlineAction-&gt;setChecked(<a class="code" href="class_q_text_edit.html#a6">underline</a>());     
00547 }
00548 
<a name="l00550"></a><a class="code" href="class_c_h_t_m_l_widget.html#h5">00550</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h5">CHTMLWidget::slotSetCurrentFontSize</a>( <font class="keywordtype">int</font> size ){
00551     <font class="keywordflow">if</font> (size &gt; 0)
00552         <a class="code" href="class_q_text_edit.html#g13">setPointSize</a>(size);
00553 }
00554 
00555 <font class="keywordtype">void</font> CHTMLWidget::slotSetCurrentFont(<font class="keyword">const</font> QString&amp; font) {
00556     QFont newFont(<a class="code" href="class_q_text_edit.html#a10">font</a>, <a class="code" href="class_q_text_edit.html#a8">pointSize</a>());
00557     newFont.setBold(<a class="code" href="class_q_text_edit.html#a5">bold</a>());
00558     newFont.setItalic(<a class="code" href="class_q_text_edit.html#a4">italic</a>());
00559     newFont.setUnderline(<a class="code" href="class_q_text_edit.html#a6">underline</a>());  
00560     
00561     <a class="code" href="class_q_text_edit.html#g15">setFont</a>( newFont );
00562 }
00563 
<a name="l00565"></a><a class="code" href="class_c_h_t_m_l_widget.html#h6">00565</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h6">CHTMLWidget::slotSetCurrentColor</a>( <font class="keyword">const</font> QColor&amp; color){
00566     <a class="code" href="class_q_text_edit.html#g14">setColor</a>(<a class="code" href="class_q_text_edit.html#a9">color</a>);
00567 }
00568 
<a name="l00570"></a><a class="code" href="class_c_h_t_m_l_widget.html#h8">00570</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h8">CHTMLWidget::slotCurrentFontChanged</a>( <font class="keyword">const</font> QFont&amp; f){
00571     m_fontAction-&gt;setFont( f.family() );    
00572     m_fontSizeAction-&gt;setFontSize( f.pointSize() ); 
00573 
00574     m_boldAction-&gt;setChecked( f.bold() );
00575     m_italicAction-&gt;setChecked( f.italic() );
00576     m_underlineAction-&gt;setChecked( f.underline() ); 
00577 }
00578 
<a name="l00580"></a><a class="code" href="class_c_h_t_m_l_widget.html#h7">00580</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h7">CHTMLWidget::slotCurrentColorChanged</a>( <font class="keyword">const</font> QColor&amp; c){
00581     m_colorChooser-&gt;setColor(c);
00582 }
00583 
<a name="l00585"></a><a class="code" href="class_c_h_t_m_l_widget.html#h9">00585</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h9">CHTMLWidget::slotCurrentAlignementChanged</a>(<font class="keywordtype">int</font> a){
00586     m_alignLeftAction-&gt;setChecked( (a == AlignLeft) || (a == Qt3::AlignAuto) );
00587     m_alignCenterAction-&gt;setChecked( a == AlignHCenter );
00588     m_alignRightAction-&gt;setChecked( a == AlignRight );
00589     m_alignJustifyAction-&gt;setChecked( a == Qt3::AlignJustify ); 
00590 }
00591 
<a name="l00593"></a><a class="code" href="class_c_h_t_m_l_widget.html#h12">00593</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h12">CHTMLWidget::slotAlignLeft</a>(){
00594     m_alignLeftAction-&gt;setChecked(<font class="keyword">true</font>);    
00595     m_alignCenterAction-&gt;setChecked(<font class="keyword">false</font>); 
00596     m_alignRightAction-&gt;setChecked(<font class="keyword">false</font>);  
00597     m_alignJustifyAction-&gt;setChecked(<font class="keyword">false</font>);        
00598         
00599     <a class="code" href="class_q_text_edit.html#g16">setAlignment</a>(AlignLeft);
00600 }
00601 
<a name="l00603"></a><a class="code" href="class_c_h_t_m_l_widget.html#h11">00603</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h11">CHTMLWidget::slotAlignCenter</a>(){
00604     m_alignLeftAction-&gt;setChecked(<font class="keyword">false</font>);   
00605     m_alignCenterAction-&gt;setChecked(<font class="keyword">true</font>);  
00606     m_alignRightAction-&gt;setChecked(<font class="keyword">false</font>);  
00607     m_alignJustifyAction-&gt;setChecked(<font class="keyword">false</font>);        
00608     
00609     <a class="code" href="class_q_text_edit.html#g16">setAlignment</a>(AlignHCenter);
00610 }
00611 
<a name="l00613"></a><a class="code" href="class_c_h_t_m_l_widget.html#h10">00613</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h10">CHTMLWidget::slotAlignRight</a>(){
00614     m_alignLeftAction-&gt;setChecked(<font class="keyword">false</font>);   
00615     m_alignCenterAction-&gt;setChecked(<font class="keyword">false</font>); 
00616     m_alignRightAction-&gt;setChecked(<font class="keyword">true</font>);   
00617     m_alignJustifyAction-&gt;setChecked(<font class="keyword">false</font>);        
00618         
00619     <a class="code" href="class_q_text_edit.html#g16">setAlignment</a>(AlignRight);
00620 }
00621 
<a name="l00623"></a><a class="code" href="class_c_h_t_m_l_widget.html#h13">00623</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h13">CHTMLWidget::slotAlignJustify</a>(){
00624     m_alignLeftAction-&gt;setChecked(<font class="keyword">false</font>);   
00625     m_alignCenterAction-&gt;setChecked(<font class="keyword">false</font>); 
00626     m_alignRightAction-&gt;setChecked(<font class="keyword">false</font>);  
00627     m_alignJustifyAction-&gt;setChecked(<font class="keyword">true</font>);     
00628         
00629     <a class="code" href="class_q_text_edit.html#g16">setAlignment</a>(Qt3::AlignJustify);
00630 }
00631 
<a name="l00633"></a><a class="code" href="class_c_h_t_m_l_widget.html#h14">00633</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#h14">CHTMLWidget::slotSelectAll</a>(){
00634     selectAll(<font class="keyword">false</font>);<font class="comment">//workaround</font>
00635     selectAll(<font class="keyword">true</font>);
00636 }
00637 
<a name="l00639"></a><a class="code" href="class_c_h_t_m_l_widget.html#b9">00639</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_h_t_m_l_widget.html#b9">CHTMLWidget::linksEnabled</a>()<font class="keyword"> const </font>{
00640     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00641 }
00642 
<a name="l00644"></a><a class="code" href="class_c_h_t_m_l_widget.html#c0">00644</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#c0">CHTMLWidget::emitLinkClicked</a>( <font class="keyword">const</font> QString&amp; link){
00645     <font class="keywordflow">if</font> (link.left(7) == QString::fromLatin1(<font class="stringliteral">"mailto:"</font>)) {
00646         qDebug(<font class="stringliteral">"open mailer for %s"</font>, link.mid(7).latin1());
00647         KApplication::kApplication()-&gt;invokeMailer(link.mid(7), QString::null);
00648         <font class="keywordflow">return</font>;
00649     }
00650     
00651     <font class="keywordflow">if</font> (<a class="code" href="class_c_reference_manager.html#d4">CReferenceManager::isHyperlink</a>(link)) {
00652         QString ref;
00653         QString module;
00654         CReferenceManager::Type type;           
00655         <a class="code" href="class_c_reference_manager.html#d0">CReferenceManager::decodeHyperlink</a>(link, module, ref, type);
00656         <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);
00657         <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key = <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(m);
00658         <font class="keywordflow">if</font> (key) {
00659             emit <a class="code" href="class_c_h_t_m_l_widget.html#j2">referenceClicked</a>(module, key-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(ref));
00660             <font class="keyword">delete</font> key;         
00661         }
00662     }
00663     <font class="keywordflow">else</font> {
00664         QString url = link;
00665         <font class="keywordflow">if</font> (link.left(1) == <font class="stringliteral">"/"</font>)
00666             url = link.mid(1);
00667         emit linkClicked(url);
00668     }
00669 }
00670 
<a name="l00672"></a><a class="code" href="class_c_h_t_m_l_widget.html#g2">00672</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#g2">CHTMLWidget::copyDocument</a>(){
00673     <font class="keywordflow">if</font> (!document()-&gt;text().isEmpty()) {
00674         QClipboard* cb = KApplication::clipboard();         
00675         cb-&gt;setText(document()-&gt;plainText());
00676     }   
00677 }
00678 
<a name="l00680"></a><a class="code" href="class_c_h_t_m_l_widget.html#g3">00680</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#g3">CHTMLWidget::setSource</a>(<font class="keyword">const</font> QString&amp; name){
00681     qWarning(name.latin1());    
00682     <font class="keywordflow">if</font> ( isVisible() )
00683         qApp-&gt;setOverrideCursor( waitCursor );
00684     QString source = name;
00685     QString mark;
00686     <font class="keywordtype">int</font> hash = name.find(<font class="charliteral">'#'</font>);
00687     <font class="keywordflow">if</font> ( hash != -1) {
00688         source  = name.left( hash );
00689         mark = name.mid( hash+1 );
00690     }
00691     <font class="keywordflow">if</font> ( source.left(5) == <font class="stringliteral">"file:"</font> )
00692         source = source.mid(6);
00693 
00694     QString url = mimeSourceFactory()-&gt;makeAbsolute( source, context() );
00695     qWarning(url.latin1());
00696     QString txt;
00697     <font class="keywordtype">bool</font> dosettext = <font class="keyword">false</font>;
00698 
00699     <font class="keywordflow">if</font> ( !source.isEmpty()<font class="comment">/* &amp;&amp; url != d-&gt;curmain */</font>) {
00700         <font class="keyword">const</font> QMimeSource* m = mimeSourceFactory()-&gt;data( source, context() );
00701         <font class="keywordflow">if</font> ( !m )
00702             qWarning(<font class="stringliteral">"CHTMLWidget: no mimesource for %s"</font>, source.latin1() );
00703         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( !QTextDrag::decode( m, txt ) )
00704             qWarning(<font class="stringliteral">"CHTMLWidget: cannot decode %s"</font>, source.latin1() );
00705         dosettext = <font class="keyword">true</font>;
00706     }   
00707     <font class="keywordflow">if</font> ( !mark.isEmpty() ) {
00708         url += <font class="stringliteral">"#"</font>;
00709         url += mark;
00710     }   
00711     <font class="keywordflow">if</font> ( dosettext )
00712         setText( txt, url );
00713 
00714     <font class="keywordflow">if</font> ( isVisible() &amp;&amp; !mark.isEmpty() )
00715         scrollToAnchor( mark );
00716     <font class="keywordflow">else</font>
00717         setContentsPos( 0, 0 ); 
00718     <font class="keywordflow">if</font> ( isVisible() )
00719         qApp-&gt;restoreOverrideCursor();
00720 }
00721 
<a name="l00723"></a><a class="code" href="class_c_h_t_m_l_widget.html#c1">00723</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#c1">CHTMLWidget::emitHighlighted</a>( <font class="keyword">const</font> QString&amp; s ){
00724 <font class="comment">//  qWarning("%s was highlighted at %i|%i", s.latin1(), m_hoverPos.x(), m_hoverPos.y());</font>
00725 
00726 }
00727 
<a name="l00729"></a><a class="code" href="class_c_h_t_m_l_widget.html#a10">00729</a> Qt3::QTextDocument* <a class="code" href="class_c_h_t_m_l_widget.html#a10">CHTMLWidget::getDocument</a>()<font class="keyword"> const</font>{
00730     <font class="keywordflow">return</font> QTextEdit::document();
00731 }
00732 
<a name="l00734"></a><a class="code" href="class_c_h_t_m_l_widget.html#a11">00734</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a11">CHTMLWidget::placeCursor</a>( <font class="keyword">const</font> QPoint &amp;pos, Qt3::QTextCursor *c ){
00735     <a class="code" href="class_q_text_edit.html#b2">QTextEdit::placeCursor</a>(pos, c);
00736 }
00737 
<a name="l00739"></a><a class="code" href="class_c_h_t_m_l_widget.html#a13">00739</a> ListCSwordModuleInfo&amp; <a class="code" href="class_c_h_t_m_l_widget.html#a13">CHTMLWidget::modules</a>()<font class="keyword"> const </font>{
00740     <font class="keywordflow">if</font> (m_moduleList)
00741         <font class="keywordflow">return</font> *m_moduleList;
00742 }
00743 
<a name="l00745"></a><a class="code" href="class_c_h_t_m_l_widget.html#a12">00745</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_widget.html#a12">CHTMLWidget::setModules</a>( ListCSwordModuleInfo&amp; modules ) {
00746     *m_moduleList = <a class="code" href="class_c_h_t_m_l_widget.html#a13">modules</a>; <font class="comment">//copy entries</font>
00747     <font class="comment">//add data path of all modules tom our config</font>
00748     <font class="keywordflow">for</font> (m_moduleList-&gt;first(); m_moduleList-&gt;current(); m_moduleList-&gt;next()) {
00749         <font class="keyword">const</font> QString path = m_moduleList-&gt;current()-&gt;config(CSwordModuleInfo::AbsoluteDataPath);
00750 <font class="comment">//      qWarning("ADDED PATH: %s", path.latin1());</font>
00751         mimeSourceFactory()-&gt;addFilePath( path );
00752 <font class="comment">//      path += "/";</font>
00753 <font class="comment">//      mimeSourceFactory()-&gt;addFilePath( path );       </font>
00754 <font class="comment">//      path += "anfang9/";</font>
00755 <font class="comment">//      mimeSourceFactory()-&gt;addFilePath( path );       </font>
00756         
00757     };
00758 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
