<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cprinter.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cprinter.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cprinter.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sat Aug 5 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cprinter.h"</font>
00019 <font class="preprocessor">#include "cprintitem.h"</font>
00020 <font class="preprocessor">#include "cprintdialogpages.h"</font>
00021 
00022 <font class="preprocessor">#include "backend/cswordbackend.h"</font>
00023 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00024 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00025 
00026 <font class="comment">//KDE includes</font>
00027 <font class="preprocessor">#include &lt;kconfig.h&gt;</font>
00028 <font class="preprocessor">#include &lt;kprocess.h&gt;</font>
00029 <font class="preprocessor">#include &lt;kconfigbase.h&gt;</font>
00030 <font class="preprocessor">#include &lt;kstandarddirs.h&gt;</font>
00031 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00032 <font class="preprocessor">#include &lt;kapplication.h&gt;</font>
00033 
00034 <font class="comment">//Qt includes</font>
00035 <font class="preprocessor">#include &lt;qfile.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qdir.h&gt;</font>
00037 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00038 <font class="preprocessor">#include &lt;qpainter.h&gt;</font>
00039 <font class="preprocessor">#include &lt;qpaintdevice.h&gt;</font>
00040 <font class="preprocessor">#include &lt;qpaintdevicemetrics.h&gt;</font>
00041 
00042 
00043 CPrinter::CPrinter( QObject* parent ) : QObject(parent) {
00044   m_styleData.standardStyle = QString::fromLatin1(\
00045 <font class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE DOC &gt;&lt;BibleTimePrintingStyle syntaxVersion=\"1\" name=\"%1\"&gt;\</font>
00046 <font class="stringliteral"> &lt;HEADER alignment=\"0\" enabled=\"1\" &gt;\</font>
00047 <font class="stringliteral">  &lt;COLORS bgcolor=\"#ffffff\" fgcolor=\"#000000\" /&gt;\</font>
00048 <font class="stringliteral">  &lt;FONT family=\"\" weight=\"75\" pointsize=\"12\" italic=\"0\" /&gt;\</font>
00049 <font class="stringliteral">  &lt;FRAME enabled=\"0\" /&gt;\</font>
00050 <font class="stringliteral"> &lt;/HEADER&gt;\</font>
00051 <font class="stringliteral"> &lt;DESCRIPTION alignment=\"0\" enabled=\"1\" &gt;\</font>
00052 <font class="stringliteral">  &lt;COLORS bgcolor=\"#ffffff\" fgcolor=\"#000000\" /&gt;\</font>
00053 <font class="stringliteral">  &lt;FONT family=\"\" weight=\"50\" pointsize=\"10\" italic=\"0\" /&gt;\</font>
00054 <font class="stringliteral">  &lt;FRAME enabled=\"0\" /&gt;\</font>
00055 <font class="stringliteral"> &lt;/DESCRIPTION&gt;\</font>
00056 <font class="stringliteral"> &lt;MODULETEXT alignment=\"0\" enabled=\"1\" &gt;\</font>
00057 <font class="stringliteral">  &lt;COLORS bgcolor=\"#ffffff\" fgcolor=\"#000000\" /&gt; \</font>
00058 <font class="stringliteral">  &lt;FONT family=\"\" weight=\"50\" pointsize=\"10\" italic=\"0\" /&gt;\</font>
00059 <font class="stringliteral">  &lt;FRAME enabled=\"0\" /&gt;\</font>
00060 <font class="stringliteral"> &lt;/MODULETEXT&gt;\</font>
00061 <font class="stringliteral">&lt;/BibleTimePrintingStyle&gt;"</font>).arg(i18n(<font class="stringliteral">"Standard"</font>));
00062 
00063   m_styleData.bwStyle = QString::fromLatin1(\
00064 <font class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!DOCTYPE DOC &gt;&lt;BibleTimePrintingStyle syntaxVersion=\"1\" name=\"%1\" &gt;\</font>
00065 <font class="stringliteral"> &lt;HEADER alignment=\"1\" enabled=\"1\" &gt;\</font>
00066 <font class="stringliteral">  &lt;COLORS bgcolor=\"#ffffff\" fgcolor=\"#000000\" /&gt;\</font>
00067 <font class="stringliteral">  &lt;FONT family=\"\" weight=\"75\" pointsize=\"12\" italic=\"0\" /&gt;\</font>
00068 <font class="stringliteral">  &lt;FRAME thickness=\"1\" style=\"1\" color=\"#000000\" enabled=\"1\" /&gt;\</font>
00069 <font class="stringliteral"> &lt;/HEADER&gt;\</font>
00070 <font class="stringliteral"> &lt;DESCRIPTION alignment=\"1\" enabled=\"1\" &gt;\</font>
00071 <font class="stringliteral">  &lt;COLORS bgcolor=\"#ffffff\" fgcolor=\"#000000\" /&gt;\</font>
00072 <font class="stringliteral">  &lt;FONT family=\"\" weight=\"50\" pointsize=\"10\" italic=\"1\" /&gt;\</font>
00073 <font class="stringliteral">  &lt;FRAME enabled=\"0\" /&gt;\</font>
00074 <font class="stringliteral"> &lt;/DESCRIPTION&gt;\</font>
00075 <font class="stringliteral"> &lt;MODULETEXT alignment=\"0\" enabled=\"1\" &gt;\</font>
00076 <font class="stringliteral">  &lt;COLORS bgcolor=\"#ffffff\" fgcolor=\"#000000\" /&gt;\</font>
00077 <font class="stringliteral">  &lt;FONT family=\"\" weight=\"50\" pointsize=\"10\" italic=\"0\" /&gt;\</font>
00078 <font class="stringliteral">  &lt;FRAME thickness=\"1\" style=\"1\" color=\"#000000\" enabled=\"1\" /&gt;\</font>
00079 <font class="stringliteral"> &lt;/MODULETEXT&gt;\</font>
00080 <font class="stringliteral">&lt;/BibleTimePrintingStyle&gt;"</font>).arg(i18n(<font class="stringliteral">"Black&amp;amp;White for larger text portions"</font>));
00081 
00082 
00083     m_config = <font class="keyword">new</font> KConfig(<font class="stringliteral">"bt-printing"</font>, <font class="keyword">false</font>, <font class="keyword">true</font> );
00084 
00085     m_queue.setAutoDelete(<font class="keyword">true</font>);            
00086     m_styleList.setAutoDelete(<font class="keyword">true</font>);        
00087     m_cachedPage.initialized = <font class="keyword">false</font>;
00088     m_cachedPage.refresh = <font class="keyword">false</font>;   
00089     m_addedItem = <font class="keyword">false</font>;
00090     
00091     {
00092         KConfigGroupSaver gs(m_config, <font class="stringliteral">"Options"</font>);  
00093         QMap&lt;QString, QString&gt; map = m_config-&gt;entryMap(<font class="stringliteral">"Options"</font>);
00094         setOptions(map);
00095     }
00096     
00097     m_styleDir = <font class="stringliteral">"printing/"</font>;
00098     KStandardDirs stdDirs;
00099     m_styleSaveLocation = stdDirs.saveLocation(<font class="stringliteral">"data"</font>, <font class="stringliteral">"bibletime/"</font>+m_styleDir);        
00100     
00101     readSettings();
00102     setupStyles();
00103     setupStandardStyle();       
00104 }
00105 
00106 CPrinter::~CPrinter(){
00107     saveSettings();
00108     saveStyles();   
00109     m_config-&gt;sync();
00110             
00111     <font class="keyword">delete</font> m_config;
00112 }
00113 
00115 <font class="keyword">const</font> <font class="keywordtype">bool</font> CPrinter::newPage(){
00116     <font class="keywordflow">if</font> (aborted()) {
00117         qWarning(<font class="stringliteral">"CPrinter::newPage: Printing was aborted!"</font>);
00118         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00119     }
00120     <font class="keyword">const</font> <font class="keywordtype">bool</font> result = KPrinter::newPage();
00121     <font class="keywordflow">if</font> (result) {
00122         m_pagePosition.curPage++;
00123         m_pagePosition.rect = contentSize();            
00124         setVerticalPos(pageMargins().top);
00125     }
00126     <font class="keywordflow">return</font> result;
00127 }
00128 
00130 <font class="keywordtype">void</font> CPrinter::setAllMargins( <font class="keyword">const</font> CPageMargin margins ) {
00131     m_cachedPage.refresh = <font class="keyword">true</font>;    
00132     m_pageMargin = margins;
00133 }
00134 
00136 <font class="keyword">const</font> CPrinter::CPageMargin&amp; CPrinter::pageMargins()<font class="keyword"> const </font>{
00137     <font class="keywordflow">return</font> m_pageMargin;
00138 }
00139 
00141 <font class="keywordtype">void</font> CPrinter::setup( QWidget* parent ){
00142     KPrinter::addDialogPage( <font class="keyword">new</font> <a class="code" href="class_c_print_item_list_page.html">CPrintItemListPage</a>(<font class="keyword">this</font>) );
00143     KPrinter::addDialogPage( <font class="keyword">new</font> <a class="code" href="class_c_style_list_page.html">CStyleListPage</a>(<font class="keyword">this</font>) );
00144 
00145     <font class="keywordflow">if</font> ( KPrinter::setup(parent) ) {
00146         saveSettings();
00147         readSettings();
00148         print();
00149     }
00150 }
00151 
00153 <font class="keywordtype">void</font> CPrinter::print(){
00154     emit printingStarted();
00155     QPainter p;
00156     <font class="keywordflow">if</font> (!p.begin(<font class="keyword">this</font>)) {
00157         p.end();
00158         <font class="keywordflow">return</font>;
00159     }   
00160     <font class="keywordtype">int</font> lastPercent = 0;
00161     <font class="keywordtype">int</font> pos = 1;
00162     <font class="keyword">const</font> <font class="keywordtype">int</font> count = m_queue.count();
00163     <font class="keyword">const</font> <font class="keywordtype">int</font> copies = numCopies();
00164     <font class="keywordtype">float</font> copyFrac;
00165     emit percentCompleted(0);
00166     
00167     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> copy = 0; copy &lt; copies &amp;&amp; !aborted(); copy++) {   <font class="comment">//make numCopies() copies of the pages</font>
00168         copyFrac = (float(copies))/ (float)(copy+1);
00169         <font class="keywordflow">for</font> (m_queue.first(), pos = 1; m_queue.current(); m_queue.next(), ++pos) {
00170             KApplication::kApplication()-&gt;processEvents(5); <font class="comment">//do not lock the GUI!</font>
00171             <font class="keywordflow">if</font> (!aborted()) {
00172                 m_queue.current()-&gt;draw(&amp;p,<font class="keyword">this</font>);               
00173                 <font class="keywordflow">if</font> ((int)((float)pos / (float)count *(float)100 * copyFrac) &gt; lastPercent)
00174                     emit percentCompleted(++lastPercent);
00175             }
00176         };
00177         <font class="keywordflow">if</font> (!aborted() &amp;&amp; (copy+1 &lt; copies) )
00178             newPage();  <font class="comment">//new pages seperate copies</font>
00179     }
00180     emit printingFinished();    
00181     clearQueue();<font class="comment">//delete all items</font>
00182 }
00183 
00185 <font class="keywordtype">void</font> CPrinter::appendItems( ListCPrintItem&amp; items ){
00186     <font class="keywordflow">for</font>(items.first(); items.current(); items.next()) {
00187         items.current()-&gt;setStyle(m_standardStyle);
00188         m_queue.append(items.current());
00189     }
00190     <font class="keywordflow">if</font> (items.count() &amp;&amp; !m_addedItem) {
00191         m_addedItem = <font class="keyword">true</font>;
00192         emit addedFirstQueueItem(); 
00193     }
00194 }
00195 
00197 <font class="keywordtype">void</font> CPrinter::clearQueue(){
00198     m_queue.clear();
00199     m_addedItem = <font class="keyword">false</font>;<font class="comment">//queue is empty    </font>
00200     emit queueCleared();    
00201 }
00202 
00204 ListCPrintItem&amp; CPrinter::printQueue() {
00205     <font class="keywordflow">return</font> m_queue;
00206 }
00207 
00209 <font class="keywordtype">void</font> CPrinter::setPrintQueue( ListCPrintItem&amp; queue ){
00210     clearQueue();
00211     m_queue = queue; <font class="comment">//copy items</font>
00212 }
00213 
00215 <font class="keywordtype">void</font> CPrinter::appendItem(<a class="code" href="class_c_print_item.html">CPrintItem</a>* newItem){
00216     <font class="keywordflow">if</font> (!newItem)
00217         <font class="keywordflow">return</font>;
00218     newItem-&gt;<a class="code" href="class_c_print_item.html#a1">setStyle</a>(m_standardStyle);
00219     m_queue.append(newItem);
00220 
00221     <font class="keywordflow">if</font> (!m_addedItem) {
00222         m_addedItem = <font class="keyword">true</font>;
00223         emit addedFirstQueueItem();
00224     }
00225 }
00226 
00228 <font class="keywordtype">void</font> CPrinter::setupStyles(){   
00229 <font class="comment">//load local styles </font>
00230     QDir d( m_styleSaveLocation );
00231     QStringList files = d.entryList(<font class="stringliteral">"*.xml"</font>);
00232   CStyle* style = 0;
00233     <font class="keywordflow">for</font> ( QStringList::Iterator it = files.begin(); it != files.end(); ++it ) {
00234         m_styleList.append( style = <font class="keyword">new</font> CStyle() ); <font class="comment">//automatically load from file      </font>
00235     style-&gt;loadFromFile(m_styleSaveLocation + *it);
00236     }
00237     
00238 <font class="comment">//load styles included in this source file!</font>
00239   <font class="keywordflow">if</font> (CStyle* newStyle = <font class="keyword">new</font> CStyle(m_styleData.standardStyle)) {
00240         <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;             
00241         <font class="keywordflow">for</font>(m_styleList.first(); m_styleList.current() &amp;&amp; !found; m_styleList.next()) {
00242             <font class="keywordflow">if</font> (newStyle-&gt;styleName() == m_styleList.current()-&gt;styleName()) {
00243                 found = <font class="keyword">true</font>;
00244             }
00245         }       
00246                 
00247         <font class="keywordflow">if</font> (!found) {
00248             m_styleList.append( newStyle );
00249         }
00250      <font class="keywordflow">else</font> {
00251        <font class="keyword">delete</font> newStyle;
00252      };
00253   };
00254 
00255   <font class="keywordflow">if</font> (CStyle* newStyle = <font class="keyword">new</font> CStyle(m_styleData.bwStyle)) {
00256         <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;             
00257         <font class="keywordflow">for</font>(m_styleList.first(); m_styleList.current() &amp;&amp; !found; m_styleList.next()) {
00258             <font class="keywordflow">if</font> (newStyle-&gt;styleName() == m_styleList.current()-&gt;styleName()) {
00259                 found = <font class="keyword">true</font>;
00260             }
00261         }       
00262                 
00263         <font class="keywordflow">if</font> (!found) {
00264             m_styleList.append( newStyle );
00265         }
00266      <font class="keywordflow">else</font> {
00267        <font class="keyword">delete</font> newStyle;
00268      };
00269   };
00270 
00271 
00272 <font class="comment">//load systemwide styles, probably standard styles installed by BibleTime</font>
00273     KStandardDirs stdDirs;
00274     QStringList globalPaths = stdDirs.findDirs(<font class="stringliteral">"data"</font>, <font class="stringliteral">"bibletime/"</font>+m_styleDir);
00275     <font class="keywordflow">if</font> (globalPaths.count()) { <font class="comment">//try to find some new global styles </font>
00276         <font class="keywordflow">for</font> (QStringList::Iterator path = globalPaths.begin(); path!=globalPaths.end(); ++path) {
00277             d = QDir( *path );
00278             QStringList files = d.entryList(<font class="stringliteral">"*.xml"</font>);
00279             <font class="keywordflow">for</font> ( QStringList::Iterator it = files.begin(); it != files.end(); ++it ) {
00280                 CStyle* newStyle = <font class="keyword">new</font> CStyle();
00281         newStyle-&gt;loadFromFile(*path + *it);
00282                 
00283                 <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;             
00284                 <font class="keywordflow">for</font>(m_styleList.first(); m_styleList.current() &amp;&amp; !found; m_styleList.next()) {
00285                     <font class="keywordflow">if</font> (newStyle-&gt;styleName() == m_styleList.current()-&gt;styleName()) {
00286                         found = <font class="keyword">true</font>;
00287                     }
00288                 }       
00289                 
00290                 <font class="keywordflow">if</font> (!found) {
00291                     m_styleList.append( newStyle );
00292                 }
00293         <font class="keywordflow">else</font> {
00294           <font class="keyword">delete</font> newStyle;
00295         };
00296             }       
00297         }
00298     }
00299 }
00300 
00302 <font class="keywordtype">void</font> CPrinter::saveStyles(){
00303     QDir d(m_styleSaveLocation);    
00304     QStringList files = d.entryList(<font class="stringliteral">"*.xml"</font>);
00305     <font class="keywordflow">for</font> ( QStringList::Iterator it = files.begin(); it != files.end(); ++it ) {
00306         d.remove(*it);
00307     }
00308     
00309     <font class="keywordflow">for</font> (m_styleList.first(); m_styleList.current(); m_styleList.next()) {
00310         m_styleList.current()-&gt;saveToFile(  m_styleSaveLocation + QString::fromLatin1(<font class="stringliteral">"printing-style-%1"</font>).arg(m_styleList.at()) + <font class="stringliteral">".xml"</font> );
00311     }
00312 }
00313 
00315 <font class="keywordtype">void</font> CPrinter::readSettings(){
00316     KConfigGroupSaver gs(m_config, <font class="stringliteral">"Settings"</font>);
00317     <font class="keyword">const</font> QString leading = <font class="stringliteral">"kde-bibletime-"</font>;
00318         
00319     setFullPage(<font class="keyword">true</font>);
00320     m_pagePosition.curPage = 1;
00321     m_pagePosition.rect = contentSize();
00322 
00323     QPaintDeviceMetrics m(<font class="keyword">this</font>);
00324     <font class="keyword">const</font> <font class="keywordtype">float</font> r = static_cast&lt;float&gt;(m.width()) / m.widthMM();        
00325     m_pageMargin.left   = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Left margin"</font>, 15));
00326     setOption(leading+<font class="stringliteral">"left_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Left margin"</font>, 15)));
00327     
00328     m_pageMargin.right  = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Right margin"</font>, 15));
00329     setOption(leading+<font class="stringliteral">"right_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Right margin"</font>, 15)));
00330         
00331     m_pageMargin.top        = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Top margin"</font>, 15));
00332     setOption(leading+<font class="stringliteral">"upper_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Top margin"</font>, 15)));
00333         
00334     m_pageMargin.bottom = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Bottom margin"</font>, 15));
00335     setOption(leading+<font class="stringliteral">"lower_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Bottom margin"</font>, 15)));        
00336     
00337     m_cachedPage.refresh = <font class="keyword">true</font>;    
00338 }
00339 
00341 <font class="keywordtype">void</font> CPrinter::saveSettings(){  
00342     <font class="keyword">const</font> QString leading = <font class="stringliteral">"kde-bibletime-"</font>;
00343     KConfigGroupSaver gs(m_config, <font class="stringliteral">"Settings"</font>);
00344     m_config-&gt;writeEntry(<font class="stringliteral">"Left margin"</font>, option(leading+<font class="stringliteral">"left_margin"</font>).toInt());
00345     m_config-&gt;writeEntry(<font class="stringliteral">"Right margin"</font>, option(leading+<font class="stringliteral">"right_margin"</font>).toInt());
00346     m_config-&gt;writeEntry(<font class="stringliteral">"Top margin"</font>, option(leading+<font class="stringliteral">"upper_margin"</font>).toInt());
00347     m_config-&gt;writeEntry(<font class="stringliteral">"Bottom margin"</font>, option(leading+<font class="stringliteral">"lower_margin"</font>).toInt());
00348 }
00349 
00351 StyleItemList&amp; CPrinter::styleList() {
00352     <font class="keywordflow">return</font> m_styleList;
00353 }
00354 
00356 <font class="keywordtype">void</font> CPrinter::setStyleList( StyleItemList&amp; list){
00357     m_styleList = list; <font class="comment">//copy items</font>
00358 }
00359 
00361 <font class="keyword">const</font> QRect CPrinter::contentSize() {
00362   <font class="keywordflow">if</font>    (   m_cachedPage.refresh || !m_cachedPage.initialized || (m_cachedPage.initialized &amp;&amp; (m_cachedPage.cachedPaper != pageSize())) )
00363   { <font class="comment">//refresh page size info</font>
00364         m_cachedPage.initialized = <font class="keyword">true</font>;
00365         m_cachedPage.refresh = <font class="keyword">false</font>;
00366         m_cachedPage.cachedPaper = pageSize();      
00367         
00368       QPaintDeviceMetrics metric( <font class="keyword">this</font> ); <font class="comment">//note that metric's width and height span the whole page             </font>
00369       m_cachedPage.size.setLeft( m_pageMargin.left );
00370       m_cachedPage.size.setTop( m_pageMargin.top );
00371       m_cachedPage.size.setRight( metric.width() -  m_pageMargin.right );
00372       m_cachedPage.size.setBottom( metric.height() <font class="comment">/*- m_pageMargin.top*/</font> - m_pageMargin.bottom );
00373     }
00374   <font class="keywordflow">return</font> m_cachedPage.size;
00375 }
00376 
00378 KConfig* <font class="keyword">const</font> CPrinter::config()<font class="keyword"> const </font>{
00379     <font class="keywordflow">return</font> m_config;    
00380 }
00381 
00383 <font class="keywordtype">void</font> CPrinter::setupStandardStyle(){
00384     <font class="comment">//see if m_items contains standard style</font>
00385     <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;
00386     <font class="keywordflow">for</font> (m_styleList.first(); m_styleList.current(); m_styleList.next()) {
00387         <font class="keywordflow">if</font> (m_styleList.current()-&gt;styleName() == i18n(<font class="stringliteral">"Standard"</font>)) {   <font class="comment">//found the style</font>
00388             found = <font class="keyword">true</font>;
00389             m_standardStyle = m_styleList.current();
00390             <font class="keywordflow">break</font>;
00391         }
00392     }
00393         
00394     <font class="keywordflow">if</font> (!found) {
00395         m_standardStyle = <font class="keyword">new</font> CStyle();     
00396         m_standardStyle-&gt;setStyleName(i18n(<font class="stringliteral">"Standard"</font>));        
00397         m_styleList.append( m_standardStyle );
00398     }
00399 }
00400 
00402 <font class="keyword">const</font> <font class="keywordtype">int</font> CPrinter::verticalPos()<font class="keyword"> const </font>{
00403     <font class="keywordflow">return</font> m_pagePosition.rect.y();
00404 }
00405 
00407 <font class="keywordtype">void</font> CPrinter::setVerticalPos( <font class="keyword">const</font> <font class="keywordtype">int</font> yPos ){
00408     m_pagePosition.rect.setY(yPos);
00409 }
00410 
00412 <font class="keywordtype">void</font> CPrinter::emitStylesChanged(){
00413     emit sigStylesChanged();
00414 }
00415 
00417 CStyle* <font class="keyword">const</font> CPrinter::standardStyle()<font class="keyword"> const </font>{
00418     <font class="keywordflow">return</font> m_standardStyle;
00419 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:09 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
