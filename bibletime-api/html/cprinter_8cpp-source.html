<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cprinter.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cprinter.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cprinter.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sat Aug 5 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cprinter.h"</font>
00019 <font class="preprocessor">#include "cprintitem.h"</font>
00020 <font class="preprocessor">#include "cstyleformat.h"</font>
00021 <font class="preprocessor">#include "cstyleformatframe.h"</font>
00022 <font class="preprocessor">#include "cprintdialogpages.h"</font>
00023 
00024 <font class="preprocessor">#include "../backend/cswordbackend.h"</font>
00025 <font class="preprocessor">#include "../backend/cswordversekey.h"</font>
00026 <font class="preprocessor">#include "../backend/cswordldkey.h"</font>
00027 
00028 <font class="comment">//KDE includes</font>
00029 <font class="preprocessor">#include &lt;kconfig.h&gt;</font>
00030 <font class="preprocessor">#include &lt;kprocess.h&gt;</font>
00031 <font class="preprocessor">#include &lt;kconfigbase.h&gt;</font>
00032 <font class="preprocessor">#include &lt;krandomsequence.h&gt;</font>
00033 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00034 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00035 
00036 <font class="comment">//Qt includes</font>
00037 <font class="preprocessor">#include &lt;qfile.h&gt;</font>
00038 <font class="preprocessor">#include &lt;qstringlist.h&gt;</font>
00039 <font class="preprocessor">#include &lt;qpainter.h&gt;</font>
00040 <font class="preprocessor">#include &lt;qpaintdevice.h&gt;</font>
00041 <font class="preprocessor">#include &lt;qpaintdevicemetrics.h&gt;</font>
00042 
00043 CPrinter::CPrinter( QObject* parent ) : QObject(parent) {
00044     m_config = <font class="keyword">new</font> KConfig(<font class="stringliteral">"bt-printing"</font>, <font class="keyword">false</font>, <font class="keyword">true</font> );
00045 
00046     m_queue.setAutoDelete(<font class="keyword">true</font>);            
00047     m_styleList.setAutoDelete(<font class="keyword">true</font>);        
00048     m_cachedPage.initialized = <font class="keyword">false</font>;
00049     m_cachedPage.refresh = <font class="keyword">false</font>;   
00050     m_addedItem = <font class="keyword">false</font>;
00051     
00052     {
00053         KConfigGroupSaver gs(m_config, <font class="stringliteral">"Options"</font>);  
00054         QMap&lt;QString, QString&gt; map = m_config-&gt;entryMap(<font class="stringliteral">"Options"</font>);
00055         setOptions(map);
00056     }
00057     readSettings();
00058     setupStyles();
00059     setupStandardStyle();       
00060 }
00061 
00062 CPrinter::~CPrinter(){
00063     saveSettings();
00064     saveStyles();   
00065     m_config-&gt;sync();
00066             
00067     <font class="keyword">delete</font> m_config;
00068 }
00069 
00070 <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>&amp; CPrinter::rightMargin()<font class="keyword"> const </font>{
00071     <font class="keywordflow">return</font> m_pageMargin.right;
00072 }
00073 
00074 <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>&amp; CPrinter::leftMargin()<font class="keyword"> const </font>{
00075     <font class="keywordflow">return</font> m_pageMargin.left;
00076 }
00077 
00078 <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>&amp; CPrinter::upperMargin()<font class="keyword"> const </font>{
00079     <font class="keywordflow">return</font> m_pageMargin.top;
00080 }
00081 
00082 <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>&amp; CPrinter::lowerMargin()<font class="keyword"> const </font>{
00083     <font class="keywordflow">return</font> m_pageMargin.bottom;
00084 }
00085 
00087 <font class="keyword">const</font> <font class="keywordtype">bool</font> CPrinter::newPage(){
00088     <font class="keywordflow">if</font> (aborted()) {
00089         qWarning(<font class="stringliteral">"CPrinter::newPage: Printing was aborted!"</font>);
00090         <font class="keywordflow">return</font> <font class="keyword">false</font>;
00091     }
00092     <font class="keyword">const</font> <font class="keywordtype">bool</font> result = KPrinter::newPage();
00093     <font class="keywordflow">if</font> (result) {
00094         m_pagePosition.curPage++;
00095         m_pagePosition.rect = contentSize();            
00096     }
00097     <font class="keywordflow">return</font> result;
00098 }
00099 
00101 <font class="keywordtype">void</font> CPrinter::setAllMargins( <font class="keyword">const</font> CPageMargin margins ) {
00102     m_cachedPage.refresh = <font class="keyword">true</font>;    
00103     m_pageMargin = margins;
00104 }
00105 
00107 CPrinter::CPageMargin CPrinter::pageMargins(){
00108     <font class="keywordflow">return</font> m_pageMargin;
00109 }
00110 
00112 <font class="keywordtype">void</font> CPrinter::setup( QWidget* parent ){
00113     <a class="code" href="class_c_print_item_list_page.html">CPrintItemListPage</a>* printItemPage = <font class="keyword">new</font> <a class="code" href="class_c_print_item_list_page.html">CPrintItemListPage</a>(<font class="keyword">this</font>);
00114     KPrinter::addDialogPage(printItemPage);
00115 
00116     <a class="code" href="class_c_style_list_page.html">CStyleListPage</a>* stylePage = <font class="keyword">new</font> <a class="code" href="class_c_style_list_page.html">CStyleListPage</a>(<font class="keyword">this</font>);
00117     KPrinter::addDialogPage(stylePage);
00118 
00119     <font class="keywordflow">if</font> ( KPrinter::setup(parent) ) {
00120         saveSettings();
00121         readSettings();
00122         print();
00123     }
00124 }
00125 
00127 <font class="keywordtype">void</font> CPrinter::print(){
00128     emit printingStarted();
00129     QPainter p;
00130     <font class="keywordflow">if</font> (!p.begin(<font class="keyword">this</font>)) {
00131         p.end();
00132         <font class="keywordflow">return</font>;
00133     }   
00134     <font class="keywordtype">int</font> lastPercent = 0;
00135     <font class="keywordtype">int</font> percent = 0;
00136     <font class="keywordtype">int</font> pos = 1;
00137     <font class="keyword">const</font> <font class="keywordtype">int</font> count = m_queue.count();
00138     <font class="keyword">const</font> <font class="keywordtype">int</font> copies = numCopies();
00139     <font class="keywordtype">float</font> copyFrac;
00140     emit percentCompleted(0);
00141     
00142     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> copy = 0; copy &lt; copies &amp;&amp; !aborted(); copy++) {   <font class="comment">//make numCopies() copies of the pages</font>
00143         copyFrac = (float(copies))/ (float)(copy+1);
00144         <font class="keywordflow">for</font> (m_queue.first(), pos = 1; m_queue.current(); m_queue.next(), ++pos) {
00145             KApplication::kApplication()-&gt;processEvents(5); <font class="comment">//do not lock the GUI!</font>
00146             <font class="keywordflow">if</font> (!aborted()) {
00147                 m_queue.current()-&gt;draw(&amp;p,<font class="keyword">this</font>);               
00148                 <font class="keywordflow">if</font> ((int)((float)pos / (float)count *(float)100 * copyFrac) &gt; lastPercent)
00149                     emit percentCompleted(++lastPercent);
00150             }
00151         };
00152         <font class="keywordflow">if</font> (!aborted() &amp;&amp; (copy+1 &lt; copies) )
00153             newPage();  <font class="comment">//new pages seperate copies</font>
00154     }
00155     emit printingFinished();    
00156     clearQueue();<font class="comment">//delete all items</font>
00157 }
00158 
00160 <font class="keywordtype">void</font> CPrinter::appendItems( PrintItemList&amp; items ){
00161     <font class="keywordflow">for</font>(items.first(); items.current(); items.next()) {
00162         items.current()-&gt;setStyle(m_standardStyle);
00163         m_queue.append(items.current());
00164     }
00165     <font class="keywordflow">if</font> (items.count() &amp;&amp; !m_addedItem) {
00166         m_addedItem = <font class="keyword">true</font>;
00167         emit addedFirstQueueItem(); 
00168     }
00169 }
00170 
00172 <font class="keywordtype">void</font> CPrinter::clearQueue(){
00173     m_queue.clear();
00174     m_addedItem = <font class="keyword">false</font>;<font class="comment">//queue is empty    </font>
00175     emit queueCleared();    
00176 }
00177 
00179 PrintItemList&amp; CPrinter::printQueue() {
00180     <font class="keywordflow">return</font> m_queue;
00181 }
00182 
00184 <font class="keywordtype">void</font> CPrinter::setPrintQueue( PrintItemList&amp; queue ){
00185 <font class="comment">//  if (m_queue != queue) { //delete old queue</font>
00186         clearQueue();
00187 <font class="comment">//  }</font>
00188     m_queue = queue; <font class="comment">//copy items</font>
00189 }
00190 
00192 <font class="keywordtype">void</font> CPrinter::appendItem(<a class="code" href="class_c_print_item.html">CPrintItem</a>* newItem){
00193     <font class="keywordflow">if</font> (!newItem)
00194         <font class="keywordflow">return</font>;
00195     newItem-&gt;<a class="code" href="class_c_print_item.html#a1">setStyle</a>(m_standardStyle);
00196     m_queue.append(newItem);
00197 
00198     <font class="keywordflow">if</font> (!m_addedItem) {
00199         m_addedItem = <font class="keyword">true</font>;
00200         emit addedFirstQueueItem();
00201     }
00202 }
00203 
00205 <font class="keywordtype">void</font> CPrinter::setupStyles(){
00206     <font class="comment">// See function saveStyles for format of config file    </font>
00207     KConfigGroupSaver gs(m_config, <font class="stringliteral">"Styles"</font>);
00208     QStringList list = m_config-&gt;readListEntry(<font class="stringliteral">"styles"</font>);
00209     CStyle* dummyStyle = 0;
00210     
00211     <font class="keyword">const</font>   QString names[3] = { <font class="stringliteral">"HEADER"</font>, <font class="stringliteral">"DESCRIPTION"</font>, <font class="stringliteral">"MODULETEXT"</font> };
00212     <font class="keyword">const</font> CStyle::styleType formatTypes[3] = {
00213         CStyle::Header,
00214         CStyle::Description,
00215         CStyle::ModuleText
00216     };
00217                             
00218     
00219     <font class="keywordflow">for</font> ( QStringList::Iterator it = list.begin(); it != list.end(); ++it ) {
00220         dummyStyle = <font class="keyword">new</font> CStyle();
00221         <font class="keywordflow">if</font> (*it == <font class="stringliteral">"Standard"</font>)
00222             dummyStyle-&gt;setStyleName(i18n(<font class="stringliteral">"Standard"</font>));     
00223         <font class="keywordflow">else</font>
00224             dummyStyle-&gt;setStyleName(*it);
00225         
00226 
00227         <a class="code" href="class_c_style_format.html">CStyleFormat</a>* format[3] = {
00228             dummyStyle-&gt;formatForType( CStyle::Header ),
00229             dummyStyle-&gt;formatForType( CStyle::Description ),
00230             dummyStyle-&gt;formatForType( CStyle::ModuleText )
00231         };
00232             
00233         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> index = 0; index &lt; 3; index++) {
00234             m_config-&gt;setGroup(QString(<font class="stringliteral">"%1__%2"</font>).arg(*it).arg(names[index]));
00235             format[index]-&gt;<a class="code" href="class_c_style_format.html#a3">setColor</a>( CStyleFormat::Foreground, m_config-&gt;readColorEntry(<font class="stringliteral">"FGColor"</font>, &amp;Qt::black) );
00236             format[index]-&gt;<a class="code" href="class_c_style_format.html#a3">setColor</a>( CStyleFormat::Background, m_config-&gt;readColorEntry(<font class="stringliteral">"BGColor"</font>, &amp;Qt::white) );
00237             format[index]-&gt;<a class="code" href="class_c_style_format.html#a4">setFont</a>( m_config-&gt;readFontEntry(<font class="stringliteral">"Font"</font>) );
00238 <font class="comment">//          format[index]-&gt;setIdentation( m_config-&gt;readNumEntry("Identation",0) );</font>
00239             format[index]-&gt;<a class="code" href="class_c_style_format.html#a6">setAlignement</a>( (CStyleFormat::Alignement)m_config-&gt;readNumEntry(<font class="stringliteral">"Alignement"</font>,CStyleFormat::Left));
00240             dummyStyle-&gt;setFormatTypeEnabled( formatTypes[index], m_config-&gt;readBoolEntry(<font class="stringliteral">"isEnabled"</font>, <font class="keyword">true</font>) );
00241             <font class="keyword">const</font> <font class="keywordtype">bool</font> hasFrame = m_config-&gt;readBoolEntry( <font class="stringliteral">"has frame"</font>, <font class="keyword">false</font> );
00242             
00243             <a class="code" href="class_c_style_format_frame.html">CStyleFormatFrame</a>* frame = format[index]-&gt;<a class="code" href="class_c_style_format.html#a9">frame</a>();
00244             <font class="keywordflow">if</font> (frame) {
00245                 m_config-&gt;setGroup(QString(<font class="stringliteral">"%1__%2__FRAME"</font>).arg(*it).arg(names[index]));
00246                 frame-&gt;<a class="code" href="class_c_style_format_frame.html#a1">setColor</a>( m_config-&gt;readColorEntry(<font class="stringliteral">"Color"</font>, &amp;Qt::black) );
00247                 frame-&gt;<a class="code" href="class_c_style_format_frame.html#a5">setThickness</a>( m_config-&gt;readNumEntry(<font class="stringliteral">"Thickness"</font>, 1) );
00248                 frame-&gt;<a class="code" href="class_c_style_format_frame.html#a3">setLineStyle</a>( (Qt::PenStyle)(m_config-&gt;readNumEntry(<font class="stringliteral">"Line style"</font>, (<font class="keywordtype">int</font>)Qt::SolidLine)) );
00249             }
00250             format[index]-&gt;setFrame( hasFrame, frame);
00251         }       
00252         <font class="comment">//set settings for Header</font>
00253         m_styleList.append(dummyStyle);
00254     }
00255 }
00256 
00258 <font class="keywordtype">void</font> CPrinter::saveStyles(){
00273     <font class="comment">//save list of styles</font>
00274     {
00275         KConfigGroupSaver gs( m_config, <font class="stringliteral">"Styles"</font>);  
00276         QStringList strList;
00277 <font class="comment">//      ASSERT(m_styleList);</font>
00278         <font class="keywordflow">for</font> (m_styleList.first(); m_styleList.current(); m_styleList.next()) {
00279             strList.append(m_styleList.current()-&gt;styleName());
00280         }   
00281         m_config-&gt;writeEntry( <font class="stringliteral">"styles"</font>, strList);           
00282     }
00283 
00284     
00285     <font class="comment">//save settings for each style</font>
00286     <font class="keyword">const</font> QString names[3] = {<font class="stringliteral">"HEADER"</font>, <font class="stringliteral">"DESCRIPTION"</font>, <font class="stringliteral">"MODULETEXT"</font>};
00287     
00288     <font class="keywordflow">for</font> (m_styleList.first(); m_styleList.current(); m_styleList.next()) {
00289         m_config-&gt;setGroup(m_styleList.current()-&gt;styleName());
00290         CStyle* current = m_styleList.current();
00291                 
00292         <font class="keywordflow">for</font> (<font class="keywordtype">short</font> <font class="keywordtype">int</font> index = 0; index &lt; 3; index++) {
00293             m_config-&gt;setGroup(QString(<font class="stringliteral">"%1__%2"</font>).arg(current-&gt;styleName()).arg(names[index]));
00294 
00295             <a class="code" href="class_c_style_format.html">CStyleFormat</a>* format[3];
00296             format[0] = current-&gt;formatForType( CStyle::Header );
00297             format[1] = current-&gt;formatForType( CStyle::Description );
00298             format[2] = current-&gt;formatForType( CStyle::ModuleText );
00299                                                 
00300             m_config-&gt;writeEntry( <font class="stringliteral">"FGColor"</font>, format[index]-&gt;color( CStyleFormat::Background ) );
00301             m_config-&gt;writeEntry( <font class="stringliteral">"BGColor"</font>, format[index]-&gt;color( CStyleFormat::Foreground ) );
00302             m_config-&gt;writeEntry( <font class="stringliteral">"Font"</font>, format[index]-&gt;getFont() );
00303 <font class="comment">//          m_config-&gt;writeEntry( "Identation", format[index]-&gt;getIdentation() );           </font>
00304             m_config-&gt;writeEntry( <font class="stringliteral">"isEnabled"</font>, current-&gt;hasFormatTypeEnabled( (index == 0) ? CStyle::Header : ( (index == 1) ? CStyle::Description : CStyle::ModuleText)) );
00305             m_config-&gt;writeEntry( <font class="stringliteral">"Alignement"</font>, (<font class="keywordtype">int</font>)(format[index]-&gt;alignement()) );
00306             <font class="comment">//save frame settings</font>
00307             m_config-&gt;writeEntry( <font class="stringliteral">"has frame"</font>, format[index]-&gt;frame() );
00308             m_config-&gt;setGroup(QString(<font class="stringliteral">"%1__%2__FRAME"</font>).arg(m_styleList.current()-&gt;styleName()).arg(names[index]) );
00309             <a class="code" href="class_c_style_format_frame.html">CStyleFormatFrame</a>* frame = format[index]-&gt;<a class="code" href="class_c_style_format.html#a9">frame</a>();
00310             <font class="keywordflow">if</font> (frame) {    <font class="comment">//save only if we have a frame</font>
00311                 m_config-&gt;writeEntry(<font class="stringliteral">"Color"</font>, frame-&gt;<a class="code" href="class_c_style_format_frame.html#a2">color</a>());
00312                 m_config-&gt;writeEntry(<font class="stringliteral">"Thickness"</font>, frame-&gt;<a class="code" href="class_c_style_format_frame.html#a6">thickness</a>());
00313                 m_config-&gt;writeEntry(<font class="stringliteral">"Line style"</font>, (<font class="keywordtype">int</font>)(frame-&gt;<a class="code" href="class_c_style_format_frame.html#a4">lineStyle</a>()));
00314             }
00315         }
00316     }   
00317 }
00318 
00320 <font class="keywordtype">void</font> CPrinter::readSettings(){
00321     KConfigGroupSaver gs(m_config, <font class="stringliteral">"Settings"</font>);
00322     <font class="keyword">const</font> QString leading = <font class="stringliteral">"kde-bibletime-"</font>;
00323         
00324     setFullPage(<font class="keyword">true</font>);
00325     m_pagePosition.curPage = 1;
00326     m_pagePosition.rect = contentSize();
00327 
00328     QPaintDeviceMetrics m(<font class="keyword">this</font>);
00329     <font class="keyword">const</font> <font class="keywordtype">float</font> r = (float)m.width() / m.widthMM();     
00330     m_pageMargin.left   = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Left margin"</font>, 15));
00331     setOption(leading+<font class="stringliteral">"left_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Left margin"</font>, 15)));
00332     
00333     m_pageMargin.right  = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Right margin"</font>, 15));
00334     setOption(leading+<font class="stringliteral">"right_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Right margin"</font>, 15)));
00335         
00336     m_pageMargin.top        = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Top margin"</font>, 15));
00337     setOption(leading+<font class="stringliteral">"upper_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Top margin"</font>, 15)));
00338         
00339     m_pageMargin.bottom = (int)(r * m_config-&gt;readNumEntry(<font class="stringliteral">"Bottom margin"</font>, 15));
00340     setOption(leading+<font class="stringliteral">"lower_margin"</font>, QString::number(m_config-&gt;readNumEntry(<font class="stringliteral">"Bottom margin"</font>, 15)));        
00341     
00342     m_cachedPage.refresh = <font class="keyword">true</font>;    
00343 }
00344 
00346 <font class="keywordtype">void</font> CPrinter::saveSettings(){  
00347     <font class="keyword">const</font> QString leading = <font class="stringliteral">"kde-bibletime-"</font>;
00348     KConfigGroupSaver gs(m_config, <font class="stringliteral">"Settings"</font>);
00349     m_config-&gt;writeEntry(<font class="stringliteral">"Left margin"</font>, option(leading+<font class="stringliteral">"left_margin"</font>).toInt());
00350     m_config-&gt;writeEntry(<font class="stringliteral">"Right margin"</font>, option(leading+<font class="stringliteral">"right_margin"</font>).toInt());
00351     m_config-&gt;writeEntry(<font class="stringliteral">"Top margin"</font>, option(leading+<font class="stringliteral">"upper_margin"</font>).toInt());
00352     m_config-&gt;writeEntry(<font class="stringliteral">"Bottom margin"</font>, option(leading+<font class="stringliteral">"lower_margin"</font>).toInt());
00353 }
00354 
00356 StyleItemList&amp; CPrinter::styleList() {
00357     <font class="keywordflow">return</font> m_styleList;
00358 }
00359 
00361 <font class="keywordtype">void</font> CPrinter::setStyleList( StyleItemList&amp; list){
00362     m_styleList = list; <font class="comment">//copy items</font>
00363 }
00364 
00366 <font class="keyword">const</font> QRect CPrinter::contentSize() {
00367   <font class="keywordflow">if</font>    (   m_cachedPage.refresh || !m_cachedPage.initialized || (m_cachedPage.initialized &amp;&amp; (m_cachedPage.cachedPaper != pageSize())) )
00368   { <font class="comment">//refresh page size info</font>
00369         m_cachedPage.initialized = <font class="keyword">true</font>;
00370         m_cachedPage.refresh = <font class="keyword">false</font>;
00371         m_cachedPage.cachedPaper = pageSize();      
00372         
00373       QPaintDeviceMetrics metric( <font class="keyword">this</font> ); <font class="comment">//note that metric's width and height span the whole page             </font>
00374       m_cachedPage.size.setLeft( m_pageMargin.left );
00375       m_cachedPage.size.setTop( m_pageMargin.top );
00376       m_cachedPage.size.setRight( metric.width() -  m_pageMargin.right );
00377       m_cachedPage.size.setBottom( metric.height() - m_pageMargin.top - m_pageMargin.bottom );
00378     }
00379   <font class="keywordflow">return</font> m_cachedPage.size;
00380 }
00381 
00383 KConfig* <font class="keyword">const</font> CPrinter::config()<font class="keyword"> const </font>{
00384     <font class="keywordflow">return</font> m_config;    
00385 }
00386 
00388 <font class="keywordtype">void</font> CPrinter::setupStandardStyle(){
00389     <font class="comment">//see if m_items contains standard style</font>
00390     <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;
00391     <font class="keywordflow">for</font> (m_styleList.first(); m_styleList.current(); m_styleList.next()) {
00392         <font class="keywordflow">if</font> (m_styleList.current()-&gt;styleName() == i18n(<font class="stringliteral">"Standard"</font>)) {   <font class="comment">//found the style</font>
00393             found = <font class="keyword">true</font>;
00394             m_standardStyle = m_styleList.current();
00395             <font class="keywordflow">break</font>;
00396         }
00397     }
00398         
00399     <font class="keywordflow">if</font> (!found) {
00400         m_standardStyle = <font class="keyword">new</font> CStyle();     
00401         m_standardStyle-&gt;setStyleName(i18n(<font class="stringliteral">"Standard"</font>));        
00402         m_styleList.append( m_standardStyle );
00403     }
00404 }
00405 
00407 <font class="keyword">const</font> <font class="keywordtype">int</font> CPrinter::verticalPos()<font class="keyword"> const </font>{
00408     <font class="keywordflow">return</font> m_pagePosition.rect.y();
00409 }
00410 
00412 <font class="keywordtype">void</font> CPrinter::setVerticalPos( <font class="keyword">const</font> <font class="keywordtype">int</font> yPos ){
00413     m_pagePosition.rect.setY(yPos);
00414 }
00415 
00417 <font class="keywordtype">void</font> CPrinter::emitStylesChanged(){
00418     emit sigStylesChanged();
00419 }
00420 
00422 CStyle* <font class="keyword">const</font> CPrinter::standardStyle()<font class="keyword"> const </font>{
00423     <font class="keywordflow">return</font> m_standardStyle;
00424 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
