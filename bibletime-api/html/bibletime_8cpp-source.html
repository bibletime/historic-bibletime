<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>bibletime.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>bibletime.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          bibletime.cpp  -  The main class of BibleTime</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Mit Jan 19 12:57:15 CET 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//local includes</font>
00019 <font class="preprocessor">#include "config.h"</font>
00020 <font class="preprocessor">#include "bibletime.h"</font>
00021 <font class="preprocessor">#include "resource.h"</font>
00022 
00023 <font class="comment">//frontend includes</font>
00024 <font class="preprocessor">#include "frontend/chtmldialog.h"</font>
00025 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00026 <font class="preprocessor">#include "frontend/cmdiarea.h"</font>
00027 <font class="preprocessor">#include "frontend/presenters/cswordpresenter.h"</font>
00028 <font class="preprocessor">#include "frontend/presenters/cbiblepresenter.h"</font>
00029 <font class="preprocessor">#include "frontend/presenters/ccommentarypresenter.h"</font>
00030 <font class="preprocessor">#include "frontend/presenters/clexiconpresenter.h"</font>
00031 <font class="preprocessor">#include "frontend/presenters/cbookpresenter.h"</font>
00032 <font class="preprocessor">#include "frontend/keychooser/ckeychooser.h"</font>
00033 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00034 <font class="preprocessor">#include "frontend/cpointers.h"</font>
00035 
00036 <font class="comment">//backend includes</font>
00037 <font class="preprocessor">#include "backend/cswordmoduleinfo.h"</font>
00038 <font class="preprocessor">#include "backend/cswordbiblemoduleinfo.h"</font>
00039 <font class="preprocessor">#include "backend/cswordcommentarymoduleinfo.h"</font>
00040 <font class="preprocessor">#include "backend/cswordlexiconmoduleinfo.h"</font>
00041 <font class="preprocessor">#include "backend/cswordbookmoduleinfo.h"</font>
00042 <font class="preprocessor">#include "backend/chtmlentrydisplay.h"</font>
00043 <font class="preprocessor">#include "backend/chtmlchapterdisplay.h"</font>
00044 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00045 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00046 
00047 <font class="comment">//printing includes</font>
00048 <font class="preprocessor">#include "printing/cprinter.h"</font>
00049 
00050 <font class="comment">//Qt includes</font>
00051 <font class="preprocessor">#include &lt;qsplitter.h&gt;</font>
00052 
00053 <font class="comment">//KDE includes</font>
00054 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00055 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00056 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00057 <font class="preprocessor">#include &lt;kmenubar.h&gt;</font>
00058 <font class="preprocessor">#include &lt;ktoolbar.h&gt;</font>
00059 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00060 
<a name="l00061"></a><a class="code" href="class_bible_time.html#a0">00061</a> <a class="code" href="class_bible_time.html#a0">BibleTime::BibleTime</a>() : KMainWindow() {
00062     m_initialized = <font class="keyword">false</font>;
00063     <a class="code" href="class_bible_time.html#n20">m_moduleList</a>  = 0;
00064     m_progress = 0;
00065     m_currentProfile = 0;
00066     
00067     m_keyAccel = <font class="keyword">new</font> KAccel(<font class="keyword">this</font>);
00068 
00069     connect(kapp, SIGNAL(<a class="code" href="class_bible_time.html#g2">lastWindowClosed</a>()), SLOT(<a class="code" href="class_bible_time.html#g2">lastWindowClosed</a>()));
00070 
00071     <a class="code" href="class_bible_time.html#b3">initBackends</a>();
00072     <a class="code" href="class_bible_time.html#b8">initPrinter</a>();
00073     
00074     <a class="code" href="class_bible_time.html#b0">initView</a>();
00075     <a class="code" href="class_bible_time.html#b4">initActions</a>();
00076     setHelpMenuEnabled(<font class="keyword">false</font>);
00077     createGUI(<font class="stringliteral">"bibletimeui.rc"</font>);
00078     <a class="code" href="class_bible_time.html#b1">initMenubar</a>();
00079     <a class="code" href="class_bible_time.html#b2">initConnections</a>();
00080     <a class="code" href="class_bible_time.html#a3">readSettings</a>();
00081 
00082     <a class="code" href="class_bible_time.html#g6">setPlainCaption</a>(<font class="stringliteral">"BibleTime "</font> VERSION);
00083 }
00084 
<a name="l00085"></a><a class="code" href="class_bible_time.html#a1">00085</a> <a class="code" href="class_bible_time.html#a1">BibleTime::~BibleTime</a>() {
00086     <a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00087 }
00088 
<a name="l00090"></a><a class="code" href="class_bible_time.html#a4">00090</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a4">BibleTime::saveSettings</a>(){
00091     saveMainWindowSettings(KGlobal::config());
00092     <font class="keywordflow">if</font> (m_mdi)
00093         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a3">saveSettings</a>();  
00094     <font class="keywordflow">if</font> (m_keyAccel)
00095         m_keyAccel-&gt;writeSettings();
00096 
00097     CBTConfig::set(CBTConfig::toolbar, <a class="code" href="class_bible_time.html#n4">m_viewToolbar_action</a>-&gt;isChecked());
00098     CBTConfig::set(CBTConfig::mainIndex, m_viewGroupManager_action-&gt;isChecked());
00099 
00100     <font class="keywordflow">if</font> (m_viewGroupManager_action-&gt;isChecked()) <font class="comment">//only save changes when the groupmanager is visible</font>
00101         CBTConfig::set(CBTConfig::splitterSizes, m_splitter-&gt;sizes());
00102 
00103     <font class="keywordflow">if</font> (m_windowAutoTile_action-&gt;isChecked())   {
00104         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">true</font>);
00105         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">false</font>);  
00106     }
00107     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_windowAutoTile_action-&gt;isChecked() ) {
00108         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">false</font>);
00109         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">true</font>);   
00110     }
00111     <font class="keywordflow">else</font> {
00112         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">false</font>);
00113         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">false</font>);  
00114     }
00115 
00116     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::restoreWorkspace) ) {
00117         <a class="code" href="class_c_profile.html">CProfile</a>* p = m_profileMgr.<a class="code" href="class_c_profile_mgr.html#a7">startupProfile</a>();
00118         <font class="keywordflow">if</font> (p)
00119             <a class="code" href="class_bible_time.html#h12">saveProfile</a>(p);
00120     }
00121 }
00122 
<a name="l00124"></a><a class="code" href="class_bible_time.html#a3">00124</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a3">BibleTime::readSettings</a>(){
00125     qDebug(<font class="stringliteral">"BibleTime::readSettings()"</font>);
00126     
00127 <font class="comment">//  applyMainWindowSettings(m_config);</font>
00128     
00129     m_keyAccel-&gt;readSettings(KGlobal::config());
00130 
00131     <a class="code" href="class_bible_time.html#n4">m_viewToolbar_action</a>-&gt;setChecked( CBTConfig::get(CBTConfig::toolbar) );
00132     <a class="code" href="class_bible_time.html#h7">slotToggleToolbar</a>();
00133         
00134     m_viewGroupManager_action-&gt;setChecked( CBTConfig::get(CBTConfig::mainIndex) );
00135     <a class="code" href="class_bible_time.html#h9">slotToggleGroupManager</a>();
00136         
00137     m_splitter-&gt;setSizes( CBTConfig::get(CBTConfig::splitterSizes) );       
00138 
00139     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::autoTile) ) {
00140         m_windowAutoTile_action-&gt;setChecked( <font class="keyword">true</font> );
00141         m_windowAutoCascade_action-&gt;setChecked( <font class="keyword">false</font> );
00142         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::autoTile );
00143     }
00144     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::autoCascade) ) {
00145         m_windowAutoCascade_action-&gt;setChecked(<font class="keyword">true</font>);
00146         m_windowAutoTile_action-&gt;setChecked(<font class="keyword">false</font>);
00147         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::autoCascade );
00148     }
00149     <font class="keywordflow">else</font> {
00150         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::Nothing );       
00151         m_windowAutoTile_action-&gt;setChecked(<font class="keyword">false</font>);
00152         m_windowAutoCascade_action-&gt;setChecked(<font class="keyword">false</font>);      
00153     }
00154 }
00155 
<a name="l00157"></a><a class="code" href="class_bible_time.html#h1">00157</a> <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* <a class="code" href="class_bible_time.html#h1">BibleTime::createNewSwordPresenter</a>(ListCSwordModuleInfo modules, <font class="keyword">const</font> QString&amp; key) {
00158     kapp-&gt;setOverrideCursor( waitCursor );
00159     
00160     <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* presenter = 0;
00161     <font class="keywordflow">switch</font> (modules.first()-&gt;type()) {
00162         <font class="keywordflow">case</font> CSwordModuleInfo::Bible:
00163             presenter = <font class="keyword">new</font> <a class="code" href="class_c_bible_presenter.html">CBiblePresenter</a>(modules, m_mdi);
00164             <font class="keywordflow">break</font>;
00165         <font class="keywordflow">case</font> CSwordModuleInfo::Commentary:
00166             presenter = <font class="keyword">new</font> <a class="code" href="class_c_commentary_presenter.html">CCommentaryPresenter</a>(modules, m_mdi);
00167             <font class="keywordflow">break</font>;
00168         <font class="keywordflow">case</font> CSwordModuleInfo::Lexicon:
00169             presenter = <font class="keyword">new</font> <a class="code" href="class_c_lexicon_presenter.html">CLexiconPresenter</a>(modules, m_mdi);
00170             <font class="keywordflow">break</font>;
00171         <font class="keywordflow">case</font> CSwordModuleInfo::GenericBook:         
00172             presenter = <font class="keyword">new</font> CBookPresenter(modules, m_mdi);
00173             <font class="keywordflow">break</font>;
00174         <font class="keywordflow">default</font>:
00175             presenter = 0;
00176             qWarning(<font class="stringliteral">"unknown module type"</font>);
00177             <font class="keywordflow">break</font>;
00178     }   
00179     <font class="keywordflow">if</font> (presenter) {
00180         qWarning(<font class="stringliteral">"CREATE NEW PRESENTER: %s"</font>, key.latin1());
00181         connect(presenter, SIGNAL(lookupInLexicon(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)),
00182             m_mdi, SLOT(lookupInLexicon(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)));              
00183         connect(presenter, SIGNAL(lookupInModule(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)),
00184             m_mdi, SLOT(lookupInModule(<font class="keyword">const</font> QString&amp;, <font class="keyword">const</font> QString&amp;)));                           
00185         connect(presenter, SIGNAL(closePresenter(<a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>*)),
00186             m_mdi, SLOT(closePresenter(<a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>*)));                         
00187         <font class="keywordflow">if</font> (presenter-&gt;isA(<font class="stringliteral">"CBiblePresenter"</font>)) {
00188             connect(presenter-&gt;<a class="code" href="class_c_sword_presenter.html#g1">keyChooser</a>(), SIGNAL(keyChanged(<a class="code" href="class_c_sword_key.html">CSwordKey</a>*)),
00189                 m_mdi, SLOT(syncCommentaries(<a class="code" href="class_c_sword_key.html">CSwordKey</a>*)));     
00190         }
00191         presenter-&gt;<a class="code" href="class_c_sword_presenter.html#g0">lookup</a>(modules.first()-&gt;name(),key);     
00192     }
00193             
00194     kapp-&gt;restoreOverrideCursor();
00195     presenter-&gt;setFocus();
00196     
00197     <font class="keywordflow">return</font> presenter;
00198 }
00199 
00200 
<a name="l00202"></a><a class="code" href="class_bible_time.html#h2">00202</a> <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* <a class="code" href="class_bible_time.html#h1">BibleTime::createNewSwordPresenter</a>(<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; key) {
00203     ListCSwordModuleInfo list;
00204     list.append(module);
00205     
00206     <font class="keywordflow">return</font> <a class="code" href="class_bible_time.html#h1">createNewSwordPresenter</a>(list, key);      
00207 }
00208 
<a name="l00210"></a><a class="code" href="class_bible_time.html#b5">00210</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b5">BibleTime::refreshPresenters</a>() {
00211     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> index;             
00212     <font class="keywordflow">for</font> ( index = 0; index &lt; m_mdi-&gt;windowList().count(); index++) {
00213         <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* myPresenter = dynamic_cast&lt;CSwordPresenter*&gt;(m_mdi-&gt;windowList().at(index));
00214         <font class="keywordflow">if</font> (myPresenter)
00215         myPresenter-&gt;<a class="code" href="class_c_sword_presenter.html#a2">refresh</a>();
00216     }
00217 }
00218 
<a name="l00220"></a><a class="code" href="class_bible_time.html#b7">00220</a> <font class="keywordtype">bool</font> <a class="code" href="class_bible_time.html#b7">BibleTime::queryExit</a>(){
00221   <font class="keywordflow">if</font> (!m_initialized)
00222     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00223     <a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00224     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00225 }
00226 
<a name="l00228"></a><a class="code" href="class_bible_time.html#b6">00228</a> <font class="keywordtype">bool</font> <a class="code" href="class_bible_time.html#b6">BibleTime::queryClose</a>(){
00229 <font class="comment">//  qWarning("BibleTime::queryClose()");</font>
00230     <font class="keywordtype">bool</font> ret = <font class="keyword">true</font>;
00231     <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> index = 0; index &lt; m_mdi-&gt;windowList().count(); ++index) {
00232         <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* myPresenter = dynamic_cast&lt;CSwordPresenter*&gt;(m_mdi-&gt;windowList().at(index));
00233         <font class="keywordflow">if</font> (myPresenter)
00234         ret = myPresenter-&gt;<a class="code" href="class_c_sword_presenter.html#g4">queryClose</a>() &amp;&amp; ret;
00235     }   
00236     <font class="keywordflow">return</font> ret;
00237 }
00238 
<a name="l00240"></a><a class="code" href="class_bible_time.html#a2">00240</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a2">BibleTime::show</a>(){
00241     KMainWindow::show();    
00242     <font class="comment">//if we show BibleTime for the first time we are ready for processing</font>
00243     <font class="comment">//but not before this point.</font>
00244     m_initialized = <font class="keyword">true</font>;
00245 }
00246 
<a name="l00248"></a><a class="code" href="class_bible_time.html#b10">00248</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b10">BibleTime::saveProperties</a>(KConfig* <font class="comment">/*myConfig*/</font>){
00249 
00250 }
00251 
<a name="l00253"></a><a class="code" href="class_bible_time.html#b9">00253</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b9">BibleTime::readProperties</a>(KConfig* <font class="comment">/*myConfig*/</font>){
00254 
00255 }
00256 
<a name="l00258"></a><a class="code" href="class_bible_time.html#a5">00258</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a5">BibleTime::restoreWorkspace</a>(){ 
00259     <a class="code" href="class_c_profile.html">CProfile</a>* p = m_profileMgr.<a class="code" href="class_c_profile_mgr.html#a7">startupProfile</a>();
00260     <font class="keywordflow">if</font> (p)
00261         <a class="code" href="class_bible_time.html#h15">loadProfile</a>(p);
00262 }
00263 
<a name="l00265"></a><a class="code" href="class_bible_time.html#g7">00265</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#g7">BibleTime::setCaption</a>( <font class="keyword">const</font> QString&amp; ){
00266     KMainWindow::setPlainCaption( KApplication::kApplication()-&gt;makeStdCaption( m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a5">currentApplicationCaption</a>() ) );
00267 }
00268 
<a name="l00270"></a><a class="code" href="class_bible_time.html#g6">00270</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#g6">BibleTime::setPlainCaption</a>( <font class="keyword">const</font> QString&amp; ){
00271     KMainWindow::setPlainCaption( KApplication::kApplication()-&gt;makeStdCaption( m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a5">currentApplicationCaption</a>() ) );
00272 }
</pre></div><hr><address><small>Generated on Sun Mar 10 21:52:39 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
