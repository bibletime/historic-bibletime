<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>bibletime.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>bibletime.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          bibletime.cpp  -  The main class of BibleTime</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Mit Jan 19 12:57:15 CET 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//local includes</font>
00019 <font class="preprocessor">#include "config.h"</font>
00020 <font class="preprocessor">#include "bibletime.h"</font>
00021 <font class="preprocessor">#include "resource.h"</font>
00022 
00023 <font class="comment">//frontend includes</font>
00024 <font class="preprocessor">#include "frontend/chtmldialog.h"</font>
00025 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00026 <font class="preprocessor">#include "frontend/cmdiarea.h"</font>
00027 <font class="preprocessor">#include "frontend/displaywindow/cdisplaywindow.h"</font>
00028 <font class="preprocessor">#include "frontend/displaywindow/creadwindow.h"</font>
00029 <font class="preprocessor">#include "frontend/keychooser/ckeychooser.h"</font>
00030 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00031 <font class="preprocessor">#include "frontend/cpointers.h"</font>
00032 
00033 <font class="comment">//backend includes</font>
00034 <font class="preprocessor">#include "backend/cswordmoduleinfo.h"</font>
00035 <font class="preprocessor">#include "backend/cswordbiblemoduleinfo.h"</font>
00036 <font class="preprocessor">#include "backend/cswordcommentarymoduleinfo.h"</font>
00037 <font class="preprocessor">#include "backend/cswordlexiconmoduleinfo.h"</font>
00038 <font class="preprocessor">#include "backend/cswordbookmoduleinfo.h"</font>
00039 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00040 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00041 
00042 <font class="comment">//printing includes</font>
00043 <font class="preprocessor">#include "printing/cprinter.h"</font>
00044 
00045 <font class="comment">//Qt includes</font>
00046 <font class="preprocessor">#include &lt;qsplitter.h&gt;</font>
00047 
00048 <font class="comment">//KDE includes</font>
00049 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00050 <font class="preprocessor">#include &lt;kapplication.h&gt;</font>
00051 <font class="preprocessor">#include &lt;kconfig.h&gt;</font>
00052 <font class="preprocessor">#include &lt;kcmdlineargs.h&gt;</font>
00053 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00054 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00055 <font class="preprocessor">#include &lt;kmenubar.h&gt;</font>
00056 <font class="preprocessor">#include &lt;ktoolbar.h&gt;</font>
00057 <font class="preprocessor">#include &lt;krandomsequence.h&gt;</font>
00058 
<a name="l00059"></a><a class="code" href="class_bible_time.html#a0">00059</a> <a class="code" href="class_bible_time.html#a0">BibleTime::BibleTime</a>() : KMainWindow(0,0, WType_TopLevel <font class="comment">/*| WDestructiveClose*/</font>) {
00060     m_initialized = <font class="keyword">false</font>;
00061     <a class="code" href="class_bible_time.html#n20">m_moduleList</a>  = 0;
00062     m_progress = 0;
00063     m_currentProfile = 0;
00064     
00065     m_keyAccel = accel(); <font class="comment">//new KAccel(this);</font>
00066 
00067     connect(KApplication::kApplication(), SIGNAL(<a class="code" href="class_bible_time.html#g2">lastWindowClosed</a>()), SLOT(<a class="code" href="class_bible_time.html#g2">lastWindowClosed</a>()));
00068 
00069     <a class="code" href="class_bible_time.html#b3">initBackends</a>();
00070     <a class="code" href="class_bible_time.html#b8">initPrinter</a>();
00071     
00072     <a class="code" href="class_bible_time.html#b0">initView</a>();
00073     <a class="code" href="class_bible_time.html#b4">initActions</a>();
00074     setHelpMenuEnabled(<font class="keyword">false</font>);
00075     createGUI(<font class="stringliteral">"bibletimeui.rc"</font>);
00076     <a class="code" href="class_bible_time.html#b1">initMenubar</a>();
00077     <a class="code" href="class_bible_time.html#b2">initConnections</a>();
00078     
00079     <a class="code" href="class_bible_time.html#a3">readSettings</a>();
00080 
00081     <a class="code" href="class_bible_time.html#g6">setPlainCaption</a>(<font class="stringliteral">"BibleTime "</font> VERSION);
00082     setAutoSaveSettings(QString::fromLatin1(<font class="stringliteral">"MainWindow"</font>), <font class="keyword">false</font>);
00083 }
00084 
<a name="l00085"></a><a class="code" href="class_bible_time.html#a1">00085</a> <a class="code" href="class_bible_time.html#a1">BibleTime::~BibleTime</a>() {
00086     <a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00087 }
00088 
<a name="l00090"></a><a class="code" href="class_bible_time.html#a4">00090</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a4">BibleTime::saveSettings</a>(){
00091     <font class="keywordflow">if</font> (m_mdi)
00092         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a3">saveSettings</a>();  
00093     <font class="keywordflow">if</font> (m_keyAccel)
00094         m_keyAccel-&gt;writeSettings();
00095 
00096     CBTConfig::set(CBTConfig::toolbar, <a class="code" href="class_bible_time.html#n4">m_viewToolbar_action</a>-&gt;isChecked());
00097     CBTConfig::set(CBTConfig::mainIndex, m_viewGroupManager_action-&gt;isChecked());
00098 
00099     <font class="keywordflow">if</font> (m_viewGroupManager_action-&gt;isChecked()) <font class="comment">//only save changes when the groupmanager is visible</font>
00100         CBTConfig::set(CBTConfig::splitterSizes, m_splitter-&gt;sizes());
00101 
00102     <font class="keywordflow">if</font> (m_windowAutoTile_action-&gt;isChecked())   {
00103         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">true</font>);
00104         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">false</font>);  
00105     }
00106     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_windowAutoTile_action-&gt;isChecked() ) {
00107         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">false</font>);
00108         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">true</font>);   
00109     }
00110     <font class="keywordflow">else</font> {
00111         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">false</font>);
00112         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">false</font>);  
00113     }
00114 
00115     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::restoreWorkspace) ) {
00116         <font class="keywordflow">if</font> (<a class="code" href="class_c_profile.html">CProfile</a>* p = m_profileMgr.<a class="code" href="class_c_profile_mgr.html#a7">startupProfile</a>())
00117             <a class="code" href="class_bible_time.html#h12">saveProfile</a>(p);
00118     }
00119 }
00120 
<a name="l00122"></a><a class="code" href="class_bible_time.html#a3">00122</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a3">BibleTime::readSettings</a>(){
00123     applyMainWindowSettings(KGlobal::config(), QString::fromLatin1(<font class="stringliteral">"MainWindow"</font>));
00124     
00125     m_keyAccel-&gt;readSettings(KGlobal::config());
00126 
00127     <a class="code" href="class_bible_time.html#n4">m_viewToolbar_action</a>-&gt;setChecked( CBTConfig::get(CBTConfig::toolbar) );
00128     <a class="code" href="class_bible_time.html#h7">slotToggleToolbar</a>();
00129         
00130     m_viewGroupManager_action-&gt;setChecked( CBTConfig::get(CBTConfig::mainIndex) );
00131     <a class="code" href="class_bible_time.html#h9">slotToggleGroupManager</a>();
00132         
00133     m_splitter-&gt;setSizes( CBTConfig::get(CBTConfig::splitterSizes) );       
00134 
00135     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::autoTile) ) {
00136         m_windowAutoTile_action-&gt;setChecked( <font class="keyword">true</font> );
00137         m_windowAutoCascade_action-&gt;setChecked( <font class="keyword">false</font> );
00138         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::autoTile );
00139     }
00140     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::autoCascade) ) {
00141         m_windowAutoCascade_action-&gt;setChecked(<font class="keyword">true</font>);
00142         m_windowAutoTile_action-&gt;setChecked(<font class="keyword">false</font>);
00143         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::autoCascade );
00144     }
00145     <font class="keywordflow">else</font> {
00146         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::Nothing );       
00147         m_windowAutoTile_action-&gt;setChecked(<font class="keyword">false</font>);
00148         m_windowAutoCascade_action-&gt;setChecked(<font class="keyword">false</font>);      
00149     }
00150 }
00151 
<a name="l00153"></a><a class="code" href="class_bible_time.html#h1">00153</a> <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* <a class="code" href="class_bible_time.html#h1">BibleTime::createDisplayWindow</a>(ListCSwordModuleInfo modules, <font class="keyword">const</font> QString&amp; key) {
00154 <font class="comment">// qWarning("BibleTime::createDisplayWindow: key is %s", key.latin1());</font>
00155   kapp-&gt;setOverrideCursor( waitCursor );
00156 
00157     <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* displayWindow = CDisplayWindow::createReadInstance(modules, m_mdi); 
00158   <font class="keywordflow">if</font> (displayWindow) {
00159     displayWindow-&gt;<a class="code" href="class_c_display_window.html#a17">init</a>(key);
00160         displayWindow-&gt;show();
00161     }
00162     kapp-&gt;restoreOverrideCursor();  
00163     <font class="keywordflow">return</font> displayWindow;
00164 }
00165 
00166 
<a name="l00168"></a><a class="code" href="class_bible_time.html#h2">00168</a> <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* <a class="code" href="class_bible_time.html#h1">BibleTime::createDisplayWindow</a>(<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; key) {
00169     ListCSwordModuleInfo list;
00170     list.append(module);
00171     
00172     <font class="keywordflow">return</font> <a class="code" href="class_bible_time.html#h1">createDisplayWindow</a>(list, key);      
00173 }
00174 
<a name="l00176"></a><a class="code" href="class_bible_time.html#b5">00176</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b5">BibleTime::refreshPresenters</a>() {
00177     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> index;             
00178     <font class="keywordflow">for</font> ( index = 0; index &lt; m_mdi-&gt;windowList().count(); index++) {
00179         <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* window = dynamic_cast&lt;CDisplayWindow*&gt;(m_mdi-&gt;windowList().at(index));
00180         <font class="keywordflow">if</font> (window)
00181         window-&gt;<a class="code" href="class_c_display_window.html#a6">refresh</a>();
00182     }
00183 }
00184 
<a name="l00186"></a><a class="code" href="class_bible_time.html#b7">00186</a> <font class="keywordtype">bool</font> <a class="code" href="class_bible_time.html#b7">BibleTime::queryExit</a>(){
00187 <font class="comment">//  qWarning("BibleTime::queryExit()");</font>
00188     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00189 
00190   <font class="keywordflow">if</font> (!m_initialized)
00191     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00192     <a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00193     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00194 }
00195 
<a name="l00197"></a><a class="code" href="class_bible_time.html#b6">00197</a> <font class="keywordtype">bool</font> <a class="code" href="class_bible_time.html#b6">BibleTime::queryClose</a>(){
00198 <font class="comment">//  qWarning("BibleTime::queryClose()");</font>
00199     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00200 
00201     <font class="keywordtype">bool</font> ret = <font class="keyword">true</font>;
00202     <font class="keywordflow">for</font> ( <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> index = 0; index &lt; m_mdi-&gt;windowList().count(); ++index) {
00203         <font class="keywordflow">if</font> (<a class="code" href="class_c_display_window.html">CDisplayWindow</a>* window = dynamic_cast&lt;CDisplayWindow*&gt;(m_mdi-&gt;windowList().at(index)))
00204         ret = window-&gt;<a class="code" href="class_c_display_window.html#a13">queryClose</a>() &amp;&amp; ret;
00205     }   
00206     <font class="keywordflow">return</font> ret;
00207 }
00208 
<a name="l00210"></a><a class="code" href="class_bible_time.html#a2">00210</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a2">BibleTime::show</a>(){
00211     KMainWindow::show();    
00212     <font class="comment">//if we show BibleTime for the first time we are ready for processing</font>
00213     <font class="comment">//but not before this point.</font>
00214     m_initialized = <font class="keyword">true</font>;
00215 }
00216 
<a name="l00218"></a><a class="code" href="class_bible_time.html#b10">00218</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b10">BibleTime::saveProperties</a>(KConfig* <font class="comment">/*myConfig*/</font>){
00219 
00220 }
00221 
<a name="l00223"></a><a class="code" href="class_bible_time.html#b9">00223</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b9">BibleTime::readProperties</a>(KConfig* <font class="comment">/*myConfig*/</font>){
00224 
00225 }
00226 
<a name="l00228"></a><a class="code" href="class_bible_time.html#a5">00228</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a5">BibleTime::restoreWorkspace</a>(){ 
00229     <font class="keywordflow">if</font> (<a class="code" href="class_c_profile.html">CProfile</a>* p = m_profileMgr.<a class="code" href="class_c_profile_mgr.html#a7">startupProfile</a>())
00230         <a class="code" href="class_bible_time.html#h15">loadProfile</a>(p);
00231 }
00232 
<a name="l00234"></a><a class="code" href="class_bible_time.html#g7">00234</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#g7">BibleTime::setCaption</a>( <font class="keyword">const</font> QString&amp; ){
00235     KMainWindow::setPlainCaption( KApplication::kApplication()-&gt;makeStdCaption( m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a5">currentApplicationCaption</a>() ) );
00236 }
00237 
<a name="l00239"></a><a class="code" href="class_bible_time.html#g6">00239</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#g6">BibleTime::setPlainCaption</a>( <font class="keyword">const</font> QString&amp; ){
00240     KMainWindow::setPlainCaption( KApplication::kApplication()-&gt;makeStdCaption( m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a5">currentApplicationCaption</a>() ) );
00241 }
00242 
<a name="l00244"></a><a class="code" href="class_bible_time.html#g8">00244</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#g8">BibleTime::processCommandline</a>(){
00245     KCmdLineArgs *args = KCmdLineArgs::parsedArgs();
00246 
00247   <font class="keywordflow">if</font> (CBTConfig::get(CBTConfig::restoreWorkspace) &amp;&amp; !args-&gt;isSet(<font class="stringliteral">"ignore-startprofile"</font>))
00248     <a class="code" href="class_bible_time.html#a5">restoreWorkspace</a>();
00249   QString bibleKey = args-&gt;getOption(<font class="stringliteral">"open-default-bible"</font>);
00250   <font class="keywordflow">if</font> (!bibleKey.isNull() &amp;&amp; args-&gt;isSet(<font class="stringliteral">"open-default-bible"</font>)) {
00251     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* bible = <a class="code" href="class_c_pointers.html#d1">CPointers::backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a10">findModuleByDescription</a>(CBTConfig::get(CBTConfig::standardBible));
00252     Q_ASSERT(bible);
00253     <font class="keywordflow">if</font> (bibleKey == <font class="stringliteral">"&lt;random&gt;"</font>) {
00254 <font class="comment">//      qWarning("Open #random# key in default bible!");</font>
00255       <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> vk(0);
00256       <font class="keyword">const</font> <font class="keywordtype">int</font> maxIndex = 32400;
00257 
00258       KRandomSequence rs;
00259       <font class="keywordtype">int</font> newIndex = rs.getLong(maxIndex);
00260       vk.setPosition(TOP);
00261       vk.Index(newIndex);
00262       bibleKey = vk.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>();
00263     }
00264 <font class="comment">//    else {</font>
00265 <font class="comment">//      qWarning("Open given key!");</font>
00266 <font class="comment">//    }</font>
00267     <a class="code" href="class_bible_time.html#h1">createDisplayWindow</a>(bible, bibleKey);
00268   }
00269 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:07 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
