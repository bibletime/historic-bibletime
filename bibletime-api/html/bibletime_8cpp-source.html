<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>bibletime.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>bibletime.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          bibletime.cpp  -  The main class of BibleTime</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Mit Jan 19 12:57:15 CET 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//local includes</font>
00019 <font class="preprocessor">#include "config.h"</font>
00020 <font class="preprocessor">#include "bibletime.h"</font>
00021 <font class="preprocessor">#include "resource.h"</font>
00022 
00023 <font class="comment">//frontend includes</font>
00024 <font class="preprocessor">#include "frontend/chtmldialog.h"</font>
00025 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00026 <font class="preprocessor">#include "frontend/cmdiarea.h"</font>
00027 <font class="preprocessor">#include "frontend/displaywindow/cdisplaywindow.h"</font>
00028 <font class="preprocessor">#include "frontend/displaywindow/creadwindow.h"</font>
00029 <font class="comment">//#include "frontend/presenters/cswordpresenter.h"</font>
00030 <font class="comment">//#include "frontend/presenters/cbiblepresenter.h"</font>
00031 <font class="comment">//#include "frontend/presenters/ccommentarypresenter.h"</font>
00032 <font class="comment">//#include "frontend/presenters/clexiconpresenter.h"</font>
00033 <font class="comment">//#include "frontend/presenters/cbookpresenter.h"</font>
00034 <font class="preprocessor">#include "frontend/keychooser/ckeychooser.h"</font>
00035 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00036 <font class="preprocessor">#include "frontend/cpointers.h"</font>
00037 
00038 <font class="comment">//backend includes</font>
00039 <font class="preprocessor">#include "backend/cswordmoduleinfo.h"</font>
00040 <font class="preprocessor">#include "backend/cswordbiblemoduleinfo.h"</font>
00041 <font class="preprocessor">#include "backend/cswordcommentarymoduleinfo.h"</font>
00042 <font class="preprocessor">#include "backend/cswordlexiconmoduleinfo.h"</font>
00043 <font class="preprocessor">#include "backend/cswordbookmoduleinfo.h"</font>
00044 <font class="preprocessor">#include "backend/chtmlentrydisplay.h"</font>
00045 <font class="preprocessor">#include "backend/chtmlchapterdisplay.h"</font>
00046 <font class="preprocessor">#include "backend/cswordversekey.h"</font>
00047 <font class="preprocessor">#include "backend/cswordldkey.h"</font>
00048 
00049 <font class="comment">//printing includes</font>
00050 <font class="preprocessor">#include "printing/cprinter.h"</font>
00051 
00052 <font class="comment">//Qt includes</font>
00053 <font class="preprocessor">#include &lt;qsplitter.h&gt;</font>
00054 
00055 <font class="comment">//KDE includes</font>
00056 <font class="preprocessor">#include &lt;kaction.h&gt;</font>
00057 <font class="preprocessor">#include &lt;kapplication.h&gt;</font>
00058 <font class="preprocessor">#include &lt;kconfig.h&gt;</font>
00059 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00060 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00061 <font class="preprocessor">#include &lt;kmenubar.h&gt;</font>
00062 <font class="preprocessor">#include &lt;ktoolbar.h&gt;</font>
00063 
<a name="l00064"></a><a class="code" href="class_bible_time.html#a0">00064</a> <a class="code" href="class_bible_time.html#a0">BibleTime::BibleTime</a>() : KMainWindow() {
00065     m_initialized = <font class="keyword">false</font>;
00066     <a class="code" href="class_bible_time.html#n20">m_moduleList</a>  = 0;
00067     m_progress = 0;
00068     m_currentProfile = 0;
00069     
00070     m_keyAccel = <font class="keyword">new</font> KAccel(<font class="keyword">this</font>);
00071 
00072     connect(KApplication::kApplication(), SIGNAL(<a class="code" href="class_bible_time.html#g2">lastWindowClosed</a>()), SLOT(<a class="code" href="class_bible_time.html#g2">lastWindowClosed</a>()));
00073 
00074     <a class="code" href="class_bible_time.html#b3">initBackends</a>();
00075     <a class="code" href="class_bible_time.html#b8">initPrinter</a>();
00076     
00077     <a class="code" href="class_bible_time.html#b0">initView</a>();
00078     <a class="code" href="class_bible_time.html#b4">initActions</a>();
00079     setHelpMenuEnabled(<font class="keyword">false</font>);
00080     createGUI(<font class="stringliteral">"bibletimeui.rc"</font>);
00081     <a class="code" href="class_bible_time.html#b1">initMenubar</a>();
00082     <a class="code" href="class_bible_time.html#b2">initConnections</a>();
00083     
00084     <a class="code" href="class_bible_time.html#a3">readSettings</a>();
00085 
00086     <a class="code" href="class_bible_time.html#g6">setPlainCaption</a>(<font class="stringliteral">"BibleTime "</font> VERSION);
00087     setAutoSaveSettings(QString::fromLatin1(<font class="stringliteral">"MainWindow"</font>), <font class="keyword">false</font>);
00088 }
00089 
<a name="l00090"></a><a class="code" href="class_bible_time.html#a1">00090</a> <a class="code" href="class_bible_time.html#a1">BibleTime::~BibleTime</a>() {
00091     <a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00092 }
00093 
<a name="l00095"></a><a class="code" href="class_bible_time.html#a4">00095</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a4">BibleTime::saveSettings</a>(){
00096     <font class="keywordflow">if</font> (m_mdi)
00097         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a3">saveSettings</a>();  
00098     <font class="keywordflow">if</font> (m_keyAccel)
00099         m_keyAccel-&gt;writeSettings();
00100 
00101     CBTConfig::set(CBTConfig::toolbar, <a class="code" href="class_bible_time.html#n4">m_viewToolbar_action</a>-&gt;isChecked());
00102     CBTConfig::set(CBTConfig::mainIndex, m_viewGroupManager_action-&gt;isChecked());
00103 
00104     <font class="keywordflow">if</font> (m_viewGroupManager_action-&gt;isChecked()) <font class="comment">//only save changes when the groupmanager is visible</font>
00105         CBTConfig::set(CBTConfig::splitterSizes, m_splitter-&gt;sizes());
00106 
00107     <font class="keywordflow">if</font> (m_windowAutoTile_action-&gt;isChecked())   {
00108         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">true</font>);
00109         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">false</font>);  
00110     }
00111     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( m_windowAutoTile_action-&gt;isChecked() ) {
00112         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">false</font>);
00113         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">true</font>);   
00114     }
00115     <font class="keywordflow">else</font> {
00116         CBTConfig::set(CBTConfig::autoTile, <font class="keyword">false</font>);
00117         CBTConfig::set(CBTConfig::autoCascade, <font class="keyword">false</font>);  
00118     }
00119 
00120     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::restoreWorkspace) ) {
00121         <font class="keywordflow">if</font> (<a class="code" href="class_c_profile.html">CProfile</a>* p = m_profileMgr.<a class="code" href="class_c_profile_mgr.html#a7">startupProfile</a>())
00122             <a class="code" href="class_bible_time.html#h12">saveProfile</a>(p);
00123     }
00124 }
00125 
<a name="l00127"></a><a class="code" href="class_bible_time.html#a3">00127</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a3">BibleTime::readSettings</a>(){
00128     applyMainWindowSettings(KGlobal::config(), QString::fromLatin1(<font class="stringliteral">"MainWindow"</font>));
00129     
00130     m_keyAccel-&gt;readSettings(KGlobal::config());
00131 
00132     <a class="code" href="class_bible_time.html#n4">m_viewToolbar_action</a>-&gt;setChecked( CBTConfig::get(CBTConfig::toolbar) );
00133     <a class="code" href="class_bible_time.html#h7">slotToggleToolbar</a>();
00134         
00135     m_viewGroupManager_action-&gt;setChecked( CBTConfig::get(CBTConfig::mainIndex) );
00136     <a class="code" href="class_bible_time.html#h9">slotToggleGroupManager</a>();
00137         
00138     m_splitter-&gt;setSizes( CBTConfig::get(CBTConfig::splitterSizes) );       
00139 
00140     <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::autoTile) ) {
00141         m_windowAutoTile_action-&gt;setChecked( <font class="keyword">true</font> );
00142         m_windowAutoCascade_action-&gt;setChecked( <font class="keyword">false</font> );
00143         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::autoTile );
00144     }
00145     <font class="keywordflow">else</font> <font class="keywordflow">if</font> ( CBTConfig::get(CBTConfig::autoCascade) ) {
00146         m_windowAutoCascade_action-&gt;setChecked(<font class="keyword">true</font>);
00147         m_windowAutoTile_action-&gt;setChecked(<font class="keyword">false</font>);
00148         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::autoCascade );
00149     }
00150     <font class="keywordflow">else</font> {
00151         m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a4">setGUIOption</a>( CMDIArea::Nothing );       
00152         m_windowAutoTile_action-&gt;setChecked(<font class="keyword">false</font>);
00153         m_windowAutoCascade_action-&gt;setChecked(<font class="keyword">false</font>);      
00154     }
00155 }
00156 
<a name="l00158"></a><a class="code" href="class_bible_time.html#h1">00158</a> <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* <a class="code" href="class_bible_time.html#h1">BibleTime::createDisplayWindow</a>(ListCSwordModuleInfo modules, <font class="keyword">const</font> QString&amp; key) {
00159     kapp-&gt;setOverrideCursor( waitCursor );
00160 
00161     <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* displayWindow = CDisplayWindow::createReadInstance(modules, m_mdi); 
00162   <font class="keywordflow">if</font> (displayWindow) {
00163     displayWindow-&gt;<a class="code" href="class_c_display_window.html#a17">init</a>(key);
00164         displayWindow-&gt;show();
00165     }
00166   <font class="comment">//    if (presenter) {</font>
00167 <font class="comment">//      connect(presenter, SIGNAL(lookupInLexicon(const QString&amp;, const QString&amp;)),</font>
00168 <font class="comment">//          m_mdi, SLOT(lookupInLexicon(const QString&amp;, const QString&amp;)));              </font>
00169 <font class="comment">//      connect(presenter, SIGNAL(lookupInModule(const QString&amp;, const QString&amp;)),</font>
00170 <font class="comment">//          m_mdi, SLOT(lookupInModule(const QString&amp;, const QString&amp;)));                           </font>
00171 <font class="comment">//      if (presenter-&gt;isA("CBiblePresenter")) {</font>
00172 <font class="comment">//          connect(presenter-&gt;keyChooser(), SIGNAL(keyChanged(CSwordKey*)),</font>
00173 <font class="comment">//              m_mdi, SLOT(syncCommentaries(CSwordKey*)));     </font>
00174 <font class="comment">//      }</font>
00175 <font class="comment">//      presenter-&gt;lookup(modules.first()-&gt;name(),key);     </font>
00176 <font class="comment">//  }</font>
00177 
00178     kapp-&gt;restoreOverrideCursor();  
00179     <font class="keywordflow">return</font> displayWindow;
00180 }
00181 
00182 
<a name="l00184"></a><a class="code" href="class_bible_time.html#h2">00184</a> <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* <a class="code" href="class_bible_time.html#h1">BibleTime::createDisplayWindow</a>(<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; key) {
00185     ListCSwordModuleInfo list;
00186     list.append(module);
00187     
00188     <font class="keywordflow">return</font> <a class="code" href="class_bible_time.html#h1">createDisplayWindow</a>(list, key);      
00189 }
00190 
<a name="l00192"></a><a class="code" href="class_bible_time.html#b5">00192</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b5">BibleTime::refreshPresenters</a>() {
00193     <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> index;             
00194     <font class="keywordflow">for</font> ( index = 0; index &lt; m_mdi-&gt;windowList().count(); index++) {
00195         <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* window = dynamic_cast&lt;CDisplayWindow*&gt;(m_mdi-&gt;windowList().at(index));
00196         <font class="keywordflow">if</font> (window)
00197         window-&gt;<a class="code" href="class_c_display_window.html#a6">refresh</a>();
00198     }
00199 }
00200 
<a name="l00202"></a><a class="code" href="class_bible_time.html#b7">00202</a> <font class="keywordtype">bool</font> <a class="code" href="class_bible_time.html#b7">BibleTime::queryExit</a>(){
00203   <font class="keywordflow">if</font> (!m_initialized)
00204     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00205     <a class="code" href="class_bible_time.html#a4">saveSettings</a>();
00206     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00207 }
00208 
<a name="l00210"></a><a class="code" href="class_bible_time.html#b6">00210</a> <font class="keywordtype">bool</font> <a class="code" href="class_bible_time.html#b6">BibleTime::queryClose</a>(){
00211     <font class="keywordtype">bool</font> ret = <font class="keyword">true</font>;
00212     <font class="keywordflow">for</font> ( <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> index = 0; index &lt; m_mdi-&gt;windowList().count(); ++index) {
00213         <font class="keywordflow">if</font> (<a class="code" href="class_c_display_window.html">CDisplayWindow</a>* window = dynamic_cast&lt;CDisplayWindow*&gt;(m_mdi-&gt;windowList().at(index)))
00214         ret = window-&gt;<a class="code" href="class_c_display_window.html#a13">queryClose</a>() &amp;&amp; ret;
00215     }   
00216     <font class="keywordflow">return</font> ret;
00217 }
00218 
<a name="l00220"></a><a class="code" href="class_bible_time.html#a2">00220</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a2">BibleTime::show</a>(){
00221     KMainWindow::show();    
00222     <font class="comment">//if we show BibleTime for the first time we are ready for processing</font>
00223     <font class="comment">//but not before this point.</font>
00224     m_initialized = <font class="keyword">true</font>;
00225 }
00226 
<a name="l00228"></a><a class="code" href="class_bible_time.html#b10">00228</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b10">BibleTime::saveProperties</a>(KConfig* <font class="comment">/*myConfig*/</font>){
00229 
00230 }
00231 
<a name="l00233"></a><a class="code" href="class_bible_time.html#b9">00233</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#b9">BibleTime::readProperties</a>(KConfig* <font class="comment">/*myConfig*/</font>){
00234 
00235 }
00236 
<a name="l00238"></a><a class="code" href="class_bible_time.html#a5">00238</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#a5">BibleTime::restoreWorkspace</a>(){ 
00239     <font class="keywordflow">if</font> (<a class="code" href="class_c_profile.html">CProfile</a>* p = m_profileMgr.<a class="code" href="class_c_profile_mgr.html#a7">startupProfile</a>())
00240         <a class="code" href="class_bible_time.html#h15">loadProfile</a>(p);
00241 }
00242 
<a name="l00244"></a><a class="code" href="class_bible_time.html#g7">00244</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#g7">BibleTime::setCaption</a>( <font class="keyword">const</font> QString&amp; ){
00245     KMainWindow::setPlainCaption( KApplication::kApplication()-&gt;makeStdCaption( m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a5">currentApplicationCaption</a>() ) );
00246 }
00247 
<a name="l00249"></a><a class="code" href="class_bible_time.html#g6">00249</a> <font class="keywordtype">void</font> <a class="code" href="class_bible_time.html#g6">BibleTime::setPlainCaption</a>( <font class="keyword">const</font> QString&amp; ){
00250     KMainWindow::setPlainCaption( KApplication::kApplication()-&gt;makeStdCaption( m_mdi-&gt;<a class="code" href="class_c_m_d_i_area.html#a5">currentApplicationCaption</a>() ) );
00251 }
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:11 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
