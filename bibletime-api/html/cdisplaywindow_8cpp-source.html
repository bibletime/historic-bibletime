<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cdisplaywindow.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cdisplaywindow.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cdisplaywindow.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Don Mai 9 2002</font>
00005 <font class="comment">    copyright            : (C) 2002 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//BibleTime includes</font>
00019 <font class="preprocessor">#include "cdisplaywindow.h"</font>
00020 <font class="preprocessor">#include "creadwindow.h"</font>
00021 <font class="preprocessor">#include "cbiblereadwindow.h"</font>
00022 <font class="preprocessor">#include "ccommentaryreadwindow.h"</font>
00023 <font class="preprocessor">#include "clexiconreadwindow.h"</font>
00024 <font class="preprocessor">#include "cbookreadwindow.h"</font>
00025 <font class="preprocessor">#include "cmodulechooserbar.h"</font>
00026 <font class="preprocessor">#include "cdisplaysettingsbutton.h"</font>
00027 
00028 <font class="preprocessor">#include "backend/cswordkey.h"</font>
00029 
00030 <font class="preprocessor">#include "frontend/keychooser/ckeychooser.h"</font>
00031 
00032 <font class="preprocessor">#include "frontend/cmdiarea.h"</font>
00033 <font class="preprocessor">#include "frontend/cprofilewindow.h"</font>
00034 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00035 
00036 
00037 <font class="comment">//Qt includes</font>
00038 
00039 <font class="comment">//KDE includes</font>
00040 <font class="preprocessor">#include &lt;kaccel.h&gt;</font>
00041 
00042 <a class="code" href="class_c_read_window.html">CReadWindow</a>* CDisplayWindow::createReadInstance(ListCSwordModuleInfo modules, <a class="code" href="class_c_m_d_i_area.html">CMDIArea</a>* parent, <font class="keyword">const</font> <font class="keywordtype">char</font>* name = 0) {
00043   <font class="keywordflow">switch</font> (modules.first()-&gt;type()) {
00044         <font class="keywordflow">case</font> CSwordModuleInfo::Bible:
00045             <font class="keywordflow">return</font> <font class="keyword">new</font> <a class="code" href="class_c_bible_read_window.html">CBibleReadWindow</a>(modules, parent);
00046         <font class="keywordflow">case</font> CSwordModuleInfo::Commentary:
00047             <font class="keywordflow">return</font> <font class="keyword">new</font> <a class="code" href="class_c_commentary_read_window.html">CCommentaryReadWindow</a>(modules, parent);
00048         <font class="keywordflow">case</font> CSwordModuleInfo::Lexicon:
00049             <font class="keywordflow">return</font> <font class="keyword">new</font> <a class="code" href="class_c_lexicon_read_window.html">CLexiconReadWindow</a>(modules, parent);
00050         <font class="keywordflow">case</font> CSwordModuleInfo::GenericBook:         
00051             <font class="keywordflow">return</font> <font class="keyword">new</font> <a class="code" href="class_c_book_read_window.html">CBookReadWindow</a>(modules, parent);
00052         <font class="keywordflow">default</font>:
00053             qWarning(<font class="stringliteral">"unknown module type"</font>);
00054             <font class="keywordflow">break</font>;
00055     }
00056   <font class="keywordflow">return</font> 0;
00057 }
00058 
00059 
00060 <a class="code" href="class_c_write_window.html">CWriteWindow</a>* CDisplayWindow::createWriteInstance(ListCSwordModuleInfo modules, <a class="code" href="class_c_m_d_i_area.html">CMDIArea</a>* parent, <font class="keyword">const</font> <font class="keywordtype">char</font>* name = 0) {
00061     <font class="keywordflow">return</font> 0;
00062 }
00063 
00064 CDisplayWindow::CDisplayWindow(ListCSwordModuleInfo modules, <a class="code" href="class_c_m_d_i_area.html">CMDIArea</a> *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : KMainWindow(parent,name,WDestructiveClose) {
00065     m_mdi = parent;
00066     m_modules = modules;
00067   m_isReady = <font class="keyword">false</font>;
00068   m_moduleChooserBar = 0;
00069   m_swordKey = 0;
00070   m_keyChooser = 0;
00071   m_mainToolBar = 0;
00072   m_displaySettingsButton = 0;
00073 }
00074 
00075 CDisplayWindow::~CDisplayWindow(){
00076 <font class="comment">//  qWarning("destructor of CDisplayWindow");</font>
00077 }
00078 
00079 <a class="code" href="class_c_m_d_i_area.html">CMDIArea</a>* <font class="keyword">const</font> CDisplayWindow::mdi() {
00080   Q_ASSERT(m_mdi);
00081     <font class="keywordflow">return</font> m_mdi;
00082 }
00083 
<a name="l00085"></a><a class="code" href="class_c_display_window.html#a1">00085</a> <font class="keyword">const</font> QString <a class="code" href="class_c_display_window.html#a1">CDisplayWindow::windowCaption</a>(){
00086 <font class="comment">//  qWarning("CDisplayWindow::windowCaption()");</font>
00087     <font class="keywordflow">if</font> (!m_modules.count())
00088         <font class="keywordflow">return</font> QString::null;
00089 
00090     QString ret = m_modules.first()-&gt;name();        
00091     <font class="keywordflow">if</font> (m_modules.count() &gt; 1) {
00092         <font class="keywordflow">for</font> (m_modules.next(); m_modules.current(); m_modules.next())    {
00093             ret += <font class="stringliteral">" | "</font> + m_modules.current()-&gt;name(); 
00094         }
00095     }
00096     <font class="keywordflow">return</font> ret;
00097 }
00098 
<a name="l00100"></a><a class="code" href="class_c_display_window.html#a2">00100</a> ListCSwordModuleInfo&amp; <a class="code" href="class_c_display_window.html#a2">CDisplayWindow::modules</a>(){
00101 <font class="comment">//  qWarning("CDisplayWindow::modules()");</font>
00102 <font class="comment">//  qWarning("count is %i", m_modules.count());</font>
00103     <font class="keywordflow">return</font> m_modules;
00104 }
00105 
<a name="l00107"></a><a class="code" href="class_c_display_window.html#a5">00107</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a5">CDisplayWindow::setCaption</a>( <font class="keyword">const</font> QString&amp;  ){
00108     QWidget::setCaption( <a class="code" href="class_c_display_window.html#a1">windowCaption</a>() );
00109 }
00110 
<a name="l00111"></a><a class="code" href="class_c_display_window.html#d2">00111</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#d2">CDisplayWindow::insertKeyboardActions</a>( KAccel* <font class="keyword">const</font> accel ) {
00112 }
00113 
<a name="l00115"></a><a class="code" href="class_c_display_window.html#b3">00115</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#b3">CDisplayWindow::windowActivated</a>( <font class="keyword">const</font> <font class="keywordtype">bool</font> hasFocus ){
00116     <font class="keywordflow">if</font> (accel())
00117         accel()-&gt;setEnabled(hasFocus);
00118 }
00119 
<a name="l00121"></a><a class="code" href="class_c_display_window.html#h2">00121</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#h2">CDisplayWindow::polish</a>(){
00122 <font class="comment">//  qWarning("CDisplayWindow::polish()");</font>
00123   KMainWindow::polish();
00124 }
00125 
<a name="l00127"></a><a class="code" href="class_c_display_window.html#a6">00127</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a6">CDisplayWindow::refresh</a>() {
00128 <font class="comment">//  qWarning("CDisplayWindow::refresh()");</font>
00129     m_filterOptions = CBTConfig::getFilterOptionDefaults();
00130     m_displayOptions = CBTConfig::getDisplayOptionDefaults();
00131 
00132     <font class="keywordflow">if</font> (<a class="code" href="class_c_display_window.html#a20">displaySettingsButton</a>())
00133         <a class="code" href="class_c_display_window.html#a20">displaySettingsButton</a>()-&gt;reset(<a class="code" href="class_c_display_window.html#a2">modules</a>());
00134 }
00135 
<a name="l00137"></a><a class="code" href="class_c_display_window.html#a10">00137</a> CSwordBackend::FilterOptionsBool&amp; <a class="code" href="class_c_display_window.html#a10">CDisplayWindow::filterOptions</a>() {
00138 <font class="comment">//  qWarning("CDisplayWindow::filterOptions()");</font>
00139     <font class="keywordflow">return</font> m_filterOptions;
00140 }
00141 
<a name="l00143"></a><a class="code" href="class_c_display_window.html#a9">00143</a> CSwordBackend::DisplayOptionsBool&amp; <a class="code" href="class_c_display_window.html#a9">CDisplayWindow::displayOptions</a>() {
00144 <font class="comment">//  qWarning("CDisplayWindow::displayOptions()");   </font>
00145     <font class="keywordflow">return</font> m_displayOptions;
00146 }
00147 
<a name="l00149"></a><a class="code" href="class_c_display_window.html#a8">00149</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a8">CDisplayWindow::setDisplayOptions</a>( <font class="keyword">const</font> CSwordBackend::DisplayOptionsBool displayOptions ){
00150     m_displayOptions = displayOptions;
00151 }
00152 
<a name="l00154"></a><a class="code" href="class_c_display_window.html#a7">00154</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a7">CDisplayWindow::setFilterOptions</a>( CSwordBackend::FilterOptionsBool filterOptions ){
00155   m_filterOptions = filterOptions;
00156 }
00157 
<a name="l00159"></a><a class="code" href="class_c_display_window.html#a12">00159</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_display_window.html#a12">CDisplayWindow::isReady</a>()<font class="keyword"> const</font>{
00160     <font class="keywordflow">return</font> m_isReady;
00161 }
00162 
<a name="l00164"></a><a class="code" href="class_c_display_window.html#a11">00164</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a11">CDisplayWindow::setReady</a>( <font class="keyword">const</font> <font class="keywordtype">bool</font> ready ){
00165     m_isReady = ready;
00166 }
00167 
<a name="l00169"></a><a class="code" href="class_c_display_window.html#a13">00169</a> <font class="keywordtype">bool</font> <a class="code" href="class_c_display_window.html#a13">CDisplayWindow::queryClose</a>(){
00170     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00171 }
00172 
<a name="l00174"></a><a class="code" href="class_c_display_window.html#a14">00174</a> <a class="code" href="class_c_key_chooser.html">CKeyChooser</a>* <font class="keyword">const</font> <a class="code" href="class_c_display_window.html#a14">CDisplayWindow::keyChooser</a>(){
00175     <font class="keywordflow">return</font> m_keyChooser;
00176 }
00177 
<a name="l00179"></a><a class="code" href="class_c_display_window.html#b4">00179</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#b4">CDisplayWindow::setKeyChooser</a>( <a class="code" href="class_c_key_chooser.html">CKeyChooser</a>* ck ){
00180   m_keyChooser = ck;
00181 }
00182 
<a name="l00184"></a><a class="code" href="class_c_display_window.html#a16">00184</a> <a class="code" href="class_c_sword_key.html">CSwordKey</a>* <a class="code" href="class_c_display_window.html#a16">CDisplayWindow::key</a>() {
00185     <font class="keywordflow">return</font> m_swordKey;
00186 }
00187 
<a name="l00189"></a><a class="code" href="class_c_display_window.html#a15">00189</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a15">CDisplayWindow::setKey</a>( <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key ){
00190     m_swordKey = key;
00191 }
00192 
00193 <font class="keywordtype">void</font> CDisplayWindow::modulesChanged(){
00194   <a class="code" href="class_c_display_window.html#b8">setModules</a>( m_moduleChooserBar-&gt;<a class="code" href="class_c_module_chooser_bar.html#a1">getModuleList</a>() );
00195   <font class="keywordflow">if</font> (!<a class="code" href="class_c_display_window.html#a2">modules</a>().count())
00196     close();
00197   <font class="keywordflow">else</font> {
00198         <font class="keywordflow">if</font> (<a class="code" href="class_c_display_window.html#a20">displaySettingsButton</a>())
00199         <a class="code" href="class_c_display_window.html#a20">displaySettingsButton</a>()-&gt;reset(<a class="code" href="class_c_display_window.html#a2">modules</a>());
00200       <a class="code" href="class_c_display_window.html#a16">key</a>()-&gt;<a class="code" href="class_c_sword_key.html#a4">module</a>(<a class="code" href="class_c_display_window.html#a2">modules</a>().first());
00201       <a class="code" href="class_c_display_window.html#a14">keyChooser</a>()-&gt;<a class="code" href="class_c_key_chooser.html#g3">setModule</a>(<a class="code" href="class_c_display_window.html#a2">modules</a>().first());   
00202       <a class="code" href="class_c_display_window.html#h1">lookup</a>(<a class="code" href="class_c_display_window.html#a16">key</a>());
00203     }
00204 }
00205 
<a name="l00207"></a><a class="code" href="class_c_display_window.html#b6">00207</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#h1">CDisplayWindow::lookup</a>( <a class="code" href="class_c_sword_key.html">CSwordKey</a>* key ){
00208 <font class="comment">//  qWarning("CDisplayWindow::lookup( CSwordKey* key )");</font>
00209 }
00210 
<a name="l00212"></a><a class="code" href="class_c_display_window.html#b5">00212</a> <a class="code" href="class_c_module_chooser_bar.html">CModuleChooserBar</a>* <font class="keyword">const</font> <a class="code" href="class_c_display_window.html#b5">CDisplayWindow::moduleChooserBar</a>()<font class="keyword"> const</font>{
00213     <font class="keywordflow">return</font> m_moduleChooserBar;
00214 }
00215 
<a name="l00217"></a><a class="code" href="class_c_display_window.html#b7">00217</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#b7">CDisplayWindow::setModuleChooserBar</a>( <a class="code" href="class_c_module_chooser_bar.html">CModuleChooserBar</a>* bar ){
00218     <font class="keywordflow">if</font> (m_moduleChooserBar)
00219         disconnect(m_moduleChooserBar, SIGNAL(sigChanged()), <font class="keyword">this</font>, SLOT(modulesChanged()));
00220     m_moduleChooserBar = bar;
00221     connect(bar, SIGNAL(sigChanged()), SLOT(modulesChanged()));
00222 }
00223 
<a name="l00225"></a><a class="code" href="class_c_display_window.html#b8">00225</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#b8">CDisplayWindow::setModules</a>( <font class="keyword">const</font> ListCSwordModuleInfo newModules ){
00226     m_modules = newModules;
00227 }
00228 
<a name="l00230"></a><a class="code" href="class_c_display_window.html#a17">00230</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_display_window.html#a17">CDisplayWindow::init</a>( <font class="keyword">const</font> QString&amp; keyName ){
00231   <a class="code" href="class_c_display_window.html#b10">initView</a>();
00232   setMinimumSize( 350,300 );    
00233   <a class="code" href="class_c_display_window.html#a5">setCaption</a>(<a class="code" href="class_c_display_window.html#a1">windowCaption</a>());
00234   show();
00235     <a class="code" href="class_c_display_window.html#b9">initConnections</a>();
00236   <a class="code" href="class_c_display_window.html#b2">initKeyboardActions</a>();
00237   <a class="code" href="class_c_display_window.html#a6">refresh</a>();
00238 
00239   <a class="code" href="class_c_display_window.html#a16">key</a>()-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(keyName);
00240 
00241   <font class="keywordflow">return</font> <font class="keyword">true</font>;
00242 }
00243 
<a name="l00245"></a><a class="code" href="class_c_display_window.html#a19">00245</a> KToolBar* <font class="keyword">const</font> <a class="code" href="class_c_display_window.html#a19">CDisplayWindow::mainToolBar</a>()<font class="keyword"> const</font>{
00246   <font class="keywordflow">return</font> m_mainToolBar;
00247 }
00248 
<a name="l00250"></a><a class="code" href="class_c_display_window.html#a18">00250</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a18">CDisplayWindow::setMainToolBar</a>( KToolBar* bar ){
00251     m_mainToolBar = bar;
00252 }
00253 
<a name="l00255"></a><a class="code" href="class_c_display_window.html#a20">00255</a> CDisplaySettingsButton* <font class="keyword">const</font> <a class="code" href="class_c_display_window.html#a20">CDisplayWindow::displaySettingsButton</a>()<font class="keyword"> const</font>{
00256   <font class="keywordflow">return</font> m_displaySettingsButton;
00257 }
00258 
<a name="l00260"></a><a class="code" href="class_c_display_window.html#a21">00260</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#a21">CDisplayWindow::setDisplaySettingsButton</a>( CDisplaySettingsButton* button ){
00261   <font class="keywordflow">if</font> (m_displaySettingsButton)
00262         disconnect(m_displaySettingsButton, SIGNAL( sigChanged() ),<font class="keyword">this</font>,    SLOT(<a class="code" href="class_c_display_window.html#h1">lookup</a>() ));
00263   m_displaySettingsButton = button; 
00264     connect(m_displaySettingsButton, SIGNAL(sigChanged()),<font class="keyword">this</font>, SLOT(<a class="code" href="class_c_display_window.html#h1">lookup</a>()));
00265 }
00266 
<a name="l00268"></a><a class="code" href="class_c_display_window.html#h1">00268</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#h1">CDisplayWindow::lookup</a>(){
00269 <font class="comment">//  qWarning("CDisplayWindow::lookup()");</font>
00270     <a class="code" href="class_c_display_window.html#h1">lookup</a>( <a class="code" href="class_c_display_window.html#a16">key</a>() );
00271 }
00272 
<a name="l00273"></a><a class="code" href="class_c_display_window.html#g0">00273</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#h1">CDisplayWindow::lookup</a>( <font class="keyword">const</font> QString&amp; moduleName, <font class="keyword">const</font> QString&amp; keyName ) {
00274 <font class="comment">//  qWarning("CDisplayWindow::lookup( const QString&amp;, const QString&amp; )");</font>
00275   Q_ASSERT(<a class="code" href="class_c_display_window.html#a12">isReady</a>());
00276   <font class="keywordflow">if</font> (!<a class="code" href="class_c_display_window.html#a12">isReady</a>())
00277     <font class="keywordflow">return</font>;
00278 
00279 
00280     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a11">findModuleByName</a>(moduleName);
00281     <font class="keywordflow">if</font> (m &amp;&amp; <a class="code" href="class_c_display_window.html#a2">modules</a>().containsRef(m) &amp;&amp; !keyName.isEmpty()) {
00282         <a class="code" href="class_c_display_window.html#a16">key</a>()-&gt;<a class="code" href="class_c_sword_key.html#a1">key</a>(keyName);
00283         <a class="code" href="class_c_display_window.html#a14">keyChooser</a>()-&gt;<a class="code" href="class_c_key_chooser.html#g0">setKey</a>(<a class="code" href="class_c_display_window.html#a16">key</a>()); <font class="comment">//the key chooser does send an update signal</font>
00284     }
00285     <font class="keywordflow">else</font> {
00286         QWidgetList windows = mdi()-&gt;windowList();
00287     <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;
00288         <a class="code" href="class_c_display_window.html">CDisplayWindow</a>* dw = 0;
00289     <font class="keywordflow">for</font> (windows.first(); windows.current(); windows.next()) {
00290         dw = dynamic_cast&lt;CDisplayWindow*&gt;(windows.current());
00291         <font class="keywordflow">if</font> (dw &amp;&amp; dw-&gt;<a class="code" href="class_c_display_window.html#a2">modules</a>().containsRef(m)) {
00292                 found = <font class="keyword">true</font>;
00293                 <font class="keywordflow">break</font>;
00294             }
00295         }
00296         <font class="keywordflow">if</font> (found) {
00297             dw-&gt;<a class="code" href="class_c_display_window.html#g0">lookup</a>(moduleName, keyName);
00298     }
00299         <font class="keywordflow">else</font> {
00300         ListCSwordModuleInfo mList;
00301         mList.append(m);
00302             mdi()-&gt;<a class="code" href="class_c_m_d_i_area.html#g5">emitCreateDisplayWindow</a>(mList, keyName);
00303     }
00304     }   
00305 }
00306 
<a name="l00307"></a><a class="code" href="class_c_display_window.html#g1">00307</a> <font class="keywordtype">void</font> <a class="code" href="class_c_display_window.html#h1">CDisplayWindow::lookup</a>( <font class="keyword">const</font> QString&amp; key ) {
00308 <font class="comment">//  qWarning("CDisplayWindow::lookup( const QString&amp; key )");</font>
00309     <a class="code" href="class_c_display_window.html#h1">lookup</a>(<a class="code" href="class_c_display_window.html#a2">modules</a>().first()-&gt;name(), <a class="code" href="class_c_display_window.html#a16">key</a>);
00310 }
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:12 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
