<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cmdiarea.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cmdiarea.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cmdiarea.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Wed Jan 19 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "cmdiarea.h"</font>
00019 <font class="preprocessor">#include "../backend/cswordmoduleinfo.h"</font>
00020 <font class="preprocessor">#include "../backend/cswordversekey.h"</font>
00021 <font class="preprocessor">#include "presenters/cbiblepresenter.h"</font>
00022 <font class="preprocessor">#include "presenters/clexiconpresenter.h"</font>
00023 <font class="preprocessor">#include "presenters/ccommentarypresenter.h"</font>
00024 <font class="preprocessor">#include "keychooser/ckeychooser.h"</font>
00025 <font class="preprocessor">#include "../resource.h"</font>
00026 <font class="preprocessor">#include "../whatsthisdef.h"</font>
00027 <font class="preprocessor">#include "../../config.h"</font>
00028 
00029 <font class="comment">//KDE includes</font>
00030 <font class="preprocessor">#include &lt;kpopupmenu.h&gt;</font>
00031 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00032 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00033 
00034 <font class="comment">//QT includes</font>
00035 <font class="preprocessor">#include &lt;qobjectlist.h&gt;</font>
00036 <font class="preprocessor">#include &lt;qtimer.h&gt;</font>
00037 <font class="preprocessor">#include &lt;qevent.h&gt;</font>
00038 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00039 
00040 CMDIArea::CMDIArea(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00041     : QWorkspace(parent, name) {            
00042     m_childEvent = <font class="keyword">false</font>;
00043     guiOption = Nothing;
00044     m_appCaption = QString::null;
00045     
00046     <a class="code" href="class_c_lexicon_presenter.html#c1">initView</a>();
00047     <a class="code" href="class_c_lexicon_presenter.html#c0">initConnections</a>();
00048     readSettings();
00049 }
00050 
00051 CMDIArea::~CMDIArea(){
00052 }
00053 
<a name="l00055"></a><a class="code" href="class_c_m_d_i_area.html#b3">00055</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#b3">CMDIArea::initView</a>(){
00056     QWhatsThis::add(<font class="keyword">this</font>, WT_MDI_AREA_WIDGET ); 
00057 }
00058 
<a name="l00060"></a><a class="code" href="class_c_m_d_i_area.html#b2">00060</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#b2">CMDIArea::initConnections</a>(){
00061     connect(<font class="keyword">this</font>, SIGNAL(windowActivated(QWidget*)),
00062         <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_m_d_i_area.html#g0">slotClientActivated</a>(QWidget*)));
00063 }
00064 
<a name="l00066"></a><a class="code" href="class_c_m_d_i_area.html#g0">00066</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#g0">CMDIArea::slotClientActivated</a>(QWidget* client){
00067 <font class="comment">//  qWarning("slotClientActivated(QWidget* client)");</font>
00068     <font class="keywordflow">if</font> (!client)
00069         <font class="keywordflow">return</font>;             
00070     <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* sp = dynamic_cast&lt;CSwordPresenter*&gt;(client);   
00071     <font class="keywordflow">if</font> (sp &amp;&amp; !sp-&gt;<a class="code" href="class_c_sword_presenter.html#g5">initialized</a>())
00072         <font class="keywordflow">return</font>;
00073     
00074     m_appCaption = client-&gt;caption().stripWhiteSpace(); 
00075 <font class="comment">//  qWarning("caption is %s", m_appCaption.latin1());</font>
00076     emit <a class="code" href="class_c_m_d_i_area.html#j0">sigSetToplevelCaption</a>( m_appCaption ); 
00077 
00078     <a class="code" href="class_c_bible_presenter.html">CBiblePresenter</a>* p = dynamic_cast&lt;CBiblePresenter*&gt;(client);
00079     <font class="keywordflow">if</font> (p &amp;&amp; p-&gt;<a class="code" href="class_c_sword_presenter.html#g1">keyChooser</a>())
00080         <a class="code" href="class_c_m_d_i_area.html#g4">syncCommentaries</a>( p-&gt;<a class="code" href="class_c_sword_presenter.html#g1">keyChooser</a>()-&gt;<a class="code" href="class_c_key_chooser.html#g2">key</a>() );
00081 }
00082 
<a name="l00084"></a><a class="code" href="class_c_m_d_i_area.html#b0">00084</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#b0">CMDIArea::childEvent</a> ( QChildEvent * e ){
00085     <font class="keywordflow">if</font> (m_childEvent)
00086         <font class="keywordflow">return</font>; 
00087     QWorkspace::childEvent(e);      
00088     m_childEvent = <font class="keyword">true</font>;
00089     
00090     <font class="keywordflow">if</font> (!windowList().count()) {
00091         m_appCaption = QString::null;
00092         emit <a class="code" href="class_c_m_d_i_area.html#j0">sigSetToplevelCaption</a>( KApplication::kApplication()-&gt;makeStdCaption(m_appCaption) );       
00093         emit <a class="code" href="class_c_m_d_i_area.html#j1">sigLastPresenterClosed</a>();
00094     }   
00095     <font class="keywordflow">if</font> (!e) {
00096         m_childEvent = <font class="keyword">false</font>;
00097         <font class="keywordflow">return</font>;
00098     }
00099     
00100     <font class="keywordflow">if</font> (e-&gt;inserted() || e-&gt;removed()) {
00101         <font class="keywordflow">switch</font> (guiOption) {
00102             <font class="keywordflow">case</font> autoTile:
00103                 QTimer::singleShot( 0, <font class="keyword">this</font>, SLOT(tile()) );
00104 <font class="comment">//              tile();</font>
00105                 <font class="keywordflow">break</font>;
00106             <font class="keywordflow">case</font> autoCascade:
00107                 QTimer::singleShot( 0, <font class="keyword">this</font>, SLOT(cascade()) );
00108 <font class="comment">//              cascade();</font>
00109                 <font class="keywordflow">break</font>;
00110             <font class="keywordflow">default</font>:
00111                 <font class="keywordflow">break</font>;
00112         }
00113     }
00114 
00115     m_childEvent = <font class="keyword">false</font>;
00116 }
00117 
<a name="l00119"></a><a class="code" href="class_c_m_d_i_area.html#b1">00119</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#b1">CMDIArea::resizeEvent</a>(QResizeEvent* e){    
00120     QWorkspace::resizeEvent(e); 
00121     <font class="keywordflow">switch</font> (guiOption) {
00122         <font class="keywordflow">case</font> autoTile:
00123             QTimer::singleShot( 0, <font class="keyword">this</font>, SLOT(tile()) );
00124 <font class="comment">//          tile();</font>
00125             <font class="keywordflow">break</font>;
00126         <font class="keywordflow">case</font> autoCascade:
00127             QTimer::singleShot( 0, <font class="keyword">this</font>, SLOT(cascade()) );
00128 <font class="comment">//          cascade();</font>
00129             <font class="keywordflow">break</font>;
00130         <font class="keywordflow">default</font>:
00131             <font class="keywordflow">break</font>;
00132     }
00133 }
00134 
00136 <font class="keywordtype">void</font> CMDIArea::saveSettings(){
00137 }
00138 
00140 <font class="keywordtype">void</font> CMDIArea::readSettings(){
00141 }
00142 
<a name="l00144"></a><a class="code" href="class_c_m_d_i_area.html#g1">00144</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#g1">CMDIArea::deleteAll</a>(){
00145     QWidgetList windows = windowList();
00146     
00147     setUpdatesEnabled(<font class="keyword">false</font>);
00148     <font class="keywordflow">for</font> ( QWidget* w = windows.first(); w; w = windows.next() ) {
00149         w-&gt;setUpdatesEnabled(<font class="keyword">false</font>);
00150         m_deleteWindows.clear();
00151         <font class="keyword">delete</font> w;
00152     }
00153     setUpdatesEnabled(<font class="keyword">true</font>);        
00154 }
00155 
<a name="l00157"></a><a class="code" href="class_c_m_d_i_area.html#a4">00157</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#a4">CMDIArea::setGUIOption</a>( mdiOption new_GUIOption){
00158     guiOption = new_GUIOption;
00159     <font class="comment">//now do the initial action</font>
00160     <font class="keywordflow">switch</font> (guiOption) {
00161         <font class="keywordflow">case</font> autoTile:
00162             tile();
00163             <font class="keywordflow">break</font>;
00164         <font class="keywordflow">case</font> autoCascade:
00165             cascade();
00166             <font class="keywordflow">break</font>;
00167         <font class="keywordflow">case</font> Nothing:
00168             <font class="keywordflow">break</font>;
00169     }   
00170 }
00171 
00173 <font class="keywordtype">void</font> CMDIArea::tile(){
00174     <font class="keywordflow">if</font> (!isUpdatesEnabled() || !windowList().count() )  
00175         <font class="keywordflow">return</font>;
00176     <font class="keywordflow">if</font> (windowList().count() == 1 <font class="comment">/*&amp;&amp; !windowList().at(0)-&gt;isHidden() &amp;&amp; !windowList().at(0)-&gt;isMinimized()*/</font>) {
00177         m_appCaption = windowList().at(0)-&gt;caption();
00178         windowList().at(0)-&gt;showMaximized();
00179     }
00180     <font class="keywordflow">else</font>
00181         QWorkspace::tile();
00182 }
00183 
00185 <font class="keywordtype">void</font> CMDIArea::cascade(){
00186     <font class="keywordflow">if</font> (!isUpdatesEnabled() || !windowList().count() )
00187         <font class="keywordflow">return</font>;     
00188     <font class="keywordflow">if</font> (windowList().count() == 1 <font class="comment">/*&amp;&amp; !windowList().at(0)-&gt;isHidden() &amp;&amp; !windowList().at(0)-&gt;isMinimized()*/</font>) {
00189         m_appCaption = windowList().at(0)-&gt;caption();       
00190         windowList().at(0)-&gt;showMaximized();
00191     }
00192     <font class="keywordflow">else</font>
00193         QWorkspace::cascade();
00194 }
00195 
<a name="l00197"></a><a class="code" href="class_c_m_d_i_area.html#g4">00197</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#g4">CMDIArea::syncCommentaries</a>(<a class="code" href="class_c_sword_key.html">CSwordKey</a>* syncKey){
00198     QWidgetList windows = windowList(); 
00199     <font class="keywordflow">if</font> (!windows.count())
00200         <font class="keywordflow">return</font>; 
00201     
00202     <font class="keywordflow">for</font> (windows.first(); windows.current(); windows.next()) {
00203         <a class="code" href="class_c_commentary_presenter.html">CCommentaryPresenter</a>* p = dynamic_cast&lt;CCommentaryPresenter*&gt;(windows.current());
00204         <font class="keywordflow">if</font> (p)
00205             p-&gt;<a class="code" href="class_c_commentary_presenter.html#a2">synchronize</a>(syncKey);
00206     }   
00207 }
00208 
<a name="l00210"></a><a class="code" href="class_c_m_d_i_area.html#g5">00210</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#g5">CMDIArea::lookupInLexicon</a>(<font class="keyword">const</font> QString&amp; text, <font class="keyword">const</font> QString&amp; module){
00211 <font class="comment">//  qWarning("CMDIArea::lookupInLexicon(const QString&amp; text, const QString&amp; module)");</font>
00212     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);
00213     ASSERT(m);
00214     <font class="keywordflow">if</font> (!m)
00215         <font class="keywordflow">return</font>;
00216     <a class="code" href="class_c_lexicon_presenter.html">CLexiconPresenter</a>* p = 0;
00217     
00218     QWidgetList windows = windowList(); 
00219     <font class="keywordflow">if</font> (!windows.count())
00220         <font class="keywordflow">return</font>;
00221     <font class="keywordtype">bool</font> found = <font class="keyword">false</font>;
00222     <font class="keywordflow">for</font> (windows.first(); windows.current(); windows.next()) {
00223         p = dynamic_cast&lt;CLexiconPresenter*&gt;(windows.current());
00224         <font class="keywordflow">if</font> (p &amp;&amp; (m == p-&gt;<a class="code" href="class_c_sword_presenter.html#a3">getModuleList</a>().first())) {
00225             found = <font class="keyword">true</font>;
00226             <font class="keywordflow">break</font>;
00227         }
00228     }
00229     <font class="keywordflow">if</font> (!found)
00230         emit createNewSwordPresenter(m, text);
00231     <font class="keywordflow">else</font>
00232         p-&gt;<a class="code" href="class_c_lexicon_presenter.html#g0">lookup</a>(module, text);
00233 }
00234 
<a name="l00236"></a><a class="code" href="class_c_m_d_i_area.html#g6">00236</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#g6">CMDIArea::lookupInModule</a>(<font class="keyword">const</font> QString&amp; module, <font class="keyword">const</font> QString&amp; key){
00237 <font class="comment">//  qWarning("CMDIArea::lookupInLexicon(const QString&amp; text, const QString&amp; module)");</font>
00238     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a12">findModuleByName</a>(module);
00239     <font class="keywordflow">if</font> (!m)
00240         <font class="keywordflow">return</font>;
00241     <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* p = 0;
00242 
00243     <font class="keywordtype">bool</font> found = <font class="keyword">false</font>; 
00244     QWidgetList windows = windowList(); 
00245     <font class="keywordflow">for</font> (windows.first(); windows.current(); windows.next()) {
00246         p = dynamic_cast&lt;CSwordPresenter*&gt;(windows.current());
00247         <font class="keywordflow">if</font> (p &amp;&amp; (p-&gt;<a class="code" href="class_c_sword_presenter.html#a3">getModuleList</a>().containsRef(m))) {
00248             found = <font class="keyword">true</font>;
00249             <font class="keywordflow">break</font>;
00250         }
00251     }
00252     <font class="keywordflow">if</font> (!found)
00253         emit createNewSwordPresenter(m, key);
00254     <font class="keywordflow">else</font>
00255         p-&gt;<a class="code" href="class_c_sword_presenter.html#g0">lookup</a>(module, key);
00256 }
00257 
<a name="l00259"></a><a class="code" href="class_c_m_d_i_area.html#g7">00259</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#g7">CMDIArea::closePresenter</a>(<a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* p){
00260     <font class="keywordflow">if</font> (!p)
00261         <font class="keywordflow">return</font>;
00262     
00263     m_deleteWindows.append(p);
00264   QTimer::singleShot(5000, <font class="keyword">this</font>, SLOT(<a class="code" href="class_c_m_d_i_area.html#i0">deleteCurrentPresenter</a>()) );  
00265 }
00266 
<a name="l00268"></a><a class="code" href="class_c_m_d_i_area.html#i0">00268</a> <font class="keywordtype">void</font> <a class="code" href="class_c_m_d_i_area.html#i0">CMDIArea::deleteCurrentPresenter</a>(){
00269     setUpdatesEnabled(<font class="keyword">false</font>);
00270     <a class="code" href="class_c_sword_presenter.html">CSwordPresenter</a>* p = m_deleteWindows.first();
00271 <font class="comment">//  if ( p ) {</font>
00272         <font class="keyword">delete</font> p;
00273         m_deleteWindows.removeRef(p);
00274 <font class="comment">//  }</font>
00275     setUpdatesEnabled(<font class="keyword">true</font>);
00276     <a class="code" href="class_c_m_d_i_area.html#g0">slotClientActivated</a>(activeWindow());
00277     <font class="keywordflow">if</font> (activeWindow())
00278         m_appCaption = activeWindow()-&gt;caption();
00279 }
00280 
<a name="l00282"></a><a class="code" href="class_c_m_d_i_area.html#a5">00282</a> <font class="keyword">const</font> QString <a class="code" href="class_c_m_d_i_area.html#a5">CMDIArea::currentApplicationCaption</a>()<font class="keyword"> const </font>{
00283     <font class="keywordflow">return</font> m_appCaption;
00284 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
