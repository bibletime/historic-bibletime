<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>csearchdialogscope.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>csearchdialogscope.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          csearchdialogscope.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Sun Nov 12 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="preprocessor">#include "csearchdialogscope.h"</font>
00019 <font class="preprocessor">#include "../../whatsthisdef.h"</font>
00020 <font class="preprocessor">#include "../../tooltipdef.h"</font>
00021 
00022 <font class="preprocessor">#include &lt;qpushbutton.h&gt;</font>
00023 <font class="preprocessor">#include &lt;qradiobutton.h&gt;</font>
00024 <font class="preprocessor">#include &lt;qbuttongroup.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00026 <font class="preprocessor">#include &lt;qlabel.h&gt;</font>
00027 <font class="preprocessor">#include &lt;qlistbox.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qgroupbox.h&gt;</font>
00029 <font class="preprocessor">#include &lt;qinputdialog.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qlineedit.h&gt;</font>
00031 <font class="preprocessor">#include &lt;qcombobox.h&gt;</font>
00032 <font class="preprocessor">#include &lt;qwhatsthis.h&gt;</font>
00033 <font class="preprocessor">#include &lt;qtooltip.h&gt;</font>
00034 
00035 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00036 <font class="preprocessor">#include &lt;ksimpleconfig.h&gt;</font>
00037 
00038 <font class="preprocessor">#include "versekey.h"</font>
00039 
00040 CSearchDialogScopeChooser::CSearchDialogScopeChooser(QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : QWidget(parent,name) {
00041 
00042   QHBoxLayout*  HLayout = <font class="keyword">new</font> QHBoxLayout(<font class="keyword">this</font>);
00043 
00044   noScope = <font class="keyword">new</font> QRadioButton(i18n(<font class="stringliteral">"No scope"</font>     ),<font class="keyword">this</font>);
00045     QToolTip::add(noScope, TT_SD_SCOPE_NO_SCOPE);
00046     QWhatsThis::add(noScope, WT_SD_SCOPE_NO_SCOPE);
00047     
00048   lastResultScope = <font class="keyword">new</font> QRadioButton(i18n(<font class="stringliteral">"Last result"</font>),<font class="keyword">this</font>);
00049     QToolTip::add(lastResultScope, TT_SD_SCOPE_LAST_RESULT);
00050     QWhatsThis::add(lastResultScope, WT_SD_SCOPE_LAST_RESULT);
00051 
00052   useScope = <font class="keyword">new</font> QRadioButton(i18n(<font class="stringliteral">"Use scope"</font>  ),<font class="keyword">this</font>);
00053     QToolTip::add(useScope, TT_SD_SCOPE_OWN_SCOPE);
00054     QWhatsThis::add(useScope, WT_SD_SCOPE_OWN_SCOPE);
00055 
00056   group = <font class="keyword">new</font> QButtonGroup();
00057   group-&gt;insert(noScope);
00058   group-&gt;insert(lastResultScope);
00059   group-&gt;insert(useScope);
00060   noScope-&gt;setChecked(<font class="keyword">true</font>);
00061 
00062   RangeChooser = <font class="keyword">new</font> QComboBox(<font class="keyword">this</font>);
00063   RangeLabel = <font class="keyword">new</font> QLabel(RangeChooser,  i18n(<font class="stringliteral">"Choose custom range"</font>),<font class="keyword">this</font>);
00064     QToolTip::add(RangeChooser, TT_SD_SCOPE_CHOOSER);
00065   QWhatsThis::add(RangeChooser, WT_SD_SCOPE_CHOOSER);
00066 
00067   editButton = <font class="keyword">new</font> QPushButton(i18n(<font class="stringliteral">"Edit ranges"</font>),<font class="keyword">this</font>);
00068   editButton-&gt;setFixedWidth(editButton-&gt;sizeHint().width());
00069     QToolTip::add(editButton, TT_SD_SCOPE_EDIT_SCOPE_BUTTON);
00070     QWhatsThis::add(editButton, WT_SD_SCOPE_EDIT_SCOPE_BUTTON); 
00071   connect(editButton,SIGNAL(clicked()),<font class="keyword">this</font>,SLOT(editButtonClicked()));
00072   connect(group,SIGNAL(clicked(<font class="keywordtype">int</font>)),<font class="keyword">this</font>,SLOT(scopeChanged()));
00073 
00074   QVBoxLayout*  VLayout_1 = <font class="keyword">new</font> QVBoxLayout(HLayout);
00075   VLayout_1-&gt;addWidget(noScope,                 Qt::AlignTop);
00076   VLayout_1-&gt;addWidget(lastResultScope, Qt::AlignTop);
00077   VLayout_1-&gt;addWidget(useScope,                Qt::AlignTop);
00078 
00079   HLayout-&gt;addStretch();
00080 
00081   QVBoxLayout*  VLayout_2 = <font class="keyword">new</font> QVBoxLayout(HLayout);
00082   VLayout_2-&gt;addWidget(RangeLabel);
00083   VLayout_2-&gt;addWidget(RangeChooser);
00084   VLayout_2-&gt;addWidget(editButton);
00085 
00086   HLayout-&gt;addStretch();
00087 
00088   config = <font class="keyword">new</font> KSimpleConfig(<font class="stringliteral">"bt-custom_ranges"</font>, <font class="keyword">false</font>);
00089   <font class="comment">//we use this to use the global standard</font>
00090   config-&gt;setGroup(QString::fromLatin1(<font class="stringliteral">"main"</font>));
00091   <font class="keywordflow">if</font> (config-&gt;readBoolEntry(<font class="stringliteral">"first usage"</font>, <font class="keyword">true</font>)) {     
00092     config-&gt;writeEntry(<font class="stringliteral">"first usage"</font>, <font class="keyword">false</font>);
00093     config-&gt;setGroup(QString::fromLatin1(<font class="stringliteral">"custom ranges"</font>));
00094     
00095       QMap&lt;QString,QString&gt; entryMap;
00096       entryMap.insert(i18n(<font class="stringliteral">"Old testament"</font>),          QString::fromLatin1(<font class="stringliteral">"Gen - Mal"</font>));
00097       entryMap.insert(i18n(<font class="stringliteral">"Moses/Pentateuch/Torah"</font>), QString::fromLatin1(<font class="stringliteral">"Gen - Deut"</font>));               
00098       entryMap.insert(i18n(<font class="stringliteral">"History"</font>),                QString::fromLatin1(<font class="stringliteral">"Jos - Est"</font>));        
00099       entryMap.insert(i18n(<font class="stringliteral">"Prophets"</font>),               QString::fromLatin1(<font class="stringliteral">"Isa - Mal"</font>));    
00100       entryMap.insert(i18n(<font class="stringliteral">"New testament"</font>),          QString::fromLatin1(<font class="stringliteral">"Mat - Rev"</font>));
00101       entryMap.insert(i18n(<font class="stringliteral">"Gospels"</font>),                              QString::fromLatin1(<font class="stringliteral">"Mat - Joh"</font>));
00102       entryMap.insert(i18n(<font class="stringliteral">"Letters/Epistels"</font>),             QString::fromLatin1(<font class="stringliteral">"Rom - Jude"</font>));
00103       entryMap.insert(i18n(<font class="stringliteral">"Paul's Epistels"</font>),              QString::fromLatin1(<font class="stringliteral">"Rom - Phile"</font>));
00104 
00105       QMap&lt;QString,QString&gt;::Iterator it;           
00106                 
00107         <font class="keywordflow">for</font> ( it = entryMap.begin(); it != entryMap.end(); ++it) {
00108           <font class="keywordflow">if</font> (it.key() != QString::null) {
00109                 QString text = QString::null;
00110             ListKey lk = VerseKey().ParseVerseList(it.data().local8Bit(),<font class="stringliteral">"Genesis 1:1"</font>,<font class="keyword">true</font>);
00111                 <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; lk.Count(); ++i) {
00112                     <font class="keywordflow">if</font> (i)
00113                         text.append(<font class="stringliteral">";"</font>);                                           
00114                     VerseKey* element = dynamic_cast&lt;VerseKey*&gt;(lk.GetElement(i));
00115                     <font class="keywordflow">if</font> (element)    
00116                         text += QString::fromLatin1(<font class="stringliteral">"%1 - %2"</font>)
00117                             .arg( QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)element-&gt;LowerBound()) )
00118                             .arg( QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)element-&gt;UpperBound()) );
00119                     <font class="keywordflow">else</font>
00120                         text += QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*lk.GetElement(i));         
00121                 }
00122                 config-&gt;writeEntry(it.key(),text);
00123             }   
00124     }
00125   }
00126 
00127   config-&gt;setGroup(QString(<font class="stringliteral">"custom ranges"</font>));
00128   QMap&lt;QString,QString&gt; entryMap = config-&gt;entryMap(QString(<font class="stringliteral">"custom ranges"</font>));
00129   QMap&lt;QString,QString&gt;::Iterator it;   
00130     <font class="keywordflow">for</font> ( it = entryMap.begin(); it != entryMap.end(); ++it)
00131       <font class="keywordflow">if</font> (it.key() != QString::null)
00132           RangeChooser-&gt;insertItem( it.key() );
00133     scopeChanged(); <font class="comment">//set initial state</font>
00134 }
00135 
00136 ListKey CSearchDialogScopeChooser::getScope(){
00137     <font class="keywordflow">return</font> VerseKey().ParseVerseList( config-&gt;readEntry( RangeChooser-&gt;currentText() ).local8Bit(), <font class="stringliteral">"Genesis 1:1"</font>, <font class="keyword">true</font>);
00138 }
00139 
00140 <font class="keyword">const</font> CSwordModuleSearch::scopeType CSearchDialogScopeChooser::getScopeType()<font class="keyword"> const </font>{
00141   <font class="keywordflow">if</font> (noScope-&gt;isChecked())         <font class="keywordflow">return</font> CSwordModuleSearch::Scope_NoScope;
00142   <font class="keywordflow">if</font> (lastResultScope-&gt;isChecked()) <font class="keywordflow">return</font> CSwordModuleSearch::Scope_LastSearch;
00143   <font class="keywordflow">if</font> (useScope-&gt;isChecked())        <font class="keywordflow">return</font> CSwordModuleSearch::Scope_Bounds;
00144 
00145   <font class="keywordflow">return</font> CSwordModuleSearch::Scope_NoScope;
00146 }
00147 
00148 <font class="keyword">const</font> QString CSearchDialogScopeChooser::getScopeTypeString() {
00149   <font class="keywordflow">if</font> (noScope-&gt;isChecked())         <font class="keywordflow">return</font> noScope-&gt;text();
00150   <font class="keywordflow">if</font> (lastResultScope-&gt;isChecked()) <font class="keywordflow">return</font> lastResultScope-&gt;text();
00151   <font class="keywordflow">if</font> (useScope-&gt;isChecked())        <font class="keywordflow">return</font> useScope-&gt;text();
00152 
00153   <font class="keywordflow">return</font> noScope-&gt;text();
00154 }
00155 <font class="keywordtype">void</font> CSearchDialogScopeChooser::editButtonClicked(){
00156   CSearchDialogScopeEdit *dialog = <font class="keyword">new</font> CSearchDialogScopeEdit(this-&gt;config, <font class="keyword">this</font>, <font class="stringliteral">"ranges dialog"</font>);
00157   dialog-&gt;exec();
00158 
00159   <font class="comment">//refresh the rangechooser</font>
00160   RangeChooser-&gt;clear();
00161 
00162   QMap&lt;QString,QString&gt; entryMap = config-&gt;entryMap(QString(<font class="stringliteral">"custom ranges"</font>));
00163   QMap&lt;QString,QString&gt;::Iterator it;
00164   <font class="keywordflow">for</font> ( it = entryMap.begin(); it != entryMap.end(); ++it) {
00165       qDebug(it.key().local8Bit());
00166       <font class="keywordflow">if</font> (it.key() != QString::null)
00167           RangeChooser-&gt;insertItem( it.key() );
00168     }
00169 }
00170 
<a name="l00172"></a><a class="code" href="class_c_search_dialog_scope_chooser.html#i1">00172</a> <font class="keywordtype">void</font> <a class="code" href="class_c_search_dialog_scope_chooser.html#i1">CSearchDialogScopeChooser::scopeChanged</a>(){
00173     RangeLabel-&gt;setEnabled  (getScopeType() == CSwordModuleSearch::Scope_Bounds ? <font class="keyword">true</font> : <font class="keyword">false</font>);
00174     RangeChooser-&gt;setEnabled(getScopeType() == CSwordModuleSearch::Scope_Bounds ? <font class="keyword">true</font> : <font class="keyword">false</font>);
00175     editButton-&gt;setEnabled  (getScopeType() == CSwordModuleSearch::Scope_Bounds ? <font class="keyword">true</font> : <font class="keyword">false</font>);
00176 }
00177 
00178 
00179 CSearchDialogScopeChooser::~CSearchDialogScopeChooser(){
00180     <font class="keywordflow">if</font> (config) {
00181       config-&gt;setGroup(QString(<font class="stringliteral">"main"</font>));    
00182       config-&gt;writeEntry(<font class="stringliteral">"firstUsage"</font>, <font class="keyword">true</font>);
00183         config-&gt;sync();
00184         <font class="keyword">delete</font> config;
00185     }
00186 }
00187 
00188 CSearchDialogScopeEdit::~CSearchDialogScopeEdit(){  
00189   <font class="comment">//not delete config, because it points to the parent config</font>
00190 }
00191 
00192 CSearchDialogScopeEdit::CSearchDialogScopeEdit(KSimpleConfig *parentconfig, QWidget *parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name ) : QDialog(parent,name,<font class="comment">/*modal*/</font>true) {
00193 
00194   QGridLayout*  Layout = <font class="keyword">new</font> QGridLayout(<font class="keyword">this</font>, 5, 5, 5, 0);
00195 
00196   RangeChooser = <font class="keyword">new</font> QComboBox(<font class="keyword">this</font>);
00197     QToolTip::add(RangeChooser, TT_SD_SCOPE_CHOOSER);
00198   QWhatsThis::add(RangeChooser, WT_SD_SCOPE_CHOOSER);
00199   RangeChooser-&gt;setEnabled(<font class="keyword">false</font>);
00200 
00201   RangeEdit = <font class="keyword">new</font> QLineEdit(<font class="keyword">this</font>);
00202     QToolTip::add(RangeChooser, TT_SD_SCOPE_EDIT_LINE);
00203   QWhatsThis::add(RangeChooser, WT_SD_SCOPE_EDIT_LINE);
00204   RangeEdit-&gt;setEnabled(<font class="keyword">false</font>);
00205 
00206   RangeDisp = <font class="keyword">new</font> QListBox(<font class="keyword">this</font>);
00207     QToolTip::add(RangeDisp, TT_SD_SCOPE_PARSED_LIST);
00208   QWhatsThis::add(RangeDisp, WT_SD_SCOPE_PARSED_LIST);
00209 
00210   newButton   = <font class="keyword">new</font> QPushButton(i18n(<font class="stringliteral">"Add"</font>),<font class="keyword">this</font>);
00211     QToolTip::add(newButton, TT_SD_SCOPE_NEW_SCOPE);
00212   QWhatsThis::add(newButton, WT_SD_SCOPE_NEW_SCOPE);
00213 
00214   deleteButton= <font class="keyword">new</font> QPushButton(i18n(<font class="stringliteral">"Delete"</font>),<font class="keyword">this</font>);
00215   deleteButton-&gt;setEnabled(<font class="keyword">false</font>);  
00216     QToolTip::add(deleteButton, TT_SD_SCOPE_DELETE_SCOPE);
00217   QWhatsThis::add(deleteButton, WT_SD_SCOPE_DELETE_SCOPE);
00218 
00219   closeButton = <font class="keyword">new</font> QPushButton(i18n(<font class="stringliteral">"Close"</font>),<font class="keyword">this</font>);
00220     QToolTip::add(closeButton, TT_SD_SCOPE_CLOSE);
00221   QWhatsThis::add(closeButton, WT_SD_SCOPE_CLOSE);
00222 
00223   QLabel* RangeLabel = <font class="keyword">new</font> QLabel(i18n(<font class="stringliteral">"Choose custom range"</font>),<font class="keyword">this</font>);
00224   QLabel* RangeEditLabel = <font class="keyword">new</font> QLabel(i18n(<font class="stringliteral">"Define range text"</font>),<font class="keyword">this</font>);
00225   QLabel* RangeDispLabel = <font class="keyword">new</font> QLabel(i18n(<font class="stringliteral">"Range parsing results"</font>),<font class="keyword">this</font>);
00226 
00227 
00228   Layout-&gt;addMultiCellWidget(RangeLabel,  0,0,0,2);
00229   Layout-&gt;addMultiCellWidget(RangeChooser,1,1,0,2);
00230 
00231   Layout-&gt;addMultiCellWidget(RangeEditLabel,0,0,4,4);
00232   Layout-&gt;addMultiCellWidget(RangeEdit,     1,1,4,4);
00233 
00234   Layout-&gt;addMultiCellWidget(RangeDispLabel,2,2,4,4);
00235   Layout-&gt;addMultiCellWidget(RangeDisp,     3,4,4,4);
00236 
00237   Layout-&gt;addMultiCellWidget(newButton,   3,3,0,0, Qt::AlignCenter);
00238   Layout-&gt;addMultiCellWidget(deleteButton,3,3,2,2, Qt::AlignCenter);
00239   Layout-&gt;addMultiCellWidget(closeButton, 4,4,0,2, Qt::AlignCenter);
00240 
00241   Layout-&gt;addRowSpacing(0, RangeLabel-&gt;sizeHint().height());
00242   Layout-&gt;addRowSpacing(1, RangeChooser-&gt;sizeHint().height());
00243   Layout-&gt;addRowSpacing(2, RangeDispLabel-&gt;sizeHint().height());
00244   Layout-&gt;addRowSpacing(3, newButton-&gt;sizeHint().height());
00245   Layout-&gt;addRowSpacing(4, RangeEdit-&gt;sizeHint().height() * 4);<font class="comment">// 4 lines</font>
00246   Layout-&gt;setRowStretch(4, 1); <font class="comment">//only 4 will be stretched</font>
00247 
00248   Layout-&gt;addColSpacing(0, newButton-&gt;sizeHint().width());
00249   Layout-&gt;addColSpacing(1, 2);
00250   Layout-&gt;addColSpacing(2, deleteButton-&gt;sizeHint().width());
00251   Layout-&gt;addColSpacing(3, 10);
00252   Layout-&gt;addColSpacing(4, RangeLabel-&gt;sizeHint().width() * 2);
00253   Layout-&gt;setColStretch(4, 1);<font class="comment">//only 4 ill be stretched</font>
00254 
00255 
00256   connect(newButton,SIGNAL(clicked()),
00257            <font class="keyword">this</font>,SLOT(NewButtonClicked()));
00258     connect(deleteButton, SIGNAL(clicked()),
00259              <font class="keyword">this</font>,SLOT(DeleteButtonClicked()));
00260     connect(closeButton, SIGNAL(clicked()),
00261              <font class="keyword">this</font>,SLOT(closeButtonClicked()));
00262   connect(RangeEdit,SIGNAL(textChanged(<font class="keyword">const</font> QString &amp;)),
00263            <font class="keyword">this</font>,SLOT(RangeEditTextChanged(<font class="keyword">const</font> QString &amp;)));
00264     connect(RangeChooser,SIGNAL(activated(<font class="keywordtype">int</font>)),
00265              <font class="keyword">this</font>,SLOT(RangeChooserActivated(<font class="keywordtype">int</font>)));
00266 
00267 
00268     config = parentconfig;
00269     
00270   config-&gt;setGroup(QString::fromLatin1(<font class="stringliteral">"custom ranges"</font>));
00271   QMap&lt;QString,QString&gt; entryMap = config-&gt;entryMap(QString::fromLatin1(<font class="stringliteral">"custom ranges"</font>));
00272   QMap&lt;QString,QString&gt;::Iterator it;
00273     <font class="keywordflow">for</font> ( it = entryMap.begin(); it != entryMap.end(); ++it) {
00274 <font class="comment">//      qDebug(it.key().local8Bit());</font>
00275       <font class="keywordflow">if</font> (it.key() != QString::null)
00276           RangeChooser-&gt;insertItem( it.key() );
00277     }
00278     <font class="keywordflow">if</font> (RangeChooser-&gt;count()&gt;0){
00279       RangeChooser-&gt;setEnabled(<font class="keyword">true</font>);
00280       RangeEdit-&gt;setEnabled(<font class="keyword">true</font>);
00281       deleteButton-&gt;setEnabled(<font class="keyword">true</font>);
00282       RangeEdit-&gt;setFocus();
00283       emit RangeChooserActivated(0);
00284     }
00285 }
00286 
00287 <font class="keywordtype">void</font> CSearchDialogScopeEdit::NewButtonClicked(){
00288   <font class="keywordtype">bool</font> ok = <font class="keyword">false</font>;
00289   QString text = QInputDialog::getText( i18n( <font class="stringliteral">"Range name"</font> ), i18n( <font class="stringliteral">"Please enter a name for the new range"</font> ),QLineEdit::Normal,QString::null, &amp;ok, <font class="keyword">this</font> );
00290     <font class="keywordflow">if</font> (!ok)
00291         <font class="keywordflow">return</font>;
00292 
00293   <font class="keywordflow">if</font> ( !text.isEmpty() <font class="comment">/*&amp;&amp; !config-&gt;hasKey( text )*/</font> )
00294     config-&gt;writeEntry(text, QString::null);<font class="comment">// user entered something and pressed ok</font>
00295   <font class="comment">//refresh the rangechooser</font>
00296   RangeChooser-&gt;clear();
00297 
00298   QMap&lt;QString,QString&gt; entryMap = config-&gt;entryMap(QString(<font class="stringliteral">"custom ranges"</font>));
00299   QMap&lt;QString,QString&gt;::Iterator it;
00300   <font class="keywordflow">for</font> ( it = entryMap.begin(); it != entryMap.end(); ++it) {
00301       qDebug(it.key().local8Bit());
00302       <font class="keywordflow">if</font> (it.key() != QString::null)
00303           RangeChooser-&gt;insertItem( it.key() );
00304     }
00305     <font class="keywordflow">if</font> (RangeChooser-&gt;count()&gt;0){
00306       RangeChooser-&gt;setEnabled(<font class="keyword">true</font>);
00307       RangeEdit-&gt;setEnabled(<font class="keyword">true</font>);
00308       deleteButton-&gt;setEnabled(<font class="keyword">true</font>);
00309       RangeChooser-&gt;setCurrentItem( RangeChooser-&gt;count()-1 );
00310       emit RangeChooserActivated( RangeChooser-&gt;currentItem() );
00311       RangeEdit-&gt;setFocus();
00312     }
00313 }
00314 
00315 <font class="keywordtype">void</font> CSearchDialogScopeEdit::DeleteButtonClicked(<font class="keywordtype">void</font>){
00316   <font class="keywordtype">int</font> index = RangeChooser-&gt;currentItem();
00317   QString text=RangeChooser-&gt;currentText();
00318   <font class="keywordflow">if</font> ( !text.isEmpty() ){
00319     config-&gt;deleteEntry(text,<font class="keyword">false</font>);
00320                 
00321         <font class="comment">//refresh the rangechooser</font>
00322     RangeChooser-&gt;clear();
00323 
00324     QMap&lt;QString,QString&gt; entryMap = config-&gt;entryMap(QString(<font class="stringliteral">"custom ranges"</font>));
00325     QMap&lt;QString,QString&gt;::Iterator it;
00326     <font class="keywordflow">for</font> ( it = entryMap.begin(); it != entryMap.end(); ++it) {
00327       qDebug(it.key().local8Bit());
00328       <font class="keywordflow">if</font> (it.key() != QString::null)
00329           RangeChooser-&gt;insertItem( it.key() );
00330     }
00331     <font class="keywordflow">if</font> (RangeChooser-&gt;count()&gt;0){
00332       RangeChooser-&gt;setCurrentItem( (index&gt;0)?(index-1):0 );
00333       emit RangeChooserActivated( RangeChooser-&gt;currentItem() );
00334     }
00335     <font class="keywordflow">else</font>{
00336       RangeChooser-&gt;setEnabled(<font class="keyword">false</font>);
00337       RangeEdit-&gt;setEnabled(<font class="keyword">false</font>);
00338       deleteButton-&gt;setEnabled(<font class="keyword">false</font>);
00339       <font class="comment">//clear</font>
00340       RangeEdit-&gt;setText(QString::null);
00341       RangeDisp-&gt;clear();
00342 
00343       }
00344   }
00345 }
00346 
00347 <font class="keywordtype">void</font> CSearchDialogScopeEdit::RangeChooserActivated(<font class="keywordtype">int</font> index){
00348     QString value = config-&gt;readEntry(RangeChooser-&gt;text(index));
00349   RangeEdit-&gt;setText(value);
00350 
00351   <font class="comment">//a workaround, maybe emitted twice, which is no problem</font>
00352   emit RangeEditTextChanged(value);
00353 }
00354 
00355 <font class="keywordtype">void</font> CSearchDialogScopeEdit::RangeEditTextChanged(<font class="keyword">const</font> QString &amp;text){
00356     config-&gt;writeEntry(RangeChooser-&gt;currentText(), text);
00357   RangeDisp-&gt;clear();
00358     VerseKey key;
00359   ListKey verses = key.ParseVerseList((<font class="keyword">const</font> <font class="keywordtype">char</font>*)text.local8Bit(), key, <font class="keyword">true</font>);
00360     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; i &lt; verses.Count(); ++i) {
00361         VerseKey* element = dynamic_cast&lt;VerseKey*&gt;(verses.GetElement(i));
00362         <font class="keywordflow">if</font> (element)    
00363             RangeDisp-&gt;insertItem(QString(<font class="stringliteral">"%1 - %2"</font>).arg(QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)element-&gt;LowerBound())).arg(QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)element-&gt;UpperBound())));
00364         <font class="keywordflow">else</font>
00365             RangeDisp-&gt;insertItem(QString::fromLocal8Bit((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*verses.GetElement(i)));
00366     }
00367 }
00368 
00369 
00371 <font class="keywordtype">void</font> CSearchDialogScopeEdit::closeButtonClicked(){
00372     close();
00373 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:09 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
