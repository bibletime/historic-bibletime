<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>chtmldialog.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>chtmldialog.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          chtmldialog.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Tue Jan 25 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime Team</font>
00006 <font class="comment">    email                : Info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//own includes</font>
00019 <font class="comment">//#include "chtmlwidget.h"</font>
00020 <font class="preprocessor">#include "chtmldialog.h"</font>
00021 <font class="preprocessor">#include "ctoolclass.h"</font>
00022 
00023 <font class="comment">//QT includes</font>
00024 <font class="preprocessor">#include &lt;qlayout.h&gt;</font>
00025 <font class="preprocessor">#include &lt;qhbox.h&gt;</font>
00026 <font class="preprocessor">#include &lt;qfile.h&gt;</font>
00027 <font class="preprocessor">#include &lt;qtextbrowser.h&gt;</font>
00028 <font class="preprocessor">#include &lt;qtoolbar.h&gt;</font>
00029 <font class="preprocessor">#include &lt;qtoolbutton.h&gt;</font>
00030 <font class="preprocessor">#include &lt;qpushbutton.h&gt;</font>
00031 
00032 <font class="comment">//KDE includes</font>
00033 <font class="preprocessor">#include &lt;kcombobox.h&gt;</font>
00034 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00035 <font class="preprocessor">#include &lt;kiconloader.h&gt;</font>
00036 <font class="preprocessor">#include &lt;kapp.h&gt;</font>
00037 
00038 
00039 CHTMLDialog::CHTMLDialog(QWidget* parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name )
00040     : QDialog ( parent, name, true, WStyle_MinMax | WStyle_DialogBorder | WStyle_Dialog )
00041 {
00042     init(<font class="keyword">false</font>);
00043 }
00044 
00045 CHTMLDialog::CHTMLDialog(<font class="keyword">const</font> QString&amp; url, QWidget* parent, <font class="keyword">const</font> <font class="keywordtype">char</font> *name)
00046     : QDialog ( parent, name, true, WStyle_MinMax | WStyle_DialogBorder | WStyle_Dialog )
00047 {
00048     init();
00049     QString file = <a class="code" href="class_c_tool_class.html#d0">CToolClass::locatehtml</a>(url);
00050     
00051     m_textBrowser-&gt;mimeSourceFactory()-&gt;setFilePath(file);
00052     m_textBrowser-&gt;setSource(file);
00053 }
00054 
00055 CHTMLDialog::~CHTMLDialog(){
00056 }
00057 
<a name="l00059"></a><a class="code" href="class_c_h_t_m_l_dialog.html#a3">00059</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_dialog.html#a3">CHTMLDialog::setText</a>(<font class="keyword">const</font> QString&amp; text){
00060     m_textBrowser-&gt;setText(text);
00061 }
00062 
<a name="l00064"></a><a class="code" href="class_c_h_t_m_l_dialog.html#b0">00064</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_dialog.html#b0">CHTMLDialog::init</a>(<font class="keyword">const</font> <font class="keywordtype">bool</font> enableHistory){
00065     resize(600,400);        
00066     QVBoxLayout* layout = <font class="keyword">new</font> QVBoxLayout(<font class="keyword">this</font>, 5);
00067         
00068     m_textBrowser = <font class="keyword">new</font> QTextBrowser(<font class="keyword">this</font>);     
00069     KURL url(<a class="code" href="class_c_tool_class.html#d0">CToolClass::locatehtml</a>(<font class="stringliteral">"bibletime/helpdialog/index.docbook"</font>)); 
00070     m_textBrowser-&gt;mimeSourceFactory()-&gt;addFilePath(url.directory());
00071     url.cd(QString::fromLatin1(<font class="stringliteral">".."</font>));
00072     m_textBrowser-&gt;mimeSourceFactory()-&gt;addFilePath(url.directory());
00073     url.cd(QString::fromLatin1(<font class="stringliteral">".."</font>));
00074     m_textBrowser-&gt;mimeSourceFactory()-&gt;addFilePath(url.directory());
00075     url.cd(QString::fromLatin1(<font class="stringliteral">".."</font>));
00076     m_textBrowser-&gt;mimeSourceFactory()-&gt;addFilePath(url.directory());
00077     
00078     
00079     <font class="keywordflow">if</font> (enableHistory) {
00080         QHBox* toolBar = <font class="keyword">new</font> QHBox(<font class="keyword">this</font>, <font class="stringliteral">"history toolbar"</font>);
00081         
00082         QToolButton *button = 0;        
00083         button = <font class="keyword">new</font> QToolButton(toolBar);
00084         button-&gt;setIconSet(SmallIcon(<font class="stringliteral">"back"</font>));
00085         button-&gt;setTextLabel(i18n(<font class="stringliteral">"Backward"</font>));     
00086         button-&gt;setEnabled(<font class="keyword">false</font>);      
00087         button-&gt;setUsesTextLabel(<font class="keyword">true</font>);
00088         button-&gt;setFixedSize(button-&gt;sizeHint());
00089         connect(button, SIGNAL(clicked()), m_textBrowser, SLOT(backward()));
00090         connect(m_textBrowser, SIGNAL(backwardAvailable(<font class="keywordtype">bool</font>)),
00091             button, SLOT(setEnabled(<font class="keywordtype">bool</font>)));        
00092     connect( m_textBrowser, SIGNAL( <a class="code" href="class_c_h_t_m_l_dialog.html#h0">textChanged</a>() ),    
00093          <font class="keyword">this</font>, SLOT( <a class="code" href="class_c_h_t_m_l_dialog.html#h0">textChanged</a>() ) );
00094 
00095         m_historyCombo = <font class="keyword">new</font> KComboBox(toolBar);
00096         toolBar-&gt;setStretchFactor(m_historyCombo, 5);       
00097     connect( m_historyCombo, SIGNAL( activated( <font class="keyword">const</font> QString &amp; ) ),
00098          <font class="keyword">this</font>, SLOT( <a class="code" href="class_c_h_t_m_l_dialog.html#h1">historyItemSelected</a>( <font class="keyword">const</font> QString &amp; ) ) );
00099         
00100                         
00101         button = <font class="keyword">new</font> QToolButton(toolBar);      
00102         button-&gt;setEnabled(<font class="keyword">false</font>);
00103         button-&gt;setTextLabel(i18n(<font class="stringliteral">"Forward"</font>));      
00104         button-&gt;setUsesTextLabel(<font class="keyword">true</font>);     
00105         button-&gt;setIconSet(SmallIcon(<font class="stringliteral">"forward"</font>));
00106         button-&gt;setFixedSize(button-&gt;sizeHint());
00107         connect(button, SIGNAL(clicked()), m_textBrowser, SLOT(forward()));     
00108         connect(m_textBrowser, SIGNAL(forwardAvailable(<font class="keywordtype">bool</font>)),
00109             button, SLOT(setEnabled(<font class="keywordtype">bool</font>)));
00110             
00111         layout-&gt;addWidget(toolBar);     
00112     }       
00113     layout-&gt;addSpacing(5);  
00114     layout-&gt;addWidget(m_textBrowser,5);
00115     
00116     QHBoxLayout* hBox = <font class="keyword">new</font> QHBoxLayout();
00117     QPushButton* closeButton = <font class="keyword">new</font> QPushButton(<font class="keyword">this</font>);
00118     closeButton-&gt;setText(i18n(<font class="stringliteral">"Close"</font>));
00119     connect(closeButton, SIGNAL(pressed()), <font class="keyword">this</font>, SLOT(close()));
00120     hBox-&gt;addStretch(5);
00121     hBox-&gt;addWidget(closeButton,1);
00122     
00123     layout-&gt;addLayout(hBox);
00124 }
00125 
<a name="l00127"></a><a class="code" href="class_c_h_t_m_l_dialog.html#h1">00127</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_dialog.html#h1">CHTMLDialog::historyItemSelected</a>( <font class="keyword">const</font> QString &amp; file ){
00128     m_textBrowser-&gt;setSource(file);
00129 }
00130 
<a name="l00132"></a><a class="code" href="class_c_h_t_m_l_dialog.html#h0">00132</a> <font class="keywordtype">void</font> <a class="code" href="class_c_h_t_m_l_dialog.html#h0">CHTMLDialog::textChanged</a>(){
00133     <font class="keywordflow">if</font> ( m_textBrowser-&gt;documentTitle().isNull() )
00134         setCaption( m_textBrowser-&gt;context() );
00135     <font class="keywordflow">else</font>
00136         setCaption( m_textBrowser-&gt;documentTitle() ) ;
00137 
00138     QString selectedURL = caption();
00139     <font class="keywordflow">if</font> ( !selectedURL.isEmpty() &amp;&amp; m_historyCombo ) {
00140         <font class="keywordtype">bool</font> exists = <font class="keyword">false</font>;
00141         <font class="keywordtype">int</font> i;
00142         <font class="keywordflow">for</font> ( i = 0; i &lt; m_historyCombo-&gt;count(); ++i ) {
00143             <font class="keywordflow">if</font> ( m_historyCombo-&gt;text( i ) == selectedURL ) {
00144                 exists = <font class="keyword">true</font>;
00145                 <font class="keywordflow">break</font>;
00146             }
00147         }
00148         <font class="keywordflow">if</font> ( !exists ) {
00149         m_historyCombo-&gt;insertItem( selectedURL, -1 );
00150         m_historyCombo-&gt;setCurrentItem( 0 );
00151         } <font class="keywordflow">else</font>
00152         m_historyCombo-&gt;setCurrentItem( i );
00153         selectedURL = QString::null;
00154     }   
00155 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
