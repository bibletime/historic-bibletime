<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>qcleanuphandler.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>qcleanuphandler.h</h1><div class="fragment"><pre>00001 <font class="preprocessor">#ifndef QCLEANUPHANDLER_H</font>
00002 <font class="preprocessor"></font><font class="preprocessor">#define QCLEANUPHANDLER_H</font>
00003 <font class="preprocessor"></font>
00004 <font class="preprocessor">#ifndef QT_H</font>
00005 <font class="preprocessor"></font><font class="preprocessor">#include &lt;qlist.h&gt;</font>
00006 <font class="preprocessor">#include &lt;qguardedptr.h&gt;</font>
00007 <font class="preprocessor">#endif // QT_H</font>
00008 <font class="preprocessor"></font>
00009 <font class="keyword">template</font>&lt;<font class="keyword">class</font> Type&gt;
00010 <font class="keyword">class </font>Q_EXPORT QGuardedCleanupHandler
00011 {
00012 <font class="keyword">public</font>:
00013     ~QGuardedCleanupHandler() { clear(); }
00014 
00015     <font class="keywordtype">void</font> add( Type* object )
00016     {
00017     cleanupObjects.insert( 0, <font class="keyword">new</font> QGuardedPtr&lt;Type&gt;(object) );
00018     }
00019 
00020     <font class="keywordtype">void</font> remove( Type *object )
00021     {
00022     QListIterator&lt;QGuardedPtr&lt;Type&gt; &gt; it( cleanupObjects );
00023     <font class="keywordflow">while</font> ( it.current() ) {
00024         QGuardedPtr&lt;Type&gt;* guard = it.current();
00025         ++it;
00026         <font class="keywordflow">if</font> ( (Type *)guard == object ) {
00027         cleanupObjects.removeRef( guard );
00028         <font class="keyword">delete</font> guard;
00029         <font class="keywordflow">break</font>;
00030         }
00031     }
00032     }
00033 
00034     <font class="keywordtype">bool</font> isEmpty()<font class="keyword"> const</font>
00035 <font class="keyword">    </font>{
00036     QListIterator&lt;QGuardedPtr&lt;Type&gt; &gt; it( cleanupObjects );
00037     <font class="keywordflow">while</font> ( it.current() ) {
00038         QGuardedPtr&lt;Type&gt;* guard = it.current();
00039         ++it;
00040         <font class="keywordflow">if</font> ( (Type*)*guard )
00041         <font class="keywordflow">return</font> FALSE;
00042     }
00043     <font class="keywordflow">return</font> TRUE;
00044     }
00045 
00046     <font class="keywordtype">void</font> clear() {
00047     QListIterator&lt;QGuardedPtr&lt;Type&gt; &gt; it( cleanupObjects );
00048     it.toLast();
00049     <font class="keywordflow">while</font> ( it.current() ) {
00050         QGuardedPtr&lt;Type&gt;* guard = it.current();
00051         --it;
00052         cleanupObjects.removeRef( guard );
00053         <font class="keyword">delete</font> (Type*)*guard;
00054         <font class="keyword">delete</font> guard;
00055     }
00056     }
00057 
00058 <font class="keyword">private</font>:
00059     QList&lt;QGuardedPtr&lt;Type&gt; &gt; cleanupObjects;
00060 };
00061 
00062 <font class="keyword">template</font>&lt;<font class="keyword">class</font> Type&gt;
00063 <font class="keyword">class </font>Q_EXPORT QCleanupHandler
00064 {
00065 <font class="keyword">public</font>:
00066     QCleanupHandler() : cleanupObjects( 0 )
00067     {}
00068     ~QCleanupHandler() { clear(); }
00069 
00070     <font class="keywordtype">void</font> add( Type* object )
00071     {
00072     <font class="keywordflow">if</font> ( !cleanupObjects ) {
00073         cleanupObjects = <font class="keyword">new</font> QList&lt;Type&gt;;
00074     }
00075     cleanupObjects-&gt;insert( 0, object );
00076     }
00077 
00078     <font class="keywordtype">void</font> remove( Type *object )
00079     {
00080     <font class="keywordflow">if</font> ( !cleanupObjects )
00081         <font class="keywordflow">return</font>;
00082     <font class="keywordflow">if</font> ( object )
00083         cleanupObjects-&gt;removeRef( object );
00084     }
00085 
00086     <font class="keywordtype">bool</font> isEmpty()<font class="keyword"> const</font>
00087 <font class="keyword">    </font>{
00088     <font class="keywordflow">return</font> cleanupObjects ? cleanupObjects-&gt;isEmpty() : TRUE;
00089     }
00090 
00091     <font class="keywordtype">void</font> clear()
00092     {
00093     <font class="keywordflow">if</font> ( !cleanupObjects )
00094         <font class="keywordflow">return</font>;
00095 
00096     QListIterator&lt;Type&gt; it( *cleanupObjects );
00097     it.toLast();
00098     <font class="keywordflow">while</font> ( it.current() ) {
00099         Type* object = it.current();
00100         --it;
00101         cleanupObjects-&gt;removeRef( object );
00102         <font class="keyword">delete</font> object;
00103     }
00104 
00105     <font class="keyword">delete</font> cleanupObjects;
00106     cleanupObjects = 0;
00107     }
00108 
00109 <font class="keyword">private</font>:
00110     QList&lt;Type&gt; *cleanupObjects;
00111 };
00112 
00113 <font class="preprocessor">#endif //QCLEANUPHANDLER_H</font>
</pre></div><hr><address><small>Generated on Sun Mar 10 21:36:54 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
