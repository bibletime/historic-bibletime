<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cswordbackend.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cswordbackend.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          cswordbackend.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Thu Oct 5 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//BibleTime includes</font>
00019 <font class="preprocessor">#include "cswordbackend.h"</font>
00020 <font class="preprocessor">#include "chtmlentrydisplay.h"</font>
00021 <font class="preprocessor">#include "chtmlchapterdisplay.h"</font>
00022 <font class="preprocessor">#include "cswordbiblemoduleinfo.h"</font>
00023 <font class="preprocessor">#include "cswordcommentarymoduleinfo.h"</font>
00024 <font class="preprocessor">#include "cswordlexiconmoduleinfo.h"</font>
00025 <font class="preprocessor">#include "cswordbookmoduleinfo.h"</font>
00026 
00027 <font class="preprocessor">#include "bt_thmlhtml.h"</font>
00028 <font class="preprocessor">#include "bt_gbfhtml.h"</font>
00029 <font class="preprocessor">#include &lt;dirent.h&gt;</font>
00030 <font class="preprocessor">#include &lt;unistd.h&gt;</font>
00031 
00032 <font class="comment">//Qt includes</font>
00033 <font class="preprocessor">#include &lt;qdir.h&gt;</font>
00034 
00035 <font class="comment">//KDE includes</font>
00036 <font class="preprocessor">#include &lt;klocale.h&gt;</font>
00037 
00038 <font class="comment">//Sword includes</font>
00039 <font class="preprocessor">#include &lt;swdisp.h&gt;</font>
00040 <font class="preprocessor">#include &lt;swfiltermgr.h&gt;</font>
00041 <font class="preprocessor">#include &lt;encfiltmgr.h&gt;</font>
00042 <font class="preprocessor">#include &lt;plainhtml.h&gt;</font>
00043 <font class="preprocessor">#include &lt;rawgbf.h&gt;</font>
00044 <font class="preprocessor">#include &lt;rtfhtml.h&gt;</font>
00045 <font class="preprocessor">#include &lt;filemgr.h&gt;</font>
00046 <font class="preprocessor">#include &lt;utilstr.h&gt;</font>
00047 
00048 <font class="comment">//static class-wide members</font>
00049 <font class="keyword">static</font> QMap&lt;QString, QString&gt; moduleDescriptionMap;
00050 
<a name="l00051"></a><a class="code" href="class_c_sword_backend.html#a0">00051</a> <a class="code" href="class_c_sword_backend.html#a0">CSwordBackend::CSwordBackend</a>()
00052     : SWMgr(0,0,false,new EncodingFilterMgr( ENC_UTF8 )),
00053     m_errorCode(noError),
00054     m_entryDisplay(0),
00055     m_chapterDisplay(0),
00056     m_moduleList(0),
00057     m_gbfFilter(0),
00058     m_plainTextFilter(0),
00059     m_thmlFilter(0)
00060 {   
00061 
00062 }
00063 
<a name="l00064"></a><a class="code" href="class_c_sword_backend.html#a1">00064</a> <a class="code" href="class_c_sword_backend.html#a1">CSwordBackend::~CSwordBackend</a>(){
00065     <a class="code" href="class_c_sword_backend.html#a4">shutdownModules</a>();  
00066     <font class="comment">//delete filters</font>
00067     <font class="keyword">delete</font> m_gbfFilter;
00068     <font class="keyword">delete</font> m_plainTextFilter;   
00069     <font class="keyword">delete</font> m_thmlFilter;    
00070 }
00071 
00072 <font class="preprocessor">#define CHECK_HTML_CHAPTER_DISLPAY \</font>
00073 <font class="preprocessor">    if (!m_chapterDisplay) \</font>
00074 <font class="preprocessor">        m_chapterDisplay = new CHTMLChapterDisplay();</font>
00075 <font class="preprocessor"></font>
00076 <font class="preprocessor">#define CHECK_HTML_ENTRY_DISLPAY \</font>
00077 <font class="preprocessor">    if (!m_entryDisplay) \</font>
00078 <font class="preprocessor">        m_entryDisplay = new CHTMLEntryDisplay();</font>
00079 <font class="preprocessor"></font>        
<a name="l00081"></a><a class="code" href="class_c_sword_backend.html#a3">00081</a> <font class="keyword">const</font> CSwordBackend::ErrorCode <a class="code" href="class_c_sword_backend.html#a3">CSwordBackend::initModules</a>() {
00082     ModMap::iterator it;
00083     SWModule*   curMod = 0;
00084     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* newModule = 0;
00085     <font class="keywordflow">if</font> (!m_moduleList)
00086         m_moduleList = <font class="keyword">new</font> ListCSwordModuleInfo();
00087             
00088     <a class="code" href="class_c_sword_backend.html#a4">shutdownModules</a>(); <font class="comment">//remove previous modules</font>
00089     m_moduleList-&gt;clear();  
00090 
00091     <font class="keywordflow">for</font> (it = Modules.begin(); it != Modules.end(); it++) {
00092         curMod = (*it).second;
00093         <font class="keywordflow">if</font> (!strcmp(curMod-&gt;Type(), <font class="stringliteral">"Biblical Texts"</font>)) {
00094             newModule = <font class="keyword">new</font> <a class="code" href="class_c_sword_bible_module_info.html">CSwordBibleModuleInfo</a>(curMod);
00095             CHECK_HTML_CHAPTER_DISLPAY  <font class="comment">//a macro to check the chapter display          </font>
00096             newModule-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Disp(m_chapterDisplay);
00097         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strcmp(curMod-&gt;Type(), <font class="stringliteral">"Commentaries"</font>)) {
00098             newModule = <font class="keyword">new</font> <a class="code" href="class_c_sword_commentary_module_info.html">CSwordCommentaryModuleInfo</a>(curMod);
00099             CHECK_HTML_ENTRY_DISLPAY    <font class="comment">//a macro to check the entry display</font>
00100             newModule-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Disp(m_entryDisplay);
00101         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strcmp(curMod-&gt;Type(), <font class="stringliteral">"Lexicons / Dictionaries"</font>)) {
00102             newModule = <font class="keyword">new</font> <a class="code" href="class_c_sword_lexicon_module_info.html">CSwordLexiconModuleInfo</a>(curMod);
00103             CHECK_HTML_ENTRY_DISLPAY    <font class="comment">//a macro to check the entry display            </font>
00104             newModule-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Disp(m_entryDisplay);
00105         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (!strcmp(curMod-&gt;Type(), <font class="stringliteral">"Generic Book"</font>)) {
00106             newModule = <font class="keyword">new</font> <a class="code" href="class_c_sword_book_module_info.html">CSwordBookModuleInfo</a>(curMod);
00107             CHECK_HTML_ENTRY_DISLPAY    <font class="comment">//a macro to check the entry display            </font>
00108             newModule-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Disp(m_entryDisplay);
00109         }
00110 
00111         <font class="keywordflow">if</font> (newModule)  <font class="comment">//append the new modules to our list</font>
00112             m_moduleList-&gt;append( newModule );
00113     }   
00114     <font class="keywordflow">if</font> (m_moduleList-&gt;count() == 0)
00115         m_errorCode = noModulesAvailable;
00116         
00117 <font class="comment">//module are now available, fill the static lists</font>
00118     <font class="keywordflow">for</font> (m_moduleList-&gt;first(); m_moduleList-&gt;current(); m_moduleList-&gt;next()) {
00119         moduleDescriptionMap.insert(m_moduleList-&gt;current()-&gt;config(CSwordModuleInfo::Description), m_moduleList-&gt;current()-&gt;name());
00120     }
00121 
00122     <font class="keywordflow">return</font> m_errorCode;
00123 }
00124 <font class="preprocessor">#undef CHECK_HTML_CHAPTER_DISPLAY</font>
00125 <font class="preprocessor"></font><font class="preprocessor">#undef CHECK_HTML_ENTRY_DISPLAY</font>
00126 <font class="preprocessor"></font>
<a name="l00127"></a><a class="code" href="class_c_sword_backend.html#b0">00127</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_backend.html#b0">CSwordBackend::AddRenderFilters</a>(SWModule *module, ConfigEntMap &amp;section) {
00128     string sourceformat;
00129     string moduleDriver;
00130     ConfigEntMap::iterator entry;
00131     <font class="keywordtype">bool</font> noDriver = <font class="keyword">true</font>;
00132 
00133     sourceformat = ((entry = section.find(<font class="stringliteral">"SourceType"</font>)) != section.end()) ? (*entry).second : (string) <font class="stringliteral">""</font>;
00134     moduleDriver = ((entry = section.find(<font class="stringliteral">"ModDrv"</font>)) != section.end()) ? (*entry).second : (string) <font class="stringliteral">""</font>;
00135 
00136     <font class="keywordflow">if</font> (!stricmp(sourceformat.c_str(), <font class="stringliteral">"GBF"</font>)) {
00137         <font class="keywordflow">if</font> (!m_gbfFilter)
00138             m_gbfFilter = <font class="keyword">new</font> <a class="code" href="class_b_t___g_b_f_h_t_m_l.html">BT_GBFHTML</a>();
00139         module-&gt;AddRenderFilter(m_gbfFilter);
00140         noDriver = <font class="keyword">false</font>;
00141     }
00142 
00143     <font class="keywordflow">if</font> (!stricmp(sourceformat.c_str(), <font class="stringliteral">"PLAIN"</font>)) {
00144         <font class="keywordflow">if</font> (!m_plainTextFilter)
00145             m_plainTextFilter = <font class="keyword">new</font> PLAINHTML();    
00146         module-&gt;AddRenderFilter(m_plainTextFilter);
00147         noDriver = <font class="keyword">false</font>;
00148     }
00149 
00150     <font class="keywordflow">if</font> (!stricmp(sourceformat.c_str(), <font class="stringliteral">"ThML"</font>)) {
00151         <font class="keywordflow">if</font> (!m_thmlFilter)
00152             m_thmlFilter = <font class="keyword">new</font> <a class="code" href="class_b_t___th_m_l_h_t_m_l.html">BT_ThMLHTML</a>();
00153         module-&gt;AddRenderFilter(m_thmlFilter);
00154         noDriver = <font class="keyword">false</font>;
00155     }
00156 
00157     <font class="keywordflow">if</font> (noDriver){
00158         <font class="keywordflow">if</font> (!stricmp(moduleDriver.c_str(), <font class="stringliteral">"RawCom"</font>) || !stricmp(moduleDriver.c_str(), <font class="stringliteral">"RawLD"</font>)) {
00159             <font class="keywordflow">if</font> (!m_plainTextFilter)
00160                 m_plainTextFilter = <font class="keyword">new</font> PLAINHTML();
00161             module-&gt;AddRenderFilter(m_plainTextFilter);
00162             noDriver = <font class="keyword">false</font>;
00163         }
00164     }
00165 }
00166 
<a name="l00168"></a><a class="code" href="class_c_sword_backend.html#a4">00168</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_sword_backend.html#a4">CSwordBackend::shutdownModules</a>(){
00169     <font class="keywordflow">for</font> (m_moduleList-&gt;first(); m_moduleList-&gt;current(); m_moduleList-&gt;next()) {
00170         <font class="keywordflow">if</font> (m_moduleList-&gt;current()) {
00171             <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* current = m_moduleList-&gt;current();
00172             m_moduleList-&gt;removeRef(current);
00173             <font class="keyword">delete</font> current;
00174         }       
00175     }
00176     m_moduleList-&gt;clear();  
00177     <font class="keywordflow">return</font> <font class="keyword">true</font>;
00178 }
00179 
<a name="l00181"></a><a class="code" href="class_c_sword_backend.html#a8">00181</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_sword_backend.html#a8">CSwordBackend::isOptionEnabled</a>( <font class="keyword">const</font> <a class="code" href="class_c_sword_backend.html#s16">CSwordBackend::FilterOptions</a> type) {
00182     <font class="keywordflow">return</font> (getGlobalOption( <a class="code" href="class_c_sword_backend.html#d1">optionName</a>(type).latin1() ) == <font class="stringliteral">"On"</font>);
00183 }
00184 
<a name="l00186"></a><a class="code" href="class_c_sword_backend.html#a5">00186</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_backend.html#a5">CSwordBackend::setOption</a>( <font class="keyword">const</font> <a class="code" href="class_c_sword_backend.html#s16">CSwordBackend::FilterOptions</a> type, <font class="keyword">const</font> <font class="keywordtype">bool</font> enable){
00187 <font class="comment">// const QString optionName = ;</font>
00188     setGlobalOption(<a class="code" href="class_c_sword_backend.html#d1">optionName</a>(type).latin1(), enable ? <font class="stringliteral">"On"</font>: <font class="stringliteral">"Off"</font>);
00189 }
00190 
00191 <font class="keywordtype">void</font> CSwordBackend::setFilterOptions( <font class="keyword">const</font> CSwordBackend::FilterOptionsBool options){
00192   <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( footnotes,                     options.footnotes );
00193   <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( strongNumbers,             options.strongNumbers );
00194   <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( headings,                      options.headings );
00195   <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( morphTags,                     options.morphTags );
00196     <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( lemmas,                          options.lemmas );
00197     <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( hebrewPoints,                options.hebrewPoints );
00198     <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( hebrewCantillation,  options.hebrewCantillation );
00199     <a class="code" href="class_c_sword_backend.html#a5">setOption</a>( greekAccents,                options.greekAccents);
00200 }
00201 
00202 <font class="keywordtype">void</font> CSwordBackend::setDisplayOptions( <font class="keyword">const</font> CSwordBackend::DisplayOptionsBool options){
00203   <font class="keywordflow">if</font> (m_entryDisplay)
00204         m_entryDisplay-&gt;<a class="code" href="class_c_h_t_m_l_entry_display.html#a5">setDisplayOptions</a>(options); 
00205   <font class="keywordflow">if</font> (m_chapterDisplay)
00206         m_chapterDisplay-&gt;<a class="code" href="class_c_h_t_m_l_entry_display.html#a5">setDisplayOptions</a>(options);   
00207 }
00208 
00209 
<a name="l00214"></a><a class="code" href="class_c_sword_backend.html#a9">00214</a> <font class="keywordtype">void</font> <a class="code" href="class_c_sword_backend.html#a9">CSwordBackend::Load</a>() {
00215     <font class="keywordflow">if</font> (!config) {  <font class="comment">// If we weren't passed a config object at construction, find a config file</font>
00216         <font class="keywordflow">if</font> (!configPath)    <font class="comment">// If we weren't passed a config path at construction...</font>
00217             findConfig(&amp;configType, &amp;prefixPath, &amp;configPath);
00218         <font class="keywordflow">if</font> (configPath) {
00219             <font class="keywordflow">if</font> (configType)
00220                 loadConfigDir(configPath);
00221             <font class="keywordflow">else</font>    config = myconfig = <font class="keyword">new</font> SWConfig(configPath);
00222         }
00223     }
00224 
00225     <font class="keywordflow">if</font> (config) {
00226         SectionMap::iterator Sectloop, Sectend;
00227         ConfigEntMap::iterator Entryloop, Entryend;
00228 
00229         DeleteMods();
00230 
00231         <font class="keywordflow">for</font> (Sectloop = config-&gt;Sections.lower_bound(<font class="stringliteral">"Globals"</font>), Sectend = config-&gt;Sections.upper_bound(<font class="stringliteral">"Globals"</font>); Sectloop != Sectend; Sectloop++) {      <font class="comment">// scan thru all 'Globals' sections</font>
00232             <font class="keywordflow">for</font> (Entryloop = (*Sectloop).second.lower_bound(<font class="stringliteral">"AutoInstall"</font>), Entryend = (*Sectloop).second.upper_bound(<font class="stringliteral">"AutoInstall"</font>); Entryloop != Entryend; Entryloop++)   <font class="comment">// scan thru all AutoInstall entries</font>
00233                 InstallScan((*Entryloop).second.c_str());       <font class="comment">// Scan AutoInstall entry directory for new modules and install</font>
00234         }       
00235         <font class="keywordflow">if</font> (configType) {   <font class="comment">// force reload on config object because we may have installed new modules</font>
00236             <font class="keyword">delete</font> myconfig;
00237             config = myconfig = 0;
00238             loadConfigDir(configPath);
00239         }
00240         <font class="keywordflow">else</font>    config-&gt;Load();
00241 
00242         CreateMods();
00243 
00244 <font class="comment">//  augment config with ~/.sword/mods.d if it exists ---------------------</font>
00245             <font class="keywordtype">char</font> *envhomedir  = getenv (<font class="stringliteral">"HOME"</font>);
00246             <font class="keywordflow">if</font> (envhomedir != NULL &amp;&amp; configType != 2) { <font class="comment">// 2 = user only</font>
00247                 string path = envhomedir;
00248                 <font class="keywordflow">if</font> ((envhomedir[strlen(envhomedir)-1] != <font class="charliteral">'\\'</font>) &amp;&amp; (envhomedir[strlen(envhomedir)-1] != <font class="charliteral">'/'</font>))
00249                     path += <font class="stringliteral">"/"</font>;
00250                 path += <font class="stringliteral">".sword/"</font>;
00251                 <font class="keywordflow">if</font> (FileMgr::existsDir(path.c_str(), <font class="stringliteral">"mods.d"</font>)) {
00252                     <font class="keywordtype">char</font> *savePrefixPath = 0;
00253                     <font class="keywordtype">char</font> *saveConfigPath = 0;
00254                     SWConfig *saveConfig = 0;
00255                     stdstr(&amp;savePrefixPath, prefixPath);
00256                     stdstr(&amp;prefixPath, path.c_str());
00257                     path += <font class="stringliteral">"mods.d"</font>;
00258                     stdstr(&amp;saveConfigPath, configPath);
00259                     stdstr(&amp;configPath, path.c_str());
00260                     saveConfig = config;
00261                     config = myconfig = 0;
00262                     loadConfigDir(configPath);
00263 
00264                     CreateMods();
00265 
00266                     stdstr(&amp;prefixPath, savePrefixPath);
00267                     <font class="keyword">delete</font> []savePrefixPath;
00268                     stdstr(&amp;configPath, saveConfigPath);
00269                     <font class="keyword">delete</font> []saveConfigPath;
00270                     (*saveConfig) += *config;
00271                     homeConfig = myconfig;
00272                     config = myconfig = saveConfig;
00273                 }
00274             }
00275 <font class="comment">// -------------------------------------------------------------------------</font>
00276   }
00277     <font class="keywordflow">else</font> {
00278         <font class="keywordflow">if</font> (!configPath)
00279             m_errorCode = noSwordModuleConfigDirectory;
00280         <font class="keywordflow">else</font>
00281             m_errorCode = noModulesAvailable;   
00282         qWarning(<font class="stringliteral">"BibleTime: Can't find 'mods.conf' or 'mods.d'. Please setup /etc/sword.conf! Read the documentation on www.bibletime.de how to do this!"</font>);
00283     }
00284 <font class="comment">//  if ( (access("/etc/sword.conf",R_OK) == -1) &amp;&amp; !strlen(getenv("SWORD_PATH")))</font>
00285 <font class="comment">//      m_errorCode = noSwordConfigFile;</font>
00286 }
00287 
<a name="l00289"></a><a class="code" href="class_c_sword_backend.html#a11">00289</a> <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* <font class="keyword">const</font> <a class="code" href="class_c_sword_backend.html#a11">CSwordBackend::findModuleByDescription</a>(<font class="keyword">const</font> QString&amp; description){
00290   <font class="keywordflow">if</font> (m_moduleList &amp;&amp; m_moduleList-&gt;count())
00291     <font class="keywordflow">for</font> ( m_moduleList-&gt;first();m_moduleList-&gt;current();m_moduleList-&gt;next() )
00292       <font class="keywordflow">if</font> ( m_moduleList-&gt;current()-&gt;config(CSwordModuleInfo::Description) == description )
00293         <font class="keywordflow">return</font> m_moduleList-&gt;current();
00294   <font class="keywordflow">return</font> 0;
00295 }
00296 
<a name="l00298"></a><a class="code" href="class_c_sword_backend.html#d0">00298</a> <font class="keyword">const</font> QString <a class="code" href="class_c_sword_backend.html#d0">CSwordBackend::findModuleNameByDescription</a>(<font class="keyword">const</font> QString&amp; description){
00299     <font class="keywordflow">if</font> (moduleDescriptionMap.contains(description))
00300         <font class="keywordflow">return</font> moduleDescriptionMap[description];
00301   <font class="keywordflow">return</font> QString::null;
00302 }
00303 
<a name="l00305"></a><a class="code" href="class_c_sword_backend.html#a12">00305</a> <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* <font class="keyword">const</font> <a class="code" href="class_c_sword_backend.html#a12">CSwordBackend::findModuleByName</a>(<font class="keyword">const</font> QString&amp; name){
00306   <font class="keywordflow">if</font> (m_moduleList &amp;&amp; m_moduleList-&gt;count())
00307     <font class="keywordflow">for</font> ( m_moduleList-&gt;first(); m_moduleList-&gt;current(); m_moduleList-&gt;next() )
00308       <font class="keywordflow">if</font> ( m_moduleList-&gt;current()-&gt;name() == name )
00309         <font class="keywordflow">return</font> m_moduleList-&gt;current();
00310   <font class="keywordflow">return</font> 0;
00311 }
00312 
<a name="l00314"></a><a class="code" href="class_c_sword_backend.html#a14">00314</a> <font class="keyword">const</font> <font class="keywordtype">bool</font> <a class="code" href="class_c_sword_backend.html#a14">CSwordBackend::moduleConfig</a>(<font class="keyword">const</font> QString&amp; module, SWConfig&amp; moduleConfig) {
00315     SectionMap::iterator section;
00316     DIR *dir = opendir(configPath);
00317     <font class="keyword">struct </font>dirent *ent;
00318     
00319     <font class="keywordtype">bool</font> foundConfig = <font class="keyword">false</font>;   
00320     QString modFile;    
00321     <font class="keywordflow">if</font> (dir) {    <font class="comment">// find and update .conf file</font>
00322         rewinddir(dir);
00323         <font class="keywordflow">while</font> ((ent = readdir(dir)) &amp;&amp; !foundConfig) {
00324             <font class="keywordflow">if</font> ((strcmp(ent-&gt;d_name, <font class="stringliteral">"."</font>)) &amp;&amp; (strcmp(ent-&gt;d_name, <font class="stringliteral">".."</font>))) {                                
00325                 modFile = QString::fromLocal8Bit(configPath);
00326                 modFile += QString::fromLatin1(<font class="stringliteral">"/"</font>);
00327                 modFile += QString::fromLocal8Bit(ent-&gt;d_name);
00328                 <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a> = SWConfig( (<font class="keyword">const</font> <font class="keywordtype">char</font>*)modFile.local8Bit() );
00329                 section =   <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a>.Sections.find( (<font class="keyword">const</font> <font class="keywordtype">char</font>*)module.local8Bit() );
00330                 foundConfig = ( section != <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a>.Sections.end() );
00331             }
00332         }
00333         closedir(dir);
00334     }
00335     <font class="keywordflow">else</font> { <font class="comment">//try to read mods.conf</font>
00336         <font class="comment">//moduleConfig = SWConfig( configPath + "/mods.conf" );</font>
00337         <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a> = SWConfig(<font class="stringliteral">""</font>);<font class="comment">//global config     </font>
00338         section =   config-&gt;Sections.find( (<font class="keyword">const</font> <font class="keywordtype">char</font>*)module.local8Bit() );       
00339         foundConfig = ( section != config-&gt;Sections.end() );        
00340         
00341         ConfigEntMap::iterator entry;
00342         <font class="keywordflow">if</font> (foundConfig) { <font class="comment">//copy module section</font>
00343             <font class="keywordflow">for</font> (entry = (*section).second.begin(); entry != (*section).second.end(); entry++) {
00344                     <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a>.Sections[(*section).first].insert(ConfigEntMap::value_type((*entry).first, (*entry).second));
00345             }
00346         }           
00347     }
00348     
00349     <font class="keywordflow">if</font> (!foundConfig &amp;&amp; configType != 2) { <font class="comment">//search in $HOME/.sword/</font>
00350         QString myPath = QString::fromLatin1(<font class="stringliteral">"%1/.sword/mods.d"</font>).arg(getenv(<font class="stringliteral">"HOME"</font>));
00351         dir = opendir(myPath.latin1());
00352         <font class="keywordflow">if</font> (dir) {
00353             rewinddir(dir);
00354             <font class="keywordflow">while</font> ((ent = readdir(dir)) &amp;&amp; !foundConfig) {
00355                 <font class="keywordflow">if</font> ((strcmp(ent-&gt;d_name, <font class="stringliteral">"."</font>)) &amp;&amp; (strcmp(ent-&gt;d_name, <font class="stringliteral">".."</font>))) {                                
00356                     modFile = myPath;
00357                     modFile += <font class="stringliteral">"/"</font>;
00358                     modFile += ent-&gt;d_name;
00359                     <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a> = SWConfig( (<font class="keyword">const</font> <font class="keywordtype">char</font>*)modFile.local8Bit() );
00360                     section =   <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a>.Sections.find( (<font class="keyword">const</font> <font class="keywordtype">char</font>*)module.local8Bit() );
00361                     foundConfig = ( section != <a class="code" href="class_c_sword_backend.html#a14">moduleConfig</a>.Sections.end() );
00362                 }
00363             }
00364             closedir(dir);
00365         }
00366     }
00367     <font class="keywordflow">return</font> foundConfig;
00368 }
00369 
<a name="l00371"></a><a class="code" href="class_c_sword_backend.html#d1">00371</a> <font class="keyword">const</font> QString <a class="code" href="class_c_sword_backend.html#d1">CSwordBackend::optionName</a>( <font class="keyword">const</font> <a class="code" href="class_c_sword_backend.html#s16">CSwordBackend::FilterOptions</a> option ){
00372     <font class="keywordflow">switch</font> (option) {
00373         <font class="keywordflow">case</font> CSwordBackend::footnotes:
00374             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Footnotes"</font>);
00375         <font class="keywordflow">case</font> CSwordBackend::strongNumbers:
00376             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Strong's Numbers"</font>);
00377         <font class="keywordflow">case</font> CSwordBackend::headings:
00378             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Headings"</font>);
00379         <font class="keywordflow">case</font> CSwordBackend::morphTags:
00380             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Morphological Tags"</font>);
00381     <font class="keywordflow">case</font> CSwordBackend::lemmas:
00382             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Lemmas"</font>);
00383         <font class="keywordflow">case</font> CSwordBackend::hebrewPoints:
00384             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Hebrew Vowel Points"</font>);
00385         <font class="keywordflow">case</font> CSwordBackend::hebrewCantillation:
00386             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Hebrew Cantillation"</font>);
00387         <font class="keywordflow">case</font> CSwordBackend::greekAccents:
00388             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Greek Accents"</font>);
00389     }
00390     <font class="keywordflow">return</font> QString::null;   
00391 }
00392 
<a name="l00394"></a><a class="code" href="class_c_sword_backend.html#d3">00394</a> <font class="keyword">const</font> QString <a class="code" href="class_c_sword_backend.html#d3">CSwordBackend::translatedOptionName</a>(<font class="keyword">const</font> <a class="code" href="class_c_sword_backend.html#s16">CSwordBackend::FilterOptions</a> option){
00395     <font class="keywordflow">switch</font> (option) {
00396         <font class="keywordflow">case</font> CSwordBackend::footnotes:
00397             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Footnotes"</font>);
00398         <font class="keywordflow">case</font> CSwordBackend::strongNumbers:
00399             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Strong's Numbers"</font>);
00400         <font class="keywordflow">case</font> CSwordBackend::headings:
00401             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Headings"</font>);
00402         <font class="keywordflow">case</font> CSwordBackend::morphTags:
00403             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Morphological Tags"</font>);
00404     <font class="keywordflow">case</font> CSwordBackend::lemmas:
00405             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Lemmas"</font>);
00406         <font class="keywordflow">case</font> CSwordBackend::hebrewPoints:
00407             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Hebrew Vowel Points"</font>);
00408         <font class="keywordflow">case</font> CSwordBackend::hebrewCantillation:
00409             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Hebrew Cantillation"</font>);
00410         <font class="keywordflow">case</font> CSwordBackend::greekAccents:
00411             <font class="keywordflow">return</font> i18n(<font class="stringliteral">"Greek Accents"</font>);
00412     }
00413     <font class="keywordflow">return</font> QString::null;   
00414 
00415 }
00416 
00417 
<a name="l00418"></a><a class="code" href="class_c_sword_backend.html#d2">00418</a> <font class="keyword">const</font> QString <a class="code" href="class_c_sword_backend.html#d2">CSwordBackend::configOptionName</a>( <font class="keyword">const</font> <a class="code" href="class_c_sword_backend.html#s16">CSwordBackend::FilterOptions</a> option ){
00419     <font class="keywordflow">switch</font> (option) {
00420         <font class="keywordflow">case</font> CSwordBackend::footnotes:
00421             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Footnotes"</font>);
00422         <font class="keywordflow">case</font> CSwordBackend::strongNumbers:
00423             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Strongs"</font>);
00424         <font class="keywordflow">case</font> CSwordBackend::headings:
00425             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Headings"</font>);
00426         <font class="keywordflow">case</font> CSwordBackend::morphTags:
00427             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Morph"</font>);
00428     <font class="keywordflow">case</font> CSwordBackend::lemmas:
00429             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Lemma"</font>);
00430         <font class="keywordflow">case</font> CSwordBackend::hebrewPoints:
00431             <font class="keywordflow">return</font> QString(<font class="stringliteral">"HebrewPoints"</font>);
00432         <font class="keywordflow">case</font> CSwordBackend::hebrewCantillation:
00433             <font class="keywordflow">return</font> QString(<font class="stringliteral">"Cantillation"</font>);
00434         <font class="keywordflow">case</font> CSwordBackend::greekAccents:
00435             <font class="keywordflow">return</font> QString(<font class="stringliteral">"GreekAccents"</font>);
00436     }
00437     <font class="keywordflow">return</font> QString::null;   
00438 }
00439 
<a name="l00440"></a><a class="code" href="class_c_sword_backend.html#a10">00440</a> <font class="keyword">const</font> QString <a class="code" href="class_c_sword_backend.html#a10">CSwordBackend::booknameLanguage</a>( <font class="keyword">const</font> QString&amp; language ) {
00441     <font class="keywordflow">if</font> (!language.isNull())
00442         LocaleMgr::systemLocaleMgr.setDefaultLocaleName( language.local8Bit() );
00443     <font class="keywordflow">return</font> QString::fromLatin1(LocaleMgr::systemLocaleMgr.getDefaultLocaleName());
00444 }
00445 
<a name="l00447"></a><a class="code" href="class_c_sword_backend.html#a15">00447</a> <font class="keyword">const</font> SWVersion <a class="code" href="class_c_sword_backend.html#a15">CSwordBackend::Version</a>() {
00448 <font class="comment">//  qWarning("Current version: %s", SWVersion::currentVersion);</font>
00449     <font class="keywordflow">return</font>  SWVersion::currentVersion;
00450 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:47 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
