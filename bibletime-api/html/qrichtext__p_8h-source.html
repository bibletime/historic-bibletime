<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>qrichtext_p.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.13 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>qrichtext_p.h</h1><div class="fragment"><pre>00001 <font class="comment">/****************************************************************************</font>
00002 <font class="comment">**</font>
00003 <font class="comment">** Definition of internal rich text classes</font>
00004 <font class="comment">**</font>
00005 <font class="comment">** Created : 990124</font>
00006 <font class="comment">**</font>
00007 <font class="comment">** Copyright (C) 1999-2000 Trolltech AS.  All rights reserved.</font>
00008 <font class="comment">**</font>
00009 <font class="comment">** This file is part of the kernel module of the Qt GUI Toolkit.</font>
00010 <font class="comment">**</font>
00011 <font class="comment">** This file may be distributed under the terms of the Q Public License</font>
00012 <font class="comment">** as defined by Trolltech AS of Norway and appearing in the file</font>
00013 <font class="comment">** LICENSE.QPL included in the packaging of this file.</font>
00014 <font class="comment">**</font>
00015 <font class="comment">** This file may be distributed and/or modified under the terms of the</font>
00016 <font class="comment">** GNU General Public License version 2 as published by the Free Software</font>
00017 <font class="comment">** Foundation and appearing in the file LICENSE.GPL included in the</font>
00018 <font class="comment">** packaging of this file.</font>
00019 <font class="comment">**</font>
00020 <font class="comment">** Licensees holding valid Qt Enterprise Edition or Qt Professional Edition</font>
00021 <font class="comment">** licenses may use this file in accordance with the Qt Commercial License</font>
00022 <font class="comment">** Agreement provided with the Software.</font>
00023 <font class="comment">**</font>
00024 <font class="comment">** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</font>
00025 <font class="comment">** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</font>
00026 <font class="comment">**</font>
00027 <font class="comment">** See http://www.trolltech.com/pricing.html or email sales@trolltech.com for</font>
00028 <font class="comment">**   information about Qt Commercial License Agreements.</font>
00029 <font class="comment">** See http://www.trolltech.com/qpl/ for QPL licensing information.</font>
00030 <font class="comment">** See http://www.trolltech.com/gpl/ for GPL licensing information.</font>
00031 <font class="comment">**</font>
00032 <font class="comment">** Contact info@trolltech.com if any conditions of this licensing are</font>
00033 <font class="comment">** not clear to you.</font>
00034 <font class="comment">**</font>
00035 <font class="comment">**********************************************************************/</font>
00036 
00037 <font class="preprocessor">#ifndef QRICHTEXT_P_H</font>
00038 <font class="preprocessor"></font><font class="preprocessor">#define QRICHTEXT_P_H</font>
00039 <font class="preprocessor"></font>
00040 <font class="comment">//</font>
00041 <font class="comment">//  W A R N I N G</font>
00042 <font class="comment">//  -------------</font>
00043 <font class="comment">//</font>
00044 <font class="comment">// This file is not part of the Qt API.  It exists for the convenience</font>
00045 <font class="comment">// of a number of Qt sources files.  This header file may change from</font>
00046 <font class="comment">// version to version without notice, or even be removed.</font>
00047 <font class="comment">//</font>
00048 <font class="comment">// We mean it.</font>
00049 <font class="comment">//</font>
00050 <font class="comment">//</font>
00051 
00052 <font class="preprocessor">#ifndef QT_H</font>
00053 <font class="preprocessor"></font><font class="preprocessor">#include "qt3stuff.h"</font>
00054 <font class="preprocessor">#include "qstring.h"</font>
00055 <font class="preprocessor">#include "qlist.h"</font>
00056 <font class="preprocessor">#include "qrect.h"</font>
00057 <font class="preprocessor">#include "qfontmetrics.h"</font>
00058 <font class="preprocessor">#include "qintdict.h"</font>
00059 <font class="preprocessor">#include "qmap.h"</font>
00060 <font class="preprocessor">#include "qstringlist.h"</font>
00061 <font class="preprocessor">#include "qfont.h"</font>
00062 <font class="preprocessor">#include "qcolor.h"</font>
00063 <font class="preprocessor">#include "qsize.h"</font>
00064 <font class="preprocessor">#include "qvaluelist.h"</font>
00065 <font class="preprocessor">#include "qvaluestack.h"</font>
00066 <font class="preprocessor">#include "qobject.h"</font>
00067 <font class="preprocessor">#include "qdict.h"</font>
00068 <font class="preprocessor">#include "qtextstream.h"</font>
00069 <font class="preprocessor">#include "qpixmap.h"</font>
00070 <font class="preprocessor">#include "qstylesheet.h"</font>
00071 <font class="preprocessor">#include "qvector.h"</font>
00072 <font class="preprocessor">#include "qpainter.h"</font>
00073 <font class="preprocessor">#include "qlayout.h"</font>
00074 <font class="preprocessor">#include "qobject.h"</font>
00075 <font class="preprocessor">#include &lt;limits.h&gt;</font>
00076 <font class="preprocessor">#include "qcomplextext_p.h"</font>
00077 <font class="preprocessor">#include "qapplication.h"</font>
00078 <font class="preprocessor">#endif // QT_H</font>
00079 <font class="preprocessor"></font>
00080 <font class="comment">// We need this to avoid clashes</font>
00081 <font class="keyword">namespace </font>Qt3 {
00082 
00083 <font class="keyword">class </font>QTextDocument;
00084 <font class="keyword">class </font>QTextString;
00085 <font class="keyword">class </font>QTextPreProcessor;
00086 <font class="keyword">class </font>QTextFormat;
00087 <font class="keyword">class </font>QTextCursor;
00088 <font class="keyword">class </font>QTextParag;
00089 <font class="keyword">class </font>QTextFormatter;
00090 <font class="keyword">class </font>QTextIndent;
00091 <font class="keyword">class </font>QTextFormatCollection;
00092 <font class="keyword">class </font>QStyleSheetItem;
00093 <font class="keyword">class </font>QTextCustomItem;
00094 <font class="keyword">class </font>QTextFlow;
00095 <font class="keyword">struct </font>QBidiContext;
00096 
00097 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
00098 
00099 <font class="keyword">class </font>Q_EXPORT QTextStringChar
00100 {
00101     <font class="keyword">friend</font> <font class="keyword">class </font>QTextString;
00102 
00103 <font class="keyword">public</font>:
00104     <font class="comment">// this is never called, initialize variables in QTextString::insert()!!!</font>
00105     QTextStringChar() : lineStart( 0 ), type( Regular ), startOfRun( 0 ) {d.format=0;}
00106     ~QTextStringChar();
00107     QChar c;
00108     <font class="keyword">enum</font> Type { Regular, Custom, Mark, Shaped };
00109     uint lineStart : 1;
00110     uint rightToLeft : 1;
00111     uint hasCursor : 1;
00112     uint canBreak : 1;
00113     Type type : 2;
00114     uint startOfRun : 1;
00115 
00116     <font class="keywordtype">int</font> x;
00117     <font class="keywordtype">int</font> height() <font class="keyword">const</font>;
00118     <font class="keywordtype">int</font> ascent() <font class="keyword">const</font>;
00119     <font class="keywordtype">int</font> descent() <font class="keyword">const</font>;
00120     <font class="keywordtype">bool</font> isCustom()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> type == Custom; }
00121     QTextFormat *format() <font class="keyword">const</font>;
00122     QTextCustomItem *customItem() <font class="keyword">const</font>;
00123     <font class="keywordtype">void</font> setFormat( QTextFormat *f );
00124     <font class="keywordtype">void</font> setCustomItem( QTextCustomItem *i );
00125     <font class="keywordtype">void</font> loseCustomItem();
00126     QTextStringChar *clone() <font class="keyword">const</font>;
00127     <font class="keyword">struct </font>CustomData
00128     {
00129     QTextFormat *format;
00130     QTextCustomItem *custom;
00131     };
00132 
00133     <font class="keyword">struct </font>MarkData
00134     {
00135     QTextFormat *format;
00136     <font class="keywordtype">short</font> xoff; <font class="comment">// x offset for painting the Mark</font>
00137     <font class="keywordtype">short</font> yoff; <font class="comment">// y offset for painting the Mark</font>
00138     };
00139 
00140     <font class="keyword">struct </font>ShapedData
00141     {
00142     QTextFormat *format;
00143     QChar shapedGlyph;
00144     };
00145 
00146     <font class="keyword">union </font>{
00147     QTextFormat* format;
00148     CustomData* custom;
00149     MarkData *mark;
00150     ShapedData *shaped;
00151     } d;
00152 
00153 <font class="keyword">private</font>:
00154     QTextStringChar &amp;operator=( <font class="keyword">const</font> QTextStringChar &amp; ) {
00155     <font class="comment">//abort();</font>
00156     <font class="keywordflow">return</font> *<font class="keyword">this</font>;
00157     }
00158     QTextStringChar( <font class="keyword">const</font> QTextStringChar &amp; ); <font class="comment">// copy-constructor, forbidden</font>
00159     <font class="keyword">friend</font> <font class="keyword">class </font>QComplexText;
00160     <font class="keyword">friend</font> <font class="keyword">class </font>QTextParag;
00161 };
00162 
00163 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
00164 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
00165 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMemArray&lt;QTextStringChar&gt;;
00166 <font class="comment">// MOC_SKIP_END</font>
00167 <font class="preprocessor">#endif</font>
00168 <font class="preprocessor"></font>
00169 <font class="keyword">class </font>Q_EXPORT QTextString
00170 {
00171 <font class="keyword">public</font>:
00172 
00173     QTextString();
00174     QTextString( <font class="keyword">const</font> QTextString &amp;s );
00175     ~QTextString();
00176 
00177     QString toString() <font class="keyword">const</font>;
00178     <font class="keyword">static</font> QString toString( <font class="keyword">const</font> QMemArray&lt;QTextStringChar&gt; &amp;data );
00179     QString toReverseString() <font class="keyword">const</font>;
00180 
00181     QTextStringChar &amp;at( <font class="keywordtype">int</font> i ) <font class="keyword">const</font>;
00182     <font class="keywordtype">int</font> length() <font class="keyword">const</font>;
00183 
00184     <font class="keywordtype">int</font> width( <font class="keywordtype">int</font> idx ) <font class="keyword">const</font>;
00185 
00186     <font class="keywordtype">void</font> insert( <font class="keywordtype">int</font> index, <font class="keyword">const</font> QString &amp;s, QTextFormat *f );
00187     <font class="keywordtype">void</font> insert( <font class="keywordtype">int</font> index, QTextStringChar *c );
00188     <font class="keywordtype">void</font> truncate( <font class="keywordtype">int</font> index );
00189     <font class="keywordtype">void</font> remove( <font class="keywordtype">int</font> index, <font class="keywordtype">int</font> len );
00190     <font class="keywordtype">void</font> clear();
00191 
00192     <font class="keywordtype">void</font> setFormat( <font class="keywordtype">int</font> index, QTextFormat *f, <font class="keywordtype">bool</font> useCollection );
00193 
00194     <font class="keywordtype">void</font> setTextChanged( <font class="keywordtype">bool</font> b ) { textChanged = b; }
00195     <font class="keywordtype">void</font> setBidi( <font class="keywordtype">bool</font> b ) { bidi = b; }
00196     <font class="keywordtype">bool</font> isTextChanged()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> textChanged; }
00197     <font class="keywordtype">bool</font> isBidi() <font class="keyword">const</font>;
00198     <font class="keywordtype">bool</font> isRightToLeft() <font class="keyword">const</font>;
00199 
00200     QMemArray&lt;QTextStringChar&gt; subString( <font class="keywordtype">int</font> start = 0, <font class="keywordtype">int</font> len = 0xFFFFFF ) <font class="keyword">const</font>;
00201     QMemArray&lt;QTextStringChar&gt; rawData()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> data; }
00202 
00203     <font class="keywordtype">void</font> operator=( <font class="keyword">const</font> QString &amp;s ) { clear(); insert( 0, s, 0 ); }
00204     <font class="keywordtype">void</font> operator+=( <font class="keyword">const</font> QString &amp;s );
00205     <font class="keywordtype">void</font> prepend( <font class="keyword">const</font> QString &amp;s ) { insert( 0, s, 0 ); }
00206 
00207 <font class="keyword">private</font>:
00208     <font class="keywordtype">void</font> checkBidi() <font class="keyword">const</font>;
00209     <font class="keywordtype">void</font> basicDirection() <font class="keyword">const</font>;
00210 
00211     QMemArray&lt;QTextStringChar&gt; data;
00212     uint textChanged : 1;
00213     uint bidi : 1; <font class="comment">// true when the paragraph has right to left characters</font>
00214     uint rightToLeft : 1; <font class="comment">// true if the basic direction of the paragraph is right to left.</font>
00215 };
00216 
00217 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextString::isBidi()<font class="keyword"> const</font>
00218 <font class="keyword"></font>{
00219     <font class="keywordflow">if</font> ( textChanged )
00220     checkBidi();
00221     <font class="keywordflow">return</font> bidi;
00222 }
00223 
00224 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextString::isRightToLeft()<font class="keyword"> const</font>
00225 <font class="keyword"></font>{
00226      <font class="keywordflow">if</font> ( textChanged )
00227     checkBidi();
00228     <font class="keywordflow">return</font> rightToLeft;
00229 }
00230 
00231 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
00232 
00233 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
00234 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
00235 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QValueStack&lt;int&gt;;
00236 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QValueStack&lt;QTextParag*&gt;;
00237 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QValueStack&lt;bool&gt;;
00238 <font class="comment">// MOC_SKIP_END</font>
00239 <font class="preprocessor">#endif</font>
00240 <font class="preprocessor"></font>
00241 <font class="keyword">class </font>Q_EXPORT QTextCursor
00242 {
00243 <font class="keyword">public</font>:
00244     QTextCursor( QTextDocument *d );
00245     QTextCursor();
00246     QTextCursor( <font class="keyword">const</font> QTextCursor &amp;c );
00247     QTextCursor &amp;operator=( <font class="keyword">const</font> QTextCursor &amp;c );
00248     <font class="keywordtype">bool</font> operator==( <font class="keyword">const</font> QTextCursor &amp;c ) <font class="keyword">const</font>;
00249     <font class="keywordtype">bool</font> operator!=( <font class="keyword">const</font> QTextCursor &amp;c )<font class="keyword"> const </font>{ <font class="keywordflow">return</font> !(*<font class="keyword">this</font> == c); }
00250 
00251     QTextDocument *document()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> doc; }
00252     <font class="keywordtype">void</font> setDocument( QTextDocument *d );
00253 
00254     QTextParag *parag() <font class="keyword">const</font>;
00255     <font class="keywordtype">int</font> index() <font class="keyword">const</font>;
00256     <font class="keywordtype">void</font> setParag( QTextParag *s, <font class="keywordtype">bool</font> restore = TRUE );
00257 
00258     <font class="keywordtype">void</font> gotoLeft();
00259     <font class="keywordtype">void</font> gotoRight();
00260     <font class="keywordtype">void</font> gotoUp();
00261     <font class="keywordtype">void</font> gotoDown();
00262     <font class="keywordtype">void</font> gotoLineEnd();
00263     <font class="keywordtype">void</font> gotoLineStart();
00264     <font class="keywordtype">void</font> gotoHome();
00265     <font class="keywordtype">void</font> gotoEnd();
00266     <font class="keywordtype">void</font> gotoPageUp( <font class="keywordtype">int</font> visibleHeight );
00267     <font class="keywordtype">void</font> gotoPageDown( <font class="keywordtype">int</font> visibleHeight );
00268     <font class="keywordtype">void</font> gotoWordLeft();
00269     <font class="keywordtype">void</font> gotoWordRight();
00270 
00271     <font class="keywordtype">void</font> insert( <font class="keyword">const</font> QString &amp;s, <font class="keywordtype">bool</font> checkNewLine, QMemArray&lt;QTextStringChar&gt; *formatting = 0 );
00272     <font class="keywordtype">void</font> splitAndInsertEmptyParag( <font class="keywordtype">bool</font> ind = TRUE, <font class="keywordtype">bool</font> updateIds = TRUE );
00273     <font class="keywordtype">bool</font> remove();
00274     <font class="keywordtype">void</font> killLine();
00275     <font class="keywordtype">void</font> indent();
00276 
00277     <font class="keywordtype">bool</font> atParagStart();
00278     <font class="keywordtype">bool</font> atParagEnd();
00279 
00280     <font class="keywordtype">void</font> setIndex( <font class="keywordtype">int</font> i, <font class="keywordtype">bool</font> restore = TRUE );
00281 
00282     <font class="keywordtype">void</font> checkIndex();
00283 
00284     <font class="keywordtype">int</font> offsetX()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> ox; }
00285     <font class="keywordtype">int</font> offsetY()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> oy; }
00286 
00287     QTextParag *topParag()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> parags.isEmpty() ? string : parags.first(); }
00288     <font class="keywordtype">int</font> totalOffsetX() <font class="keyword">const</font>;
00289     <font class="keywordtype">int</font> totalOffsetY() <font class="keyword">const</font>;
00290 
00291     <font class="keywordtype">bool</font> place( <font class="keyword">const</font> QPoint &amp;pos, QTextParag *s );
00292     <font class="keywordtype">void</font> restoreState();
00293 
00294     <font class="keywordtype">int</font> x() <font class="keyword">const</font>;
00295     <font class="keywordtype">int</font> y() <font class="keyword">const</font>;
00296 
00297     <font class="keywordtype">int</font> nestedDepth()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> indices.count(); }
00298 
00299 <font class="keyword">private</font>:
00300     <font class="keyword">enum</font> Operation { EnterBegin, EnterEnd, Next, Prev, Up, Down };
00301 
00302     <font class="keywordtype">void</font> push();
00303     <font class="keywordtype">void</font> pop();
00304     <font class="keywordtype">void</font> processNesting( Operation op );
00305     <font class="keywordtype">void</font> invalidateNested();
00306     <font class="keywordtype">void</font> gotoIntoNested( <font class="keyword">const</font> QPoint &amp;globalPos );
00307 
00308     QTextParag *string;
00309     QTextDocument *doc;
00310     <font class="keywordtype">int</font> idx, tmpIndex;
00311     <font class="keywordtype">int</font> ox, oy;
00312     QValueStack&lt;int&gt; indices;
00313     QValueStack&lt;QTextParag*&gt; parags;
00314     QValueStack&lt;int&gt; xOffsets;
00315     QValueStack&lt;int&gt; yOffsets;
00316     QValueStack&lt;bool&gt; nestedStack;
00317     <font class="keywordtype">bool</font> nested;
00318 
00319 };
00320 
00321 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
00322 
00323 <font class="keyword">class </font>Q_EXPORT QTextCommand
00324 {
00325 <font class="keyword">public</font>:
00326     <font class="keyword">enum</font> Commands { Invalid, Insert, Delete, Format, Alignment, ParagType };
00327 
00328     QTextCommand( QTextDocument *d ) : doc( d ), cursor( d ) {}
00329     <font class="keyword">virtual</font> ~QTextCommand() {}
00330     <font class="keyword">virtual</font> Commands type()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> Invalid; };
00331 
00332     <font class="keyword">virtual</font> QTextCursor *execute( QTextCursor *c ) = 0;
00333     <font class="keyword">virtual</font> QTextCursor *unexecute( QTextCursor *c ) = 0;
00334 
00335 <font class="keyword">protected</font>:
00336     QTextDocument *doc;
00337     QTextCursor cursor;
00338 
00339 };
00340 
00341 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
00342 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
00343 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QPtrList&lt;QTextCommand&gt;;
00344 <font class="comment">// MOC_SKIP_END</font>
00345 <font class="preprocessor">#endif</font>
00346 <font class="preprocessor"></font>
00347 <font class="keyword">class </font>Q_EXPORT QTextCommandHistory
00348 {
00349 <font class="keyword">public</font>:
00350     QTextCommandHistory( <font class="keywordtype">int</font> s ) : current( -1 ), steps( s ) { history.setAutoDelete( TRUE ); }
00351     ~QTextCommandHistory() { clear(); }
00352 
00353     <font class="keywordtype">void</font> clear() { history.clear(); current = -1; }
00354 
00355     <font class="keywordtype">void</font> addCommand( QTextCommand *cmd );
00356     QTextCursor *undo( QTextCursor *c );
00357     QTextCursor *redo( QTextCursor *c );
00358 
00359     <font class="keywordtype">bool</font> isUndoAvailable();
00360     <font class="keywordtype">bool</font> isRedoAvailable();
00361 
00362     <font class="keywordtype">void</font> setUndoDepth( <font class="keywordtype">int</font> d ) { steps = d; }
00363     <font class="keywordtype">int</font> undoDepth()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> steps; }
00364 
00365 <font class="keyword">private</font>:
00366     QPtrList&lt;QTextCommand&gt; history;
00367     <font class="keywordtype">int</font> current, steps;
00368 
00369 };
00370 
00371 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
00372 
00373 <font class="keyword">class </font>Q_EXPORT QTextCustomItem
00374 {
00375 <font class="keyword">public</font>:
00376     QTextCustomItem( QTextDocument *p );
00377     <font class="keyword">virtual</font> ~QTextCustomItem();
00378 
00379     <font class="keyword">virtual</font> <font class="keywordtype">void</font> draw(QPainter* p, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch, <font class="keyword">const</font> QColorGroup&amp; cg, <font class="keywordtype">bool</font> selected ) = 0;
00380 
00381     <font class="keyword">virtual</font> <font class="keywordtype">void</font> move( <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y ) { xpos = x; ypos = y; }
00382     <font class="keywordtype">int</font> x()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> xpos; }
00383     <font class="keywordtype">int</font> y()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> ypos; }
00384 
00385     <font class="keyword">virtual</font> <font class="keywordtype">void</font> adjustToPainter( QPainter* ) { width = 0; }
00386 
00387     <font class="keyword">enum</font> Placement { PlaceInline = 0, PlaceLeft, PlaceRight };
00388     <font class="keyword">virtual</font> Placement placement()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> PlaceInline; }
00389     <font class="keywordtype">bool</font> placeInline() { <font class="keywordflow">return</font> placement() == PlaceInline; }
00390 
00391     <font class="keyword">virtual</font> <font class="keywordtype">bool</font> ownLine()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> FALSE; }
00392     <font class="keyword">virtual</font> <font class="keywordtype">void</font> resize( QPainter*, <font class="keywordtype">int</font> nwidth ){ width = nwidth; };
00393     <font class="keyword">virtual</font> <font class="keywordtype">void</font> invalidate() {};
00394 
00395     <font class="keyword">virtual</font> <font class="keywordtype">bool</font> isNested()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> FALSE; }
00396     <font class="keyword">virtual</font> <font class="keywordtype">int</font> minimumWidth()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> 0; }
00397     <font class="keyword">virtual</font> <font class="keywordtype">int</font> widthHint()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> 0; }
00398 
00399     <font class="keyword">virtual</font> QString richText()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> QString::null; }
00400 
00401     <font class="keywordtype">int</font> width;
00402     <font class="keywordtype">int</font> height;
00403 
00404     <font class="keyword">virtual</font> <font class="keywordtype">void</font> enter( QTextCursor *, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy, <font class="keywordtype">bool</font> atEnd = FALSE ) {
00405     doc = doc; parag = parag; idx = idx; ox = ox; oy = oy; Q_UNUSED( atEnd )
00406     }
00407     <font class="keyword">virtual</font> <font class="keywordtype">void</font> enterAt( QTextCursor *, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy, <font class="keyword">const</font> QPoint &amp; ) {
00408     doc = doc; parag = parag; idx = idx; ox = ox; oy = oy;
00409     }
00410     <font class="keyword">virtual</font> <font class="keywordtype">void</font> next( QTextCursor *, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy ) {
00411     doc = doc; parag = parag; idx = idx; ox = ox; oy = oy;
00412     }
00413     <font class="keyword">virtual</font> <font class="keywordtype">void</font> prev( QTextCursor *, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy ) {
00414     doc = doc; parag = parag; idx = idx; ox = ox; oy = oy;
00415     }
00416     <font class="keyword">virtual</font> <font class="keywordtype">void</font> down( QTextCursor *, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy ) {
00417     doc = doc; parag = parag; idx = idx; ox = ox; oy = oy;
00418     }
00419     <font class="keyword">virtual</font> <font class="keywordtype">void</font> up( QTextCursor *, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy ) {
00420     doc = doc; parag = parag; idx = idx; ox = ox; oy = oy;
00421     }
00422 
00423     QTextDocument *parent; <font class="comment">// obsolete?</font>
00424 
00425     QTextParag *paragraph()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> parag; }
00426     <font class="keywordtype">void</font> setParagraph( QTextParag * p ) { parag = p; }
00427 <font class="keyword">protected</font>:
00428     <font class="keywordtype">int</font> xpos;
00429     <font class="keywordtype">int</font> ypos;
00430 <font class="keyword">private</font>:
00431     QTextParag *parag;
00432 };
00433 
00434 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
00435 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
00436 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMap&lt;QString, QString&gt;;
00437 <font class="comment">// MOC_SKIP_END</font>
00438 <font class="preprocessor">#endif</font>
00439 <font class="preprocessor"></font>
00440 <font class="keyword">class </font>Q_EXPORT QTextImage : <font class="keyword">public</font> QTextCustomItem
00441 {
00442 <font class="keyword">public</font>:
00443     QTextImage( QTextDocument *p, <font class="keyword">const</font> QMap&lt;QString, QString&gt; &amp;attr, <font class="keyword">const</font> QString&amp; context,
00444         QMimeSourceFactory &amp;factory);
00445     ~QTextImage();
00446 
00447     Placement placement()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> place; }
00448     <font class="keywordtype">void</font> adjustToPainter( QPainter* );
00449     <font class="keywordtype">int</font> widthHint()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> width; }
00450     <font class="keywordtype">int</font> minimumWidth()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> width; }
00451 
00452     QString richText() <font class="keyword">const</font>;
00453 
00454     <font class="keywordtype">void</font> draw( QPainter* p, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch, <font class="keyword">const</font> QColorGroup&amp; cg, <font class="keywordtype">bool</font> selected );
00455 
00456 <font class="keyword">private</font>:
00457     QRegion* reg;
00458     QPixmap pm;
00459     Placement place;
00460     <font class="keywordtype">int</font> tmpwidth, tmpheight;
00461     QMap&lt;QString, QString&gt; attributes;
00462     QString imgId;
00463 
00464 };
00465 
00466 <font class="keyword">class </font>Q_EXPORT QTextHorizontalLine : <font class="keyword">public</font> QTextCustomItem
00467 {
00468 <font class="keyword">public</font>:
00469     QTextHorizontalLine( QTextDocument *p );
00470     ~QTextHorizontalLine();
00471     <font class="keywordtype">void</font> adjustToPainter( QPainter* );
00472     <font class="keywordtype">void</font> draw(QPainter* p, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch, <font class="keyword">const</font> QColorGroup&amp; cg, <font class="keywordtype">bool</font> selected );
00473     QString richText() <font class="keyword">const</font>;
00474 
00475     <font class="keywordtype">bool</font> ownLine()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> TRUE; }
00476 
00477 <font class="keyword">private</font>:
00478     <font class="keywordtype">int</font> tmpheight;
00479 
00480 };
00481 
00482 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
00483 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
00484 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QPtrList&lt;QTextCustomItem&gt;;
00485 <font class="comment">// MOC_SKIP_END</font>
00486 <font class="preprocessor">#endif</font>
00487 <font class="preprocessor"></font>
00488 <font class="keyword">class </font>Q_EXPORT QTextFlow
00489 {
00490     <font class="keyword">friend</font> <font class="keyword">class </font>QTextDocument;
00491     <font class="keyword">friend</font> <font class="keyword">class </font>QTextTableCell;
00492 
00493 <font class="keyword">public</font>:
00494     QTextFlow();
00495     <font class="keyword">virtual</font> ~QTextFlow();
00496 
00497     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setWidth( <font class="keywordtype">int</font> w );
00498     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setPageSize( <font class="keywordtype">int</font> ps ) { pagesize = ps; }
00499     <font class="keywordtype">int</font> pageSize()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> pagesize; }
00500 
00501     <font class="keyword">virtual</font> <font class="keywordtype">int</font> adjustLMargin( <font class="keywordtype">int</font> yp, <font class="keywordtype">int</font> h, <font class="keywordtype">int</font> margin, <font class="keywordtype">int</font> space );
00502     <font class="keyword">virtual</font> <font class="keywordtype">int</font> adjustRMargin( <font class="keywordtype">int</font> yp, <font class="keywordtype">int</font> h, <font class="keywordtype">int</font> margin, <font class="keywordtype">int</font> space );
00503 
00504     <font class="keyword">virtual</font> <font class="keywordtype">void</font> registerFloatingItem( QTextCustomItem* item, <font class="keywordtype">bool</font> right = FALSE );
00505     <font class="keyword">virtual</font> <font class="keywordtype">void</font> unregisterFloatingItem( QTextCustomItem* item );
00506     <font class="keyword">virtual</font> <font class="keywordtype">void</font> drawFloatingItems(QPainter* p, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch, <font class="keyword">const</font> QColorGroup&amp; cg, <font class="keywordtype">bool</font> selected );
00507     <font class="keyword">virtual</font> <font class="keywordtype">void</font> adjustFlow( <font class="keywordtype">int</font>  &amp;yp, <font class="keywordtype">int</font> w, <font class="keywordtype">int</font> h, QTextParag *parag, <font class="keywordtype">bool</font> pages = TRUE );
00508 
00509     <font class="keyword">virtual</font> <font class="keywordtype">bool</font> isEmpty() { <font class="keywordflow">return</font> leftItems.isEmpty() &amp;&amp; rightItems.isEmpty(); }
00510     <font class="keyword">virtual</font> <font class="keywordtype">void</font> updateHeight( QTextCustomItem *i );
00511 
00512     <font class="keyword">virtual</font> <font class="keywordtype">void</font> draw( QPainter *, <font class="keywordtype">int</font> , <font class="keywordtype">int</font> , <font class="keywordtype">int</font> , <font class="keywordtype">int</font> ) {}
00513     <font class="keyword">virtual</font> <font class="keywordtype">void</font> eraseAfter( QTextParag *, QPainter *, <font class="keyword">const</font> QColorGroup&amp; ) {}
00514 
00515     <font class="keywordtype">void</font> clear();
00516 
00517 <font class="keyword">private</font>:
00518     <font class="keywordtype">int</font> width;
00519     <font class="keywordtype">int</font> height;
00520 
00521     <font class="keywordtype">int</font> pagesize;
00522 
00523     QPtrList&lt;QTextCustomItem&gt; leftItems;
00524     QPtrList&lt;QTextCustomItem&gt; rightItems;
00525 
00526 };
00527 
00528 <font class="keyword">class </font>QTextTable;
00529 
00530 <font class="keyword">class </font>Q_EXPORT QTextTableCell : <font class="keyword">public</font> QLayoutItem
00531 {
00532     <font class="keyword">friend</font> <font class="keyword">class </font>QTextTable;
00533 
00534 <font class="keyword">public</font>:
00535     QTextTableCell( QTextTable* table,
00536             <font class="keywordtype">int</font> row, <font class="keywordtype">int</font> column,
00537             <font class="keyword">const</font> QMap&lt;QString, QString&gt; &amp;attr,
00538             <font class="keyword">const</font> QStyleSheetItem* style,
00539             <font class="keyword">const</font> QTextFormat&amp;, <font class="keyword">const</font> QString&amp; context,
00540             QMimeSourceFactory &amp;factory, QStyleSheet *sheet, <font class="keyword">const</font> QString&amp; doc );
00541     QTextTableCell( QTextTable* table, <font class="keywordtype">int</font> row, <font class="keywordtype">int</font> column );
00542 
00543     ~QTextTableCell();
00544     QSize sizeHint() <font class="keyword">const</font> ;
00545     QSize minimumSize() <font class="keyword">const</font> ;
00546     QSize maximumSize() <font class="keyword">const</font> ;
00547     QSizePolicy::ExpandData expanding() <font class="keyword">const</font>;
00548     <font class="keywordtype">bool</font> isEmpty() <font class="keyword">const</font>;
00549     <font class="keywordtype">void</font> setGeometry( <font class="keyword">const</font> QRect&amp; ) ;
00550     QRect geometry() <font class="keyword">const</font>;
00551 
00552     <font class="keywordtype">bool</font> hasHeightForWidth() <font class="keyword">const</font>;
00553     <font class="keywordtype">int</font> heightForWidth( <font class="keywordtype">int</font> ) <font class="keyword">const</font>;
00554 
00555     <font class="keywordtype">void</font> adjustToPainter();
00556 
00557     <font class="keywordtype">int</font> row()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> row_; }
00558     <font class="keywordtype">int</font> column()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> col_; }
00559     <font class="keywordtype">int</font> rowspan()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> rowspan_; }
00560     <font class="keywordtype">int</font> colspan()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> colspan_; }
00561     <font class="keywordtype">int</font> stretch()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> stretch_; }
00562 
00563     QTextDocument* richText()  <font class="keyword">const</font> { <font class="keywordflow">return</font> richtext; }
00564     QTextTable* table()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> parent; }
00565 
00566     <font class="keywordtype">void</font> draw( <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch, <font class="keyword">const</font> QColorGroup&amp; cg, <font class="keywordtype">bool</font> selected );
00567 
00568     QBrush *backGround()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> background; }
00569     <font class="keyword">virtual</font> <font class="keywordtype">void</font> invalidate() { cached_width = -1; cached_sizehint = -1; }
00570 
00571 <font class="keyword">private</font>:
00572     QPainter* painter() <font class="keyword">const</font>;
00573     QRect geom;
00574     QTextTable* parent;
00575     QTextDocument* richtext;
00576     <font class="keywordtype">int</font> row_;
00577     <font class="keywordtype">int</font> col_;
00578     <font class="keywordtype">int</font> rowspan_;
00579     <font class="keywordtype">int</font> colspan_;
00580     <font class="keywordtype">int</font> stretch_;
00581     <font class="keywordtype">int</font> maxw;
00582     <font class="keywordtype">int</font> minw;
00583     <font class="keywordtype">bool</font> hasFixedWidth;
00584     QBrush *background;
00585     <font class="keywordtype">int</font> cached_width;
00586     <font class="keywordtype">int</font> cached_sizehint;
00587     QMap&lt;QString, QString&gt; attributes;
00588 
00589 };
00590 
00591 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
00592 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
00593 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QPtrList&lt;QTextTableCell&gt;;
00594 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMap&lt;QTextCursor*, int&gt;;
00595 <font class="comment">// MOC_SKIP_END</font>
00596 <font class="preprocessor">#endif</font>
00597 <font class="preprocessor"></font>
00598 <font class="keyword">class </font>Q_EXPORT QTextTable: <font class="keyword">public</font> QTextCustomItem
00599 {
00600     <font class="keyword">friend</font> <font class="keyword">class </font>QTextTableCell;
00601 
00602 <font class="keyword">public</font>:
00603     QTextTable( QTextDocument *p, <font class="keyword">const</font> QMap&lt;QString, QString&gt; &amp;attr );
00604     ~QTextTable();
00605     <font class="keywordtype">void</font> adjustToPainter( QPainter *p );
00606     <font class="keywordtype">void</font> verticalBreak( <font class="keywordtype">int</font>  y, QTextFlow* flow );
00607     <font class="keywordtype">void</font> draw( QPainter* p, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch,
00608            <font class="keyword">const</font> QColorGroup&amp; cg, <font class="keywordtype">bool</font> selected );
00609 
00610     <font class="keywordtype">bool</font> noErase()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> TRUE; };
00611     <font class="keywordtype">bool</font> ownLine()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> TRUE; }
00612     Placement placement()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> place; }
00613     <font class="keywordtype">bool</font> isNested()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> TRUE; }
00614     <font class="keywordtype">void</font> resize( QPainter*, <font class="keywordtype">int</font> nwidth );
00615     <font class="keyword">virtual</font> <font class="keywordtype">void</font> invalidate() { cachewidth = -1; };
00617 
00618     <font class="keyword">virtual</font> <font class="keywordtype">void</font> enter( QTextCursor *c, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy, <font class="keywordtype">bool</font> atEnd = FALSE );
00619     <font class="keyword">virtual</font> <font class="keywordtype">void</font> enterAt( QTextCursor *c, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy, <font class="keyword">const</font> QPoint &amp;pos );
00620     <font class="keyword">virtual</font> <font class="keywordtype">void</font> next( QTextCursor *c, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy );
00621     <font class="keyword">virtual</font> <font class="keywordtype">void</font> prev( QTextCursor *c, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy );
00622     <font class="keyword">virtual</font> <font class="keywordtype">void</font> down( QTextCursor *c, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy );
00623     <font class="keyword">virtual</font> <font class="keywordtype">void</font> up( QTextCursor *c, QTextDocument *&amp;doc, QTextParag *&amp;parag, <font class="keywordtype">int</font> &amp;idx, <font class="keywordtype">int</font> &amp;ox, <font class="keywordtype">int</font> &amp;oy );
00624 
00625     QString richText() <font class="keyword">const</font>;
00626 
00627     <font class="keywordtype">int</font> minimumWidth()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> layout ? layout-&gt;minimumSize().width() : 0; }
00628     <font class="keywordtype">int</font> widthHint()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> ( layout ? layout-&gt;sizeHint().width() : 0 ) + 2 * outerborder; }
00629 
00630 <font class="keyword">private</font>:
00631     <font class="keywordtype">void</font> format( <font class="keywordtype">int</font> &amp;w );
00632     <font class="keywordtype">void</font> addCell( QTextTableCell* cell );
00633 
00634 <font class="keyword">private</font>:
00635     QGridLayout* layout;
00636     QPtrList&lt;QTextTableCell&gt; cells;
00637     QPainter* painter;
00638     <font class="keywordtype">int</font> cachewidth;
00639     <font class="keywordtype">int</font> fixwidth;
00640     <font class="keywordtype">int</font> cellpadding;
00641     <font class="keywordtype">int</font> cellspacing;
00642     <font class="keywordtype">int</font> border;
00643     <font class="keywordtype">int</font> outerborder;
00644     <font class="keywordtype">int</font> stretch;
00645     <font class="keywordtype">int</font> innerborder;
00646     <font class="keywordtype">int</font> us_ib, us_b, us_ob, us_cs;
00647     <font class="keywordtype">int</font> lastX, lastY;
00648     QMap&lt;QString, QString&gt; attributes;
00649 
00650     QMap&lt;QTextCursor*, int&gt; currCell;
00651 
00652     Placement place;
00653 };
00654 
00655 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
00656 
00657 <font class="keyword">class </font>QTextTableCell;
00658 <font class="keyword">class </font>QTextParag;
00659 
00660 <font class="keyword">struct </font>Q_EXPORT QTextDocumentSelection
00661 {
00662     QTextCursor startCursor, endCursor;
00663     <font class="keywordtype">bool</font> swapped;
00664 };
00665 
00666 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
00667 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
00668 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMap&lt;int, QColor&gt;;
00669 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMap&lt;int, bool&gt;;
00670 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMap&lt;int, QTextDocumentSelection&gt;;
00671 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QPtrList&lt;QTextDocument&gt;;
00672 <font class="comment">// MOC_SKIP_END</font>
00673 <font class="preprocessor">#endif</font>
00674 <font class="preprocessor"></font>
00675 <font class="keyword">class </font>Q_EXPORT QTextDocument : <font class="keyword">public</font> QObject
00676 {
00677     Q_OBJECT
00678 
00679     <font class="keyword">friend</font> <font class="keyword">class </font>QTextTableCell;
00680     <font class="keyword">friend</font> <font class="keyword">class </font>QTextCursor;
00681     <font class="keyword">friend</font> <font class="keyword">class </font>QTextView;
00682     <font class="keyword">friend</font> <font class="keyword">class </font>QTextParag;
00683 
00684 <font class="keyword">public</font>:
00685 <font class="comment">//ANY_CHARSET_BEGIN</font>
00686     QMap&lt;QString,QFont::CharSet&gt;* charsetMap;
00687 <font class="comment">//ANY_CHARSET_END</font>
00688 
00689     <font class="keyword">enum</font> SelectionIds {
00690     Standard = 0,
00691     Temp = 32000 <font class="comment">// This selection must not be drawn, it's used e.g. by undo/redo to</font>
00692     <font class="comment">// remove multiple lines with removeSelectedText()</font>
00693     };
00694 
00695     QTextDocument( QTextDocument *p );
00696     QTextDocument( QTextDocument *d, QTextFormatCollection *f );
00697     ~QTextDocument();
00698     QTextDocument *parent()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> par; }
00699     QTextParag *parentParag()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> parParag; }
00700 
00701     <font class="keywordtype">void</font> setText( <font class="keyword">const</font> QString &amp;text, <font class="keyword">const</font> QString &amp;context );
00702     QMap&lt;QString, QString&gt; attributes()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> attribs; }
00703     <font class="keywordtype">void</font> setAttributes( <font class="keyword">const</font> QMap&lt;QString, QString&gt; &amp;attr ) { attribs = attr; }
00704 
00705     QString text() <font class="keyword">const</font>;
00706     QString text( <font class="keywordtype">int</font> parag ) <font class="keyword">const</font>;
00707     QString originalText() <font class="keyword">const</font>;
00708 
00709     <font class="keywordtype">int</font> x() <font class="keyword">const</font>;
00710     <font class="keywordtype">int</font> y() <font class="keyword">const</font>;
00711     <font class="keywordtype">int</font> width() <font class="keyword">const</font>;
00712     <font class="keywordtype">int</font> widthUsed() <font class="keyword">const</font>;
00713     <font class="keywordtype">int</font> visibleWidth() <font class="keyword">const</font>;
00714     <font class="keywordtype">int</font> height() <font class="keyword">const</font>;
00715     <font class="keywordtype">void</font> setWidth( <font class="keywordtype">int</font> w );
00716     <font class="keywordtype">int</font> minimumWidth() <font class="keyword">const</font>;
00717     <font class="keywordtype">bool</font> setMinimumWidth( <font class="keywordtype">int</font> w, QTextParag *parag );
00718 
00719     QTextParag *firstParag() <font class="keyword">const</font>;
00720     QTextParag *lastParag() <font class="keyword">const</font>;
00721     <font class="keywordtype">void</font> setFirstParag( QTextParag *p );
00722     <font class="keywordtype">void</font> setLastParag( QTextParag *p );
00723 
00724     <font class="keywordtype">void</font> invalidate();
00725 
00726     <font class="keywordtype">void</font> setPreProcessor( QTextPreProcessor *sh );
00727     QTextPreProcessor *preProcessor() <font class="keyword">const</font>;
00728 
00729     <font class="keywordtype">void</font> setFormatter( QTextFormatter *f );
00730     QTextFormatter *formatter() <font class="keyword">const</font>;
00731 
00732     <font class="keywordtype">void</font> setIndent( QTextIndent *i );
00733     QTextIndent *indent() <font class="keyword">const</font>;
00734 
00735     QColor selectionColor( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
00736     <font class="keywordtype">bool</font> invertSelectionText( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
00737     <font class="keywordtype">void</font> setSelectionColor( <font class="keywordtype">int</font> id, <font class="keyword">const</font> QColor &amp;c );
00738     <font class="keywordtype">void</font> setInvertSelectionText( <font class="keywordtype">int</font> id, <font class="keywordtype">bool</font> b );
00739     <font class="keywordtype">bool</font> hasSelection( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
00740     <font class="keywordtype">void</font> setSelectionStart( <font class="keywordtype">int</font> id, QTextCursor *cursor );
00741     <font class="keywordtype">bool</font> setSelectionEnd( <font class="keywordtype">int</font> id, QTextCursor *cursor );
00742     <font class="keywordtype">void</font> selectAll( <font class="keywordtype">int</font> id );
00743     <font class="keywordtype">bool</font> removeSelection( <font class="keywordtype">int</font> id );
00744     <font class="keywordtype">void</font> selectionStart( <font class="keywordtype">int</font> id, <font class="keywordtype">int</font> &amp;paragId, <font class="keywordtype">int</font> &amp;index );
00745     QTextCursor selectionStartCursor( <font class="keywordtype">int</font> id );
00746     QTextCursor selectionEndCursor( <font class="keywordtype">int</font> id );
00747     <font class="keywordtype">void</font> selectionEnd( <font class="keywordtype">int</font> id, <font class="keywordtype">int</font> &amp;paragId, <font class="keywordtype">int</font> &amp;index );
00748     <font class="keywordtype">void</font> setFormat( <font class="keywordtype">int</font> id, QTextFormat *f, <font class="keywordtype">int</font> flags );
00749     QTextParag *selectionStart( <font class="keywordtype">int</font> id );
00750     QTextParag *selectionEnd( <font class="keywordtype">int</font> id );
00751     <font class="keywordtype">int</font> numSelections()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> nSelections; }
00752     <font class="keywordtype">void</font> addSelection( <font class="keywordtype">int</font> id );
00753 
00754     QString selectedText( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
00755     <font class="keywordtype">void</font> copySelectedText( <font class="keywordtype">int</font> id );
00756     <font class="keywordtype">void</font> removeSelectedText( <font class="keywordtype">int</font> id, QTextCursor *cursor );
00757     <font class="keywordtype">void</font> indentSelection( <font class="keywordtype">int</font> id );
00758 
00759     QTextParag *paragAt( <font class="keywordtype">int</font> i ) <font class="keyword">const</font>;
00760 
00761     <font class="keywordtype">void</font> addCommand( QTextCommand *cmd );
00762     QTextCursor *undo( QTextCursor *c = 0 );
00763     QTextCursor *redo( QTextCursor *c  = 0 );
00764     QTextCommandHistory *commands()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> commandHistory; }
00765 
00766     QTextFormatCollection *formatCollection() <font class="keyword">const</font>;
00767 
00768     <font class="keywordtype">bool</font> find( <font class="keyword">const</font> QString &amp;expr, <font class="keywordtype">bool</font> cs, <font class="keywordtype">bool</font> wo, <font class="keywordtype">bool</font> forward, <font class="keywordtype">int</font> *parag, <font class="keywordtype">int</font> *index, QTextCursor *cursor );
00769 
00770     <font class="keywordtype">void</font> setTextFormat( Qt::TextFormat f );
00771     Qt::TextFormat textFormat() <font class="keyword">const</font>;
00772 
00773     <font class="keywordtype">bool</font> inSelection( <font class="keywordtype">int</font> selId, <font class="keyword">const</font> QPoint &amp;pos ) <font class="keyword">const</font>;
00774 
00775     QStyleSheet *styleSheet()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> sheet_; }
00776     QMimeSourceFactory *mimeSourceFactory()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> factory_; }
00777     QString context()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> contxt; }
00778 
00779     <font class="keywordtype">void</font> setStyleSheet( QStyleSheet *s );
00780     <font class="keywordtype">void</font> updateStyles();
00781     <font class="keywordtype">void</font> updateFontSizes( <font class="keywordtype">int</font> base );
00782     <font class="keywordtype">void</font> updateFontAttributes( <font class="keyword">const</font> QFont &amp;f, <font class="keyword">const</font> QFont &amp;old );
00783     <font class="keywordtype">void</font> setMimeSourceFactory( QMimeSourceFactory *f ) { <font class="keywordflow">if</font> ( f ) factory_ = f; }
00784     <font class="keywordtype">void</font> setContext( <font class="keyword">const</font> QString &amp;c ) { <font class="keywordflow">if</font> ( !c.isEmpty() ) contxt = c; }
00785 
00786     <font class="keywordtype">void</font> setUnderlineLinks( <font class="keywordtype">bool</font> b ) { underlLinks = b; }
00787     <font class="keywordtype">bool</font> underlineLinks()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> underlLinks; }
00788 
00789     <font class="keywordtype">void</font> setPaper( QBrush *brush ) { <font class="keywordflow">if</font> ( backBrush ) <font class="keyword">delete</font> backBrush; backBrush = brush; }
00790     QBrush *paper()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> backBrush; }
00791 
00792     <font class="keywordtype">void</font> doLayout( QPainter *p, <font class="keywordtype">int</font> w );
00793     <font class="keywordtype">void</font> draw( QPainter *p, <font class="keyword">const</font> QRegion &amp;reg, <font class="keyword">const</font> QColorGroup &amp;cg, <font class="keyword">const</font> QBrush *paper = 0 );
00794     <font class="keywordtype">void</font> drawParag( QPainter *p, QTextParag *parag, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch,
00795             QPixmap *&amp;doubleBuffer, <font class="keyword">const</font> QColorGroup &amp;cg,
00796             <font class="keywordtype">bool</font> drawCursor, QTextCursor *cursor, <font class="keywordtype">bool</font> resetChanged = TRUE );
00797     QTextParag *draw( QPainter *p, <font class="keywordtype">int</font> cx, <font class="keywordtype">int</font> cy, <font class="keywordtype">int</font> cw, <font class="keywordtype">int</font> ch, <font class="keyword">const</font> QColorGroup &amp;cg,
00798               <font class="keywordtype">bool</font> onlyChanged = FALSE, <font class="keywordtype">bool</font> drawCursor = FALSE, QTextCursor *cursor = 0,
00799               <font class="keywordtype">bool</font> resetChanged = TRUE );
00800 
00801     <font class="keywordtype">void</font> setDefaultFont( <font class="keyword">const</font> QFont &amp;f );
00802 
00803     <font class="keywordtype">void</font> registerCustomItem( QTextCustomItem *i, QTextParag *p );
00804     <font class="keywordtype">void</font> unregisterCustomItem( QTextCustomItem *i, QTextParag *p );
00805     <font class="keyword">const</font> QList&lt;QTextCustomItem&gt; &amp; allCustomItems()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> customItems; }
00806 
00807     <font class="keywordtype">void</font> setFlow( QTextFlow *f );
00808     QTextFlow *flow()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> flow_; }
00809     <font class="keywordtype">bool</font> verticalBreak()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> pages; }
00810     <font class="keywordtype">void</font> setVerticalBreak( <font class="keywordtype">bool</font> b ) { pages = b; }
00811 
00812     <font class="keywordtype">void</font> setUseFormatCollection( <font class="keywordtype">bool</font> b ) { useFC = b; }
00813     <font class="keywordtype">bool</font> useFormatCollection()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> useFC; }
00814 
00815     QTextTableCell *tableCell()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> tc; }
00816     <font class="keywordtype">void</font> setTableCell( QTextTableCell *c ) { tc = c; }
00817 
00818     <font class="keywordtype">void</font> setPlainText( <font class="keyword">const</font> QString &amp;text );
00819     <font class="keywordtype">void</font> setRichText( <font class="keyword">const</font> QString &amp;text, <font class="keyword">const</font> QString &amp;context );
00820     QString richText( QTextParag *p = 0 ) <font class="keyword">const</font>;
00821     QString plainText( QTextParag *p = 0 ) <font class="keyword">const</font>;
00822 
00823     <font class="keywordtype">bool</font> focusNextPrevChild( <font class="keywordtype">bool</font> next );
00824 
00825     <font class="keywordtype">int</font> alignment() <font class="keyword">const</font>;
00826     <font class="keywordtype">void</font> setAlignment( <font class="keywordtype">int</font> a );
00827 
00828     <font class="keywordtype">int</font> *tabArray() <font class="keyword">const</font>;
00829     <font class="keywordtype">int</font> tabStopWidth() <font class="keyword">const</font>;
00830     <font class="keywordtype">void</font> setTabArray( <font class="keywordtype">int</font> *a );
00831     <font class="keywordtype">void</font> setTabStops( <font class="keywordtype">int</font> tw );
00832 
00833     <font class="keywordtype">void</font> setUndoDepth( <font class="keywordtype">int</font> d ) { commandHistory-&gt;setUndoDepth( d ); }
00834     <font class="keywordtype">int</font> undoDepth()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> commandHistory-&gt;undoDepth(); }
00835 
00836     <font class="keywordtype">int</font> length() <font class="keyword">const</font>;
00837     <font class="keywordtype">void</font> clear( <font class="keywordtype">bool</font> createEmptyParag = FALSE );
00838 
00839     <font class="keyword">virtual</font> QTextParag *createParag( QTextDocument *d, QTextParag *pr = 0, QTextParag *nx = 0, <font class="keywordtype">bool</font> updateIds = TRUE );
00840     <font class="keywordtype">void</font> insertChild( QObject *o ) { QObject::insertChild( o ); }
00841     <font class="keywordtype">void</font> removeChild( QObject *o ) { QObject::removeChild( o ); }
00842     <font class="keywordtype">void</font> insertChild( QTextDocument *d ) { childList.append( d ); }
00843     <font class="keywordtype">void</font> removeChild( QTextDocument *d ) { childList.removeRef( d ); }
00844     QPtrList&lt;QTextDocument&gt; children()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> childList; }
00845 
00846     <font class="keywordtype">void</font> setAddMargins( <font class="keywordtype">bool</font> b ) { addMargs = b; }
00847     <font class="keywordtype">int</font> addMargins()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> addMargs; }
00848 
00849 signals:
00850     <font class="keywordtype">void</font> minimumWidthChanged( <font class="keywordtype">int</font> );
00851 
00852 <font class="keyword">private</font>:
00853 <font class="comment">//ANY_CHARSET_BEGIN    </font>
00854     <font class="keywordtype">bool</font> m_assignedFontMap;
00855 <font class="comment">//ANY_CHARSET_END</font>
00856     <font class="keywordtype">void</font> init();
00857     QPixmap *bufferPixmap( <font class="keyword">const</font> QSize &amp;s );
00858     <font class="comment">// HTML parser</font>
00859     <font class="keywordtype">bool</font> hasPrefix(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font> pos, QChar c);
00860     <font class="keywordtype">bool</font> hasPrefix(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font> pos, <font class="keyword">const</font> QString&amp; s);
00861     QTextCustomItem* parseTable( <font class="keyword">const</font> QMap&lt;QString, QString&gt; &amp;attr, <font class="keyword">const</font> QTextFormat &amp;fmt, <font class="keyword">const</font> QString &amp;doc, <font class="keywordtype">int</font>&amp; pos, QTextParag *curpar );
00862     <font class="keywordtype">bool</font> eatSpace(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font>&amp; pos, <font class="keywordtype">bool</font> includeNbsp = FALSE );
00863     <font class="keywordtype">bool</font> eat(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font>&amp; pos, QChar c);
00864     QString parseOpenTag(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font>&amp; pos, QMap&lt;QString, QString&gt; &amp;attr, <font class="keywordtype">bool</font>&amp; emptyTag);
00865     QString parseCloseTag( <font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font>&amp; pos );
00866     QChar parseHTMLSpecialChar(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font>&amp; pos);
00867     QString parseWord(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font>&amp; pos, <font class="keywordtype">bool</font> lower = TRUE);
00868     QChar parseChar(<font class="keyword">const</font> QString&amp; doc, <font class="keywordtype">int</font>&amp; pos, QStyleSheetItem::WhiteSpaceMode wsm );
00869     <font class="keywordtype">void</font> setRichTextInternal( <font class="keyword">const</font> QString &amp;text );
00870 
00871 <font class="keyword">private</font>:
00872     <font class="keyword">struct </font>Q_EXPORT Focus {
00873     QTextParag *parag;
00874     <font class="keywordtype">int</font> start, len;
00875     QString href;
00876     };
00877 
00878     <font class="keywordtype">int</font> cx, cy, cw, vw;
00879     QTextParag *fParag, *lParag;
00880     QTextPreProcessor *pProcessor;
00881     QMap&lt;int, QColor&gt; selectionColors;
00882     QMap&lt;int, QTextDocumentSelection&gt; selections;
00883     QMap&lt;int, bool&gt; selectionText;
00884     QTextCommandHistory *commandHistory;
00885     QTextFormatter *pFormatter;
00886     QTextIndent *indenter;
00887     QTextFormatCollection *fCollection;
00888     Qt::TextFormat txtFormat;
00889     <font class="keywordtype">bool</font> preferRichText;
00890     QTextFlow *flow_;
00891     QPtrList&lt;QTextCustomItem&gt; customItems;
00892     <font class="keywordtype">bool</font> pages;
00893     QTextDocument *par;
00894     QTextParag *parParag;
00895     <font class="keywordtype">bool</font> useFC;
00896     QTextTableCell *tc;
00897     <font class="keywordtype">bool</font> withoutDoubleBuffer;
00898     QTextCursor *tmpCursor;
00899     <font class="keywordtype">bool</font> underlLinks;
00900     QColor linkC;
00901     QBrush *backBrush;
00902     QPixmap *buf_pixmap;
00903     <font class="keywordtype">bool</font> nextDoubleBuffered;
00904     Focus focusIndicator;
00905     <font class="keywordtype">int</font> minw;
00906     QTextParag *minwParag;
00907     QStyleSheet* sheet_;
00908     QMimeSourceFactory* factory_;
00909     QString contxt;
00910     QMap&lt;QString, QString&gt; attribs;
00911     <font class="keywordtype">int</font> align;
00912     <font class="keywordtype">int</font> *tArray;
00913     <font class="keywordtype">int</font> tStopWidth;
00914     <font class="keywordtype">int</font> uDepth;
00915     QString oText;
00916     QPtrList&lt;QTextDocument&gt; childList;
00917     <font class="keywordtype">int</font> nSelections;
00918     <font class="keywordtype">bool</font> addMargs;
00919 
00920 };
00921 
00922 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
00923 
00924 
00925 <font class="keyword">class </font>Q_EXPORT QTextDeleteCommand : <font class="keyword">public</font> QTextCommand
00926 {
00927 <font class="keyword">public</font>:
00928     QTextDeleteCommand( QTextDocument *d, <font class="keywordtype">int</font> i, <font class="keywordtype">int</font> idx, <font class="keyword">const</font> QMemArray&lt;QTextStringChar&gt; &amp;str,
00929             <font class="keyword">const</font> QValueList&lt; QPtrVector&lt;QStyleSheetItem&gt; &gt; &amp;os,
00930             <font class="keyword">const</font> QValueList&lt;QStyleSheetItem::ListStyle&gt; &amp;ols,
00931             <font class="keyword">const</font> QMemArray&lt;int&gt; &amp;oas );
00932     QTextDeleteCommand( QTextParag *p, <font class="keywordtype">int</font> idx, <font class="keyword">const</font> QMemArray&lt;QTextStringChar&gt; &amp;str );
00933     ~QTextDeleteCommand();
00934     Commands type()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> Delete; };
00935     QTextCursor *execute( QTextCursor *c );
00936     QTextCursor *unexecute( QTextCursor *c );
00937 
00938 <font class="keyword">protected</font>:
00939     <font class="keywordtype">int</font> id, index;
00940     QTextParag *parag;
00941     QMemArray&lt;QTextStringChar&gt; text;
00942     QValueList&lt; QPtrVector&lt;QStyleSheetItem&gt; &gt; oldStyles;
00943     QValueList&lt;QStyleSheetItem::ListStyle&gt; oldListStyles;
00944     QMemArray&lt;int&gt; oldAligns;
00945 
00946 };
00947 
00948 <font class="keyword">class </font>Q_EXPORT QTextInsertCommand : <font class="keyword">public</font> QTextDeleteCommand
00949 {
00950 <font class="keyword">public</font>:
00951     QTextInsertCommand( QTextDocument *d, <font class="keywordtype">int</font> i, <font class="keywordtype">int</font> idx, <font class="keyword">const</font> QMemArray&lt;QTextStringChar&gt; &amp;str,
00952             <font class="keyword">const</font> QValueList&lt; QPtrVector&lt;QStyleSheetItem&gt; &gt; &amp;os,
00953             <font class="keyword">const</font> QValueList&lt;QStyleSheetItem::ListStyle&gt; &amp;ols,
00954             <font class="keyword">const</font> QMemArray&lt;int&gt; &amp;oas )
00955     : QTextDeleteCommand( d, i, idx, str, os, ols, oas ) {}
00956     QTextInsertCommand( QTextParag *p, <font class="keywordtype">int</font> idx, <font class="keyword">const</font> QMemArray&lt;QTextStringChar&gt; &amp;str )
00957     : QTextDeleteCommand( p, idx, str ) {}
00958     Commands type()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> Insert; };
00959     QTextCursor *execute( QTextCursor *c ) { <font class="keywordflow">return</font> QTextDeleteCommand::unexecute( c ); }
00960     QTextCursor *unexecute( QTextCursor *c ) { <font class="keywordflow">return</font> QTextDeleteCommand::execute( c ); }
00961 
00962 };
00963 
00964 <font class="keyword">class </font>Q_EXPORT QTextFormatCommand : <font class="keyword">public</font> QTextCommand
00965 {
00966 <font class="keyword">public</font>:
00967     QTextFormatCommand( QTextDocument *d, <font class="keywordtype">int</font> sid, <font class="keywordtype">int</font> sidx, <font class="keywordtype">int</font> eid, <font class="keywordtype">int</font> eidx, <font class="keyword">const</font> QMemArray&lt;QTextStringChar&gt; &amp;old, QTextFormat *f, <font class="keywordtype">int</font> fl );
00968     ~QTextFormatCommand();
00969     Commands type()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> Format; }
00970     QTextCursor *execute( QTextCursor *c );
00971     QTextCursor *unexecute( QTextCursor *c );
00972 
00973 <font class="keyword">protected</font>:
00974     <font class="keywordtype">int</font> startId, startIndex, endId, endIndex;
00975     QTextFormat *format;
00976     QMemArray&lt;QTextStringChar&gt; oldFormats;
00977     <font class="keywordtype">int</font> flags;
00978 
00979 };
00980 
00981 <font class="keyword">class </font>Q_EXPORT QTextAlignmentCommand : <font class="keyword">public</font> QTextCommand
00982 {
00983 <font class="keyword">public</font>:
00984     QTextAlignmentCommand( QTextDocument *d, <font class="keywordtype">int</font> fParag, <font class="keywordtype">int</font> lParag, <font class="keywordtype">int</font> na, <font class="keyword">const</font> QMemArray&lt;int&gt; &amp;oa );
00985     Commands type()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> Alignment; }
00986     QTextCursor *execute( QTextCursor *c );
00987     QTextCursor *unexecute( QTextCursor *c );
00988 
00989 <font class="keyword">private</font>:
00990     <font class="keywordtype">int</font> firstParag, lastParag;
00991     <font class="keywordtype">int</font> newAlign;
00992     QMemArray&lt;int&gt; oldAligns;
00993 
00994 };
00995 
00996 <font class="keyword">class </font>Q_EXPORT QTextParagTypeCommand : <font class="keyword">public</font> QTextCommand
00997 {
00998 <font class="keyword">public</font>:
00999     QTextParagTypeCommand( QTextDocument *d, <font class="keywordtype">int</font> fParag, <font class="keywordtype">int</font> lParag, <font class="keywordtype">bool</font> l,
01000                QStyleSheetItem::ListStyle s, <font class="keyword">const</font> QValueList&lt; QPtrVector&lt;QStyleSheetItem&gt; &gt; &amp;os,
01001                <font class="keyword">const</font> QValueList&lt;QStyleSheetItem::ListStyle&gt; &amp;ols );
01002     Commands type()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> ParagType; }
01003     QTextCursor *execute( QTextCursor *c );
01004     QTextCursor *unexecute( QTextCursor *c );
01005 
01006 <font class="keyword">private</font>:
01007     <font class="keywordtype">int</font> firstParag, lastParag;
01008     <font class="keywordtype">bool</font> list;
01009     QStyleSheetItem::ListStyle listStyle;
01010     QValueList&lt; QPtrVector&lt;QStyleSheetItem&gt; &gt; oldStyles;
01011     QValueList&lt;QStyleSheetItem::ListStyle&gt; oldListStyles;
01012 
01013 };
01014 
01015 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01016 
01017 <font class="keyword">struct </font>Q_EXPORT QTextParagSelection
01018 {
01019     <font class="keywordtype">int</font> start, end;
01020 };
01021 
01022 <font class="keyword">struct </font>Q_EXPORT QTextParagLineStart
01023 {
01024     QTextParagLineStart() : y( 0 ), baseLine( 0 ), h( 0 ), bidicontext( 0 ) {  }
01025     QTextParagLineStart( ushort y_, ushort bl, ushort h_ ) : y( y_ ), baseLine( bl ), h( h_ ),
01026     w( 0 ), bidicontext( 0 )  {  }
01027     QTextParagLineStart( QBidiContext *c, QBidiStatus s ) : y(0), baseLine(0), h(0),
01028     status( s ), bidicontext( c ) { <font class="keywordflow">if</font> ( bidicontext ) bidicontext-&gt;ref();  }
01029     ~QTextParagLineStart() { <font class="keywordflow">if</font> ( bidicontext &amp;&amp; bidicontext-&gt;deref() ) <font class="keyword">delete</font> bidicontext;  }
01030     <font class="keywordtype">void</font> setContext( QBidiContext *c ) {
01031     <font class="keywordflow">if</font> ( c == bidicontext )
01032         <font class="keywordflow">return</font>;
01033     <font class="keywordflow">if</font> ( bidicontext &amp;&amp; bidicontext-&gt;deref() )
01034         <font class="keyword">delete</font> bidicontext;
01035     bidicontext = c;
01036     <font class="keywordflow">if</font> ( bidicontext )
01037         bidicontext-&gt;ref();
01038     }
01039     QBidiContext *context()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> bidicontext; }
01040 
01041 <font class="keyword">public</font>:
01042     ushort y, baseLine, h;
01043     QBidiStatus status;
01044     <font class="keywordtype">int</font> w;
01045 
01046 <font class="keyword">private</font>:
01047     QBidiContext *bidicontext;
01048 
01049 };
01050 
01051 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
01052 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
01053 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMap&lt;int, QTextParagSelection&gt;;
01054 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QMap&lt;int, QTextParagLineStart*&gt;;
01055 <font class="comment">// MOC_SKIP_END</font>
01056 <font class="preprocessor">#endif</font>
01057 <font class="preprocessor"></font>
01058 <font class="keyword">class </font>Q_EXPORT QTextParagData
01059 {
01060 <font class="keyword">public</font>:
01061     QTextParagData() {}
01062     <font class="keyword">virtual</font> ~QTextParagData() {}
01063     <font class="keyword">virtual</font> <font class="keywordtype">void</font> join( QTextParagData * ) {}
01064 };
01065 
01066 <font class="keyword">class </font>Q_EXPORT QTextParag
01067 {
01068     <font class="keyword">friend</font> <font class="keyword">class </font>QTextDocument;
01069     <font class="keyword">friend</font> <font class="keyword">class </font>QTextCursor;
01070 
01071 <font class="keyword">public</font>:
01072     QTextParag( QTextDocument *d, QTextParag *pr = 0, QTextParag *nx = 0, <font class="keywordtype">bool</font> updateIds = TRUE );
01073     <font class="keyword">virtual</font> ~QTextParag();
01074 
01075     QTextString *string() <font class="keyword">const</font>;
01076     QTextStringChar *at( <font class="keywordtype">int</font> i ) <font class="keyword">const</font>; <font class="comment">// maybe remove later</font>
01077     <font class="keywordtype">int</font> length() <font class="keyword">const</font>; <font class="comment">// maybe remove later</font>
01078 
01079     <font class="keywordtype">void</font> setListStyle( QStyleSheetItem::ListStyle ls );
01080     QStyleSheetItem::ListStyle listStyle() <font class="keyword">const</font>;
01081     <font class="keywordtype">void</font> setListValue( <font class="keywordtype">int</font> v ) { list_val = v; }
01082     <font class="keywordtype">int</font> listValue()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> list_val; }
01083 
01084     <font class="keywordtype">void</font> setList( <font class="keywordtype">bool</font> b, <font class="keywordtype">int</font> listStyle );
01085     <font class="keywordtype">void</font> incDepth();
01086     <font class="keywordtype">void</font> decDepth();
01087 
01088     <font class="keywordtype">void</font> setFormat( QTextFormat *fm );
01089     QTextFormat *paragFormat() <font class="keyword">const</font>;
01090 
01091     QTextDocument *document() <font class="keyword">const</font>;
01092 
01093     QRect rect() <font class="keyword">const</font>;
01094     <font class="keywordtype">void</font> setHeight( <font class="keywordtype">int</font> h ) { r.setHeight( h ); }
01095     <font class="keywordtype">void</font> setWidth( <font class="keywordtype">int</font> w ) { r.setWidth( w ); }
01096     <font class="keywordtype">void</font> show();
01097     <font class="keywordtype">void</font> hide();
01098     <font class="keywordtype">bool</font> isVisible()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> visible; }
01099 
01100     <font class="keywordtype">bool</font> isLastInFrame()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> lastInFrame; }
01101     <font class="keywordtype">void</font> setMovedDown( <font class="keywordtype">bool</font> b ) { movedDown = b; }
01102     <font class="keywordtype">bool</font> isMovedDown()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> movedDown; }
01103 
01104     QTextParag *prev() <font class="keyword">const</font>;
01105     QTextParag *next() <font class="keyword">const</font>;
01106     <font class="keywordtype">void</font> setPrev( QTextParag *s );
01107     <font class="keywordtype">void</font> setNext( QTextParag *s );
01108 
01109     <font class="keywordtype">void</font> insert( <font class="keywordtype">int</font> index, <font class="keyword">const</font> QString &amp;s );
01110     <font class="keywordtype">void</font> append( <font class="keyword">const</font> QString &amp;s, <font class="keywordtype">bool</font> reallyAtEnd = FALSE );
01111     <font class="keywordtype">void</font> truncate( <font class="keywordtype">int</font> index );
01112     <font class="keywordtype">void</font> remove( <font class="keywordtype">int</font> index, <font class="keywordtype">int</font> len );
01113     <font class="keywordtype">void</font> join( QTextParag *s );
01114 
01115     <font class="keywordtype">void</font> invalidate( <font class="keywordtype">int</font> chr );
01116 
01117     <font class="keywordtype">void</font> move( <font class="keywordtype">int</font> &amp;dy );
01118     <font class="keywordtype">void</font> format( <font class="keywordtype">int</font> start = -1, <font class="keywordtype">bool</font> doMove = TRUE );
01119 
01120     <font class="keywordtype">bool</font> isValid() <font class="keyword">const</font>;
01121     <font class="keywordtype">bool</font> hasChanged() <font class="keyword">const</font>;
01122     <font class="keywordtype">void</font> setChanged( <font class="keywordtype">bool</font> b, <font class="keywordtype">bool</font> recursive = FALSE );
01123 
01124     <font class="keywordtype">int</font> lineHeightOfChar( <font class="keywordtype">int</font> i, <font class="keywordtype">int</font> *bl = 0, <font class="keywordtype">int</font> *y = 0 ) <font class="keyword">const</font>;
01125     QTextStringChar *lineStartOfChar( <font class="keywordtype">int</font> i, <font class="keywordtype">int</font> *index = 0, <font class="keywordtype">int</font> *line = 0 ) <font class="keyword">const</font>;
01126     <font class="keywordtype">int</font> lines() <font class="keyword">const</font>;
01127     QTextStringChar *lineStartOfLine( <font class="keywordtype">int</font> line, <font class="keywordtype">int</font> *index = 0 ) <font class="keyword">const</font>;
01128     <font class="keywordtype">int</font> lineY( <font class="keywordtype">int</font> l ) <font class="keyword">const</font>;
01129     <font class="keywordtype">int</font> lineBaseLine( <font class="keywordtype">int</font> l ) <font class="keyword">const</font>;
01130     <font class="keywordtype">int</font> lineHeight( <font class="keywordtype">int</font> l ) <font class="keyword">const</font>;
01131     <font class="keywordtype">void</font> lineInfo( <font class="keywordtype">int</font> l, <font class="keywordtype">int</font> &amp;y, <font class="keywordtype">int</font> &amp;h, <font class="keywordtype">int</font> &amp;bl ) <font class="keyword">const</font>;
01132 
01133     <font class="keywordtype">void</font> setSelection( <font class="keywordtype">int</font> id, <font class="keywordtype">int</font> start, <font class="keywordtype">int</font> end );
01134     <font class="keywordtype">void</font> removeSelection( <font class="keywordtype">int</font> id );
01135     <font class="keywordtype">int</font> selectionStart( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
01136     <font class="keywordtype">int</font> selectionEnd( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
01137     <font class="keywordtype">bool</font> hasSelection( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
01138     <font class="keywordtype">bool</font> hasAnySelection() <font class="keyword">const</font>;
01139     <font class="keywordtype">bool</font> fullSelected( <font class="keywordtype">int</font> id ) <font class="keyword">const</font>;
01140 
01141     <font class="keywordtype">void</font> setEndState( <font class="keywordtype">int</font> s );
01142     <font class="keywordtype">int</font> endState() <font class="keyword">const</font>;
01143 
01144     <font class="keywordtype">void</font> setParagId( <font class="keywordtype">int</font> i );
01145     <font class="keywordtype">int</font> paragId() <font class="keyword">const</font>;
01146 
01147     <font class="keywordtype">bool</font> firstPreProcess() <font class="keyword">const</font>;
01148     <font class="keywordtype">void</font> setFirstPreProcess( <font class="keywordtype">bool</font> b );
01149 
01150     <font class="keywordtype">void</font> indent( <font class="keywordtype">int</font> *oldIndent = 0, <font class="keywordtype">int</font> *newIndent = 0 );
01151 
01152     <font class="keywordtype">void</font> setExtraData( QTextParagData *data );
01153     QTextParagData *extraData() <font class="keyword">const</font>;
01154 
01155     QMap&lt;int, QTextParagLineStart*&gt; &amp;lineStartList();
01156 
01157     <font class="keywordtype">void</font> setFormat( <font class="keywordtype">int</font> index, <font class="keywordtype">int</font> len, QTextFormat *f, <font class="keywordtype">bool</font> useCollection = TRUE, <font class="keywordtype">int</font> flags = -1 );
01158 
01159     <font class="keywordtype">void</font> setAlignment( <font class="keywordtype">int</font> a );
01160     <font class="keywordtype">int</font> alignment() <font class="keyword">const</font>;
01161 
01162     <font class="keyword">virtual</font> <font class="keywordtype">void</font> paint( QPainter &amp;painter, <font class="keyword">const</font> QColorGroup &amp;cg, QTextCursor *cursor = 0, <font class="keywordtype">bool</font> drawSelections = FALSE,
01163             <font class="keywordtype">int</font> clipx = -1, <font class="keywordtype">int</font> clipy = -1, <font class="keywordtype">int</font> clipw = -1, <font class="keywordtype">int</font> cliph = -1 );
01164 
01165     <font class="keywordtype">void</font> setStyleSheetItems( <font class="keyword">const</font> QPtrVector&lt;QStyleSheetItem&gt; &amp;vec );
01166     QPtrVector&lt;QStyleSheetItem&gt; styleSheetItems() <font class="keyword">const</font>;
01167     QStyleSheetItem *style() <font class="keyword">const</font>;
01168 
01169     <font class="keyword">virtual</font> <font class="keywordtype">int</font> topMargin() <font class="keyword">const</font>;
01170     <font class="keyword">virtual</font> <font class="keywordtype">int</font> bottomMargin() <font class="keyword">const</font>;
01171     <font class="keyword">virtual</font> <font class="keywordtype">int</font> leftMargin() <font class="keyword">const</font>;
01172     <font class="keyword">virtual</font> <font class="keywordtype">int</font> firstLineMargin() <font class="keyword">const</font>;
01173     <font class="keyword">virtual</font> <font class="keywordtype">int</font> rightMargin() <font class="keyword">const</font>;
01174     <font class="keyword">virtual</font> <font class="keywordtype">int</font> lineSpacing( <font class="keywordtype">int</font> line ) <font class="keyword">const</font>;
01175 
01176     <font class="keywordtype">int</font> numberOfSubParagraph() <font class="keyword">const</font>;
01177     <font class="keywordtype">void</font> registerFloatingItem( QTextCustomItem *i );
01178     <font class="keywordtype">void</font> unregisterFloatingItem( QTextCustomItem *i );
01179 
01180     <font class="keywordtype">void</font> setFullWidth( <font class="keywordtype">bool</font> b ) { fullWidth = b; }
01181     <font class="keywordtype">bool</font> isFullWidth()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> fullWidth; }
01182 
01183     QTextTableCell *tableCell()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> tc; }
01184     <font class="keywordtype">void</font> setTableCell( QTextTableCell *c ) { tc = c; }
01185 
01186     <font class="keywordtype">void</font> addCustomItem();
01187     <font class="keywordtype">void</font> removeCustomItem();
01188     <font class="keywordtype">int</font> customItems() <font class="keyword">const</font>;
01189 
01190     QBrush *background() <font class="keyword">const</font>;
01191 
01192     <font class="keywordtype">void</font> setDocumentRect( <font class="keyword">const</font> QRect &amp;r );
01193     <font class="keywordtype">int</font> documentWidth() <font class="keyword">const</font>;
01194     <font class="keywordtype">int</font> documentVisibleWidth() <font class="keyword">const</font>;
01195     <font class="keywordtype">int</font> documentX() <font class="keyword">const</font>;
01196     <font class="keywordtype">int</font> documentY() <font class="keyword">const</font>;
01197     QTextFormatCollection *formatCollection() <font class="keyword">const</font>;
01198     <font class="keywordtype">void</font> setFormatter( QTextFormatter *f );
01199     QTextFormatter *formatter() <font class="keyword">const</font>;
01200     <font class="keywordtype">int</font> minimumWidth() <font class="keyword">const</font>;
01201 
01202     <font class="keyword">virtual</font> <font class="keywordtype">int</font> nextTab( <font class="keywordtype">int</font> i, <font class="keywordtype">int</font> x );
01203     <font class="keywordtype">void</font> setTabArray( <font class="keywordtype">int</font> *a );
01204     <font class="keywordtype">void</font> setTabStops( <font class="keywordtype">int</font> tw );
01205     <font class="keywordtype">int</font> *tabArray()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> tArray; }
01206 
01207     <font class="keywordtype">void</font> setPainter( QPainter *p );
01208     QPainter *painter()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> pntr; }
01209 
01210     <font class="keywordtype">void</font> setNewLinesAllowed( <font class="keywordtype">bool</font> b );
01211     <font class="keywordtype">bool</font> isNewLinesAllowed() <font class="keyword">const</font>;
01212 
01213     QString richText() <font class="keyword">const</font>;
01214 
01215     <font class="keywordtype">void</font> addCommand( QTextCommand *cmd );
01216     QTextCursor *undo( QTextCursor *c = 0 );
01217     QTextCursor *redo( QTextCursor *c  = 0 );
01218     QTextCommandHistory *commands()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> commandHistory; }
01219     <font class="keyword">virtual</font> <font class="keywordtype">void</font> copyParagData( QTextParag *parag );
01220 
01221 <font class="keyword">protected</font>:
01222     <font class="keyword">virtual</font> <font class="keywordtype">void</font> drawLabel( QPainter* p, <font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> w, <font class="keywordtype">int</font> h, <font class="keywordtype">int</font> base, <font class="keyword">const</font> QColorGroup&amp; cg );
01223     <font class="keyword">virtual</font> <font class="keywordtype">void</font> drawParagString( QPainter &amp;painter, <font class="keyword">const</font> QString &amp;str, <font class="keywordtype">int</font> start, <font class="keywordtype">int</font> len, <font class="keywordtype">int</font> startX,
01224                   <font class="keywordtype">int</font> lastY, <font class="keywordtype">int</font> baseLine, <font class="keywordtype">int</font> bw, <font class="keywordtype">int</font> h, <font class="keywordtype">bool</font> drawSelections,
01225                   QTextFormat *lastFormat, <font class="keywordtype">int</font> i, <font class="keyword">const</font> QMemArray&lt;int&gt; &amp;selectionStarts,
01226                   <font class="keyword">const</font> QMemArray&lt;int&gt; &amp;selectionEnds, <font class="keyword">const</font> QColorGroup &amp;cg, <font class="keywordtype">bool</font> rightToLeft  );
01227 
01228 <font class="keyword">private</font>:
01229 
01230     QMap&lt;int, QTextParagLineStart*&gt; lineStarts;
01231     <font class="keywordtype">int</font> invalid;
01232     QRect r;
01233     QTextParag *p, *n;
01234     QTextDocument *doc;
01235     <font class="keywordtype">bool</font> changed : 1;
01236     <font class="keywordtype">bool</font> firstFormat : 1;
01237     <font class="keywordtype">bool</font> firstPProcess : 1;
01238     <font class="keywordtype">bool</font> needPreProcess : 1;
01239     <font class="keywordtype">bool</font> fullWidth : 1;
01240     <font class="keywordtype">bool</font> newLinesAllowed : 1;
01241     <font class="keywordtype">bool</font> movedDown : 1;
01242     <font class="keywordtype">bool</font> lastInFrame : 1;
01243     <font class="keywordtype">bool</font> visible : 1;
01244     QMap&lt;int, QTextParagSelection&gt; selections;
01245     <font class="keywordtype">int</font> state, id;
01246     QTextString *str;
01247     <font class="keywordtype">int</font> align;
01248     QPtrVector&lt;QStyleSheetItem&gt; styleSheetItemsVec;
01249     QStyleSheetItem::ListStyle listS;
01250     <font class="keywordtype">int</font> numSubParag;
01251     <font class="keywordtype">int</font> tm, bm, lm, rm, flm;
01252     QTextFormat *defFormat;
01253     QPtrList&lt;QTextCustomItem&gt; floatingItems;
01254     QTextTableCell *tc;
01255     <font class="keywordtype">int</font> numCustomItems;
01256     QRect docRect;
01257     QTextFormatter *pFormatter;
01258     <font class="keywordtype">int</font> *tArray;
01259     <font class="keywordtype">int</font> tabStopWidth;
01260     QTextParagData *eData;
01261     QPainter *pntr;
01262     QTextCommandHistory *commandHistory;
01263     <font class="keywordtype">int</font> list_val;
01264 
01265 };
01266 
01267 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01268 
01269 <font class="keyword">class </font>Q_EXPORT QTextFormatter
01270 {
01271 <font class="keyword">public</font>:
01272     QTextFormatter();
01273     <font class="keyword">virtual</font> ~QTextFormatter() {}
01274     <font class="keyword">virtual</font> <font class="keywordtype">int</font> format( QTextDocument *doc, QTextParag *parag, <font class="keywordtype">int</font> start, <font class="keyword">const</font> QMap&lt;int, QTextParagLineStart*&gt; &amp;oldLineStarts ) = 0;
01275 
01276     <font class="keywordtype">bool</font> isWrapEnabled()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> wrapEnabled;}
01277     <font class="keywordtype">int</font> wrapAtColumn()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> wrapColumn;}
01278     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setWrapEnabled( <font class="keywordtype">bool</font> b ) { wrapEnabled = b; }
01279     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setWrapAtColumn( <font class="keywordtype">int</font> c ) { wrapColumn = c; }
01280     <font class="keyword">virtual</font> <font class="keywordtype">void</font> setAllowBreakInWords( <font class="keywordtype">bool</font> b ) { biw = b; }
01281     <font class="keywordtype">bool</font> allowBreakInWords()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> biw; }
01282 
01283 <font class="keyword">protected</font>:
01284     <font class="keyword">virtual</font> QTextParagLineStart *formatLine( QTextParag *parag, QTextString *string, QTextParagLineStart *line, QTextStringChar *start,
01285                            QTextStringChar *last, <font class="keywordtype">int</font> align = Qt3::AlignAuto, <font class="keywordtype">int</font> space = 0 );
01286     <font class="comment">//QTextStringChar</font>
01287     <font class="comment">//virtual QTextParagLineStart *bidiReorderLine( QTextParag *parag, QTextString *string, QTextParagLineStart *line, QTextStringChar *start,</font>
01288     <font class="comment">//                      QTextStringChar *last, int align, int space );</font>
01289     <font class="keyword">virtual</font> <font class="keywordtype">bool</font> isBreakable( QTextString *string, <font class="keywordtype">int</font> pos ) <font class="keyword">const</font>;
01290     <font class="keywordtype">void</font> insertLineStart( QTextParag *parag, <font class="keywordtype">int</font> index, QTextParagLineStart *ls );
01291 
01292 <font class="keyword">private</font>:
01293     <font class="keywordtype">bool</font> wrapEnabled;
01294     <font class="keywordtype">int</font> wrapColumn;
01295     <font class="keywordtype">bool</font> biw;
01296 
01297 <font class="preprocessor">#ifdef HAVE_THAI_BREAKS</font>
01298 <font class="preprocessor"></font>    <font class="keyword">static</font> QCString *thaiCache;
01299     <font class="keyword">static</font> QTextString *cachedString;
01300     <font class="keyword">static</font> ThBreakIterator *thaiIt;
01301 <font class="preprocessor">#endif</font>
01302 <font class="preprocessor"></font>};
01303 
01304 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01305 
01306 <font class="keyword">class </font>Q_EXPORT QTextFormatterBreakInWords : <font class="keyword">public</font> QTextFormatter
01307 {
01308 <font class="keyword">public</font>:
01309     QTextFormatterBreakInWords();
01310     <font class="keywordtype">int</font> format( QTextDocument *doc, QTextParag *parag, <font class="keywordtype">int</font> start, <font class="keyword">const</font> QMap&lt;int, QTextParagLineStart*&gt; &amp;oldLineStarts );
01311 
01312 };
01313 
01314 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01315 
01316 <font class="keyword">class </font>Q_EXPORT QTextFormatterBreakWords : <font class="keyword">public</font> QTextFormatter
01317 {
01318 <font class="keyword">public</font>:
01319     QTextFormatterBreakWords();
01320     <font class="keywordtype">int</font> format( QTextDocument *doc, QTextParag *parag, <font class="keywordtype">int</font> start, <font class="keyword">const</font> QMap&lt;int, QTextParagLineStart*&gt; &amp;oldLineStarts );
01321 
01322 };
01323 
01324 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01325 
01326 <font class="keyword">class </font>Q_EXPORT QTextIndent
01327 {
01328 <font class="keyword">public</font>:
01329     QTextIndent();
01330     <font class="keyword">virtual</font> <font class="keywordtype">void</font> indent( QTextDocument *doc, QTextParag *parag, <font class="keywordtype">int</font> *oldIndent = 0, <font class="keywordtype">int</font> *newIndent = 0 ) = 0;
01331 
01332 };
01333 
01334 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01335 
01336 <font class="keyword">class </font>Q_EXPORT QTextPreProcessor
01337 {
01338 <font class="keyword">public</font>:
01339     <font class="keyword">enum</font> Ids {
01340     Standard = 0
01341     };
01342 
01343     QTextPreProcessor();
01344     <font class="keyword">virtual</font> <font class="keywordtype">void</font> process( QTextDocument *doc, QTextParag *, <font class="keywordtype">int</font>, <font class="keywordtype">bool</font> = TRUE ) = 0;
01345     <font class="keyword">virtual</font> QTextFormat *format( <font class="keywordtype">int</font> id ) = 0;
01346 
01347 };
01348 
01349 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01350 
01351 <font class="keyword">class </font>Q_EXPORT QTextFormat
01352 {
01353     <font class="keyword">friend</font> <font class="keyword">class </font>QTextFormatCollection;
01354 
01355 <font class="keyword">public</font>:
01356     <font class="keyword">enum</font> Flags {
01357     NoFlags,
01358     Bold = 1,
01359     Italic = 2,
01360     Underline = 4,
01361     Family = 8,
01362     Size = 16,
01363     Color = 32,
01364     Misspelled = 64,
01365     VAlign = 128,
01366     Font = Bold | Italic | Underline | Family | Size,
01367     Format = Font | Color | Misspelled | VAlign
01368     };
01369 
01370     <font class="keyword">enum</font> VerticalAlignment { AlignNormal, AlignSubScript, AlignSuperScript };
01371 
01372     QTextFormat();
01373     <font class="keyword">virtual</font> ~QTextFormat() {}
01374     QTextFormat( <font class="keyword">const</font> QStyleSheetItem *s );
01375     QTextFormat( <font class="keyword">const</font> QFont &amp;f, <font class="keyword">const</font> QColor &amp;c, QTextFormatCollection *parent = 0 );
01376     QTextFormat( <font class="keyword">const</font> QTextFormat &amp;fm );
01377     QTextFormat makeTextFormat( <font class="keyword">const</font> QStyleSheetItem *style, <font class="keyword">const</font> QMap&lt;QString,QString&gt;&amp; attr ) <font class="keyword">const</font>;
01378     QTextFormat&amp; operator=( <font class="keyword">const</font> QTextFormat &amp;fm );
01379     <font class="keyword">virtual</font> <font class="keywordtype">void</font> copyFormat( <font class="keyword">const</font> QTextFormat &amp;fm, <font class="keywordtype">int</font> flags );
01380     QColor color() <font class="keyword">const</font>;
01381     QFont font() <font class="keyword">const</font>;
01382     <font class="keywordtype">bool</font> isMisspelled() <font class="keyword">const</font>;
01383     VerticalAlignment vAlign() <font class="keyword">const</font>;
01384     <font class="keywordtype">int</font> minLeftBearing() <font class="keyword">const</font>;
01385     <font class="keywordtype">int</font> minRightBearing() <font class="keyword">const</font>;
01386     <font class="keywordtype">int</font> width( <font class="keyword">const</font> QChar &amp;c ) <font class="keyword">const</font>;
01387     <font class="keywordtype">int</font> width( <font class="keyword">const</font> QString &amp;str, <font class="keywordtype">int</font> pos ) <font class="keyword">const</font>;
01388     <font class="keywordtype">int</font> height() <font class="keyword">const</font>;
01389     <font class="keywordtype">int</font> ascent() <font class="keyword">const</font>;
01390     <font class="keywordtype">int</font> descent() <font class="keyword">const</font>;
01391     QString anchorHref() <font class="keyword">const</font>;
01392     QString anchorName() <font class="keyword">const</font>;
01393     <font class="keywordtype">bool</font> isAnchor() <font class="keyword">const</font>;
01394     <font class="keywordtype">bool</font> useLinkColor() <font class="keyword">const</font>;
01395 
01396     <font class="keywordtype">void</font> setBold( <font class="keywordtype">bool</font> b );
01397     <font class="keywordtype">void</font> setItalic( <font class="keywordtype">bool</font> b );
01398     <font class="keywordtype">void</font> setUnderline( <font class="keywordtype">bool</font> b );
01399     <font class="keywordtype">void</font> setFamily( <font class="keyword">const</font> QString &amp;f );
01400     <font class="keywordtype">void</font> setPointSize( <font class="keywordtype">int</font> s );
01401     <font class="keywordtype">void</font> setFont( <font class="keyword">const</font> QFont &amp;f );
01402     <font class="keywordtype">void</font> setColor( <font class="keyword">const</font> QColor &amp;c );
01403     <font class="keywordtype">void</font> setMisspelled( <font class="keywordtype">bool</font> b );
01404     <font class="keywordtype">void</font> setVAlign( VerticalAlignment a );
01405 
01406     <font class="keywordtype">bool</font> operator==( <font class="keyword">const</font> QTextFormat &amp;f ) <font class="keyword">const</font>;
01407     QTextFormatCollection *parent() <font class="keyword">const</font>;
01408     <font class="keywordtype">void</font> setCollection( QTextFormatCollection *parent ) { collection = parent; }
01409     QString key() <font class="keyword">const</font>;
01410 
01411     <font class="keyword">static</font> QString getKey( <font class="keyword">const</font> QFont &amp;f, <font class="keyword">const</font> QColor &amp;c, <font class="keywordtype">bool</font> misspelled, <font class="keyword">const</font> QString &amp;lhref, <font class="keyword">const</font> QString &amp;lnm, VerticalAlignment vAlign );
01412 
01413     <font class="keywordtype">void</font> addRef();
01414     <font class="keywordtype">void</font> removeRef();
01415 
01416     QString makeFormatChangeTags( QTextFormat *f ) <font class="keyword">const</font>;
01417     QString makeFormatEndTags() <font class="keyword">const</font>;
01418 
01419     <font class="keywordtype">void</font> setPainter( QPainter *p );
01420     <font class="keywordtype">void</font> updateStyle();
01421     <font class="keywordtype">void</font> updateStyleFlags();
01422     <font class="keywordtype">void</font> setStyle( <font class="keyword">const</font> QString &amp;s );
01423     QString styleName()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> style; }
01424 
01425     <font class="keywordtype">int</font> changed()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> different; }
01426 
01427 <font class="keyword">protected</font>:
01428     <font class="keyword">virtual</font> <font class="keywordtype">void</font> generateKey();
01429     QFont fn;
01430     <font class="keywordtype">void</font> update();
01431     <font class="keywordtype">void</font> setKey( <font class="keyword">const</font> QString &amp;key ) { k = key; }
01432 
01433 <font class="keyword">private</font>:
01434     QString k;
01435     QColor col;
01436     QFontMetrics fm;
01437     uint missp : 1;
01438     uint linkColor : 1;
01439     <font class="keywordtype">int</font> leftBearing, rightBearing;
01440     VerticalAlignment ha;
01441     uchar widths[ 256 ];
01442     <font class="keywordtype">int</font> hei, asc, dsc;
01443     QTextFormatCollection *collection;
01444     <font class="keywordtype">int</font> ref;
01445     <font class="keywordtype">int</font> logicalFontSize;
01446     <font class="keywordtype">int</font> stdPointSize;
01447     QString anchor_href;
01448     QString anchor_name;
01449     QPainter *painter;
01450     QString style;
01451     <font class="keywordtype">int</font> different;
01452 
01453 };
01454 
01455 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01456 
01457 <font class="preprocessor">#if defined(Q_TEMPLATEDLL)</font>
01458 <font class="preprocessor"></font><font class="comment">// MOC_SKIP_BEGIN</font>
01459 <font class="keyword">template</font> <font class="keyword">class </font>Q_EXPORT QDict&lt;QTextFormat&gt;;
01460 <font class="comment">// MOC_SKIP_END</font>
01461 <font class="preprocessor">#endif</font>
01462 <font class="preprocessor"></font>
01463 <font class="keyword">class </font>Q_EXPORT QTextFormatCollection
01464 {
01465     <font class="keyword">friend</font> <font class="keyword">class </font>QTextDocument;
01466 
01467 <font class="keyword">public</font>:
01468     QTextFormatCollection();
01469     <font class="keyword">virtual</font> ~QTextFormatCollection();
01470 
01471     <font class="keywordtype">void</font> setDefaultFormat( QTextFormat *f );
01472     QTextFormat *defaultFormat() <font class="keyword">const</font>;
01473     QTextFormat *format( <font class="keyword">const</font> QTextFormat *f );
01474     <font class="keyword">virtual</font> QTextFormat *format( QTextFormat *of, QTextFormat *nf, <font class="keywordtype">int</font> flags );
01475     <font class="keyword">virtual</font> QTextFormat *format( <font class="keyword">const</font> QFont &amp;f, <font class="keyword">const</font> QColor &amp;c );
01476     <font class="keyword">virtual</font> <font class="keywordtype">void</font> remove( QTextFormat *f );
01477     <font class="keyword">virtual</font> QTextFormat *createFormat( <font class="keyword">const</font> QTextFormat &amp;f ) { <font class="keywordflow">return</font> <font class="keyword">new</font> QTextFormat( f ); }
01478     <font class="keyword">virtual</font> QTextFormat *createFormat( <font class="keyword">const</font> QFont &amp;f, <font class="keyword">const</font> QColor &amp;c ) { <font class="keywordflow">return</font> <font class="keyword">new</font> QTextFormat( f, c, <font class="keyword">this</font> ); }
01479     <font class="keywordtype">void</font> debug();
01480 
01481     <font class="keywordtype">void</font> setPainter( QPainter *p );
01482     QStyleSheet *styleSheet()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> sheet; }
01483     <font class="keywordtype">void</font> setStyleSheet( QStyleSheet *s ) { sheet = s; }
01484     <font class="keywordtype">void</font> updateStyles();
01485     <font class="keywordtype">void</font> updateFontSizes( <font class="keywordtype">int</font> base );
01486     <font class="keywordtype">void</font> updateFontAttributes( <font class="keyword">const</font> QFont &amp;f, <font class="keyword">const</font> QFont &amp;old );
01487 
01488     QDict&lt;QTextFormat&gt; &amp; dict() { <font class="keywordflow">return</font> cKey; }
01489 
01490 <font class="keyword">private</font>:
01491     QTextFormat *defFormat, *lastFormat, *cachedFormat;
01492     QDict&lt;QTextFormat&gt; cKey;
01493     QTextFormat *cres;
01494     QFont cfont;
01495     QColor ccol;
01496     QString kof, knf;
01497     <font class="keywordtype">int</font> cflags;
01498     QStyleSheet *sheet;
01499 
01500 };
01501 
01502 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01503 
01504 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextString::length()<font class="keyword"> const</font>
01505 <font class="keyword"></font>{
01506     <font class="keywordflow">return</font> data.size();
01507 }
01508 
01509 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextString::operator+=( <font class="keyword">const</font> QString &amp;s )
01510 {
01511     insert( length(), s, 0 );
01512 }
01513 
01514 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::length()<font class="keyword"> const</font>
01515 <font class="keyword"></font>{
01516     <font class="keywordflow">return</font> str-&gt;length();
01517 }
01518 
01519 <font class="keyword">inline</font> QRect QTextParag::rect()<font class="keyword"> const</font>
01520 <font class="keyword"></font>{
01521     <font class="keywordflow">return</font> r;
01522 }
01523 
01524 <font class="keyword">inline</font> QTextParag *QTextCursor::parag()<font class="keyword"> const</font>
01525 <font class="keyword"></font>{
01526     <font class="keywordflow">return</font> string;
01527 }
01528 
01529 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextCursor::index()<font class="keyword"> const</font>
01530 <font class="keyword"></font>{
01531     <font class="keywordflow">return</font> idx;
01532 }
01533 
01534 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextCursor::setIndex( <font class="keywordtype">int</font> i, <font class="keywordtype">bool</font> restore )
01535 {
01536     <font class="keywordflow">if</font> ( restore )
01537     restoreState();
01538     tmpIndex = -1;
01539     idx = i;
01540 }
01541 
01542 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextCursor::setParag( QTextParag *s, <font class="keywordtype">bool</font> restore )
01543 {
01544     <font class="keywordflow">if</font> ( restore )
01545     restoreState();
01546     idx = 0;
01547     string = s;
01548     tmpIndex = -1;
01549 }
01550 
01551 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextCursor::checkIndex()
01552 {
01553     <font class="keywordflow">if</font> ( idx &gt;= string-&gt;length() )
01554     idx = string-&gt;length() - 1;
01555 }
01556 
01557 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextCursor::x()<font class="keyword"> const</font>
01558 <font class="keyword"></font>{
01559     QTextStringChar *c = string-&gt;at( idx );
01560     <font class="keywordtype">int</font> curx = c-&gt;x;
01561     <font class="keywordflow">if</font> ( c-&gt;rightToLeft )
01562     curx += string-&gt;string()-&gt;width( idx );
01563     <font class="keywordflow">return</font> curx;
01564 }
01565 
01566 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextCursor::y()<font class="keyword"> const</font>
01567 <font class="keyword"></font>{
01568     <font class="keywordtype">int</font> dummy, line;
01569     string-&gt;lineStartOfChar( idx, &amp;dummy, &amp;line );
01570     <font class="keywordflow">return</font> string-&gt;lineY( line );
01571 }
01572 
01573 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01574 
01575 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::x()<font class="keyword"> const</font>
01576 <font class="keyword"></font>{
01577     <font class="keywordflow">return</font> cx;
01578 }
01579 
01580 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::y()<font class="keyword"> const</font>
01581 <font class="keyword"></font>{
01582     <font class="keywordflow">return</font> cy;
01583 }
01584 
01585 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::width()<font class="keyword"> const</font>
01586 <font class="keyword"></font>{
01587     <font class="keywordflow">return</font> QMAX( cw, flow_-&gt;width );
01588 }
01589 
01590 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::visibleWidth()<font class="keyword"> const</font>
01591 <font class="keyword"></font>{
01592     <font class="keywordflow">return</font> vw;
01593 }
01594 
01595 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::height()<font class="keyword"> const</font>
01596 <font class="keyword"></font>{
01597     <font class="keywordflow">if</font> ( lParag )
01598     <font class="keywordflow">return</font> QMAX( flow_-&gt;height, lParag-&gt;rect().top() + lParag-&gt;rect().height() + 1 );
01599     <font class="keywordflow">return</font> 0;
01600 }
01601 
01602 <font class="keyword">inline</font> QTextParag *QTextDocument::firstParag()<font class="keyword"> const</font>
01603 <font class="keyword"></font>{
01604     <font class="keywordflow">return</font> fParag;
01605 }
01606 
01607 <font class="keyword">inline</font> QTextParag *QTextDocument::lastParag()<font class="keyword"> const</font>
01608 <font class="keyword"></font>{
01609     <font class="keywordflow">return</font> lParag;
01610 }
01611 
01612 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setFirstParag( QTextParag *p )
01613 {
01614     fParag = p;
01615 }
01616 
01617 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setLastParag( QTextParag *p )
01618 {
01619     lParag = p;
01620 }
01621 
01622 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setWidth( <font class="keywordtype">int</font> w )
01623 {
01624     cw = QMAX( w, minw );
01625     flow_-&gt;setWidth( cw );
01626     vw = w;
01627 }
01628 
01629 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::minimumWidth()<font class="keyword"> const</font>
01630 <font class="keyword"></font>{
01631     <font class="keywordflow">return</font> minw;
01632 }
01633 
01634 <font class="keyword">inline</font> QTextPreProcessor *QTextDocument::preProcessor()<font class="keyword"> const</font>
01635 <font class="keyword"></font>{
01636     <font class="keywordflow">return</font> pProcessor;
01637 }
01638 
01639 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setPreProcessor( QTextPreProcessor * sh )
01640 {
01641     pProcessor = sh;
01642 }
01643 
01644 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setFormatter( QTextFormatter *f )
01645 {
01646     <font class="keyword">delete</font> pFormatter;
01647     pFormatter = f;
01648 }
01649 
01650 <font class="keyword">inline</font> QTextFormatter *QTextDocument::formatter()<font class="keyword"> const</font>
01651 <font class="keyword"></font>{
01652     <font class="keywordflow">return</font> pFormatter;
01653 }
01654 
01655 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setIndent( QTextIndent *i )
01656 {
01657     indenter = i;
01658 }
01659 
01660 <font class="keyword">inline</font> QTextIndent *QTextDocument::indent()<font class="keyword"> const</font>
01661 <font class="keyword"></font>{
01662     <font class="keywordflow">return</font> indenter;
01663 }
01664 
01665 <font class="keyword">inline</font> QColor QTextDocument::selectionColor( <font class="keywordtype">int</font> id )<font class="keyword"> const</font>
01666 <font class="keyword"></font>{
01667     <font class="keywordflow">return</font> selectionColors[ id ];
01668 }
01669 
01670 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextDocument::invertSelectionText( <font class="keywordtype">int</font> id )<font class="keyword"> const</font>
01671 <font class="keyword"></font>{
01672     <font class="keywordflow">return</font> selectionText[ id ];
01673 }
01674 
01675 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setSelectionColor( <font class="keywordtype">int</font> id, <font class="keyword">const</font> QColor &amp;c )
01676 {
01677     selectionColors[ id ] = c;
01678 }
01679 
01680 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setInvertSelectionText( <font class="keywordtype">int</font> id, <font class="keywordtype">bool</font> b )
01681 {
01682     selectionText[ id ] = b;
01683 }
01684 
01685 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextDocument::hasSelection( <font class="keywordtype">int</font> id )<font class="keyword"> const</font>
01686 <font class="keyword"></font>{
01687     <font class="keywordflow">return</font> selections.find( id ) != selections.end();
01688 }
01689 
01690 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setSelectionStart( <font class="keywordtype">int</font> id, QTextCursor *cursor )
01691 {
01692     QTextDocumentSelection sel;
01693     sel.startCursor = *cursor;
01694     sel.endCursor = *cursor;
01695     sel.swapped = FALSE;
01696     selections[ id ] = sel;
01697 }
01698 
01699 <font class="keyword">inline</font> QTextParag *QTextDocument::paragAt( <font class="keywordtype">int</font> i )<font class="keyword"> const</font>
01700 <font class="keyword"></font>{
01701     QTextParag *s = fParag;
01702     <font class="keywordflow">while</font> ( s ) {
01703     <font class="keywordflow">if</font> ( s-&gt;paragId() == i )
01704         <font class="keywordflow">return</font> s;
01705     s = s-&gt;next();
01706     }
01707     <font class="keywordflow">return</font> 0;
01708 }
01709 
01710 <font class="keyword">inline</font> QTextFormatCollection *QTextDocument::formatCollection()<font class="keyword"> const</font>
01711 <font class="keyword"></font>{
01712     <font class="keywordflow">return</font> fCollection;
01713 }
01714 
01715 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::alignment()<font class="keyword"> const</font>
01716 <font class="keyword"></font>{
01717     <font class="keywordflow">return</font> align;
01718 }
01719 
01720 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setAlignment( <font class="keywordtype">int</font> a )
01721 {
01722     align = a;
01723 }
01724 
01725 <font class="keyword">inline</font> <font class="keywordtype">int</font> *QTextDocument::tabArray()<font class="keyword"> const</font>
01726 <font class="keyword"></font>{
01727     <font class="keywordflow">return</font> tArray;
01728 }
01729 
01730 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextDocument::tabStopWidth()<font class="keyword"> const</font>
01731 <font class="keyword"></font>{
01732     <font class="keywordflow">return</font> tStopWidth;
01733 }
01734 
01735 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setTabArray( <font class="keywordtype">int</font> *a )
01736 {
01737     tArray = a;
01738 }
01739 
01740 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setTabStops( <font class="keywordtype">int</font> tw )
01741 {
01742     tStopWidth = tw;
01743 }
01744 
01745 <font class="keyword">inline</font> QString QTextDocument::originalText()<font class="keyword"> const</font>
01746 <font class="keyword"></font>{
01747     <font class="keywordflow">return</font> oText;
01748 }
01749 
01750 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextDocument::setFlow( QTextFlow *f )
01751 {
01752     <font class="keywordflow">if</font> ( flow_ )
01753     <font class="keyword">delete</font> flow_;
01754     flow_ = f;
01755 }
01756 
01757 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01758 
01759 <font class="keyword">inline</font> QColor QTextFormat::color()<font class="keyword"> const</font>
01760 <font class="keyword"></font>{
01761     <font class="keywordflow">return</font> col;
01762 }
01763 
01764 <font class="keyword">inline</font> QFont QTextFormat::font()<font class="keyword"> const</font>
01765 <font class="keyword"></font>{
01766     <font class="keywordflow">return</font> fn;
01767 }
01768 
01769 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextFormat::isMisspelled()<font class="keyword"> const</font>
01770 <font class="keyword"></font>{
01771     <font class="keywordflow">return</font> missp;
01772 }
01773 
01774 <font class="keyword">inline</font> QTextFormat::VerticalAlignment QTextFormat::vAlign()<font class="keyword"> const</font>
01775 <font class="keyword"></font>{
01776     <font class="keywordflow">return</font> ha;
01777 }
01778 
01779 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextFormat::minLeftBearing()<font class="keyword"> const</font>
01780 <font class="keyword"></font>{
01781     <font class="keywordflow">if</font> ( !painter || !painter-&gt;isActive() )
01782     <font class="keywordflow">return</font> leftBearing;
01783     painter-&gt;setFont( fn );
01784     <font class="keywordflow">return</font> painter-&gt;fontMetrics().minLeftBearing();
01785 }
01786 
01787 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextFormat::minRightBearing()<font class="keyword"> const</font>
01788 <font class="keyword"></font>{
01789     <font class="keywordflow">if</font> ( !painter || !painter-&gt;isActive() )
01790     <font class="keywordflow">return</font> rightBearing;
01791     painter-&gt;setFont( fn );
01792     <font class="keywordflow">return</font> painter-&gt;fontMetrics().minRightBearing();
01793 }
01794 
01795 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextFormat::height()<font class="keyword"> const</font>
01796 <font class="keyword"></font>{
01797     <font class="keywordflow">if</font> ( !painter || !painter-&gt;isActive() )
01798     <font class="keywordflow">return</font> hei;
01799     painter-&gt;setFont( fn );
01800     <font class="keywordflow">return</font> painter-&gt;fontMetrics().height();
01801 }
01802 
01803 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextFormat::ascent()<font class="keyword"> const</font>
01804 <font class="keyword"></font>{
01805     <font class="keywordflow">if</font> ( !painter || !painter-&gt;isActive() )
01806     <font class="keywordflow">return</font> asc;
01807     painter-&gt;setFont( fn );
01808     <font class="keywordflow">return</font> painter-&gt;fontMetrics().ascent();
01809 }
01810 
01811 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextFormat::descent()<font class="keyword"> const</font>
01812 <font class="keyword"></font>{
01813     <font class="keywordflow">if</font> ( !painter || !painter-&gt;isActive() )
01814     <font class="keywordflow">return</font> dsc;
01815     painter-&gt;setFont( fn );
01816     <font class="keywordflow">return</font> painter-&gt;fontMetrics().descent();
01817 }
01818 
01819 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextFormat::operator==( <font class="keyword">const</font> QTextFormat &amp;f )<font class="keyword"> const</font>
01820 <font class="keyword"></font>{
01821     <font class="keywordflow">return</font> k == f.k;
01822 }
01823 
01824 <font class="keyword">inline</font> QTextFormatCollection *QTextFormat::parent()<font class="keyword"> const</font>
01825 <font class="keyword"></font>{
01826     <font class="keywordflow">return</font> collection;
01827 }
01828 
01829 <font class="keyword">inline</font> QString QTextFormat::key()<font class="keyword"> const</font>
01830 <font class="keyword"></font>{
01831     <font class="keywordflow">return</font> k;
01832 }
01833 
01834 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextFormat::generateKey()
01835 {
01836     k = QString::null;
01837     QTextOStream ts( &amp;k );
01838     ts &lt;&lt; fn.pointSize()
01839        &lt;&lt; fn.weight()
01840        &lt;&lt; (int)fn.underline()
01841        &lt;&lt; (int)fn.strikeOut()
01842        &lt;&lt; (int)fn.italic()
01843        &lt;&lt; col.pixel()
01844        &lt;&lt; fn.family()
01845        &lt;&lt; (int)isMisspelled()
01846        &lt;&lt; anchor_href
01847        &lt;&lt; anchor_name
01848        &lt;&lt; (int)vAlign();
01849 }
01850 
01851 <font class="keyword">inline</font> QString QTextFormat::getKey( <font class="keyword">const</font> QFont &amp;fn, <font class="keyword">const</font> QColor &amp;col, <font class="keywordtype">bool</font> misspelled,
01852                     <font class="keyword">const</font> QString &amp;lhref, <font class="keyword">const</font> QString &amp;lnm, VerticalAlignment a )
01853 {
01854     QString k;
01855     QTextOStream ts( &amp;k );
01856     ts &lt;&lt; fn.pointSize()
01857        &lt;&lt; fn.weight()
01858        &lt;&lt; (int)fn.underline()
01859        &lt;&lt; (int)fn.strikeOut()
01860        &lt;&lt; (int)fn.italic()
01861        &lt;&lt; col.pixel()
01862        &lt;&lt; fn.family()
01863        &lt;&lt; (int)misspelled
01864        &lt;&lt; lhref
01865        &lt;&lt; lnm
01866        &lt;&lt; (int)a;
01867     <font class="keywordflow">return</font> k;
01868 }
01869 
01870 <font class="keyword">inline</font> QString QTextFormat::anchorHref()<font class="keyword"> const</font>
01871 <font class="keyword"></font>{
01872     <font class="keywordflow">return</font> anchor_href;
01873 }
01874 
01875 <font class="keyword">inline</font> QString QTextFormat::anchorName()<font class="keyword"> const</font>
01876 <font class="keyword"></font>{
01877     <font class="keywordflow">return</font> anchor_name;
01878 }
01879 
01880 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextFormat::isAnchor()<font class="keyword"> const</font>
01881 <font class="keyword"></font>{
01882     <font class="keywordflow">return</font> !anchor_href.isEmpty()  || !anchor_name.isEmpty();
01883 }
01884 
01885 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextFormat::useLinkColor()<font class="keyword"> const</font>
01886 <font class="keyword"></font>{
01887     <font class="keywordflow">return</font> linkColor;
01888 }
01889 
01890 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextFormat::setStyle( <font class="keyword">const</font> QString &amp;s )
01891 {
01892     style = s;
01893     updateStyleFlags();
01894 }
01895 
01896 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextFormat::updateStyle()
01897 {
01898     <font class="keywordflow">if</font> ( !collection || !collection-&gt;styleSheet() )
01899     <font class="keywordflow">return</font>;
01900     QStyleSheetItem *item = collection-&gt;styleSheet()-&gt;item( style );
01901     <font class="keywordflow">if</font> ( !item )
01902     <font class="keywordflow">return</font>;
01903     <font class="keywordflow">if</font> ( !( different &amp; Color ) &amp;&amp; item-&gt;color().isValid() )
01904     col = item-&gt;color();
01905     <font class="keywordflow">if</font> ( !( different &amp; Size ) &amp;&amp; item-&gt;fontSize() != -1 )
01906     fn.setPointSize( item-&gt;fontSize() );
01907     <font class="keywordflow">if</font> ( !( different &amp; Family ) &amp;&amp; !item-&gt;fontFamily().isEmpty() )
01908     fn.setFamily( item-&gt;fontFamily() );
01909     <font class="keywordflow">if</font> ( !( different &amp; Bold ) &amp;&amp; item-&gt;fontWeight() != -1 )
01910     fn.setWeight( item-&gt;fontWeight() );
01911     <font class="keywordflow">if</font> ( !( different &amp; Italic ) &amp;&amp; item-&gt;definesFontItalic() )
01912     fn.setItalic( item-&gt;fontItalic() );
01913     <font class="keywordflow">if</font> ( !( different &amp; Underline ) &amp;&amp; item-&gt;definesFontUnderline() )
01914     fn.setUnderline( item-&gt;fontUnderline() );
01915     generateKey();
01916     update();
01917 
01918 }
01919 
01920 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextFormat::updateStyleFlags()
01921 {
01922     different = NoFlags;
01923     <font class="keywordflow">if</font> ( !collection || !collection-&gt;styleSheet() )
01924     <font class="keywordflow">return</font>;
01925     QStyleSheetItem *item = collection-&gt;styleSheet()-&gt;item( style );
01926     <font class="keywordflow">if</font> ( !item )
01927     <font class="keywordflow">return</font>;
01928     <font class="keywordflow">if</font> ( item-&gt;color() != col )
01929     different |= Color;
01930     <font class="keywordflow">if</font> ( item-&gt;fontSize() != fn.pointSize() )
01931     different |= Size;
01932     <font class="keywordflow">if</font> ( item-&gt;fontFamily() != fn.family() )
01933     different |= Family;
01934     <font class="keywordflow">if</font> ( item-&gt;fontItalic() != fn.italic() )
01935     different |= Italic;
01936     <font class="keywordflow">if</font> ( item-&gt;fontUnderline() != fn.underline() )
01937     different |= Underline;
01938     <font class="keywordflow">if</font> ( item-&gt;fontWeight() != fn.weight() )
01939     different |= Bold;
01940 }
01941 
01942 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01943 
01944 <font class="keyword">inline</font> QTextStringChar &amp;QTextString::at( <font class="keywordtype">int</font> i )<font class="keyword"> const</font>
01945 <font class="keyword"></font>{
01946     <font class="keywordflow">return</font> data[ i ];
01947 }
01948 
01949 <font class="keyword">inline</font> QString QTextString::toString( <font class="keyword">const</font> QArray&lt;QTextStringChar&gt; &amp;data )
01950 {
01951     QString s;
01952     <font class="keywordtype">int</font> l = data.size();
01953     s.setUnicode( 0, l );
01954     QTextStringChar *c = data.data();
01955     QChar *uc = (QChar *)s.unicode();
01956     <font class="keywordflow">while</font> ( l-- ) {
01957     *uc = c-&gt;c;
01958     uc++;
01959     c++;
01960     }
01961 
01962     <font class="keywordflow">return</font> s;
01963 }
01964 
01965 <font class="keyword">inline</font> QString QTextString::toString()<font class="keyword"> const</font>
01966 <font class="keyword"></font>{
01967     <font class="keywordflow">return</font> toString( data );
01968 }
01969 
01970 <font class="keyword">inline</font> QString QTextString::toReverseString()<font class="keyword"> const</font>
01971 <font class="keyword"></font>{
01972     QString s;
01973     <font class="keywordtype">int</font> l = length();
01974     s.setUnicode(0, l);
01975     QTextStringChar *c = data.data() + (l-1);
01976     QChar *uc = (QChar *)s.unicode();
01977     <font class="keywordflow">while</font> ( l-- ) {
01978     *uc = c-&gt;c;
01979     uc++;
01980     c--;
01981     }
01982 
01983     <font class="keywordflow">return</font> s;
01984 }
01985 
01986 <font class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
01987 
01988 <font class="keyword">inline</font> QTextStringChar *QTextParag::at( <font class="keywordtype">int</font> i )<font class="keyword"> const</font>
01989 <font class="keyword"></font>{
01990     <font class="keywordflow">return</font> &amp;str-&gt;at( i );
01991 }
01992 
01993 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextParag::isValid()<font class="keyword"> const</font>
01994 <font class="keyword"></font>{
01995     <font class="keywordflow">return</font> invalid == -1;
01996 }
01997 
01998 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextParag::hasChanged()<font class="keyword"> const</font>
01999 <font class="keyword"></font>{
02000     <font class="keywordflow">return</font> changed;
02001 }
02002 
02003 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setChanged( <font class="keywordtype">bool</font> b, <font class="keywordtype">bool</font> recursive )
02004 {
02005     changed = b;
02006     <font class="keywordflow">if</font> ( recursive ) {
02007     <font class="keywordflow">if</font> ( doc &amp;&amp; doc-&gt;parentParag() )
02008         doc-&gt;parentParag()-&gt;setChanged( b, recursive );
02009     }
02010 }
02011 
02012 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::append( <font class="keyword">const</font> QString &amp;s, <font class="keywordtype">bool</font> reallyAtEnd )
02013 {
02014     <font class="keywordflow">if</font> ( reallyAtEnd )
02015     insert( str-&gt;length(), s );
02016     <font class="keywordflow">else</font>
02017     insert( QMAX( str-&gt;length() - 1, 0 ), s );
02018 }
02019 
02020 <font class="keyword">inline</font> QTextParag *QTextParag::prev()<font class="keyword"> const</font>
02021 <font class="keyword"></font>{
02022     <font class="keywordflow">return</font> p;
02023 }
02024 
02025 <font class="keyword">inline</font> QTextParag *QTextParag::next()<font class="keyword"> const</font>
02026 <font class="keyword"></font>{
02027     <font class="keywordflow">return</font> n;
02028 }
02029 
02030 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setSelection( <font class="keywordtype">int</font> id, <font class="keywordtype">int</font> start, <font class="keywordtype">int</font> end )
02031 {
02032     QMap&lt;int, QTextParagSelection&gt;::ConstIterator it = selections.find( id );
02033     <font class="keywordflow">if</font> ( it != selections.end() ) {
02034     <font class="keywordflow">if</font> ( start == ( *it ).start &amp;&amp; end == ( *it ).end )
02035         <font class="keywordflow">return</font>;
02036     }
02037 
02038     QTextParagSelection sel;
02039     sel.start = start;
02040     sel.end = end;
02041     selections[ id ] = sel;
02042     setChanged( TRUE, TRUE );
02043 }
02044 
02045 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::removeSelection( <font class="keywordtype">int</font> id )
02046 {
02047     <font class="keywordflow">if</font> ( !hasSelection( id ) )
02048     <font class="keywordflow">return</font>;
02049     selections.remove( id );
02050     setChanged( TRUE, TRUE );
02051 }
02052 
02053 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::selectionStart( <font class="keywordtype">int</font> id )<font class="keyword"> const</font>
02054 <font class="keyword"></font>{
02055     QMap&lt;int, QTextParagSelection&gt;::ConstIterator it = selections.find( id );
02056     <font class="keywordflow">if</font> ( it == selections.end() )
02057     <font class="keywordflow">return</font> -1;
02058     <font class="keywordflow">return</font> ( *it ).start;
02059 }
02060 
02061 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::selectionEnd( <font class="keywordtype">int</font> id )<font class="keyword"> const</font>
02062 <font class="keyword"></font>{
02063     QMap&lt;int, QTextParagSelection&gt;::ConstIterator it = selections.find( id );
02064     <font class="keywordflow">if</font> ( it == selections.end() )
02065     <font class="keywordflow">return</font> -1;
02066     <font class="keywordflow">return</font> ( *it ).end;
02067 }
02068 
02069 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextParag::hasSelection( <font class="keywordtype">int</font> id )<font class="keyword"> const</font>
02070 <font class="keyword"></font>{
02071     QMap&lt;int, QTextParagSelection&gt;::ConstIterator it = selections.find( id );
02072     <font class="keywordflow">if</font> ( it == selections.end() )
02073     <font class="keywordflow">return</font> FALSE;
02074     <font class="keywordflow">return</font> ( *it ).start != ( *it ).end || length() == 1;
02075 }
02076 
02077 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextParag::hasAnySelection()<font class="keyword"> const</font>
02078 <font class="keyword"></font>{
02079     <font class="keywordflow">return</font> !selections.isEmpty();
02080 }
02081 
02082 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextParag::fullSelected( <font class="keywordtype">int</font> id )<font class="keyword"> const</font>
02083 <font class="keyword"></font>{
02084     QMap&lt;int, QTextParagSelection&gt;::ConstIterator it = selections.find( id );
02085     <font class="keywordflow">if</font> ( it == selections.end() )
02086     <font class="keywordflow">return</font> FALSE;
02087     <font class="keywordflow">return</font> ( *it ).start == 0 &amp;&amp; ( *it ).end == str-&gt;length() - 1;
02088 }
02089 
02090 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setEndState( <font class="keywordtype">int</font> s )
02091 {
02092     <font class="keywordflow">if</font> ( s == state )
02093     <font class="keywordflow">return</font>;
02094     state = s;
02095 }
02096 
02097 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::endState()<font class="keyword"> const</font>
02098 <font class="keyword"></font>{
02099     <font class="keywordflow">return</font> state;
02100 }
02101 
02102 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setParagId( <font class="keywordtype">int</font> i )
02103 {
02104     id = i;
02105 }
02106 
02107 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::paragId()<font class="keyword"> const</font>
02108 <font class="keyword"></font>{
02109     <font class="keywordflow">if</font> ( id == -1 )
02110     qWarning( <font class="stringliteral">"invalid parag id!!!!!!!! (%p)"</font>, (<font class="keywordtype">void</font>*)<font class="keyword">this</font> );
02111     <font class="keywordflow">return</font> id;
02112 }
02113 
02114 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextParag::firstPreProcess()<font class="keyword"> const</font>
02115 <font class="keyword"></font>{
02116     <font class="keywordflow">return</font> firstPProcess;
02117 }
02118 
02119 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setFirstPreProcess( <font class="keywordtype">bool</font> b )
02120 {
02121     firstPProcess = b;
02122 }
02123 
02124 <font class="keyword">inline</font> QMap&lt;int, QTextParagLineStart*&gt; &amp;QTextParag::lineStartList()
02125 {
02126     <font class="keywordflow">return</font> lineStarts;
02127 }
02128 
02129 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::lineY( <font class="keywordtype">int</font> l )<font class="keyword"> const</font>
02130 <font class="keyword"></font>{
02131     <font class="keywordflow">if</font> ( l &gt; (int)lineStarts.count() - 1 ) {
02132     qWarning( <font class="stringliteral">"QTextParag::lineY: line %d out of range!"</font>, l );
02133     <font class="keywordflow">return</font> 0;
02134     }
02135 
02136     <font class="keywordflow">if</font> ( !isValid() )
02137     ( (QTextParag*)<font class="keyword">this</font> )-&gt;format();
02138 
02139     QMap&lt;int, QTextParagLineStart*&gt;::ConstIterator it = lineStarts.begin();
02140     <font class="keywordflow">while</font> ( l-- &gt; 0 )
02141     ++it;
02142     <font class="keywordflow">return</font> ( *it )-&gt;y;
02143 }
02144 
02145 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::lineBaseLine( <font class="keywordtype">int</font> l )<font class="keyword"> const</font>
02146 <font class="keyword"></font>{
02147     <font class="keywordflow">if</font> ( l &gt; (int)lineStarts.count() - 1 ) {
02148     qWarning( <font class="stringliteral">"QTextParag::lineBaseLine: line %d out of range!"</font>, l );
02149     <font class="keywordflow">return</font> 10;
02150     }
02151 
02152     <font class="keywordflow">if</font> ( !isValid() )
02153     ( (QTextParag*)<font class="keyword">this</font> )-&gt;format();
02154 
02155     QMap&lt;int, QTextParagLineStart*&gt;::ConstIterator it = lineStarts.begin();
02156     <font class="keywordflow">while</font> ( l-- &gt; 0 )
02157     ++it;
02158     <font class="keywordflow">return</font> ( *it )-&gt;baseLine;
02159 }
02160 
02161 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::lineHeight( <font class="keywordtype">int</font> l )<font class="keyword"> const</font>
02162 <font class="keyword"></font>{
02163     <font class="keywordflow">if</font> ( l &gt; (int)lineStarts.count() - 1 ) {
02164     qWarning( <font class="stringliteral">"QTextParag::lineHeight: line %d out of range!"</font>, l );
02165     <font class="keywordflow">return</font> 15;
02166     }
02167 
02168     <font class="keywordflow">if</font> ( !isValid() )
02169     ( (QTextParag*)<font class="keyword">this</font> )-&gt;format();
02170 
02171     QMap&lt;int, QTextParagLineStart*&gt;::ConstIterator it = lineStarts.begin();
02172     <font class="keywordflow">while</font> ( l-- &gt; 0 )
02173     ++it;
02174     <font class="keywordflow">return</font> ( *it )-&gt;h;
02175 }
02176 
02177 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::lineInfo( <font class="keywordtype">int</font> l, <font class="keywordtype">int</font> &amp;y, <font class="keywordtype">int</font> &amp;h, <font class="keywordtype">int</font> &amp;bl )<font class="keyword"> const</font>
02178 <font class="keyword"></font>{
02179     <font class="keywordflow">if</font> ( l &gt; (int)lineStarts.count() - 1 ) {
02180     qWarning( <font class="stringliteral">"QTextParag::lineInfo: line %d out of range!"</font>, l );
02181     qDebug( <font class="stringliteral">"%d %d"</font>, lineStarts.count() - 1, l );
02182     y = 0;
02183     h = 15;
02184     bl = 10;
02185     <font class="keywordflow">return</font>;
02186     }
02187 
02188     <font class="keywordflow">if</font> ( !isValid() )
02189     ( (QTextParag*)<font class="keyword">this</font> )-&gt;format();
02190 
02191     QMap&lt;int, QTextParagLineStart*&gt;::ConstIterator it = lineStarts.begin();
02192     <font class="keywordflow">while</font> ( l-- &gt; 0 )
02193     ++it;
02194     y = ( *it )-&gt;y;
02195     h = ( *it )-&gt;h;
02196     bl = ( *it )-&gt;baseLine;
02197 }
02198 
02199 <font class="keyword">inline</font> QTextString *QTextParag::string()<font class="keyword"> const</font>
02200 <font class="keyword"></font>{
02201     <font class="keywordflow">return</font> str;
02202 }
02203 
02204 <font class="keyword">inline</font> QTextDocument *QTextParag::document()<font class="keyword"> const</font>
02205 <font class="keyword"></font>{
02206     <font class="keywordflow">return</font> doc;
02207 }
02208 
02209 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setAlignment( <font class="keywordtype">int</font> a )
02210 {
02211     <font class="keywordflow">if</font> ( a == align )
02212     <font class="keywordflow">return</font>;
02213     align = a;
02214     invalidate( 0 );
02215 }
02216 
02217 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::alignment()<font class="keyword"> const</font>
02218 <font class="keyword"></font>{
02219     <font class="keywordflow">if</font> ( align != -1 )
02220     <font class="keywordflow">return</font> align;
02221     QStyleSheetItem *item = style();
02222     <font class="keywordflow">if</font> ( !item )
02223     <font class="keywordflow">return</font> Qt3::AlignAuto;
02224     <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; (int)styleSheetItemsVec.size(); ++i ) {
02225     item = styleSheetItemsVec[ i ];
02226     <font class="keywordflow">if</font> ( item-&gt;alignment() != QStyleSheetItem::Undefined )
02227         <font class="keywordflow">return</font> item-&gt;alignment();
02228     }
02229     <font class="keywordflow">return</font> Qt3::AlignAuto;
02230 }
02231 
02232 <font class="keyword">inline</font> QVector&lt;QStyleSheetItem&gt; QTextParag::styleSheetItems()<font class="keyword"> const</font>
02233 <font class="keyword"></font>{
02234     QVector&lt;QStyleSheetItem&gt; vec;
02235     vec.resize( styleSheetItemsVec.size() );
02236     <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; (int)vec.size(); ++i )
02237     vec.insert( i, styleSheetItemsVec[ i ] );
02238     <font class="keywordflow">return</font> vec;
02239 }
02240 
02241 <font class="keyword">inline</font> QStyleSheetItem *QTextParag::style()<font class="keyword"> const</font>
02242 <font class="keyword"></font>{
02243     <font class="keywordflow">if</font> ( styleSheetItemsVec.size() == 0 )
02244     <font class="keywordflow">return</font> 0;
02245     <font class="keywordflow">return</font> styleSheetItemsVec[ styleSheetItemsVec.size() - 1 ];
02246 }
02247 
02248 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::numberOfSubParagraph()<font class="keyword"> const</font>
02249 <font class="keyword"></font>{
02250     <font class="keywordflow">if</font> ( numSubParag != -1 )
02251     <font class="keywordflow">return</font> numSubParag;
02252     <font class="keywordtype">int</font> n = 0;
02253     QTextParag *p = (QTextParag*)<font class="keyword">this</font>;
02254     <font class="keywordflow">while</font> ( p &amp;&amp; style() == p-&gt;style() &amp;&amp; listStyle() == p-&gt;listStyle() ) {
02255     ++n;
02256     p = p-&gt;prev();
02257     }
02258     ( (QTextParag*)<font class="keyword">this</font> )-&gt;numSubParag = n;
02259     <font class="keywordflow">return</font> n;
02260 }
02261 
02262 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setListStyle( QStyleSheetItem::ListStyle ls )
02263 {
02264     listS = ls;
02265     invalidate( 0 );
02266 }
02267 
02268 <font class="keyword">inline</font> QStyleSheetItem::ListStyle QTextParag::listStyle()<font class="keyword"> const</font>
02269 <font class="keyword"></font>{
02270     <font class="keywordflow">return</font> listS;
02271 }
02272 
02273 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setFormat( QTextFormat *fm )
02274 {
02275     <font class="keywordtype">bool</font> doUpdate = (bool)defFormat &amp;&amp; defFormat != formatCollection()-&gt;defaultFormat();
02276     defFormat = formatCollection()-&gt;format( fm );
02277     <font class="keywordflow">if</font> ( !doUpdate )
02278     <font class="keywordflow">return</font>;
02279     <font class="keywordflow">for</font> ( <font class="keywordtype">int</font> i = 0; i &lt; length(); ++i ) {
02280     <font class="keywordflow">if</font> ( at( i )-&gt;format()-&gt;styleName() == defFormat-&gt;styleName() )
02281         at( i )-&gt;format()-&gt;updateStyle();
02282     }
02283 }
02284 
02285 <font class="keyword">inline</font> QTextFormat *QTextParag::paragFormat()<font class="keyword"> const</font>
02286 <font class="keyword"></font>{
02287     <font class="keywordflow">return</font> defFormat;
02288 }
02289 
02290 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::registerFloatingItem( QTextCustomItem *i )
02291 {
02292     floatingItems.append( i );
02293 }
02294 
02295 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::unregisterFloatingItem( QTextCustomItem *i )
02296 {
02297     floatingItems.removeRef( i );
02298 }
02299 
02300 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::addCustomItem()
02301 {
02302     numCustomItems++;
02303 }
02304 
02305 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::removeCustomItem()
02306 {
02307     numCustomItems--;
02308 }
02309 
02310 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::customItems()<font class="keyword"> const</font>
02311 <font class="keyword"></font>{
02312     <font class="keywordflow">return</font> numCustomItems;
02313 }
02314 
02315 <font class="keyword">inline</font> QBrush *QTextParag::background()<font class="keyword"> const</font>
02316 <font class="keyword"></font>{
02317     <font class="keywordflow">return</font> tc ? tc-&gt;backGround() : 0;
02318 }
02319 
02320 
02321 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setDocumentRect( <font class="keyword">const</font> QRect &amp;r )
02322 {
02323     docRect = r;
02324 }
02325 
02326 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::documentWidth()<font class="keyword"> const</font>
02327 <font class="keyword"></font>{
02328     <font class="keywordflow">return</font> doc ? doc-&gt;width() : docRect.width();
02329 }
02330 
02331 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::documentVisibleWidth()<font class="keyword"> const</font>
02332 <font class="keyword"></font>{
02333     <font class="keywordflow">return</font> doc ? doc-&gt;visibleWidth() : docRect.width();
02334 }
02335 
02336 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::documentX()<font class="keyword"> const</font>
02337 <font class="keyword"></font>{
02338     <font class="keywordflow">return</font> doc ? doc-&gt;x() : docRect.x();
02339 }
02340 
02341 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::documentY()<font class="keyword"> const</font>
02342 <font class="keyword"></font>{
02343     <font class="keywordflow">return</font> doc ? doc-&gt;y() : docRect.y();
02344 }
02345 
02346 <font class="keyword">inline</font> QTextFormatter *QTextParag::formatter()<font class="keyword"> const</font>
02347 <font class="keyword"></font>{
02348     <font class="keywordflow">if</font> ( doc )
02349     <font class="keywordflow">return</font> doc-&gt;formatter();
02350     <font class="keywordflow">if</font> ( pFormatter )
02351     <font class="keywordflow">return</font> pFormatter;
02352     <font class="keywordflow">return</font> ( ( (QTextParag*)<font class="keyword">this</font> )-&gt;pFormatter = <font class="keyword">new</font> QTextFormatterBreakWords );
02353 }
02354 
02355 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setFormatter( QTextFormatter *f )
02356 {
02357     <font class="keywordflow">if</font> ( doc ) <font class="keywordflow">return</font>;
02358     <font class="keywordflow">if</font> ( pFormatter ) <font class="keyword">delete</font> pFormatter;
02359     pFormatter = f;
02360 }
02361 
02362 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextParag::minimumWidth()<font class="keyword"> const</font>
02363 <font class="keyword"></font>{
02364     <font class="keywordflow">return</font> doc ? doc-&gt;minimumWidth() : 0;
02365 }
02366 
02367 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setExtraData( QTextParagData *data )
02368 {
02369     eData = data;
02370 }
02371 
02372 <font class="keyword">inline</font> QTextParagData *QTextParag::extraData()<font class="keyword"> const</font>
02373 <font class="keyword"></font>{
02374     <font class="keywordflow">return</font> eData;
02375 }
02376 
02377 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextParag::setNewLinesAllowed( <font class="keywordtype">bool</font> b )
02378 {
02379     newLinesAllowed = b;
02380 }
02381 
02382 <font class="keyword">inline</font> <font class="keywordtype">bool</font> QTextParag::isNewLinesAllowed()<font class="keyword"> const</font>
02383 <font class="keyword"></font>{
02384     <font class="keywordflow">return</font> newLinesAllowed;
02385 }
02386 
02387 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
02388 
02389 <font class="keyword">inline</font> <font class="keywordtype">void</font> QTextFormatCollection::setDefaultFormat( QTextFormat *f )
02390 {
02391     defFormat = f;
02392 }
02393 
02394 <font class="keyword">inline</font> QTextFormat *QTextFormatCollection::defaultFormat()<font class="keyword"> const</font>
02395 <font class="keyword"></font>{
02396     <font class="keywordflow">return</font> defFormat;
02397 }
02398 
02399 <font class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</font>
02400 
02401 <font class="keyword">inline</font> QTextStringChar::~QTextStringChar()
02402 {
02403     <font class="keywordflow">if</font> ( format() )
02404     format()-&gt;removeRef();
02405     <font class="keywordflow">switch</font> ( type ) {
02406     <font class="keywordflow">case</font> Custom:
02407         <font class="keyword">delete</font> d.custom; <font class="keywordflow">break</font>;
02408     <font class="keywordflow">case</font> Mark:
02409         <font class="keyword">delete</font> d.mark; <font class="keywordflow">break</font>;
02410     <font class="keywordflow">case</font> Shaped:
02411         <font class="keyword">delete</font> d.shaped; <font class="keywordflow">break</font>;
02412     <font class="keywordflow">default</font>:
02413         <font class="keywordflow">break</font>;
02414     }
02415 }
02416 
02417 <font class="keyword">inline</font> QTextFormat *QTextStringChar::format()<font class="keyword"> const</font>
02418 <font class="keyword"></font>{
02419     <font class="keywordflow">return</font> (type == Regular) ? d.format : d.custom-&gt;format;
02420 }
02421 
02422 
02423 <font class="keyword">inline</font> QTextCustomItem *QTextStringChar::customItem()<font class="keyword"> const</font>
02424 <font class="keyword"></font>{
02425     <font class="keywordflow">return</font> isCustom() ? d.custom-&gt;custom : 0;
02426 }
02427 
02428 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextStringChar::height()<font class="keyword"> const</font>
02429 <font class="keyword"></font>{
02430     <font class="keywordflow">return</font> !isCustom() ? format()-&gt;height() : ( customItem()-&gt;placement() == QTextCustomItem::PlaceInline ? customItem()-&gt;height : 0 );
02431 }
02432 
02433 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextStringChar::ascent()<font class="keyword"> const</font>
02434 <font class="keyword"></font>{
02435     <font class="keywordflow">return</font> !isCustom() ? format()-&gt;ascent() : ( customItem()-&gt;placement() == QTextCustomItem::PlaceInline ? customItem()-&gt;height : 0 );
02436 }
02437 
02438 <font class="keyword">inline</font> <font class="keywordtype">int</font> QTextStringChar::descent()<font class="keyword"> const</font>
02439 <font class="keyword"></font>{
02440     <font class="keywordflow">return</font> !isCustom() ? format()-&gt;descent() : 0;
02441 }
02442 
02443 }; <font class="comment">// namespace</font>
02444 
02445 <font class="preprocessor">#endif</font>
02446 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Sat Feb 9 23:03:04 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.13 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
