<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>centrydisplay.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>centrydisplay.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          centrydisplay.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Fre Mai 31 2002</font>
00005 <font class="comment">    copyright            : (C) 2002 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//BibleTime includes</font>
00019 <font class="preprocessor">#include "centrydisplay.h"</font>
00020 <font class="preprocessor">#include "cswordkey.h"</font>
00021 <font class="preprocessor">#include "cswordversekey.h"</font>
00022 <font class="preprocessor">#include "cswordbookmoduleinfo.h"</font>
00023 <font class="preprocessor">#include "creferencemanager.h"</font>
00024 
00025 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00026 
00027 <font class="preprocessor">#include "util/scoped_resource.h"</font>
00028 
00029 <font class="comment">//Qt includes</font>
00030 <font class="preprocessor">#include &lt;qapplication.h&gt;</font>
00031 
00032 CEntryDisplay::CEntryDisplay(){
00033 }
00034 
00035 CEntryDisplay::~CEntryDisplay(){
00036 }
00037 
<a name="l00039"></a><a class="code" href="class_c_entry_display.html#a2">00039</a> <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#a2">CEntryDisplay::text</a>( QPtrList&lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName, CSwordBackend::DisplayOptionsBool displayOptions, CSwordBackend::FilterOptionsBool filterOptions ) {
00040   <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a7">setDisplayOptions</a>( displayOptions );
00041   <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>( filterOptions );
00042 
00043   <font class="keyword">const</font> QString entry = <a class="code" href="class_c_entry_display.html#b2">entryText</a>(modules, keyName);
00044   <font class="keywordflow">return</font> <a class="code" href="class_c_entry_display.html#b3">finishText</a>( entry, modules, keyName );
00045 }
00046 
<a name="l00048"></a><a class="code" href="class_c_entry_display.html#a3">00048</a> <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#a3">CEntryDisplay::previewText</a>( <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>*  module, <font class="keyword">const</font> QString&amp; keyName, <font class="keyword">const</font> QString&amp; headerText, CSwordBackend::DisplayOptionsBool displayOptions, CSwordBackend::FilterOptionsBool filterOptions){
00049   <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(module) );
00050   key-&gt;key(keyName);
00051 
00052   QString css = QString::null;
00053   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> t = MinType; t &lt;= MaxType; ++t) {
00054     css += <font class="stringliteral">"\t"</font> + cssString( static_cast&lt;CEntryDisplay::StyleType&gt;(t) ) + <font class="stringliteral">"\n\n"</font>;
00055   }
00056 
00057   <font class="keyword">const</font> QString pageStart = QString::fromLatin1(<font class="stringliteral">"&lt;HTML&gt;&lt;HEAD&gt;&lt;STYLE type=\"text/css\"&gt;%1&lt;/STYLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;%2&lt;HR&gt;"</font>)
00058     .arg(css)
00059     .arg(headerText);
00060 
00061   <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">"&lt;DIV %1 %2&gt;%3&lt;/DIV&gt;"</font>)
00062     .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a22">textDirection</a>() == CSwordModuleInfo::RightToLeft ? QString::fromLatin1(<font class="stringliteral">"dir=\"rtl\""</font>) : QString::null)
00063     .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>() ? QString::fromLatin1(<font class="stringliteral">"class=\"unicodetext\""</font>) : QString::null)
00064     .arg(key-&gt;renderedText());
00065 
00066   <font class="keyword">const</font> QString pageEnd = QString::fromLatin1(<font class="stringliteral">"&lt;/BODY&gt;&lt;/HTML&gt;"</font>);
00067   <font class="keywordflow">return</font> pageStart + <a class="code" href="class_c_entry_display.html#a2">text</a> + pageEnd;
00068 }
00069 
<a name="l00071"></a><a class="code" href="class_c_entry_display.html#b2">00071</a> <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#b2">CEntryDisplay::entryText</a>( QPtrList&lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName){
00072     Q_ASSERT(modules.first());
00073   <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(modules.first()) );
00074   key-&gt;key(keyName);
00075   QString renderedText = QString::null;
00076 
00077   renderedText = QString::fromLatin1(<font class="stringliteral">"&lt;TR valign=\"top\"&gt;"</font>);
00078   <font class="keywordflow">for</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = modules.first(); m; m = modules.next()) {
00079     <font class="keyword">const</font> QString tdStyle = QString::fromLatin1(<font class="stringliteral">"style=\"%1 %2\""</font>)
00080       .arg((modules.at()+1 &lt; modules.count()) ? QString::fromLatin1(<font class="stringliteral">"padding-right: 2mm; border-right:thin solid black;"</font>) : QString::null)
00081       .arg((modules.at()&gt;0 &amp;&amp; modules.at()+1 &lt;= modules.count()) ? QString::fromLatin1(<font class="stringliteral">"padding-left:2mm;"</font>) : QString::null);
00082 
00083     key-&gt;module(m);
00084     key-&gt;key(keyName);
00085     renderedText += QString::fromLatin1(<font class="stringliteral">"&lt;TD %1 valign=\"top\"&gt;&lt;SPAN %2&gt;%3&lt;/SPAN&gt;&lt;/TD&gt;"</font>)
00086                       .arg(tdStyle.latin1())
00087                       .arg(m-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>() ? <font class="stringliteral">"class=\"unicodetext\""</font> : <font class="stringliteral">""</font>)
00088                       .arg(key-&gt;renderedText());
00089   }
00090   renderedText += QString::fromLatin1(<font class="stringliteral">"&lt;/TR&gt;"</font>);
00091   <font class="keywordflow">return</font> renderedText;
00092 }
00093 
<a name="l00095"></a><a class="code" href="class_c_entry_display.html#b1">00095</a> <font class="keyword">const</font> QColor <a class="code" href="class_c_entry_display.html#b1">CEntryDisplay::color</a>( <font class="keyword">const</font> CEntryDisplay::ColorType type ) {
00096   <font class="keywordflow">switch</font> (type) {
00097     <font class="keywordflow">case</font> ReferenceColor:
00098       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::swordRefColor);
00099     <font class="keywordflow">case</font> TextColor:
00100       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::textColor);
00101     <font class="keywordflow">case</font> HighlightedTextColor:
00102       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::highlightedVerseColor);
00103     <font class="keywordflow">case</font> BackgroundColor:
00104       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::backgroundColor);
00105 <font class="comment">//    case BackgroundColor2:</font>
00106 <font class="comment">//      return CBTConfig::get(CBTConfig::background2Color);</font>
00107     <font class="keywordflow">case</font> FootnoteColor:
00108       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::footnotesColor);
00109     <font class="keywordflow">case</font> StrongsNumberColor:
00110       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::strongsColor);
00111     <font class="keywordflow">case</font> MorphCodeColor:
00112       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::morphsColor);
00113 <font class="comment">//    case LemmaColor:</font>
00114 <font class="comment">//      return CBTConfig::get(CBTConfig::lemmaColor);</font>
00115     <font class="keywordflow">case</font> JesusWordColor:
00116       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::jesuswordsColor);
00117     <font class="keywordflow">default</font>:
00118       <font class="keywordflow">return</font> Qt::white;
00119   }
00120 }
00121 
<a name="l00123"></a><a class="code" href="class_c_entry_display.html#b0">00123</a> <font class="keyword">const</font> QFont <a class="code" href="class_c_entry_display.html#b0">CEntryDisplay::font</a>( <font class="keyword">const</font> CEntryDisplay::FontType type ) {
00124   <font class="keywordflow">switch</font> (type) {
00125     <font class="keywordflow">case</font> UnicodeFont:
00126       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::unicode);
00127     <font class="keywordflow">case</font> StandardFont:
00128       <font class="keywordflow">return</font> CBTConfig::get(CBTConfig::standard);
00129     <font class="keywordflow">default</font>:
00130       <font class="keywordflow">return</font> QApplication::font();
00131   }
00132 }
00133 
<a name="l00135"></a><a class="code" href="class_c_entry_display.html#b3">00135</a> <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#b3">CEntryDisplay::finishText</a>( <font class="keyword">const</font> QString text, QPtrList &lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName){
00136   <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = modules.first();
00137   Q_ASSERT(module); <font class="comment">//shouldn't happen</font>
00138   <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(modules.first()) );
00139   key-&gt;key(keyName);
00140 
00141   QString css = <font class="stringliteral">"table.maintable {width:100%;} td.tableheading {border-bottom: thin solid black;}"</font>;
00142   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> t = MinType; t &lt;= MaxType; ++t) {
00143     css += <font class="stringliteral">"\t"</font> + cssString( static_cast&lt;CEntryDisplay::StyleType&gt;(t) ) + <font class="stringliteral">"\n\n"</font>;
00144   }
00145 
00146   <font class="keyword">const</font> <font class="keywordtype">int</font> columnWidth = (int)((float)100 / (float)modules.count());
00147 
00148   QString pageStart = QString::fromLatin1(<font class="stringliteral">"&lt;HTML&gt;&lt;HEAD&gt;&lt;STYLE type=\"text/css\"&gt;%1&lt;/STYLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;TABLE cellspacing=\"0\" class=\"maintable\"&gt;&lt;TR&gt;"</font>)
00149     .arg(css);
00150 
00151   <font class="keywordflow">for</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = modules.first(); m; m = modules.next()) {
00152     key-&gt;module(m);
00153     <font class="keyword">const</font> QString newKeyName = key-&gt;key();
00154     pageStart += QString::fromLatin1(<font class="stringliteral">"&lt;TD class=\"tableheading\" width=\"%1%\"&gt;&lt;CENTER&gt;&lt;B&gt;%2&lt;/B&gt; %3&lt;/CENTER&gt;&lt;/TD&gt;"</font>)
00155       .arg(columnWidth)
00156       .arg(m-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>())
00157       .arg(!newKeyName.isEmpty() ? QString::fromLatin1(<font class="stringliteral">"(%1)"</font>).arg(<a class="code" href="class_c_entry_display.html#b4">htmlReference</a>(m, newKeyName, newKeyName, newKeyName)) : QString::null);
00158   }
00159   pageStart += QString::fromLatin1(<font class="stringliteral">"&lt;/TR&gt;"</font>);
00160 
00161   <font class="keyword">const</font> QString pageEnd = QString::fromLatin1(<font class="stringliteral">"&lt;/TABLE&gt;&lt;/BODY&gt;&lt;/HTML&gt;"</font>);
00162 
00163   <font class="keywordflow">return</font> pageStart + <a class="code" href="class_c_entry_display.html#a2">text</a> + pageEnd;
00164 }
00165 
00166 <font class="keyword">const</font> QString CEntryDisplay::cssString( <font class="keyword">const</font> CEntryDisplay::StyleType type ){
00167   <font class="keyword">const</font> QString bgColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(BackgroundColor).name();
00168 <font class="comment">//  const QString bgColor2 = color(BackgroundColor2).name();</font>
00169 
00170   <font class="keyword">const</font> QString textColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(TextColor).name();
00171   <font class="keyword">const</font> QString highlightColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(HighlightedTextColor).name();
00172   <font class="keyword">const</font> QString swordRefColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(ReferenceColor).name();
00173   <font class="keyword">const</font> QString footnotesColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(FootnoteColor).name();
00174 
00175   <font class="keyword">const</font> QString strongsColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(StrongsNumberColor).name();
00176   <font class="keyword">const</font> QString morphsColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(MorphCodeColor).name();
00177 <font class="comment">//  const QString lemmaColor = color(LemmaColor).name();</font>
00178 
00179   <font class="keyword">const</font> QString jesusWordsColor = <a class="code" href="class_c_entry_display.html#b1">color</a>(JesusWordColor).name();
00180 
00181 
00182   QString <a class="code" href="class_c_entry_display.html#a2">text</a>;
00183   <font class="keywordflow">switch</font>(type) {
00184     <font class="keywordflow">case</font> Body:
00185       <a class="code" href="class_c_entry_display.html#a2">text</a> =  QString::fromLatin1(<font class="stringliteral">"body {%1; color: %2; font-size: %3pt; font-family: %4;}"</font>)
00186                 .arg(QString::fromLatin1(<font class="stringliteral">"background-color: %1"</font>).arg(bgColor))
00187                 .arg(textColor)
00188                 .arg(<a class="code" href="class_c_entry_display.html#b0">font</a>(StandardFont).pointSize())
00189                 .arg(<a class="code" href="class_c_entry_display.html#b0">font</a>(StandardFont).family());
00190       <font class="keywordflow">break</font>;
00191     <font class="keywordflow">case</font> Link:
00192       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">"a:link {text-decoration:none;}"</font>);
00193 <font class="comment">//              .arg(swordRefColor);</font>
00194       <font class="keywordflow">break</font>;
00195     <font class="keywordflow">case</font> LinkHover:
00196       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">"a:hover {text-decoration:none;}"</font>);
00197       <font class="keywordflow">break</font>;
00198     <font class="keywordflow">case</font> Background:
00199       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".background1 {background-color:%1;}"</font>)
00200               .arg(bgColor);
00201       <font class="keywordflow">break</font>;
00202 <font class="comment">//    case Background2:</font>
00203 <font class="comment">//      text = QString::fromLatin1(".background2 {background-color:%1;}")</font>
00204 <font class="comment">//              .arg(bgColor2);</font>
00205 <font class="comment">//      break;</font>
00206     <font class="keywordflow">case</font> HighlightedText:
00207       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".highlighted {color: %1;}"</font>)
00208               .arg(highlightColor);
00209       <font class="keywordflow">break</font>;
00210     <font class="keywordflow">case</font> UnicodeText:
00211       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".unicodetext { font-family: %1; font-size:%2pt; }"</font>)
00212                 .arg(<a class="code" href="class_c_entry_display.html#b0">font</a>(UnicodeFont).family())
00213                 .arg(<a class="code" href="class_c_entry_display.html#b0">font</a>(UnicodeFont).pointSize());
00214       <font class="keywordflow">break</font>;
00215     <font class="keywordflow">case</font> Reference:
00216       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".reference { color: %1; font-decoration: none; font-weight:bold; }"</font>)
00217               .arg(swordRefColor);
00218       <font class="keywordflow">break</font>;
00219     <font class="keywordflow">case</font> MorphCode:
00220       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".morphcode {font-size: smaller; color: %1; font-decoration:none;}"</font>)
00221               .arg(morphsColor);
00222       <font class="keywordflow">break</font>;
00223     <font class="keywordflow">case</font> StrongNumber:
00224       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".strongnumber {font-size: smaller; color: %1; font-decoration:none;}"</font>)
00225               .arg(strongsColor);
00226       <font class="keywordflow">break</font>;
00227     <font class="keywordflow">case</font> Lemma:
00228 <font class="comment">//      text = QString::fromLatin1(".lemma {font-size: smaller; color: %1; font-decoration:none;}")</font>
00229 <font class="comment">//              .arg(lemmaColor);</font>
00230       <font class="keywordflow">break</font>;
00231     <font class="keywordflow">case</font> Footnote:
00232       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".footnote  {font-size: smaller; color: %1; font-style:italic;}"</font>)
00233               .arg(footnotesColor);
00234       <font class="keywordflow">break</font>;
00235     <font class="keywordflow">case</font> FootnotePre:
00236       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".footnotepre {font-size: smaller; color: %1; font-weight: bolder;}"</font>)
00237               .arg(footnotesColor);
00238       <font class="keywordflow">break</font>;
00239     <font class="keywordflow">case</font> Poetry:
00240       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".poetry {font-weight: lighter; alignment: justify;}"</font>);
00241       <font class="keywordflow">break</font>;
00242     <font class="keywordflow">case</font> Quotation:
00243       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".quotation {font-style: italic;}"</font>);
00244       <font class="keywordflow">break</font>;
00245     <font class="keywordflow">case</font> JesusWords:
00246       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".jesuswords {font-style: italic; color: %1;}"</font>)
00247               .arg(jesusWordsColor);
00248       <font class="keywordflow">break</font>;
00249     <font class="keywordflow">case</font> BookTitle:
00250       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".booktitle {font-weight: x-bold; font-size: x-large; color: %1; margin-top:1mm; margin-bottom:1mm;}"</font>)
00251               .arg(textColor);
00252       <font class="keywordflow">break</font>;
00253     <font class="keywordflow">case</font> SectionTitle:
00254       <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::fromLatin1(<font class="stringliteral">".sectiontitle {font-size: larger; font-weight: bold; color: %1;}"</font>)
00255               .arg(textColor);
00256       <font class="keywordflow">break</font>;
00257     <font class="keywordflow">break</font>;
00258   };
00259   <font class="keywordflow">return</font> QString::fromLatin1(<font class="stringliteral">"\n\n%1\n\n"</font>).arg(<a class="code" href="class_c_entry_display.html#a2">text</a>);
00260 }
00261 
00262 <font class="keywordtype">void</font> CEntryDisplay::setDisplayOptions(<font class="keyword">const</font> CSwordBackend::DisplayOptionsBool options) {
00263   m_displayOptions = options;
00264 }
00265 
<a name="l00267"></a><a class="code" href="class_c_entry_display.html#b4">00267</a> <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#b4">CEntryDisplay::htmlReference</a>( <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module, <font class="keyword">const</font> QString&amp; keyName, <font class="keyword">const</font> QString linkText, <font class="keyword">const</font> QString&amp; anchorText ) {
00268   <font class="keywordflow">if</font> (linkText.isEmpty())
00269     <font class="keywordflow">return</font> QString::fromLatin1(<font class="stringliteral">"&lt;A NAME=\"%1\"&gt;&lt;/A&gt;"</font>).arg(anchorText);
00270   <font class="keywordflow">else</font>
00271     <font class="keywordflow">return</font> QString::fromLatin1(<font class="stringliteral">"&lt;A NAME=\"%1\" HREF=\"%2\"&gt;%3&lt;/A&gt;"</font>)
00272       .arg(anchorText)
00273       .arg(<a class="code" href="class_c_reference_manager.html#d1">CReferenceManager::encodeHyperlink</a>(module-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>(), keyName, <a class="code" href="class_c_reference_manager.html#d6">CReferenceManager::typeFromModule</a>(module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) ))
00274       .arg(linkText);
00275 }
00276 
00277 <font class="comment">/* ----------------------- new class: CChapterDisplay ------------------- */</font>
00278 
00280 <font class="keyword">const</font> QString CChapterDisplay::text( QPtrList &lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName, CSwordBackend::DisplayOptionsBool displayOptions, CSwordBackend::FilterOptionsBool filterOptions ) {  
00281   <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a7">setDisplayOptions</a>( displayOptions );
00282   <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>( filterOptions );
00283 
00284 
00285   QString <a class="code" href="class_c_entry_display.html#a2">text</a> = QString::null;
00286 
00287   <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> key(0);
00288 <font class="comment">//  key.key(keyName);</font>
00289   key = keyName;
00290 
00291   <font class="keyword">const</font> <font class="keywordtype">int</font> currentTestament = key.Testament(); 
00292     <font class="keyword">const</font> <font class="keywordtype">int</font> currentBook = key.Book();
00293     <font class="keyword">const</font> <font class="keywordtype">int</font> currentChapter = key.Chapter();
00294     
00295  <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = modules.first();
00296   <font class="keywordtype">bool</font> ok = <font class="keyword">true</font>;
00297     <font class="keywordflow">for</font> (key.Verse(1); key.Testament() == currentTestament &amp;&amp; key.Book() == currentBook &amp;&amp; key.Chapter() == currentChapter &amp;&amp; ok &amp;&amp; !module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Error(); ok = key.<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseVerse)) {
00298     <a class="code" href="class_c_entry_display.html#a2">text</a> += <a class="code" href="class_c_entry_display.html#b2">entryText</a>(modules, key.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>(), keyName);
00299     }
00300   <font class="keywordflow">return</font> <a class="code" href="class_c_entry_display.html#b3">finishText</a>(<a class="code" href="class_c_entry_display.html#a2">text</a>, modules, QString::null);
00301 }
00302 
00304 <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#b2">CChapterDisplay::entryText</a>( QPtrList&lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName, <font class="keyword">const</font> QString&amp; chosenKey ){
00305   <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> key(modules.first());
00306   QString renderedText = QString::null;
00307 
00308     <font class="comment">//Only insert the table stuff if we are displaying parallel.</font>
00309   <font class="comment">//Otherwise, strip out he table stuff -&gt; the whole chapter will be rendered in one cell!</font>
00310 
00311   <font class="keywordflow">if</font> (modules.count() &gt; 1){
00312         renderedText = QString::fromLatin1(<font class="stringliteral">"&lt;TR valign=\"top\"&gt;"</font>);
00313     }
00314 
00315   <font class="keywordflow">for</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = modules.first(); m; m = modules.next()) {
00316     key.<a class="code" href="class_c_sword_verse_key.html#a10">module</a>(m);
00317     key.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>(keyName);
00318     <font class="keyword">const</font> <font class="keywordtype">bool</font> isRTL = (m-&gt;<a class="code" href="class_c_sword_module_info.html#a22">textDirection</a>() == CSwordModuleInfo::RightToLeft);
00319 
00320     <font class="keyword">const</font> QString tdStyle = QString::fromLatin1(<font class="stringliteral">"style=\"border-bottom:thin solid black; %1 %2\""</font>)
00321       .arg((modules.at()+1 &lt; modules.count()) ? QString::fromLatin1(<font class="stringliteral">"padding-right: 2mm; border-right:thin solid black;"</font>) : QString::null)
00322       .arg((modules.at()&gt;0 &amp;&amp; modules.at()+1 &lt;= modules.count()) ? QString::fromLatin1("padding-left:2mm;<font class="stringliteral">") : QString::null);</font>
00323 <font class="stringliteral"></font>
00324 <font class="stringliteral">    const QString entry =</font>
00325 <font class="stringliteral">      QString::fromLatin1("</font>&lt;SPAN %1&gt;&lt;SPAN <font class="keyword">class</font>=\<font class="stringliteral">"%2\" dir=\"%3\"&gt;&lt;SPAN&gt;%4&lt;/SPAN&gt;%5%6&lt;/SPAN&gt;&lt;/SPAN&gt;"</font>)
00326         .arg((key.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>() == chosenKey) ? QString::fromLatin1(<font class="stringliteral">"class=\"highlighted\""</font>) : QString::null)
00327         .arg(m-&gt;isUnicode() ? QString::fromLatin1("unicodetext") : QString::fromLatin1("standardtext"))
00328         .arg(isRTL ? QString::fromLatin1("rtl") : QString::fromLatin1("ltr"))
00329         .arg(m_displayOptions.verseNumbers ? QString::fromLatin1("&lt;SUP&gt;%1&lt;/SUP&gt;").arg(<a class="code" href="class_c_entry_display.html#b4">htmlReference</a>(m, key.key(), QString::number(key.Verse()), key.key())) : <a class="code" href="class_c_entry_display.html#b4">htmlReference</a>(m, QString::null, QString::null, key.key()) )
00330         .arg(key.renderedText())
00331         .arg((modules.count() == 1 &amp;&amp; m_displayOptions.lineBreaks) ? QString::fromLatin1("&lt;BR&gt;") : QString::fromLatin1(" "));
00332 
00333     <font class="keywordflow">if</font> (modules.count() == 1)
00334             renderedText += entry;
00335     <font class="keywordflow">else</font>
00336         renderedText += QString::fromLatin1(<font class="stringliteral">"&lt;TD class=\"background1\" %1 dir=\"%2\" valign=\"top\"&gt;%3&lt;/TD&gt;"</font>)
00337                         .arg(tdStyle)
00338                         .arg(isRTL ? QString::fromLatin1(<font class="stringliteral">"rtl"</font>) : QString::fromLatin1("ltr"))
00339                                               .arg(entry);
00340   }
00341 
00342   <font class="keywordflow">if</font> (modules.count() &gt; 1){
00343         renderedText += QString::fromLatin1(<font class="stringliteral">"&lt;/TR&gt;"</font>);
00344     }
00345 
00346   <font class="keywordflow">return</font> renderedText;
00347 }
00348 
00349 <font class="keyword">const</font> QString CChapterDisplay::finishText( <font class="keyword">const</font> QString text, QPtrList &lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName) {
00350   <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module = modules.first();
00351   <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordKey&gt;</a> key( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(modules.first()) );
00352   key-&gt;key(keyName);
00353 
00354   QString css = <font class="stringliteral">"table.maintable {width:100%;} td.tableheading {border-bottom: thin solid black;}"</font>;
00355   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> t = MinType; t &lt;= MaxType; ++t) {
00356     css += <font class="stringliteral">"\t"</font> + cssString( static_cast&lt;CEntryDisplay::StyleType&gt;(t) ) + <font class="stringliteral">"\n\n"</font>;
00357   }
00358 
00359   <font class="keyword">const</font> <font class="keywordtype">int</font> columnWidth = (int)((float)100 / (float)modules.count());
00360 
00361   QString pageStart = QString::fromLatin1(<font class="stringliteral">"&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;&lt;HTML&gt;&lt;HEAD&gt;&lt;STYLE type=\"text/css\"&gt;%1&lt;/STYLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;TABLE cellspacing=\"0\" class=\"maintable\" %2&gt;&lt;TR&gt;"</font>)
00362     .arg(css)
00363     .arg(((modules.count() == 1) &amp;&amp; (modules.first()-&gt;textDirection() == CSwordModuleInfo::RightToLeft)) ? <font class="stringliteral">"dir=\"rtl\""</font> : <font class="stringliteral">""</font>);
00364 
00365   <font class="keywordflow">for</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = modules.first(); m; m = modules.next()) {
00366     key-&gt;module(m);
00367     <font class="keyword">const</font> QString newKeyName = key-&gt;key();
00368 
00369     pageStart += QString::fromLatin1(<font class="stringliteral">"&lt;TD class=\"tableheading\" width=\"%1%\"&gt;&lt;CENTER&gt;&lt;B&gt;%2&lt;/B&gt; %3&lt;/CENTER&gt;&lt;/TD&gt;"</font>)
00370       .arg(columnWidth)
00371       .arg(m-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>())
00372       .arg(!keyName.isEmpty() ? <a class="code" href="class_c_entry_display.html#b4">htmlReference</a>(m, newKeyName, newKeyName, newKeyName) : QString::null);
00373   }
00374   pageStart += QString::fromLatin1(<font class="stringliteral">"&lt;/TR&gt;"</font>);
00375 
00376   QString pageEnd = QString::fromLatin1(<font class="stringliteral">"&lt;/TABLE&gt;&lt;/BODY&gt;&lt;/HTML&gt;"</font>);
00377 
00378     <font class="keywordflow">if</font> (modules.count() == 1) <font class="comment">// render everything into one cell. entryText leaves out the table tags.</font>
00379         <font class="keywordflow">return</font> pageStart  + QString::fromLocal8Bit(<font class="stringliteral">"&lt;TR&gt;&lt;TD&gt;"</font>)
00380                       + <a class="code" href="class_c_entry_display.html#a2">text</a>
00381                                       + QString::fromLocal8Bit(<font class="stringliteral">"&lt;/TD&gt;&lt;/TR&gt;"</font>) + pageEnd;
00382   <font class="keywordflow">else</font>  <font class="comment">// use many cells. entryText inserts the necessary table tags.</font>
00383         <font class="keywordflow">return</font> pageStart + <a class="code" href="class_c_entry_display.html#a2">text</a> + pageEnd;
00384 }
00385 
00386 <font class="comment">/* ----------------------- new class: CBookDisplay ------------------- */</font>
00387 
00389 <font class="keyword">const</font> QString CBookDisplay::text( QPtrList &lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName, CSwordBackend::DisplayOptionsBool displayOptions, CSwordBackend::FilterOptionsBool filterOptions ) {
00390   qWarning(<font class="stringliteral">"CBookDisplay::text: %s"</font>, keyName.latin1());
00391 
00392   <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a7">setDisplayOptions</a>( displayOptions );
00393   <a class="code" href="class_c_pointers.html#d1">backend</a>()-&gt;<a class="code" href="class_c_sword_backend.html#a6">setFilterOptions</a>( filterOptions );
00394 
00395   QString <a class="code" href="class_c_entry_display.html#a2">text</a>;
00396     <a class="code" href="class_c_sword_book_module_info.html">CSwordBookModuleInfo</a>* book = dynamic_cast&lt;CSwordBookModuleInfo*&gt;(modules.first());
00397   <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordTreeKey&gt;</a> key( dynamic_cast&lt;CSwordTreeKey*&gt;( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(book) ) );
00398     key-&gt;key(keyName);
00399 
00400     <font class="keywordtype">int</font> displayLevel = book-&gt;<a class="code" href="class_c_sword_module_info.html#a0">config</a>( CSwordModuleInfo::DisplayLevel ).toInt();
00401   <font class="keywordflow">if</font> (displayLevel &lt;= 1) { <font class="comment">//don't display entries together</font>
00402     <font class="keywordflow">return</font> <a class="code" href="class_c_entry_display.html#b3">finishText</a>( <a class="code" href="class_c_entry_display.html#b2">entryText</a>(modules, keyName), modules, keyName );
00403   }
00404 
00405   --displayLevel; <font class="comment">//better handling if 1 is to concat the last level</font>
00406     <font class="keywordtype">int</font> moved = 0;
00407     
00408     <font class="keywordflow">while</font> (key-&gt;firstChild())
00409         ++moved; <font class="comment">//down</font>
00410 
00411     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 1; i &lt; displayLevel; i++) {
00412         <font class="keywordflow">if</font> (!key-&gt;parent() || key-&gt;key() == <font class="stringliteral">"/"</font> || key-&gt;key().isEmpty()) { <font class="comment">//first entry</font>
00413             <font class="keywordflow">break</font>;      
00414         }
00415         --moved; <font class="comment">//up</font>
00416     };
00417     
00418     <font class="keywordflow">if</font> (moved &lt;= 1) { <font class="comment">//display entries together</font>
00419         <font class="keywordflow">while</font>(key-&gt;previousSibling()); <font class="comment">//first entry of it's parent     </font>
00420         m_text = QString::null;
00421     printTree(*key, modules);   
00422     }
00423     <font class="keywordflow">else</font> { <font class="comment">//do not display entries together</font>
00424     <font class="keywordflow">return</font> <a class="code" href="class_c_entry_display.html#b3">finishText</a>( <a class="code" href="class_c_entry_display.html#b2">entryText</a>(modules, keyName), modules, keyName );
00425     }   
00426     key-&gt;key(keyName);
00427   <font class="keywordflow">return</font> <a class="code" href="class_c_entry_display.html#b3">finishText</a>(m_text, modules, keyName);
00428 }
00429 
00431 <font class="comment">//const QString CBookDisplay::previewText( CSwordModuleInfo*  module, const QString&amp; key,const QString&amp; headerText, CSwordBackend::DisplayOptionsBool displayOptions, CSwordBackend::FilterOptionsBool filterOptions){</font>
00432 <font class="comment">//  return QString::null;</font>
00433 <font class="comment">//}</font>
00434 
00436 <font class="keyword">const</font> QString <a class="code" href="class_c_entry_display.html#b2">CBookDisplay::entryText</a>( QPtrList&lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName, <font class="keyword">const</font> <font class="keywordtype">int</font> level){
00437     <a class="code" href="class_c_sword_book_module_info.html">CSwordBookModuleInfo</a>* book = dynamic_cast&lt;CSwordBookModuleInfo*&gt;(modules.first());
00438   <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordTreeKey&gt;</a> key( dynamic_cast&lt;CSwordTreeKey*&gt;( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(book) ) );
00439 
00440   key-&gt;key(keyName);
00441 
00442   <font class="keywordflow">return</font> QString::fromLatin1(<font class="stringliteral">"&lt;TR&gt;&lt;TD STYLE=\"padding-left: %1px;\"&gt;&lt;SUP&gt;%2&lt;/SUP&gt; %3&lt;/TD&gt;&lt;/TR&gt;"</font>)
00443     .arg(level*30)
00444     .arg(<a class="code" href="class_c_entry_display.html#b4">htmlReference</a>(book, keyName, key-&gt;getLocalName(), !key-&gt;key().isEmpty() ? key-&gt;key() : "/" ))
00445     .arg(key-&gt;renderedText());
00446 }
00447 
00448 <font class="keywordtype">void</font> CBookDisplay::printTree(<a class="code" href="class_c_sword_tree_key.html">CSwordTreeKey</a> treeKey, QPtrList&lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> <font class="keywordtype">int</font> levelPos){
00449   m_text += <a class="code" href="class_c_entry_display.html#b2">entryText</a>(modules, treeKey.getFullName(), levelPos);
00450 
00451   <font class="keywordflow">if</font> (treeKey.hasChildren()) {
00452     treeKey.firstChild();
00453     printTree(treeKey, modules, levelPos+1);
00454     treeKey.parent();
00455   }
00456   <font class="keywordflow">if</font> (treeKey.nextSibling())
00457         printTree(treeKey, modules, levelPos);
00458 }
00459 
00460 <font class="keyword">const</font> QString CBookDisplay::finishText( <font class="keyword">const</font> QString text, QPtrList &lt;CSwordModuleInfo&gt; modules, <font class="keyword">const</font> QString&amp; keyName){
00461     <a class="code" href="class_c_sword_book_module_info.html">CSwordBookModuleInfo</a>* book = dynamic_cast&lt;CSwordBookModuleInfo*&gt;(modules.first());
00462   <a class="code" href="structutil_1_1scoped__ptr.html">util::scoped_ptr&lt;CSwordTreeKey&gt;</a> key( dynamic_cast&lt;CSwordTreeKey*&gt;( <a class="code" href="class_c_sword_key.html#d0">CSwordKey::createInstance</a>(book) ) );
00463   key-&gt;key(keyName);
00464 
00465   QString css = <font class="stringliteral">"table.maintable {width:100%;} td.tableheading {border-bottom: thin solid black;}"</font>;
00466   <font class="keywordflow">for</font> (<font class="keywordtype">int</font> t = MinType; t &lt;= MaxType; ++t) {
00467     css += <font class="stringliteral">"\t"</font> + cssString( static_cast&lt;CEntryDisplay::StyleType&gt;(t) ) + <font class="stringliteral">"\n\n"</font>;
00468   }
00469 
00470   <font class="keyword">const</font> <font class="keywordtype">int</font> columnWidth = (int)((float)100 / (float)modules.count());
00471 
00472   QString pageStart = QString::fromLatin1(<font class="stringliteral">"&lt;HTML&gt;&lt;HEAD&gt;&lt;STYLE type=\"text/css\"&gt;%1&lt;/STYLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;TABLE cellspacing=\"0\" class=\"maintable\"&gt;&lt;TR&gt;"</font>)
00473     .arg(css);
00474 
00475   <font class="keywordflow">for</font> (<a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* m = modules.first(); m; m = modules.next()) {
00476     key-&gt;module(m);
00477     <font class="keyword">const</font> QString newKeyName = !key-&gt;key().isEmpty() ? key-&gt;key() : "/";
00478     pageStart += QString::fromLatin1(<font class="stringliteral">"&lt;TD class=\"tableheading\" width=\"%1%\"&gt;&lt;CENTER&gt;&lt;B&gt;%2&lt;/B&gt; %3&lt;/CENTER&gt;&lt;/TD&gt;"</font>)
00479       .arg(columnWidth)
00480       .arg(m-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>())
00481       .arg(!newKeyName.isEmpty() ? QString::fromLatin1(<font class="stringliteral">"(%1)"</font>).arg(<a class="code" href="class_c_entry_display.html#b4">htmlReference</a>(m, newKeyName, newKeyName, QString::null)) : QString::null);
00482   }
00483   pageStart += QString::fromLatin1(<font class="stringliteral">"&lt;/TR&gt;"</font>);
00484 
00485   <font class="keyword">const</font> QString pageEnd = QString::fromLatin1(<font class="stringliteral">"&lt;/TABLE&gt;&lt;/BODY&gt;&lt;/HTML&gt;"</font>);
00486 
00487   <font class="keywordflow">return</font> pageStart + <a class="code" href="class_c_entry_display.html#a2">text</a> + pageEnd;
00488 }
</pre></div><hr><address align="right"><small>Generated on Tue Jul 16 13:53:08 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
