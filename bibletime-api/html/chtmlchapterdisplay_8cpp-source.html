<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>chtmlchapterdisplay.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>chtmlchapterdisplay.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          chtmlchapterdisplay.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Thu Oct 12 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//BibleTiem includes</font>
00019 <font class="preprocessor">#include "chtmlchapterdisplay.h"</font>
00020 <font class="preprocessor">#include "cswordmoduleinfo.h"</font>
00021 <font class="preprocessor">#include "cswordversekey.h"</font>
00022 <font class="preprocessor">#include "../frontend/ctoolclass.h"</font>
00023 <font class="preprocessor">#include "creferencemanager.h"</font>
00024 
00025 <font class="comment">//Qt includes</font>
00026 <font class="preprocessor">#include &lt;qfont.h&gt;</font>
00027 
00028 <font class="comment">//Sword includes</font>
00029 <font class="preprocessor">#include &lt;versekey.h&gt;</font>
00030 
<a name="l00032"></a><a class="code" href="class_c_h_t_m_l_chapter_display.html#a0">00032</a> <font class="keywordtype">char</font> <a class="code" href="class_c_h_t_m_l_chapter_display.html#a0">CHTMLChapterDisplay::Display</a>( <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module ){
00033     <font class="keywordflow">if</font> (!module) {
00034         m_htmlText = QString::null;
00035         <font class="keywordflow">return</font> -1; <font class="comment">//error</font>
00036     }
00037     
00038     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> key(0);
00039     key.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>( module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;KeyText() ); 
00040 <font class="comment">//  key.setLocale(module-&gt;module()-&gt;Lang());</font>
00041     <font class="keyword">const</font> <font class="keywordtype">int</font> currentTestament = key.Testament();   
00042     <font class="keyword">const</font> <font class="keywordtype">int</font> currentBook = key.Book();
00043     <font class="keyword">const</font> <font class="keywordtype">int</font> currentChapter = key.Chapter();
00044     <font class="keyword">const</font> <font class="keywordtype">int</font> currentVerse = key.Verse();   
00045     
00046     key.<a class="code" href="class_c_sword_verse_key.html#a10">module</a>(module); 
00047     <font class="keywordtype">int</font> verse = 0;
00048     
00049     <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>()) {
00050         m_htmlHeader = <font class="stringliteral">"&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;&lt;/head&gt;"</font>;
00051     }
00052     m_htmlText = m_htmlHeader + QString::fromLatin1(<font class="stringliteral">"&lt;body&gt;"</font>);
00053     
00054     <font class="comment">//reload font settings</font>
00055     updateSettings();
00056 
00057     m_htmlText.append(QString::fromLatin1(<font class="stringliteral">"&lt;font face=\"%1\" size=\"%2\" color=\"%3\"&gt;"</font>)
00058         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>() ? m_unicodeFontName : m_standardFontName)
00059         .arg(module-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>() ? m_unicodeFontSize : m_standardFontSize)
00060         .arg(m_standardFontColorName)
00061     );
00062 
00063     <font class="keywordflow">for</font> (key.Verse(1); key.Testament() == currentTestament &amp;&amp; key.Book() == currentBook &amp;&amp; key.Chapter() == currentChapter &amp;&amp; !module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Error(); key.<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseVerse)) {
00064         verse = key.Verse();
00065         <font class="keywordflow">if</font> (m_displayOptionsBool.verseNumbers) {
00066             m_htmlText.append( QString::fromLatin1(<font class="stringliteral">"&lt;font color=\"%1\"&gt;&lt;a name=\"%2\" href=\"%3\"&gt;&lt;b&gt;%4&lt;/b&gt;&lt;/a&gt;&lt;/font&gt; "</font>)
00067                 .arg(m_swordRefColorName)
00068                 .arg(verse)
00069                 .arg(<a class="code" href="class_c_reference_manager.html#d1">CReferenceManager::encodeHyperlink</a>( module-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>(), key.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(), <a class="code" href="class_c_reference_manager.html#d6">CReferenceManager::typeFromModule</a>(module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) ))
00070                 .arg(verse)
00071             );
00072         }
00073         <font class="keywordflow">if</font> (verse == currentVerse)
00074           m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;font color=\""</font>) + m_highlightedVerseColorName + QString::fromLatin1(<font class="stringliteral">"\"&gt;"</font>);
00075         m_htmlText.append(key.<a class="code" href="class_c_sword_key.html#a5">renderedText</a>());
00076         <font class="keywordflow">if</font> (verse == currentVerse)
00077           m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;/font&gt;"</font>);
00078         <font class="keywordflow">if</font> (m_displayOptionsBool.lineBreaks)
00079             m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;br&gt;\n"</font>);
00080         <font class="keywordflow">else</font>
00081             m_htmlText += QString::fromLatin1(<font class="stringliteral">" \n"</font>);
00082     }
00083     m_htmlText.append(<font class="stringliteral">"&lt;/font&gt;"</font>);
00084     m_htmlText.append(m_htmlBody);  
00085 
00086     <font class="keywordflow">return</font> 1;   <font class="comment">//no error  </font>
00087 }
00088 
<a name="l00090"></a><a class="code" href="class_c_h_t_m_l_chapter_display.html#a1">00090</a> <font class="keywordtype">char</font> <a class="code" href="class_c_h_t_m_l_chapter_display.html#a0">CHTMLChapterDisplay::Display</a>( QList&lt;CSwordModuleInfo&gt;* moduleList){    
00091 <font class="preprocessor">#warning make table colors configurable</font>
00092 <font class="preprocessor"></font><font class="comment">//  qDebug("CHTMLChapterDisplay::Display( QList&lt;CSwordModuleInfo&gt;* moduleList)");</font>
00093     <font class="keywordflow">if</font> (!moduleList || (moduleList &amp;&amp; !moduleList-&gt;count()) ) {
00094         m_htmlText = QString::null;
00095         <font class="keywordflow">return</font> 0;
00096     }
00097     <font class="comment">//reload font settings</font>
00098     updateSettings();
00099 
00100     SWModule* module = moduleList-&gt;first()-&gt;module();       
00101         
00102     VerseKey* vk = (VerseKey*)((SWKey*)(*module));
00103     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> key(0);
00104     key.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*vk);
00105 <font class="comment">//  key.setLocale(module-&gt;Lang());  </font>
00106 
00107     <font class="keyword">const</font> <font class="keywordtype">int</font> currentTestament = key.Testament();   
00108     <font class="keyword">const</font> <font class="keywordtype">int</font> currentBook = key.Book();
00109     <font class="keyword">const</font> <font class="keywordtype">int</font> currentChapter = key.Chapter();
00110     <font class="keyword">const</font> <font class="keywordtype">int</font> chosenVerse = key.Verse();
00111     <font class="keyword">const</font> <font class="keywordtype">int</font> width = (int)((double)97/(double)moduleList-&gt;count()); <font class="comment">//width in per cent!!</font>
00112     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a> *d = 0;
00113             
00114     m_htmlText = QString::fromLatin1(<font class="stringliteral">"&lt;qt text=\"%1\"&gt;"</font>).arg(m_standardFontColorName); <font class="comment">//for compatibility with Qt's rendering  </font>
00115     m_htmlText += m_htmlHeader + QString::fromLatin1(<font class="stringliteral">"&lt;body text=\"%1\"&gt;"</font>).arg(m_standardFontColorName);
00116 
00117 
00118     m_htmlText +=
00119         QString::fromLatin1(<font class="stringliteral">"&lt;table cellpadding=\"2\" cellspacing=\"0\"&gt;&lt;td bgcolor=\"#f1f1f1\"&gt;&lt;/td&gt;"</font>);    
00120     SWModule *m = (d = moduleList-&gt;first()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;
00121 
00122     <font class="keywordflow">while</font> (m) {
00123     <font class="keywordflow">if</font> (m)
00124             m_htmlText +=
00125                 QString::fromLatin1(<font class="stringliteral">"&lt;td width=\"%1%\" bgcolor=\"#f1f1f1\"&gt;&lt;b&gt;%1&lt;/b&gt;&lt;/td&gt;"</font>).arg(width).arg(d-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>());
00126         m = (d=moduleList-&gt;next()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;           
00127     }
00128     m_htmlText.append(<font class="stringliteral">"&lt;/tr&gt;"</font>);
00129         
00130     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> current(0);
00131 <font class="comment">//  current.setLocale(module-&gt;Lang());</font>
00132     
00133     QString rowText = QString::null;
00134     <font class="keywordtype">int</font> currentVerse = 0;
00135     <font class="keywordflow">for</font> (key.Verse(1); key.Testament() == currentTestament &amp;&amp; key.Book() == currentBook &amp;&amp; key.Chapter() == currentChapter &amp;&amp; !module-&gt;Error(); key.<a class="code" href="class_c_sword_verse_key.html#a7">next</a>(CSwordVerseKey::UseVerse)) {
00136         <font class="keyword">const</font> QString currentKey = key.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>();
00137         currentVerse = key.Verse();
00138         m = (d = moduleList-&gt;first()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;
00139         
00140         rowText = QString(<font class="stringliteral">"&lt;tr&gt;&lt;td bgcolor=\"#f1f1f1\"&gt;&lt;b&gt;&lt;font color=\"%1\"&gt;&lt;a name=\"%2\" href=\"%3\"&gt;%4&lt;/a&gt;&lt;/b&gt;&lt;/td&gt;\n"</font>)
00141             .arg(m_swordRefColorName)
00142             .arg(currentVerse)
00143             .arg(<a class="code" href="class_c_reference_manager.html#d1">CReferenceManager::encodeHyperlink</a>( d-&gt;<a class="code" href="class_c_sword_module_info.html#a17">name</a>(), currentKey, <a class="code" href="class_c_reference_manager.html#d6">CReferenceManager::typeFromModule</a>(d-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) ))
00144             .arg(currentVerse);
00145         
00146         current.<a class="code" href="class_c_sword_verse_key.html#a5">key</a>(currentKey);                    
00147         <font class="keywordflow">while</font> (m) {
00148             current.<a class="code" href="class_c_sword_verse_key.html#a10">module</a>(d);
00149             rowText += QString(<font class="stringliteral">"&lt;td width=\"%1%\" bgcolor=\"%2\"&gt;"</font>)
00150                 .arg(width).arg(currentVerse % 2 ? <font class="stringliteral">"white"</font> : <font class="stringliteral">"#f1f1f1"</font>);
00151             <font class="keywordflow">if</font> (d-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>())
00152                 rowText += QString(<font class="stringliteral">"&lt;font face=\"%1\" size=\"%2\"&gt;"</font>)
00153                     .arg(m_unicodeFontName).arg(m_unicodeFontSize);
00154             <font class="keywordflow">if</font> (currentVerse == chosenVerse)
00155                 rowText += QString(<font class="stringliteral">"&lt;font color=\"%1\"&gt;"</font>)
00156                     .arg(m_highlightedVerseColorName);
00157 
00158             rowText += current.<a class="code" href="class_c_sword_key.html#a5">renderedText</a>();
00159 
00160             <font class="keywordflow">if</font> (currentVerse == chosenVerse)
00161                 rowText += QString::fromLatin1(<font class="stringliteral">"&lt;/font&gt;"</font>);
00162             <font class="keywordflow">if</font> (d-&gt;<a class="code" href="class_c_sword_module_info.html#a18">isUnicode</a>())
00163                 rowText += QString::fromLatin1(<font class="stringliteral">"&lt;/font"</font>);
00164 
00165             m = (d = moduleList-&gt;next()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;
00166         }
00167         m_htmlText.append(rowText + QString::fromLatin1(<font class="stringliteral">"&lt;/tr&gt;\n"</font>));
00168     }
00169     m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;/font&gt;&lt;/table&gt;"</font>);   
00170     m_htmlText += m_htmlBody + QString::fromLatin1(<font class="stringliteral">"&lt;/qt&gt;"</font>);
00171     
00172     <font class="comment">//clean up</font>
00173     <font class="keywordflow">return</font> 1;       
00174 }
</pre></div><hr><address><small>Generated on Sun Mar 10 22:12:46 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
