<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>chtmlchapterdisplay.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>chtmlchapterdisplay.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/***************************************************************************</font>
00002 <font class="comment">                          chtmlchapterdisplay.cpp  -  description</font>
00003 <font class="comment">                             -------------------</font>
00004 <font class="comment">    begin                : Thu Oct 12 2000</font>
00005 <font class="comment">    copyright            : (C) 2000 by The BibleTime team</font>
00006 <font class="comment">    email                : info@bibletime.de</font>
00007 <font class="comment"> ***************************************************************************/</font>
00008 
00009 <font class="comment">/***************************************************************************</font>
00010 <font class="comment"> *                                                                         *</font>
00011 <font class="comment"> *   This program is free software; you can redistribute it and/or modify  *</font>
00012 <font class="comment"> *   it under the terms of the GNU General Public License as published by  *</font>
00013 <font class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</font>
00014 <font class="comment"> *   (at your option) any later version.                                   *</font>
00015 <font class="comment"> *                                                                         *</font>
00016 <font class="comment"> ***************************************************************************/</font>
00017 
00018 <font class="comment">//BibleTiem includes</font>
00019 <font class="preprocessor">#include "chtmlchapterdisplay.h"</font>
00020 <font class="preprocessor">#include "cswordmoduleinfo.h"</font>
00021 <font class="preprocessor">#include "cswordversekey.h"</font>
00022 <font class="preprocessor">#include "frontend/ctoolclass.h"</font>
00023 <font class="preprocessor">#include "frontend/cbtconfig.h"</font>
00024 <font class="preprocessor">#include "creferencemanager.h"</font>
00025 
00026 <font class="comment">//Qt includes</font>
00027 <font class="preprocessor">#include &lt;qfont.h&gt;</font>
00028 
00029 <font class="comment">//Sword includes</font>
00030 <font class="preprocessor">#include &lt;versekey.h&gt;</font>
00031 
<a name="l00033"></a><a class="code" href="class_c_h_t_m_l_chapter_display.html#a0">00033</a> <font class="keywordtype">char</font> <a class="code" href="class_c_h_t_m_l_chapter_display.html#a0">CHTMLChapterDisplay::Display</a>( <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a>* module ){
00034     <font class="keywordflow">if</font> (!module) {
00035         m_htmlText = QString::null;
00036         <font class="keywordflow">return</font> 0; <font class="comment">//error</font>
00037     }
00038     
00039     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> key(0);
00040     key.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>( module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;KeyText() ); 
00041     <font class="keyword">const</font> <font class="keywordtype">int</font> currentTestament = key.Testament();   
00042     <font class="keyword">const</font> <font class="keywordtype">int</font> currentBook = key.Book();
00043     <font class="keyword">const</font> <font class="keywordtype">int</font> currentChapter = key.Chapter();
00044     <font class="keyword">const</font> <font class="keywordtype">int</font> currentVerse = key.Verse();   
00045     
00046     key.<a class="code" href="class_c_sword_verse_key.html#a9">module</a>(module); 
00047     <font class="keywordtype">int</font> verse = 0;
00048 
00049     <font class="comment">//reload font settings</font>
00050     updateSettings();
00051     
00052   m_htmlHeader = <a class="code" href="class_c_h_t_m_l_entry_display.html#b0">header</a>();
00053   <font class="keywordflow">if</font> (module-&gt;<a class="code" href="class_c_sword_module_info.html#a22">textDirection</a>() == CSwordModuleInfo::RightToLeft)
00054     m_htmlText = m_htmlHeader + QString::fromLatin1(<font class="stringliteral">"\n&lt;body dir=\"rtl\"&gt;\n"</font>);
00055   <font class="keywordflow">else</font>
00056     m_htmlText = m_htmlHeader + QString::fromLatin1(<font class="stringliteral">"\n&lt;body&gt;\n"</font>);
00057     
00058 
00059     <font class="keywordtype">bool</font> ok = <font class="keyword">true</font>;
00060     <font class="keywordflow">for</font> (key.Verse(1); key.Testament() == currentTestament &amp;&amp; key.Book() == currentBook &amp;&amp; key.Chapter() == currentChapter &amp;&amp; ok &amp;&amp; !module-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>()-&gt;Error(); ok = key.<a class="code" href="class_c_sword_verse_key.html#a6">next</a>(CSwordVerseKey::UseVerse)) {
00061         verse = key.Verse();
00062         <font class="keywordflow">if</font> (m_displayOptionsBool.verseNumbers) {
00063             m_htmlText.append( QString::fromLatin1(<font class="stringliteral">"&lt;span id=\"reference\"&gt;&lt;a name=\"%1\" href=\"%2\"&gt;%3&lt;/a&gt;&lt;/span&gt;\n "</font>)
00064 <font class="comment">//              .arg(m_swordRefColorName)</font>
00065                 .arg(verse)
00066                 .arg(<a class="code" href="class_c_reference_manager.html#d1">CReferenceManager::encodeHyperlink</a>( module-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>(), key.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>(), <a class="code" href="class_c_reference_manager.html#d6">CReferenceManager::typeFromModule</a>(module-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) ))
00067                 .arg(verse)
00068             );
00069         }
00070         <font class="keywordflow">if</font> (verse == currentVerse)
00071           m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;span id=\"highlighted\"&gt;\n"</font>);
00072         <font class="keywordflow">else</font>
00073             m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;span&gt;\n"</font>);
00074 
00075 <font class="comment">//      m_htmlText.append(QString::fromLatin1(" &lt;font face=\"%1\" size=\"%2\"&gt;\n")</font>
00076 <font class="comment">//      .arg(module-&gt;isUnicode() ? m_unicodeFontName : m_standardFontName)</font>
00077 <font class="comment">//        .arg(module-&gt;isUnicode() ? m_unicodeFontSize : m_standardFontSize) );</font>
00078     m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;span %1&gt;"</font>).arg( module-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>() ? <font class="stringliteral">"id=\"unicodetext\""</font> : <font class="stringliteral">""</font>  );
00079 
00080         m_htmlText += key.<a class="code" href="class_c_sword_key.html#a5">renderedText</a>();
00081 
00082         m_htmlText += <font class="stringliteral">" &lt;/span&gt;\n"</font>;
00083 
00084 <font class="comment">//      if (verse == currentVerse)</font>
00085           m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;/span&gt;\n"</font>);
00086 
00087         <font class="keywordflow">if</font> (m_displayOptionsBool.lineBreaks)
00088             m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;br&gt;\n"</font>);
00089         <font class="keywordflow">else</font>
00090             m_htmlText += QString::fromLatin1(<font class="stringliteral">"\n"</font>);
00091     }
00092     
00093     m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;/body&gt;&lt;/html&gt;"</font>);
00094     <font class="keywordflow">return</font> 1;   <font class="comment">//no error  </font>
00095 }
00096 
<a name="l00098"></a><a class="code" href="class_c_h_t_m_l_chapter_display.html#a1">00098</a> <font class="keywordtype">char</font> <a class="code" href="class_c_h_t_m_l_chapter_display.html#a0">CHTMLChapterDisplay::Display</a>( QPtrList&lt;CSwordModuleInfo&gt;* moduleList){ 
00099 <font class="preprocessor">#warning make table colors configurable</font>
00100 <font class="preprocessor"></font>    <font class="keywordflow">if</font> (!moduleList || (moduleList &amp;&amp; !moduleList-&gt;count()) ) {
00101         m_htmlText = QString::null;
00102         <font class="keywordflow">return</font> 0;
00103     }
00104     <font class="comment">//reload font settings</font>
00105     updateSettings();
00106 
00107     SWModule* module = moduleList-&gt;first()-&gt;module();
00108         
00109     VerseKey* vk = (VerseKey*)((SWKey*)(*module));
00110     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> key(0);
00111     key.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>((<font class="keyword">const</font> <font class="keywordtype">char</font>*)*vk);
00112 
00113     <font class="keyword">const</font> <font class="keywordtype">int</font> currentTestament = key.Testament();   
00114     <font class="keyword">const</font> <font class="keywordtype">int</font> currentBook = key.Book();
00115     <font class="keyword">const</font> <font class="keywordtype">int</font> currentChapter = key.Chapter();
00116     <font class="keyword">const</font> <font class="keywordtype">int</font> chosenVerse = key.Verse();
00117     <font class="keyword">const</font> <font class="keywordtype">int</font> width = (int)((double)(m_displayOptionsBool.verseNumbers ? 96 : 100)/(double)moduleList-&gt;count()); <font class="comment">//width in per cent!!</font>
00118     
00119     <a class="code" href="class_c_sword_module_info.html">CSwordModuleInfo</a> *d = 0;
00120     SWModule *m = (d = moduleList-&gt;first()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;
00121             
00122     m_htmlHeader = <a class="code" href="class_c_h_t_m_l_entry_display.html#b0">header</a>();
00123   m_htmlText = m_htmlHeader;
00124   <font class="keywordflow">if</font> (m_displayOptionsBool.verseNumbers)
00125     m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;body&gt;&lt;table cellpadding=\"2\" cellspacing=\"0\"&gt;&lt;tr&gt;&lt;td bgcolor=\"#f1f1f1\"&gt;&lt;/td&gt;"</font>);    
00126   <font class="keywordflow">else</font>
00127     m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;body&gt;&lt;table cellpadding=\"2\" cellspacing=\"0\"&gt;&lt;tr&gt;"</font>); 
00128 
00129     m = (d = moduleList-&gt;first()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;        
00130     <font class="keywordflow">while</font> (m) {
00131         m_htmlText.append(QString::fromLatin1(<font class="stringliteral">"&lt;td bgcolor=\"#f1f1f1\" width=\"%1%\"&gt;\</font>
00132 <font class="stringliteral">&lt;font face=\"%2\" size=\"%3\" color=\"%4\"&gt;&lt;b&gt;%5&lt;/b&gt;&lt;/td&gt;"</font>)
00133                 .arg(width)
00134                 .arg(m_standardFontName)
00135                 .arg(m_standardFontSize)
00136                 .arg(m_standardFontColorName)
00137                 .arg(d-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>()));
00138             m = (d=moduleList-&gt;next()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;
00139     }
00140 
00141     <a class="code" href="class_c_sword_verse_key.html">CSwordVerseKey</a> current(0);  
00142     QString rowText = QString::null;
00143     <font class="keywordtype">int</font> currentVerse = 0;
00144 
00145     <font class="keyword">const</font> QString text = QString::fromLatin1(<font class="stringliteral">"&lt;/tr&gt;&lt;tr&gt;&lt;td bgcolor=\"#f1f1f1\"&gt;&lt;b&gt;\</font>
00146 <font class="stringliteral">&lt;font face=\"%1\" size=\"%2\" color=\"%3\"&gt;&lt;a name=\"%4\" href=\"%5\"&gt;%6&lt;/a&gt;&lt;/font&gt;&lt;/b&gt;&lt;/td&gt;\n"</font>);
00147     
00148  <font class="keyword">const</font> QString cell = QString::fromLatin1(<font class="stringliteral">"&lt;td dir=\"%1\" bgcolor=\"%2\" width=\"%3%\"&gt;"</font>);
00149     
00150     <font class="keywordflow">for</font> (key.Verse(1); key.Testament() == currentTestament &amp;&amp; key.Book() == currentBook &amp;&amp; key.Chapter() == currentChapter &amp;&amp; !module-&gt;Error(); key.<a class="code" href="class_c_sword_verse_key.html#a6">next</a>(CSwordVerseKey::UseVerse)) {
00151         <font class="keyword">const</font> QString currentKey = key.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>();
00152         currentVerse = key.Verse();
00153         m = (d = moduleList-&gt;first()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;
00154         <font class="keywordflow">if</font> (m_displayOptionsBool.verseNumbers) {
00155          rowText = text.arg(m_standardFontName)
00156                         .arg(m_standardFontSize)
00157                         .arg(m_swordRefColorName)
00158                         .arg(currentVerse)
00159                         .arg(<a class="code" href="class_c_reference_manager.html#d1">CReferenceManager::encodeHyperlink</a>( d-&gt;<a class="code" href="class_c_sword_module_info.html#o2">name</a>(), currentKey, <a class="code" href="class_c_reference_manager.html#d6">CReferenceManager::typeFromModule</a>(d-&gt;<a class="code" href="class_c_sword_module_info.html#a15">type</a>()) ))
00160                         .arg(currentVerse);
00161     }
00162     <font class="keywordflow">else</font> {
00163        rowText = QString::fromLatin1(<font class="stringliteral">"&lt;/tr&gt;&lt;tr&gt;\n"</font>);
00164     }
00165         
00166         current.<a class="code" href="class_c_sword_verse_key.html#a4">key</a>(currentKey);    
00167         <font class="keywordflow">while</font> (m) {
00168             current.<a class="code" href="class_c_sword_verse_key.html#a9">module</a>(d);
00169       rowText += cell.arg(d-&gt;<a class="code" href="class_c_sword_module_info.html#a22">textDirection</a>() == CSwordModuleInfo::RightToLeft ? QString::fromLatin1(<font class="stringliteral">"rtl"</font>) : QString::fromLatin1(<font class="stringliteral">"ltor"</font>)  )
00170                      .arg(currentVerse % 2 ? <font class="stringliteral">"white"</font> : <font class="stringliteral">"#f1f1f1"</font>)
00171                      .arg(width);
00172 
00173             <font class="keywordflow">if</font> (d-&gt;<a class="code" href="class_c_sword_module_info.html#o3">isUnicode</a>())
00174                 rowText += QString::fromLatin1(<font class="stringliteral">"&lt;font face=\"%1\" size=\"%2\" color=\"%3\"&gt;"</font>)
00175                         .arg(m_unicodeFontName)
00176                         .arg(m_unicodeFontSize)
00177                         .arg(currentVerse == chosenVerse ? m_highlightedVerseColorName : m_standardFontColorName);
00178             <font class="keywordflow">else</font>
00179                 rowText += QString::fromLatin1(<font class="stringliteral">"&lt;font face=\"%1\" size=\"%2\" color=\"%3\"&gt;"</font>)
00180                         .arg(m_standardFontName)
00181                         .arg(m_standardFontSize)
00182                         .arg(currentVerse == chosenVerse ? m_highlightedVerseColorName : m_standardFontColorName);
00183 
00184             rowText += current.<a class="code" href="class_c_sword_key.html#a5">renderedText</a>() + QString::fromLatin1(<font class="stringliteral">"&lt;/font&gt;"</font>);
00185             m = (d = moduleList-&gt;next()) ? d-&gt;<a class="code" href="class_c_sword_module_info.html#a5">module</a>() : 0;
00186         }
00187         m_htmlText += rowText + QString::fromLatin1(<font class="stringliteral">"&lt;/tr&gt;\n"</font>);
00188     }
00189     m_htmlText += QString::fromLatin1(<font class="stringliteral">"&lt;/font&gt;&lt;/table&gt;&lt;/font&gt;&lt;/body&gt;&lt;/html&gt;"</font>);
00190     
00191     <font class="comment">//clean up</font>
00192     <font class="keywordflow">return</font> 1;       
00193 }
00194 
</pre></div><hr><address align="right"><small>Generated on Sun May 12 20:27:12 2002 for BibleTime by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
